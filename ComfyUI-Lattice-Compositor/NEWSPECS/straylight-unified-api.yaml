openapi: 3.1.0
info:
  title: Straylight Unified API
  version: 1.0.0
  license:
    name: Proprietary
    url: https://straylight.cx/legal/license
  description: |
    # Straylight CMO Platform - Unified Agent API

    Multi-agent orchestration for brand intelligence, content generation,
    and marketing automation. Postgres-backed, Fly.io-scaled, Weyl-powered.

    ## Architecture

    ```
    MAESTRO (Orchestrator)
         │
         ├─ CMO Domain (Content, Campaigns, Analytics, Publishing)
         ├─ Compositor Domain (Render, Effects, Animation, Audio)
         └─ Vector Domain (Intelligence, Partnerships)
    ```

    ## Authentication

    All endpoints require Bearer token authentication.

    ```bash
    curl -H "Authorization: Bearer $TOKEN" https://api.straylight.cx/...
    ```

    ## Agent Invocation Pattern

    1. **MAESTRO predicts** agents from partial input (as user types)
    2. **Agent Registry** resolves capabilities
    3. **Domain Agent** executes the task
    4. **Brand Guardian** verifies output
    5. **Response** returned with verification status

servers:
  - url: https://api.straylight.cx
    description: Production API
  - url: https://api.staging.straylight.cx
    description: Staging API

security:
  - bearer: []

tags:
  # Orchestration
  - name: maestro
    description: MAESTRO predictive orchestrator - routes intents to agents
  - name: agents
    description: Agent registry - capabilities, health, invocation
  - name: modules
    description: UI module registry - Bento grid modules, lifecycle
  - name: workflows
    description: Multi-agent workflow orchestration
  - name: events
    description: Event sourcing and replay
  - name: snapshots
    description: Event-sourced state snapshots

  # CMO Domain
  - name: cmo.content
    description: Content generation and management
  - name: cmo.campaigns
    description: Campaign planning and execution
  - name: cmo.analytics
    description: Performance metrics and reporting
  - name: cmo.publishing
    description: Social media publishing and scheduling
  - name: cmo.brand
    description: Brand intelligence and compliance
  - name: cmo.trends
    description: Trend research and competitive intelligence
  - name: cmo.abtests
    description: A/B testing and experimentation
  - name: cmo.calendar
    description: Content calendar and editorial planning
  - name: cmo.audiences
    description: Audience segments and targeting
  - name: cmo.templates
    description: Content and brief templates
  - name: cmo.approvals
    description: Content approval workflows
  - name: cmo.ideas
    description: Content ideation pipeline
  - name: cmo.pillars
    description: Content pillars and themes
  - name: cmo.reports
    description: Report generation and export
  - name: cmo.hashtags
    description: Hashtag research and optimization

  # Compositor Domain
  - name: compositor.render
    description: AI-powered video/image generation (Weyl backend)
  - name: compositor.assets
    description: Asset management and storage
  - name: compositor.queue
    description: Render queue management
  - name: compositor.workers
    description: Render worker pool
  - name: compositor.loras
    description: LoRA model management and training
  - name: compositor.cache
    description: Render cache management
  - name: compositor.transcode
    description: Video transcoding

  # Brand Intelligence
  - name: discovery
    description: Brand discovery sessions and extraction
  - name: ingestion
    description: Brand data ingestion pipeline
  - name: graph
    description: Knowledge graph queries

  # Voice
  - name: voice
    description: Voice interface - STT/TTS for conversational UI

  # UI System
  - name: ui.layouts
    description: Bento grid layouts
  - name: ui.themes
    description: Theme and style management
  - name: ui.animations
    description: Animation presets

  # Infrastructure
  - name: infrastructure
    description: Fly.io machines, volumes, scaling
  - name: health
    description: Service health and readiness
  - name: config
    description: Feature flags and configuration
  - name: scheduler
    description: Scheduled tasks and cron jobs
  - name: queues
    description: Job queue management

  # Security
  - name: auth
    description: Authentication and OAuth flows
  - name: apikeys
    description: API key management
  - name: permissions
    description: Roles and permissions
  - name: sessions
    description: Session management

  # Data
  - name: brands
    description: Brand profiles and configuration
  - name: memory
    description: Multi-tier memory system
  - name: cas
    description: Content-addressable storage
  - name: attestations
    description: Cryptographic proofs and verification
  - name: schemas
    description: Schema versioning and migrations
  - name: search
    description: Full-text search

  # Integration
  - name: integrations
    description: Platform OAuth connections
  - name: webhooks
    description: Webhook registration and delivery

  # Developer
  - name: sandbox
    description: Test environment and mock data
  - name: sdk
    description: SDK configuration
  - name: audit
    description: Audit logs
  - name: export
    description: Data export and portability
  - name: bulk
    description: Bulk operations
  - name: debug
    description: Debugging and tracing

x-tagGroups:
  - name: Orchestration
    tags: [maestro, agents, modules, workflows, events, snapshots]
  - name: CMO Domain
    tags: [cmo.content, cmo.campaigns, cmo.analytics, cmo.publishing, cmo.brand, cmo.trends, cmo.abtests, cmo.calendar, cmo.audiences, cmo.templates, cmo.approvals, cmo.ideas, cmo.pillars, cmo.reports, cmo.hashtags]
  - name: Compositor Domain
    tags: [compositor.render, compositor.assets, compositor.queue, compositor.workers, compositor.loras, compositor.cache, compositor.transcode]
  - name: Brand Intelligence
    tags: [discovery, ingestion, graph]
  - name: Voice
    tags: [voice]
  - name: UI System
    tags: [ui.layouts, ui.themes, ui.animations]
  - name: Infrastructure
    tags: [infrastructure, health, config, scheduler, queues]
  - name: Security
    tags: [auth, apikeys, permissions, sessions]
  - name: Data
    tags: [brands, memory, cas, attestations, schemas, search]
  - name: Integration
    tags: [integrations, webhooks]
  - name: Developer
    tags: [sandbox, sdk, audit, export, bulk, debug]

components:
  securitySchemes:
    bearer:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token from authentication service

  # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  # PARAMETERS (Pagination, Idempotency)
  # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  parameters:
    PageLimit:
      name: limit
      in: query
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
      description: Number of items per page

    PageCursor:
      name: cursor
      in: query
      schema:
        type: string
      description: Pagination cursor (opaque, from previous response)

    PageOffset:
      name: offset
      in: query
      schema:
        type: integer
        minimum: 0
        default: 0
      description: Offset for pagination (alternative to cursor)

    IdempotencyKey:
      name: Idempotency-Key
      in: header
      schema:
        type: string
        format: uuid
      description: |
        Client-generated UUID to ensure exactly-once semantics.
        Requests with the same key return cached response for 24h.

  # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  # HEADERS
  # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  headers:
    X-Request-Id:
      schema:
        type: string
        format: uuid
      description: Request trace ID for debugging

    X-Idempotent-Replayed:
      schema:
        type: boolean
      description: True if response was replayed from idempotency cache

    X-RateLimit-Limit:
      schema:
        type: integer
      description: Rate limit ceiling

    X-RateLimit-Remaining:
      schema:
        type: integer
      description: Remaining requests in window

    X-RateLimit-Reset:
      schema:
        type: integer
      description: Unix timestamp when limit resets

  # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  # SCHEMAS
  # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  schemas:
    # ─────────────────────────────────────────────────────────────────────────
    # Identifiers
    # ─────────────────────────────────────────────────────────────────────────
    UUID:
      type: string
      format: uuid
      description: UUID v4 identifier
      example: "550e8400-e29b-41d4-a716-446655440000"

    UUID5:
      type: string
      format: uuid
      description: UUID v5 (deterministic, content-addressed)
      example: "a3bb189e-8bf9-3888-9912-ace4e6543002"

    AgentId:
      type: string
      pattern: '^[a-z]+\.[a-z]+(\.[a-z]+)*$'
      description: Hierarchical agent identifier
      example: "cmo.content.generator"

    ContentHash:
      type: string
      pattern: '^[a-f0-9]{64}$'
      description: SHA256 content hash
      example: "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"

    # ─────────────────────────────────────────────────────────────────────────
    # Enums
    # ─────────────────────────────────────────────────────────────────────────
    AgentDomain:
      type: string
      enum: [cmo, compositor, vector, system]
      description: Agent domain classification

    AgentState:
      type: string
      enum: [active, idle, busy, degraded, offline]
      description: Agent runtime state

    Platform:
      type: string
      enum: [twitter, linkedin, instagram, facebook, tiktok, youtube, pinterest]
      description: Social media platform

    ContentType:
      type: string
      enum: [post, thread, article, story, reel, video, image, carousel]
      description: Content format type

    RenderModality:
      type: string
      enum: [video, image]
      description: Render output type

    RenderTask:
      type: string
      enum: [t2v, i2v, t2i, i2i, edit]
      description: |
        Render task type:
        - t2v: text to video
        - i2v: image to video
        - t2i: text to image
        - i2i: image to image
        - edit: inpaint/outpaint

    RenderFamily:
      type: string
      enum: [flux, wan, qwen, zimage, sdxl]
      description: Model family/backbone

    RenderBackend:
      type: string
      enum: [nunchaku, torch, tensorrt]
      description: Inference backend

    JobStatus:
      type: string
      enum: [pending, queued, running, complete, failed, cancelled]
      description: Job lifecycle state

    MemoryTier:
      type: string
      enum: [session, project, user, global]
      description: Memory storage tier

    VerificationStatus:
      type: string
      enum: [approved, rejected, warning, pending]
      description: Brand verification status

    # ─────────────────────────────────────────────────────────────────────────
    # MAESTRO Types
    # ─────────────────────────────────────────────────────────────────────────
    MaestroPredictRequest:
      type: object
      required: [input]
      properties:
        input:
          type: string
          description: User input (can be partial/incomplete)
          example: "create a twitter post about"
        context:
          $ref: '#/components/schemas/MaestroContext'
        include_agents:
          type: boolean
          default: true
          description: Include agent predictions in response
        max_candidates:
          type: integer
          minimum: 1
          maximum: 10
          default: 5
          description: Maximum agent candidates to return

    MaestroContext:
      type: object
      properties:
        user_id:
          $ref: '#/components/schemas/UUID'
        session_id:
          $ref: '#/components/schemas/UUID'
        project_id:
          $ref: '#/components/schemas/UUID'
        brand_id:
          $ref: '#/components/schemas/UUID'
        active_modules:
          type: array
          items:
            type: string
          description: Currently active UI modules
        recent_queries:
          type: array
          items:
            type: string
          description: Recent user queries for context

    MaestroPrediction:
      type: object
      required: [intent, agents]
      properties:
        intent:
          $ref: '#/components/schemas/ParsedIntent'
        agents:
          type: array
          items:
            $ref: '#/components/schemas/AgentMatch'
        coordination:
          $ref: '#/components/schemas/CoordinationPlan'
        cache_hit:
          type: boolean
        prediction_time_ms:
          type: number
          format: float

    ParsedIntent:
      type: object
      required: [type, confidence]
      properties:
        type:
          type: string
          enum: [query, command, question, workflow]
        action:
          type: string
          description: Detected action verb
        target:
          type: string
          description: Target of the action
        parameters:
          type: object
          additionalProperties: true
        confidence:
          type: number
          minimum: 0
          maximum: 1
        is_complete:
          type: boolean
          description: Whether input appears complete

    AgentMatch:
      type: object
      required: [agent_id, capability, confidence]
      properties:
        agent_id:
          $ref: '#/components/schemas/AgentId'
        capability:
          type: string
          description: Matched capability name
        confidence:
          type: number
          minimum: 0
          maximum: 1
        domain:
          $ref: '#/components/schemas/AgentDomain'
        estimated_latency_ms:
          type: integer
        match_type:
          type: string
          enum: [pattern, semantic, context]

    CoordinationPlan:
      type: object
      description: Cross-domain coordination plan
      properties:
        agents:
          type: array
          items:
            $ref: '#/components/schemas/AgentId'
        execution_order:
          type: array
          items:
            $ref: '#/components/schemas/AgentId'
        dependencies:
          type: object
          additionalProperties:
            type: array
            items:
              $ref: '#/components/schemas/AgentId'

    # ─────────────────────────────────────────────────────────────────────────
    # Agent Types
    # ─────────────────────────────────────────────────────────────────────────
    Agent:
      type: object
      required: [id, name, domain, capabilities, state]
      properties:
        id:
          $ref: '#/components/schemas/AgentId'
        name:
          type: string
        description:
          type: string
        domain:
          $ref: '#/components/schemas/AgentDomain'
        capabilities:
          type: array
          items:
            $ref: '#/components/schemas/AgentCapability'
        state:
          $ref: '#/components/schemas/AgentState'
        version:
          type: string
        metrics:
          $ref: '#/components/schemas/AgentMetrics'

    AgentCapability:
      type: object
      required: [name, description]
      properties:
        name:
          type: string
          description: Capability identifier
        description:
          type: string
        patterns:
          type: array
          items:
            type: string
          description: Intent patterns that trigger this capability
        parameters:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/ParameterSpec'
        returns:
          type: string
          description: Return type description

    ParameterSpec:
      type: object
      required: [type]
      properties:
        type:
          type: string
        required:
          type: boolean
          default: false
        description:
          type: string
        default:
          description: Default value

    AgentMetrics:
      type: object
      properties:
        invocations_total:
          type: integer
        success_rate:
          type: number
        avg_latency_ms:
          type: number
        last_invoked_at:
          type: string
          format: date-time

    AgentInvokeRequest:
      type: object
      required: [capability, parameters]
      properties:
        capability:
          type: string
          description: Capability to invoke
        parameters:
          type: object
          additionalProperties: true
        context:
          $ref: '#/components/schemas/MaestroContext'
        async:
          type: boolean
          default: false
          description: Run asynchronously (return job ID)
        webhook:
          type: string
          format: uri
          description: Webhook URL for async completion

    AgentInvokeResponse:
      type: object
      required: [status]
      properties:
        status:
          type: string
          enum: [success, error, async]
        result:
          description: Capability result (if sync)
        job_id:
          $ref: '#/components/schemas/UUID'
          description: Job ID (if async)
        verification:
          $ref: '#/components/schemas/BrandVerification'
        latency_ms:
          type: integer

    # ─────────────────────────────────────────────────────────────────────────
    # Brand Types
    # ─────────────────────────────────────────────────────────────────────────
    BrandProfile:
      type: object
      required: [id, name]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        display_name:
          type: string
        description:
          type: string
        tagline:
          type: string
        mission:
          type: string
        values:
          type: array
          items:
            type: string
        industry:
          type: string
        voice:
          $ref: '#/components/schemas/BrandVoice'
        visual:
          $ref: '#/components/schemas/BrandVisual'
        guardrails:
          $ref: '#/components/schemas/BrandGuardrails'
        personas:
          type: array
          items:
            $ref: '#/components/schemas/Persona'
        default_persona_id:
          $ref: '#/components/schemas/UUID'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        content_hash:
          $ref: '#/components/schemas/ContentHash'

    BrandVoice:
      type: object
      properties:
        tone:
          type: string
          enum: [professional, conversational, energetic, calm, authoritative, friendly, playful]
        formality:
          type: number
          minimum: 0
          maximum: 1
          description: 0 = casual, 1 = formal
        enthusiasm:
          type: number
          minimum: 0
          maximum: 1
        keywords:
          type: array
          items:
            type: string
          description: Words to use
        avoid_words:
          type: array
          items:
            type: string
          description: Words to avoid

    BrandVisual:
      type: object
      properties:
        colors:
          type: array
          items:
            $ref: '#/components/schemas/BrandColor'
        typography:
          type: array
          items:
            $ref: '#/components/schemas/BrandTypography'
        imagery_style:
          type: string
        logo_primary_url:
          type: string
          format: uri
        logo_icon_url:
          type: string
          format: uri

    BrandColor:
      type: object
      required: [role, oklch]
      properties:
        role:
          type: string
          enum: [primary, secondary, tertiary, accent, background, surface, foreground]
        oklch:
          type: object
          required: [l, c, h]
          properties:
            l:
              type: number
              minimum: 0
              maximum: 1
              description: Lightness
            c:
              type: number
              minimum: 0
              maximum: 0.4
              description: Chroma
            h:
              type: number
              minimum: 0
              maximum: 360
              description: Hue
        hex:
          type: string
          pattern: '^#[0-9A-Fa-f]{6}$'
        name:
          type: string

    BrandTypography:
      type: object
      required: [role, font_family]
      properties:
        role:
          type: string
          enum: [display, heading, subheading, body, caption, label, code]
        font_family:
          type: string
        font_weight:
          type: integer
          enum: [100, 200, 300, 400, 500, 600, 700, 800, 900]
        font_style:
          type: string
          enum: [normal, italic]

    BrandGuardrails:
      type: object
      properties:
        forbidden_words:
          type: array
          items:
            type: string
        required_disclosures:
          type: array
          items:
            type: string
        compliance_regions:
          type: array
          items:
            type: string
        content_restrictions:
          type: array
          items:
            type: string

    Persona:
      type: object
      required: [id, name, type]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        display_name:
          type: string
        type:
          type: string
          enum: [brand_avatar, spokesperson, mascot, presenter, narrator, character, ugc_creator, expert]
        description:
          type: string
        base_image_url:
          type: string
          format: uri
        lora_id:
          type: string
          description: LoRA model reference for AI generation
        voice_profile_id:
          $ref: '#/components/schemas/UUID'
        personality_traits:
          type: array
          items:
            type: string

    BrandVerification:
      type: object
      required: [status]
      properties:
        status:
          $ref: '#/components/schemas/VerificationStatus'
        scores:
          type: object
          properties:
            voice:
              type: number
              minimum: 0
              maximum: 1
            visual:
              type: number
              minimum: 0
              maximum: 1
        violations:
          type: array
          items:
            $ref: '#/components/schemas/BrandViolation'
        suggestions:
          type: array
          items:
            type: string

    BrandViolation:
      type: object
      required: [type, message, severity]
      properties:
        type:
          type: string
          enum: [voice_mismatch, forbidden_word, color_violation, compliance_issue]
        message:
          type: string
        severity:
          type: string
          enum: [error, warning, info]
        location:
          type: string
          description: Where in the content the violation occurred
        auto_fixable:
          type: boolean

    # ─────────────────────────────────────────────────────────────────────────
    # Content Types
    # ─────────────────────────────────────────────────────────────────────────
    ContentGenerateRequest:
      type: object
      required: [prompt]
      properties:
        prompt:
          type: string
          minLength: 1
          maxLength: 4000
        content_type:
          $ref: '#/components/schemas/ContentType'
        platform:
          $ref: '#/components/schemas/Platform'
        brand_id:
          $ref: '#/components/schemas/UUID'
        persona_id:
          $ref: '#/components/schemas/UUID'
        tone_override:
          type: string
        length:
          type: string
          enum: [short, medium, long]
        include_hashtags:
          type: boolean
          default: true
        include_cta:
          type: boolean
          default: false
        variations:
          type: integer
          minimum: 1
          maximum: 5
          default: 1
          description: Number of variations to generate

    Content:
      type: object
      required: [id, text, content_type]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        text:
          type: string
        content_type:
          $ref: '#/components/schemas/ContentType'
        platform:
          $ref: '#/components/schemas/Platform'
        hashtags:
          type: array
          items:
            type: string
        media_urls:
          type: array
          items:
            type: string
            format: uri
        brand_id:
          $ref: '#/components/schemas/UUID'
        persona_id:
          $ref: '#/components/schemas/UUID'
        verification:
          $ref: '#/components/schemas/BrandVerification'
        created_at:
          type: string
          format: date-time
        content_hash:
          $ref: '#/components/schemas/ContentHash'

    # ─────────────────────────────────────────────────────────────────────────
    # Render Types (Weyl Integration)
    # ─────────────────────────────────────────────────────────────────────────
    RenderRequest:
      type: object
      required: [prompt]
      properties:
        prompt:
          type: string
          minLength: 1
          maxLength: 4000
        modality:
          $ref: '#/components/schemas/RenderModality'
        family:
          $ref: '#/components/schemas/RenderFamily'
        model:
          type: string
          description: Model variant (e.g., schnell, dev, default)
        task:
          $ref: '#/components/schemas/RenderTask'
        image:
          type: string
          description: Source image URL (for i2v, i2i, edit)
        mask:
          type: string
          description: Mask image URL (for edit)
        negative_prompt:
          type: string
        format:
          type: string
          description: Output format (720p, 1024, portrait, etc.)
        duration:
          type: number
          minimum: 0.5
          maximum: 10
          description: Video duration in seconds
        steps:
          type: integer
          minimum: 1
          maximum: 150
        guidance:
          type: number
          minimum: 0
          maximum: 30
        cfg:
          type: number
          minimum: 0
          maximum: 20
        seed:
          type: integer
          minimum: 0
          maximum: 4294967295
        backend:
          $ref: '#/components/schemas/RenderBackend'
        # Brand integration
        brand_id:
          $ref: '#/components/schemas/UUID'
        persona_id:
          $ref: '#/components/schemas/UUID'
        apply_brand_colors:
          type: boolean
          default: false
        # LoRA for persona consistency
        lora:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              weight:
                type: number
                default: 1.0

    RenderJob:
      type: object
      required: [id, status]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        status:
          $ref: '#/components/schemas/JobStatus'
        modality:
          $ref: '#/components/schemas/RenderModality'
        family:
          $ref: '#/components/schemas/RenderFamily'
        model:
          type: string
        task:
          $ref: '#/components/schemas/RenderTask'
        progress:
          type: number
          minimum: 0
          maximum: 1
        eta_seconds:
          type: integer
        output_url:
          type: string
          format: uri
        outputs:
          type: array
          items:
            type: string
            format: uri
        seed:
          type: integer
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
        created_at:
          type: string
          format: date-time
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
        worker_id:
          type: string
          description: Fly.io machine ID that processed this job
        content_hash:
          $ref: '#/components/schemas/ContentHash'

    # ─────────────────────────────────────────────────────────────────────────
    # Infrastructure Types (Fly.io Integration)
    # ─────────────────────────────────────────────────────────────────────────
    Machine:
      type: object
      required: [id, state, region]
      properties:
        id:
          type: string
          description: Fly.io machine ID
        name:
          type: string
        state:
          type: string
          enum: [created, starting, started, stopping, stopped, destroying, destroyed]
        region:
          type: string
          description: Fly.io region code
        instance_id:
          type: string
        private_ip:
          type: string
          format: ipv6
        config:
          $ref: '#/components/schemas/MachineConfig'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    MachineConfig:
      type: object
      properties:
        image:
          type: string
          description: Container image
        guest:
          type: object
          properties:
            cpu_kind:
              type: string
              enum: [shared, performance]
            cpus:
              type: integer
            memory_mb:
              type: integer
            gpu_kind:
              type: string
              enum: [a100-40gb, a100-80gb, l40s, a10]
        env:
          type: object
          additionalProperties:
            type: string
        services:
          type: array
          items:
            type: object
            properties:
              ports:
                type: array
                items:
                  type: object
                  properties:
                    port:
                      type: integer
                    handlers:
                      type: array
                      items:
                        type: string
        mounts:
          type: array
          items:
            type: object
            properties:
              volume:
                type: string
              path:
                type: string

    Volume:
      type: object
      required: [id, name, state]
      properties:
        id:
          type: string
        name:
          type: string
        state:
          type: string
          enum: [created, attached, detached, destroyed]
        size_gb:
          type: integer
        region:
          type: string
        zone:
          type: string
        encrypted:
          type: boolean
        attached_machine_id:
          type: string
        created_at:
          type: string
          format: date-time

    ScaleConfig:
      type: object
      required: [min_machines, max_machines]
      properties:
        min_machines:
          type: integer
          minimum: 0
        max_machines:
          type: integer
          minimum: 1
        target_gpu_utilization:
          type: number
          minimum: 0
          maximum: 1
          description: Target GPU utilization for scaling
        scale_to_zero:
          type: boolean
          default: false
        scale_to_zero_timeout_seconds:
          type: integer
          description: Seconds of idle before scaling to zero
        regions:
          type: array
          items:
            type: string
          description: Regions to scale in

    # ─────────────────────────────────────────────────────────────────────────
    # Memory Types
    # ─────────────────────────────────────────────────────────────────────────
    MemoryEntry:
      type: object
      required: [key, value, tier, namespace]
      properties:
        key:
          type: string
        value:
          description: Any JSON value
        tier:
          $ref: '#/components/schemas/MemoryTier'
        namespace:
          type: string
        scope_id:
          $ref: '#/components/schemas/UUID'
          description: Session/project/user ID depending on tier
        ttl_seconds:
          type: integer
          description: Time-to-live (session tier only)
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    MemoryQuery:
      type: object
      required: [tier]
      properties:
        tier:
          $ref: '#/components/schemas/MemoryTier'
        namespace:
          type: string
        key_prefix:
          type: string
        scope_id:
          $ref: '#/components/schemas/UUID'
        limit:
          type: integer
          default: 100
        offset:
          type: integer
          default: 0

    # ─────────────────────────────────────────────────────────────────────────
    # Publishing Types
    # ─────────────────────────────────────────────────────────────────────────
    PublishRequest:
      type: object
      required: [content_id, platforms]
      properties:
        content_id:
          $ref: '#/components/schemas/UUID'
        platforms:
          type: array
          items:
            $ref: '#/components/schemas/Platform'
        schedule_at:
          type: string
          format: date-time
          description: When to publish (null = immediately)
        adapt_per_platform:
          type: boolean
          default: true
          description: Auto-adapt content for each platform

    PublishJob:
      type: object
      required: [id, content_id, platform, status]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        content_id:
          $ref: '#/components/schemas/UUID'
        platform:
          $ref: '#/components/schemas/Platform'
        status:
          $ref: '#/components/schemas/JobStatus'
        scheduled_at:
          type: string
          format: date-time
        published_at:
          type: string
          format: date-time
        platform_post_id:
          type: string
          description: ID of the post on the platform
        platform_url:
          type: string
          format: uri
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string

    # ─────────────────────────────────────────────────────────────────────────
    # Analytics Types
    # ─────────────────────────────────────────────────────────────────────────
    AnalyticsQuery:
      type: object
      required: [metrics]
      properties:
        metrics:
          type: array
          items:
            type: string
            enum: [impressions, reach, engagement, clicks, shares, likes, comments, ctr, roi]
        dimensions:
          type: array
          items:
            type: string
            enum: [platform, content_type, campaign, date, persona]
        filters:
          type: object
          properties:
            brand_id:
              $ref: '#/components/schemas/UUID'
            campaign_id:
              $ref: '#/components/schemas/UUID'
            platforms:
              type: array
              items:
                $ref: '#/components/schemas/Platform'
            date_from:
              type: string
              format: date
            date_to:
              type: string
              format: date
        granularity:
          type: string
          enum: [hour, day, week, month]
          default: day

    AnalyticsResult:
      type: object
      required: [data, query]
      properties:
        data:
          type: array
          items:
            type: object
            additionalProperties: true
        query:
          $ref: '#/components/schemas/AnalyticsQuery'
        totals:
          type: object
          additionalProperties:
            type: number
        generated_at:
          type: string
          format: date-time

    # ─────────────────────────────────────────────────────────────────────────
    # Error Types
    # ─────────────────────────────────────────────────────────────────────────
    Error:
      type: object
      required: [error, message]
      properties:
        error:
          type: string
          description: Machine-readable error code
        message:
          type: string
          description: Human-readable message
        request_id:
          type: string
        details:
          type: object
          additionalProperties: true

    # ─────────────────────────────────────────────────────────────────────────
    # Pagination Types
    # ─────────────────────────────────────────────────────────────────────────
    PageInfo:
      type: object
      required: [has_next, has_prev]
      properties:
        has_next:
          type: boolean
        has_prev:
          type: boolean
        next_cursor:
          type: string
        prev_cursor:
          type: string
        total:
          type: integer
          description: Total count (if available)

    # ─────────────────────────────────────────────────────────────────────────
    # Workflow Types
    # ─────────────────────────────────────────────────────────────────────────
    WorkflowDefinition:
      type: object
      required: [id, name, steps]
      properties:
        id:
          $ref: '#/components/schemas/UUID5'
        name:
          type: string
        description:
          type: string
        steps:
          type: array
          items:
            $ref: '#/components/schemas/WorkflowStep'
        trigger:
          $ref: '#/components/schemas/WorkflowTrigger'
        created_at:
          type: string
          format: date-time
        content_hash:
          $ref: '#/components/schemas/ContentHash'

    WorkflowStep:
      type: object
      required: [id, agent_id, capability]
      properties:
        id:
          type: string
        agent_id:
          $ref: '#/components/schemas/AgentId'
        capability:
          type: string
        parameters:
          type: object
          additionalProperties: true
        depends_on:
          type: array
          items:
            type: string
          description: Step IDs this step depends on
        condition:
          type: string
          description: Expression to evaluate for conditional execution
        retry:
          type: object
          properties:
            max_attempts:
              type: integer
              default: 3
            backoff_ms:
              type: integer
              default: 1000

    WorkflowTrigger:
      type: object
      properties:
        type:
          type: string
          enum: [manual, schedule, event, webhook]
        schedule:
          type: string
          description: Cron expression (if type=schedule)
        event_type:
          type: string
          description: Event type to listen for (if type=event)

    WorkflowExecution:
      type: object
      required: [id, workflow_id, status]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        workflow_id:
          $ref: '#/components/schemas/UUID5'
        status:
          type: string
          enum: [pending, running, paused, completed, failed, cancelled]
        steps:
          type: array
          items:
            $ref: '#/components/schemas/WorkflowStepExecution'
        context:
          type: object
          additionalProperties: true
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
        error:
          $ref: '#/components/schemas/Error'

    WorkflowStepExecution:
      type: object
      required: [step_id, status]
      properties:
        step_id:
          type: string
        status:
          type: string
          enum: [pending, running, completed, failed, skipped]
        result:
          description: Step output
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
        error:
          $ref: '#/components/schemas/Error'

    # ─────────────────────────────────────────────────────────────────────────
    # Voice Types (STT/TTS)
    # ─────────────────────────────────────────────────────────────────────────
    VoiceSessionState:
      type: string
      enum: [idle, listening, processing, speaking, error]

    VoiceSession:
      type: object
      required: [id, state]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        state:
          $ref: '#/components/schemas/VoiceSessionState'
        brand_id:
          $ref: '#/components/schemas/UUID'
        voice_profile_id:
          $ref: '#/components/schemas/UUID'
        audio_config:
          $ref: '#/components/schemas/AudioConfig'
        created_at:
          type: string
          format: date-time

    AudioConfig:
      type: object
      properties:
        sample_rate:
          type: integer
          enum: [8000, 16000, 22050, 44100, 48000]
          default: 16000
        encoding:
          type: string
          enum: [pcm_s16le, opus, mp3, aac]
          default: opus
        channels:
          type: integer
          enum: [1, 2]
          default: 1

    STTRequest:
      type: object
      required: [audio]
      properties:
        audio:
          type: string
          format: byte
          description: Base64-encoded audio data
        audio_config:
          $ref: '#/components/schemas/AudioConfig'
        language:
          type: string
          default: en-US
        interim_results:
          type: boolean
          default: false

    STTResult:
      type: object
      required: [transcript]
      properties:
        transcript:
          type: string
        confidence:
          type: number
          minimum: 0
          maximum: 1
        is_final:
          type: boolean
        alternatives:
          type: array
          items:
            type: object
            properties:
              transcript:
                type: string
              confidence:
                type: number

    TTSRequest:
      type: object
      required: [text]
      properties:
        text:
          type: string
          maxLength: 5000
        voice_profile_id:
          $ref: '#/components/schemas/UUID'
        persona_id:
          $ref: '#/components/schemas/UUID'
        audio_config:
          $ref: '#/components/schemas/AudioConfig'
        speed:
          type: number
          minimum: 0.5
          maximum: 2.0
          default: 1.0
        pitch:
          type: number
          minimum: -10
          maximum: 10
          default: 0

    TTSResult:
      type: object
      required: [audio_url]
      properties:
        audio_url:
          type: string
          format: uri
        audio_data:
          type: string
          format: byte
          description: Base64-encoded audio (if inline=true)
        duration_ms:
          type: integer
        content_hash:
          $ref: '#/components/schemas/ContentHash'

    VoiceProfile:
      type: object
      required: [id, name]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        provider:
          type: string
          enum: [elevenlabs, openai, azure, google]
        voice_id:
          type: string
          description: Provider-specific voice ID
        settings:
          type: object
          properties:
            stability:
              type: number
            similarity_boost:
              type: number
            style:
              type: number

    # ─────────────────────────────────────────────────────────────────────────
    # Campaign Types
    # ─────────────────────────────────────────────────────────────────────────
    CampaignStatus:
      type: string
      enum: [draft, scheduled, active, paused, completed, archived]

    Campaign:
      type: object
      required: [id, name, brand_id, status]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        brand_id:
          $ref: '#/components/schemas/UUID'
        status:
          $ref: '#/components/schemas/CampaignStatus'
        objectives:
          type: array
          items:
            type: string
        target_audience:
          $ref: '#/components/schemas/TargetAudience'
        platforms:
          type: array
          items:
            $ref: '#/components/schemas/Platform'
        budget:
          $ref: '#/components/schemas/CampaignBudget'
        schedule:
          $ref: '#/components/schemas/CampaignSchedule'
        content_ids:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        metrics:
          $ref: '#/components/schemas/CampaignMetrics'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        content_hash:
          $ref: '#/components/schemas/ContentHash'

    TargetAudience:
      type: object
      properties:
        demographics:
          type: object
          properties:
            age_min:
              type: integer
            age_max:
              type: integer
            genders:
              type: array
              items:
                type: string
            locations:
              type: array
              items:
                type: string
        interests:
          type: array
          items:
            type: string
        behaviors:
          type: array
          items:
            type: string

    CampaignBudget:
      type: object
      properties:
        total:
          type: number
        currency:
          type: string
          default: USD
        daily_limit:
          type: number
        spent:
          type: number

    CampaignSchedule:
      type: object
      properties:
        start_date:
          type: string
          format: date-time
        end_date:
          type: string
          format: date-time
        timezone:
          type: string
        posting_times:
          type: array
          items:
            type: object
            properties:
              day_of_week:
                type: integer
              hour:
                type: integer
              minute:
                type: integer

    CampaignMetrics:
      type: object
      properties:
        impressions:
          type: integer
        reach:
          type: integer
        engagement:
          type: integer
        clicks:
          type: integer
        conversions:
          type: integer
        spend:
          type: number
        roi:
          type: number

    # ─────────────────────────────────────────────────────────────────────────
    # A/B Test Types
    # ─────────────────────────────────────────────────────────────────────────
    ABTestStatus:
      type: string
      enum: [draft, running, paused, completed, cancelled]

    ABTest:
      type: object
      required: [id, name, brand_id, status, variants]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        brand_id:
          $ref: '#/components/schemas/UUID'
        status:
          $ref: '#/components/schemas/ABTestStatus'
        hypothesis:
          type: string
        variants:
          type: array
          minItems: 2
          items:
            $ref: '#/components/schemas/ABTestVariant'
        metrics:
          type: array
          items:
            type: string
            enum: [clicks, conversions, engagement, ctr, time_on_page]
        primary_metric:
          type: string
        sample_size:
          type: integer
        confidence_level:
          type: number
          default: 0.95
        results:
          $ref: '#/components/schemas/ABTestResults'
        created_at:
          type: string
          format: date-time
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time

    ABTestVariant:
      type: object
      required: [id, name, content_id]
      properties:
        id:
          type: string
        name:
          type: string
        content_id:
          $ref: '#/components/schemas/UUID'
        weight:
          type: number
          minimum: 0
          maximum: 1
          default: 0.5
        metrics:
          type: object
          additionalProperties:
            type: number

    ABTestResults:
      type: object
      properties:
        winner:
          type: string
          description: Variant ID of winner
        confidence:
          type: number
        lift:
          type: number
          description: Percentage improvement
        p_value:
          type: number
        by_variant:
          type: object
          additionalProperties:
            type: object
            properties:
              impressions:
                type: integer
              conversions:
                type: integer
              conversion_rate:
                type: number

    # ─────────────────────────────────────────────────────────────────────────
    # Trend Types
    # ─────────────────────────────────────────────────────────────────────────
    Trend:
      type: object
      required: [id, name, score]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        category:
          type: string
        score:
          type: number
          minimum: 0
          maximum: 100
          description: Trend strength score
        velocity:
          type: number
          description: Rate of change
        platforms:
          type: array
          items:
            $ref: '#/components/schemas/Platform'
        keywords:
          type: array
          items:
            type: string
        related_topics:
          type: array
          items:
            type: string
        sentiment:
          type: number
          minimum: -1
          maximum: 1
        detected_at:
          type: string
          format: date-time

    CompetitorInsight:
      type: object
      required: [competitor_name]
      properties:
        competitor_name:
          type: string
        platforms:
          type: array
          items:
            $ref: '#/components/schemas/Platform'
        recent_content:
          type: array
          items:
            type: object
            properties:
              platform:
                $ref: '#/components/schemas/Platform'
              content_preview:
                type: string
              engagement:
                type: integer
              posted_at:
                type: string
                format: date-time
        share_of_voice:
          type: number
        sentiment:
          type: number
        top_themes:
          type: array
          items:
            type: string

    # ─────────────────────────────────────────────────────────────────────────
    # CAS (Content-Addressable Storage) Types
    # ─────────────────────────────────────────────────────────────────────────
    CASObject:
      type: object
      required: [hash, size]
      properties:
        hash:
          $ref: '#/components/schemas/ContentHash'
        size:
          type: integer
          description: Size in bytes
        content_type:
          type: string
        url:
          type: string
          format: uri
        created_at:
          type: string
          format: date-time
        references:
          type: integer
          description: Number of entities referencing this object

    CASPutRequest:
      type: object
      required: [content]
      properties:
        content:
          type: string
          format: byte
          description: Base64-encoded content
        content_type:
          type: string

    # ─────────────────────────────────────────────────────────────────────────
    # Attestation Types
    # ─────────────────────────────────────────────────────────────────────────
    Attestation:
      type: object
      required: [id, type, subject_hash, signature]
      properties:
        id:
          $ref: '#/components/schemas/UUID5'
        type:
          type: string
          enum: [content_created, content_verified, brand_compliant, human_reviewed, ai_generated]
        subject_hash:
          $ref: '#/components/schemas/ContentHash'
        claims:
          type: object
          additionalProperties: true
        signature:
          type: string
          description: Ed25519 signature (base64)
        public_key:
          type: string
          description: Ed25519 public key (base64)
        timestamp:
          type: string
          format: date-time
        expires_at:
          type: string
          format: date-time

    AttestationCreateRequest:
      type: object
      required: [type, subject_hash]
      properties:
        type:
          type: string
          enum: [content_created, content_verified, brand_compliant, human_reviewed, ai_generated]
        subject_hash:
          $ref: '#/components/schemas/ContentHash'
        claims:
          type: object
          additionalProperties: true
        ttl_seconds:
          type: integer
          description: Time-to-live for attestation

    # ─────────────────────────────────────────────────────────────────────────
    # Event Types (Event Sourcing)
    # ─────────────────────────────────────────────────────────────────────────
    EventType:
      type: string
      enum:
        - agent.registered
        - agent.updated
        - agent.unregistered
        - agent.state_changed
        - content.created
        - content.updated
        - content.published
        - campaign.created
        - campaign.started
        - campaign.completed
        - render.started
        - render.completed
        - workflow.started
        - workflow.completed
        - brand.updated

    Event:
      type: object
      required: [id, type, timestamp, data]
      properties:
        id:
          $ref: '#/components/schemas/UUID5'
        type:
          $ref: '#/components/schemas/EventType'
        timestamp:
          type: string
          format: date-time
        data:
          type: object
          additionalProperties: true
        metadata:
          type: object
          properties:
            user_id:
              $ref: '#/components/schemas/UUID'
            session_id:
              $ref: '#/components/schemas/UUID'
            correlation_id:
              $ref: '#/components/schemas/UUID'
        content_hash:
          $ref: '#/components/schemas/ContentHash'

    EventStream:
      type: object
      required: [stream_id, events]
      properties:
        stream_id:
          type: string
        events:
          type: array
          items:
            $ref: '#/components/schemas/Event'
        page_info:
          $ref: '#/components/schemas/PageInfo'

    # ─────────────────────────────────────────────────────────────────────────
    # Health Types
    # ─────────────────────────────────────────────────────────────────────────
    HealthStatus:
      type: string
      enum: [healthy, degraded, unhealthy]

    HealthCheck:
      type: object
      required: [status]
      properties:
        status:
          $ref: '#/components/schemas/HealthStatus'
        version:
          type: string
        uptime_seconds:
          type: integer
        checks:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/ComponentHealth'

    ComponentHealth:
      type: object
      required: [status]
      properties:
        status:
          $ref: '#/components/schemas/HealthStatus'
        latency_ms:
          type: integer
        message:
          type: string
        last_check:
          type: string
          format: date-time

    ReadinessCheck:
      type: object
      required: [ready]
      properties:
        ready:
          type: boolean
        reason:
          type: string

    # ─────────────────────────────────────────────────────────────────────────
    # Coeffect Types
    # ─────────────────────────────────────────────────────────────────────────
    Coeffect:
      type: object
      required: [resources]
      properties:
        resources:
          type: array
          items:
            $ref: '#/components/schemas/CoeffectResource'
        request_id:
          $ref: '#/components/schemas/UUID'
        validated:
          type: boolean

    CoeffectResource:
      type: object
      required: [type, status]
      properties:
        type:
          type: string
          enum: [network, auth, sandbox, database, render, llm, storage]
        status:
          type: string
          enum: [available, unavailable, degraded]
        permissions:
          type: array
          items:
            type: string
        constraints:
          type: object
          additionalProperties: true

    # ─────────────────────────────────────────────────────────────────────────
    # Module Registry Types
    # ─────────────────────────────────────────────────────────────────────────
    Module:
      type: object
      required: [id, name, type, status]
      properties:
        id:
          $ref: '#/components/schemas/UUID5'
        name:
          type: string
        display_name:
          type: string
        type:
          type: string
          enum: [widget, panel, modal, overlay, drawer]
        status:
          type: string
          enum: [registered, loading, ready, error, unloaded]
        version:
          type: string
        dependencies:
          type: array
          items:
            $ref: '#/components/schemas/UUID5'
        config:
          $ref: '#/components/schemas/ModuleConfig'
        bento_size:
          $ref: '#/components/schemas/BentoSize'
        content_hash:
          $ref: '#/components/schemas/ContentHash'

    ModuleConfig:
      type: object
      properties:
        min_width:
          type: integer
        min_height:
          type: integer
        resizable:
          type: boolean
          default: true
        draggable:
          type: boolean
          default: true
        accepts_data:
          type: array
          items:
            type: string
        provides_data:
          type: array
          items:
            type: string

    BentoSize:
      type: object
      required: [cols, rows]
      properties:
        cols:
          type: integer
          minimum: 1
          maximum: 12
        rows:
          type: integer
          minimum: 1
          maximum: 12

    # ─────────────────────────────────────────────────────────────────────────
    # UI Layout Types
    # ─────────────────────────────────────────────────────────────────────────
    Layout:
      type: object
      required: [id, name, grid]
      properties:
        id:
          $ref: '#/components/schemas/UUID5'
        name:
          type: string
        description:
          type: string
        grid:
          $ref: '#/components/schemas/BentoGrid'
        breakpoints:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/BentoGrid'
        is_default:
          type: boolean
        created_at:
          type: string
          format: date-time
        content_hash:
          $ref: '#/components/schemas/ContentHash'

    BentoGrid:
      type: object
      required: [columns, cells]
      properties:
        columns:
          type: integer
          default: 12
        row_height:
          type: integer
          default: 80
        gap:
          type: integer
          default: 16
        cells:
          type: array
          items:
            $ref: '#/components/schemas/BentoCell'

    BentoCell:
      type: object
      required: [module_id, position]
      properties:
        module_id:
          $ref: '#/components/schemas/UUID5'
        position:
          type: object
          required: [x, y, w, h]
          properties:
            x:
              type: integer
            y:
              type: integer
            w:
              type: integer
            h:
              type: integer
        z_index:
          type: integer

    # ─────────────────────────────────────────────────────────────────────────
    # Theme Types
    # ─────────────────────────────────────────────────────────────────────────
    Theme:
      type: object
      required: [id, name, colors]
      properties:
        id:
          $ref: '#/components/schemas/UUID5'
        name:
          type: string
        colors:
          $ref: '#/components/schemas/ThemeColors'
        typography:
          $ref: '#/components/schemas/ThemeTypography'
        glassmorphism:
          $ref: '#/components/schemas/GlassmorphismConfig'
        spacing:
          type: object
          additionalProperties:
            type: integer
        radii:
          type: object
          additionalProperties:
            type: integer
        is_dark:
          type: boolean

    ThemeColors:
      type: object
      properties:
        background:
          type: string
        surface:
          type: string
        primary:
          type: string
        secondary:
          type: string
        accent:
          type: string
        text:
          type: string
        text_muted:
          type: string
        border:
          type: string
        error:
          type: string
        warning:
          type: string
        success:
          type: string

    ThemeTypography:
      type: object
      properties:
        font_family:
          type: string
        font_family_mono:
          type: string
        scale:
          type: object
          additionalProperties:
            type: object
            properties:
              size:
                type: string
              weight:
                type: integer
              line_height:
                type: number

    GlassmorphismConfig:
      type: object
      properties:
        blur:
          type: integer
          default: 20
        saturation:
          type: number
          default: 1.8
        opacity:
          type: number
          default: 0.7
        border_opacity:
          type: number
          default: 0.2

    # ─────────────────────────────────────────────────────────────────────────
    # Animation Types
    # ─────────────────────────────────────────────────────────────────────────
    AnimationPreset:
      type: object
      required: [id, name, keyframes]
      properties:
        id:
          $ref: '#/components/schemas/UUID5'
        name:
          type: string
        category:
          type: string
          enum: [entrance, exit, attention, transition, micro]
        keyframes:
          type: array
          items:
            $ref: '#/components/schemas/Keyframe'
        duration_ms:
          type: integer
          default: 300
        easing:
          type: string
          default: ease-out
        delay_ms:
          type: integer
          default: 0

    Keyframe:
      type: object
      required: [offset, properties]
      properties:
        offset:
          type: number
          minimum: 0
          maximum: 1
        properties:
          type: object
          additionalProperties: true
        easing:
          type: string

    # ─────────────────────────────────────────────────────────────────────────
    # Calendar Types
    # ─────────────────────────────────────────────────────────────────────────
    CalendarEntry:
      type: object
      required: [id, type, scheduled_at]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
          enum: [content, campaign, event, reminder, deadline]
        title:
          type: string
        description:
          type: string
        scheduled_at:
          type: string
          format: date-time
        end_at:
          type: string
          format: date-time
        all_day:
          type: boolean
          default: false
        content_id:
          $ref: '#/components/schemas/UUID'
        campaign_id:
          $ref: '#/components/schemas/UUID'
        platforms:
          type: array
          items:
            $ref: '#/components/schemas/Platform'
        status:
          type: string
          enum: [scheduled, published, cancelled, draft]
        recurrence:
          $ref: '#/components/schemas/RecurrenceRule'

    RecurrenceRule:
      type: object
      properties:
        frequency:
          type: string
          enum: [daily, weekly, monthly, yearly]
        interval:
          type: integer
          default: 1
        days_of_week:
          type: array
          items:
            type: integer
        until:
          type: string
          format: date-time
        count:
          type: integer

    # ─────────────────────────────────────────────────────────────────────────
    # Audience Types
    # ─────────────────────────────────────────────────────────────────────────
    Audience:
      type: object
      required: [id, name, brand_id]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        brand_id:
          $ref: '#/components/schemas/UUID'
        criteria:
          $ref: '#/components/schemas/AudienceCriteria'
        size_estimate:
          type: integer
        platforms:
          type: array
          items:
            $ref: '#/components/schemas/Platform'
        created_at:
          type: string
          format: date-time

    AudienceCriteria:
      type: object
      properties:
        demographics:
          $ref: '#/components/schemas/TargetAudience'
        psychographics:
          type: object
          properties:
            values:
              type: array
              items:
                type: string
            lifestyle:
              type: array
              items:
                type: string
            pain_points:
              type: array
              items:
                type: string
        behaviors:
          type: object
          properties:
            purchase_frequency:
              type: string
            brand_affinity:
              type: array
              items:
                type: string
            content_preferences:
              type: array
              items:
                type: string

    # ─────────────────────────────────────────────────────────────────────────
    # Template Types
    # ─────────────────────────────────────────────────────────────────────────
    Template:
      type: object
      required: [id, name, type, content]
      properties:
        id:
          $ref: '#/components/schemas/UUID5'
        name:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [content, brief, email, social, report]
        content:
          type: string
          description: Template content with {{placeholders}}
        variables:
          type: array
          items:
            $ref: '#/components/schemas/TemplateVariable'
        category:
          type: string
        brand_id:
          $ref: '#/components/schemas/UUID'
        is_global:
          type: boolean
          default: false
        content_hash:
          $ref: '#/components/schemas/ContentHash'

    TemplateVariable:
      type: object
      required: [name, type]
      properties:
        name:
          type: string
        type:
          type: string
          enum: [text, number, date, select, brand_field]
        required:
          type: boolean
          default: false
        default_value:
          type: string
        options:
          type: array
          items:
            type: string
        description:
          type: string

    # ─────────────────────────────────────────────────────────────────────────
    # Approval Types
    # ─────────────────────────────────────────────────────────────────────────
    ApprovalWorkflow:
      type: object
      required: [id, name, stages]
      properties:
        id:
          $ref: '#/components/schemas/UUID5'
        name:
          type: string
        description:
          type: string
        stages:
          type: array
          items:
            $ref: '#/components/schemas/ApprovalStage'
        brand_id:
          $ref: '#/components/schemas/UUID'

    ApprovalStage:
      type: object
      required: [id, name, approvers]
      properties:
        id:
          type: string
        name:
          type: string
        approvers:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
          description: User IDs who can approve
        require_all:
          type: boolean
          default: false
        auto_approve_after_hours:
          type: integer

    ApprovalRequest:
      type: object
      required: [id, content_id, workflow_id, status]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        content_id:
          $ref: '#/components/schemas/UUID'
        workflow_id:
          $ref: '#/components/schemas/UUID5'
        status:
          type: string
          enum: [pending, approved, rejected, cancelled]
        current_stage:
          type: string
        decisions:
          type: array
          items:
            $ref: '#/components/schemas/ApprovalDecision'
        submitted_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time

    ApprovalDecision:
      type: object
      required: [stage_id, user_id, decision]
      properties:
        stage_id:
          type: string
        user_id:
          $ref: '#/components/schemas/UUID'
        decision:
          type: string
          enum: [approved, rejected, skipped]
        comment:
          type: string
        decided_at:
          type: string
          format: date-time

    # ─────────────────────────────────────────────────────────────────────────
    # Idea Types
    # ─────────────────────────────────────────────────────────────────────────
    Idea:
      type: object
      required: [id, title, status]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        title:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [draft, proposed, approved, in_progress, published, archived]
        brand_id:
          $ref: '#/components/schemas/UUID'
        pillar_id:
          $ref: '#/components/schemas/UUID'
        source:
          type: string
          enum: [manual, ai_suggested, trend, competitor, user_request]
        score:
          type: number
          minimum: 0
          maximum: 100
        tags:
          type: array
          items:
            type: string
        platforms:
          type: array
          items:
            $ref: '#/components/schemas/Platform'
        target_date:
          type: string
          format: date
        content_ids:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        created_at:
          type: string
          format: date-time

    # ─────────────────────────────────────────────────────────────────────────
    # Content Pillar Types
    # ─────────────────────────────────────────────────────────────────────────
    ContentPillar:
      type: object
      required: [id, name, brand_id]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        brand_id:
          $ref: '#/components/schemas/UUID'
        themes:
          type: array
          items:
            type: string
        keywords:
          type: array
          items:
            type: string
        target_percentage:
          type: number
          description: Target % of content mix
        color:
          type: string
        icon:
          type: string

    # ─────────────────────────────────────────────────────────────────────────
    # Report Types
    # ─────────────────────────────────────────────────────────────────────────
    Report:
      type: object
      required: [id, name, type, status]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [performance, campaign, content, brand_health, competitive, custom]
        status:
          type: string
          enum: [draft, generating, ready, failed, scheduled]
        template_id:
          $ref: '#/components/schemas/UUID5'
        brand_id:
          $ref: '#/components/schemas/UUID'
        date_range:
          type: object
          properties:
            start:
              type: string
              format: date
            end:
              type: string
              format: date
        sections:
          type: array
          items:
            $ref: '#/components/schemas/ReportSection'
        output_formats:
          type: array
          items:
            type: string
            enum: [pdf, pptx, html, csv]
        output_urls:
          type: object
          additionalProperties:
            type: string
            format: uri
        schedule:
          $ref: '#/components/schemas/ReportSchedule'
        created_at:
          type: string
          format: date-time
        generated_at:
          type: string
          format: date-time

    ReportSection:
      type: object
      required: [type]
      properties:
        type:
          type: string
          enum: [summary, metrics, chart, table, narrative, comparison]
        title:
          type: string
        config:
          type: object
          additionalProperties: true
        data:
          type: object
          additionalProperties: true

    ReportSchedule:
      type: object
      properties:
        frequency:
          type: string
          enum: [daily, weekly, monthly, quarterly]
        day_of_week:
          type: integer
        day_of_month:
          type: integer
        time:
          type: string
        timezone:
          type: string
        recipients:
          type: array
          items:
            type: string
            format: email

    # ─────────────────────────────────────────────────────────────────────────
    # Hashtag Types
    # ─────────────────────────────────────────────────────────────────────────
    Hashtag:
      type: object
      required: [tag]
      properties:
        tag:
          type: string
        platform:
          $ref: '#/components/schemas/Platform'
        volume:
          type: integer
        trend:
          type: string
          enum: [rising, stable, declining]
        competition:
          type: string
          enum: [low, medium, high]
        relevance_score:
          type: number
          minimum: 0
          maximum: 1

    # ─────────────────────────────────────────────────────────────────────────
    # Render Queue Types
    # ─────────────────────────────────────────────────────────────────────────
    RenderQueueStats:
      type: object
      properties:
        pending:
          type: integer
        running:
          type: integer
        completed_24h:
          type: integer
        failed_24h:
          type: integer
        avg_wait_ms:
          type: integer
        avg_duration_ms:
          type: integer
        by_priority:
          type: object
          additionalProperties:
            type: integer
        by_model:
          type: object
          additionalProperties:
            type: integer

    # ─────────────────────────────────────────────────────────────────────────
    # Render Worker Types
    # ─────────────────────────────────────────────────────────────────────────
    RenderWorker:
      type: object
      required: [id, status]
      properties:
        id:
          type: string
        machine_id:
          type: string
        status:
          type: string
          enum: [idle, busy, warming, error, offline]
        region:
          type: string
        gpu:
          type: string
        vram_mb:
          type: integer
        vram_used_mb:
          type: integer
        loaded_models:
          type: array
          items:
            type: string
        current_job_id:
          $ref: '#/components/schemas/UUID'
        jobs_completed:
          type: integer
        last_heartbeat:
          type: string
          format: date-time

    # ─────────────────────────────────────────────────────────────────────────
    # LoRA Types
    # ─────────────────────────────────────────────────────────────────────────
    LoRA:
      type: object
      required: [id, name, status]
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [pending, training, ready, failed, archived]
        type:
          type: string
          enum: [persona, style, object, concept]
        base_model:
          type: string
        persona_id:
          $ref: '#/components/schemas/UUID'
        brand_id:
          $ref: '#/components/schemas/UUID'
        training_config:
          $ref: '#/components/schemas/LoRATrainingConfig'
        training_progress:
          type: number
          minimum: 0
          maximum: 1
        metrics:
          type: object
          properties:
            loss:
              type: number
            steps:
              type: integer
        file_url:
          type: string
          format: uri
        file_size_bytes:
          type: integer
        created_at:
          type: string
          format: date-time
        trained_at:
          type: string
          format: date-time
        content_hash:
          $ref: '#/components/schemas/ContentHash'

    LoRATrainingConfig:
      type: object
      properties:
        steps:
          type: integer
          default: 1000
        learning_rate:
          type: number
          default: 0.0001
        batch_size:
          type: integer
          default: 1
        resolution:
          type: integer
          default: 512
        rank:
          type: integer
          default: 32
        alpha:
          type: integer
          default: 32

    LoRATrainingJob:
      type: object
      required: [id, lora_id, status]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        lora_id:
          type: string
        status:
          type: string
          enum: [queued, preparing, training, finalizing, complete, failed]
        progress:
          type: number
        current_step:
          type: integer
        total_steps:
          type: integer
        eta_seconds:
          type: integer
        logs:
          type: array
          items:
            type: string
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time

    # ─────────────────────────────────────────────────────────────────────────
    # Discovery Types
    # ─────────────────────────────────────────────────────────────────────────
    DiscoverySession:
      type: object
      required: [id, brand_id, status]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        brand_id:
          $ref: '#/components/schemas/UUID'
        status:
          type: string
          enum: [active, paused, completed, abandoned]
        current_phase:
          type: string
          enum: [foundation, audience, differentiation, expression, story, execution]
        progress:
          type: number
          minimum: 0
          maximum: 1
        questions_answered:
          type: integer
        extractions:
          type: array
          items:
            $ref: '#/components/schemas/Extraction'
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time

    DiscoveryQuestion:
      type: object
      required: [id, phase, text]
      properties:
        id:
          $ref: '#/components/schemas/UUID5'
        phase:
          type: string
        text:
          type: string
        follow_ups:
          type: array
          items:
            type: string
        extraction_targets:
          type: array
          items:
            type: string
        dependencies:
          type: array
          items:
            $ref: '#/components/schemas/UUID5'

    Extraction:
      type: object
      required: [field, value, confidence]
      properties:
        field:
          type: string
        value:
          type: string
        confidence:
          type: number
          minimum: 0
          maximum: 1
        source_question_id:
          $ref: '#/components/schemas/UUID5'
        source_text:
          type: string

    # ─────────────────────────────────────────────────────────────────────────
    # Ingestion Types
    # ─────────────────────────────────────────────────────────────────────────
    IngestionJob:
      type: object
      required: [id, brand_id, source_type, status]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        brand_id:
          $ref: '#/components/schemas/UUID'
        source_type:
          type: string
          enum: [website, social, document, figma, salesforce, hubspot, manual]
        source_url:
          type: string
          format: uri
        status:
          type: string
          enum: [pending, crawling, extracting, validating, complete, failed]
        progress:
          type: number
        items_found:
          type: integer
        items_processed:
          type: integer
        extractions:
          type: array
          items:
            $ref: '#/components/schemas/Extraction'
        errors:
          type: array
          items:
            $ref: '#/components/schemas/Error'
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time

    IngestionSource:
      type: object
      required: [id, type, brand_id]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
          enum: [website, social, document, figma, salesforce, hubspot]
        brand_id:
          $ref: '#/components/schemas/UUID'
        config:
          type: object
          additionalProperties: true
        credentials_id:
          $ref: '#/components/schemas/UUID'
        last_sync_at:
          type: string
          format: date-time
        sync_frequency:
          type: string
          enum: [manual, daily, weekly, monthly]

    # ─────────────────────────────────────────────────────────────────────────
    # Knowledge Graph Types
    # ─────────────────────────────────────────────────────────────────────────
    GraphEntity:
      type: object
      required: [id, type, name]
      properties:
        id:
          $ref: '#/components/schemas/UUID5'
        type:
          type: string
          enum: [brand, persona, product, audience, competitor, theme, keyword]
        name:
          type: string
        properties:
          type: object
          additionalProperties: true
        confidence:
          type: number
        provenance:
          type: array
          items:
            type: string

    GraphRelationship:
      type: object
      required: [id, type, source_id, target_id]
      properties:
        id:
          $ref: '#/components/schemas/UUID5'
        type:
          type: string
          enum: [has_persona, targets_audience, competes_with, belongs_to, related_to]
        source_id:
          $ref: '#/components/schemas/UUID5'
        target_id:
          $ref: '#/components/schemas/UUID5'
        properties:
          type: object
          additionalProperties: true
        weight:
          type: number

    GraphQuery:
      type: object
      required: [start_node]
      properties:
        start_node:
          $ref: '#/components/schemas/UUID5'
        relationship_types:
          type: array
          items:
            type: string
        max_depth:
          type: integer
          default: 3
        direction:
          type: string
          enum: [outgoing, incoming, both]
          default: both
        limit:
          type: integer
          default: 100

    GraphQueryResult:
      type: object
      properties:
        entities:
          type: array
          items:
            $ref: '#/components/schemas/GraphEntity'
        relationships:
          type: array
          items:
            $ref: '#/components/schemas/GraphRelationship'

    # ─────────────────────────────────────────────────────────────────────────
    # Snapshot Types
    # ─────────────────────────────────────────────────────────────────────────
    Snapshot:
      type: object
      required: [id, type, state_hash]
      properties:
        id:
          $ref: '#/components/schemas/UUID5'
        type:
          type: string
          enum: [agents, modules, workflows, brands, full]
        state_hash:
          $ref: '#/components/schemas/ContentHash'
        event_sequence:
          type: integer
          description: Last event sequence number
        size_bytes:
          type: integer
        created_at:
          type: string
          format: date-time

    # ─────────────────────────────────────────────────────────────────────────
    # Feature Flag Types
    # ─────────────────────────────────────────────────────────────────────────
    FeatureFlag:
      type: object
      required: [key, enabled]
      properties:
        key:
          type: string
        enabled:
          type: boolean
        description:
          type: string
        variants:
          type: array
          items:
            $ref: '#/components/schemas/FeatureFlagVariant'
        targeting:
          $ref: '#/components/schemas/FeatureFlagTargeting'
        default_variant:
          type: string

    FeatureFlagVariant:
      type: object
      required: [key, value]
      properties:
        key:
          type: string
        value:
          description: Any JSON value
        weight:
          type: number

    FeatureFlagTargeting:
      type: object
      properties:
        user_ids:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        brand_ids:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        percentage:
          type: number
        rules:
          type: array
          items:
            type: object
            additionalProperties: true

    # ─────────────────────────────────────────────────────────────────────────
    # Scheduler Types
    # ─────────────────────────────────────────────────────────────────────────
    ScheduledJob:
      type: object
      required: [id, name, schedule, handler]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        description:
          type: string
        schedule:
          type: string
          description: Cron expression
        handler:
          type: string
          description: Handler identifier
        payload:
          type: object
          additionalProperties: true
        enabled:
          type: boolean
          default: true
        last_run_at:
          type: string
          format: date-time
        next_run_at:
          type: string
          format: date-time
        last_result:
          type: string
          enum: [success, failure, skipped]

    # ─────────────────────────────────────────────────────────────────────────
    # Queue Types
    # ─────────────────────────────────────────────────────────────────────────
    QueueStats:
      type: object
      required: [name]
      properties:
        name:
          type: string
        pending:
          type: integer
        processing:
          type: integer
        completed:
          type: integer
        failed:
          type: integer
        dlq_size:
          type: integer
        throughput_per_minute:
          type: number
        avg_processing_ms:
          type: integer

    DeadLetterItem:
      type: object
      required: [id, queue, payload, error]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        queue:
          type: string
        payload:
          type: object
          additionalProperties: true
        error:
          $ref: '#/components/schemas/Error'
        attempts:
          type: integer
        first_failed_at:
          type: string
          format: date-time
        last_failed_at:
          type: string
          format: date-time

    # ─────────────────────────────────────────────────────────────────────────
    # Auth Types
    # ─────────────────────────────────────────────────────────────────────────
    TokenResponse:
      type: object
      required: [access_token, token_type, expires_in]
      properties:
        access_token:
          type: string
        token_type:
          type: string
          default: Bearer
        expires_in:
          type: integer
        refresh_token:
          type: string
        scope:
          type: string

    APIKey:
      type: object
      required: [id, name, key_prefix]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        name:
          type: string
        key_prefix:
          type: string
          description: First 8 chars of key
        scopes:
          type: array
          items:
            type: string
        created_at:
          type: string
          format: date-time
        expires_at:
          type: string
          format: date-time
        last_used_at:
          type: string
          format: date-time

    Session:
      type: object
      required: [id, user_id]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        user_id:
          $ref: '#/components/schemas/UUID'
        ip_address:
          type: string
        user_agent:
          type: string
        created_at:
          type: string
          format: date-time
        expires_at:
          type: string
          format: date-time
        last_active_at:
          type: string
          format: date-time

    # ─────────────────────────────────────────────────────────────────────────
    # User/Permission Types
    # ─────────────────────────────────────────────────────────────────────────
    User:
      type: object
      required: [id, email]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        email:
          type: string
          format: email
        name:
          type: string
        avatar_url:
          type: string
          format: uri
        roles:
          type: array
          items:
            type: string
        brand_ids:
          type: array
          items:
            $ref: '#/components/schemas/UUID'
        created_at:
          type: string
          format: date-time

    Role:
      type: object
      required: [id, name, permissions]
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        permissions:
          type: array
          items:
            type: string

    # ─────────────────────────────────────────────────────────────────────────
    # Integration Types
    # ─────────────────────────────────────────────────────────────────────────
    Integration:
      type: object
      required: [id, platform, status]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        platform:
          $ref: '#/components/schemas/Platform'
        status:
          type: string
          enum: [connected, disconnected, error, pending]
        brand_id:
          $ref: '#/components/schemas/UUID'
        account_id:
          type: string
        account_name:
          type: string
        scopes:
          type: array
          items:
            type: string
        connected_at:
          type: string
          format: date-time
        expires_at:
          type: string
          format: date-time

    # ─────────────────────────────────────────────────────────────────────────
    # Webhook Types
    # ─────────────────────────────────────────────────────────────────────────
    Webhook:
      type: object
      required: [id, url, events]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        url:
          type: string
          format: uri
        events:
          type: array
          items:
            $ref: '#/components/schemas/EventType'
        secret:
          type: string
          description: HMAC secret (write-only)
        enabled:
          type: boolean
          default: true
        created_at:
          type: string
          format: date-time

    WebhookDelivery:
      type: object
      required: [id, webhook_id, event_id, status]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        webhook_id:
          $ref: '#/components/schemas/UUID'
        event_id:
          $ref: '#/components/schemas/UUID5'
        status:
          type: string
          enum: [pending, success, failed]
        response_code:
          type: integer
        response_body:
          type: string
        attempts:
          type: integer
        delivered_at:
          type: string
          format: date-time

    # ─────────────────────────────────────────────────────────────────────────
    # Audit Types
    # ─────────────────────────────────────────────────────────────────────────
    AuditEntry:
      type: object
      required: [id, action, user_id, timestamp]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        action:
          type: string
        user_id:
          $ref: '#/components/schemas/UUID'
        resource_type:
          type: string
        resource_id:
          type: string
        changes:
          type: object
          properties:
            before:
              type: object
            after:
              type: object
        ip_address:
          type: string
        user_agent:
          type: string
        timestamp:
          type: string
          format: date-time

    # ─────────────────────────────────────────────────────────────────────────
    # Search Types
    # ─────────────────────────────────────────────────────────────────────────
    SearchQuery:
      type: object
      required: [query]
      properties:
        query:
          type: string
        types:
          type: array
          items:
            type: string
            enum: [content, campaign, brand, idea, trend]
        brand_id:
          $ref: '#/components/schemas/UUID'
        filters:
          type: object
          additionalProperties: true
        sort:
          type: string
        limit:
          type: integer
          default: 20

    SearchResult:
      type: object
      required: [hits, total]
      properties:
        hits:
          type: array
          items:
            $ref: '#/components/schemas/SearchHit'
        total:
          type: integer
        took_ms:
          type: integer

    SearchHit:
      type: object
      required: [id, type, score]
      properties:
        id:
          type: string
        type:
          type: string
        score:
          type: number
        highlight:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
        source:
          type: object
          additionalProperties: true

    # ─────────────────────────────────────────────────────────────────────────
    # Schema Version Types
    # ─────────────────────────────────────────────────────────────────────────
    SchemaVersion:
      type: object
      required: [version, applied_at]
      properties:
        version:
          type: string
        description:
          type: string
        applied_at:
          type: string
          format: date-time
        checksum:
          type: string

    Migration:
      type: object
      required: [version, direction, status]
      properties:
        version:
          type: string
        direction:
          type: string
          enum: [up, down]
        status:
          type: string
          enum: [pending, running, complete, failed]
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
        error:
          type: string

    # ─────────────────────────────────────────────────────────────────────────
    # Bulk Operation Types
    # ─────────────────────────────────────────────────────────────────────────
    BulkOperation:
      type: object
      required: [id, type, status]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
          enum: [create, update, delete, publish, generate]
        resource_type:
          type: string
        status:
          type: string
          enum: [pending, processing, complete, failed]
        total:
          type: integer
        processed:
          type: integer
        succeeded:
          type: integer
        failed:
          type: integer
        errors:
          type: array
          items:
            type: object
            properties:
              index:
                type: integer
              error:
                $ref: '#/components/schemas/Error'
        created_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time

    # ─────────────────────────────────────────────────────────────────────────
    # Export Types
    # ─────────────────────────────────────────────────────────────────────────
    ExportJob:
      type: object
      required: [id, type, status]
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        type:
          type: string
          enum: [brand, content, analytics, full]
        format:
          type: string
          enum: [json, csv, zip]
        status:
          type: string
          enum: [pending, processing, ready, expired]
        download_url:
          type: string
          format: uri
        expires_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time

    # ─────────────────────────────────────────────────────────────────────────
    # Debug/Trace Types
    # ─────────────────────────────────────────────────────────────────────────
    Trace:
      type: object
      required: [trace_id, spans]
      properties:
        trace_id:
          type: string
        spans:
          type: array
          items:
            $ref: '#/components/schemas/Span'
        duration_ms:
          type: integer

    Span:
      type: object
      required: [span_id, name, start_time]
      properties:
        span_id:
          type: string
        parent_span_id:
          type: string
        name:
          type: string
        service:
          type: string
        start_time:
          type: string
          format: date-time
        end_time:
          type: string
          format: date-time
        duration_ms:
          type: integer
        status:
          type: string
          enum: [ok, error]
        attributes:
          type: object
          additionalProperties: true

  # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  # RESPONSES
  # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  responses:
    BadRequest:
      description: Invalid request parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: validation_error
            message: "prompt is required"

    Unauthorized:
      description: Authentication failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: unauthorized
            message: "Invalid or expired token"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    RateLimited:
      description: Rate limit exceeded
      headers:
        Retry-After:
          schema:
            type: integer
          description: Seconds to wait
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# PATHS
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
paths:
  # ─────────────────────────────────────────────────────────────────────────────
  # MAESTRO ORCHESTRATOR
  # ─────────────────────────────────────────────────────────────────────────────
  /maestro/predict:
    post:
      operationId: maestroPredict
      tags: [maestro]
      summary: Predict agents from input
      description: |
        MAESTRO predictive routing. Call this as the user types to pre-select
        agents and pre-fetch capabilities. Works with partial input.

        **Latency targets:**
        - With cache: < 5ms
        - Without cache: < 50ms
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MaestroPredictRequest'
            examples:
              partial_input:
                summary: Partial input (as user types)
                value:
                  input: "create a twitter"
                  context:
                    user_id: "550e8400-e29b-41d4-a716-446655440000"
                    active_modules: ["content", "calendar"]
                  include_agents: true
              complete_input:
                summary: Complete input
                value:
                  input: "create a twitter post about our new product launch"
                  context:
                    user_id: "550e8400-e29b-41d4-a716-446655440000"
                    brand_id: "660e8400-e29b-41d4-a716-446655440001"
      responses:
        '200':
          description: Prediction result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaestroPrediction'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /maestro/preload:
    post:
      operationId: maestroPreload
      tags: [maestro]
      summary: Preload agent capabilities
      description: |
        Pre-fetch agent capabilities and context data into cache.
        Call when user focuses input field or holds voice button.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                agent_ids:
                  type: array
                  items:
                    $ref: '#/components/schemas/AgentId'
                context_keys:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Preload result
          content:
            application/json:
              schema:
                type: object
                properties:
                  preloaded:
                    type: object
                    properties:
                      agents:
                        type: integer
                      context_keys:
                        type: integer
                  cache_keys:
                    type: array
                    items:
                      type: string

  /maestro/route:
    post:
      operationId: maestroRoute
      tags: [maestro]
      summary: Route intent to agents
      description: |
        Execute the full routing flow: parse intent, select agent(s), invoke,
        verify brand compliance, return result.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [input]
              properties:
                input:
                  type: string
                context:
                  $ref: '#/components/schemas/MaestroContext'
                auto_execute:
                  type: boolean
                  default: true
                  description: Execute immediately or return plan
      responses:
        '200':
          description: Routing result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentInvokeResponse'

  # ─────────────────────────────────────────────────────────────────────────────
  # AGENT REGISTRY
  # ─────────────────────────────────────────────────────────────────────────────
  /agents:
    get:
      operationId: listAgents
      tags: [agents]
      summary: List all agents
      parameters:
        - name: domain
          in: query
          schema:
            $ref: '#/components/schemas/AgentDomain'
        - name: state
          in: query
          schema:
            $ref: '#/components/schemas/AgentState'
        - name: capability
          in: query
          schema:
            type: string
          description: Filter by capability name
      responses:
        '200':
          description: Agent list
          content:
            application/json:
              schema:
                type: object
                required: [agents]
                properties:
                  agents:
                    type: array
                    items:
                      $ref: '#/components/schemas/Agent'
                  total:
                    type: integer

  /agents/{agent_id}:
    get:
      operationId: getAgent
      tags: [agents]
      summary: Get agent details
      parameters:
        - name: agent_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/AgentId'
      responses:
        '200':
          description: Agent details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Agent'
        '404':
          $ref: '#/components/responses/NotFound'

  /agents/{agent_id}/invoke:
    post:
      operationId: invokeAgent
      tags: [agents]
      summary: Invoke agent capability
      parameters:
        - name: agent_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/AgentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AgentInvokeRequest'
      responses:
        '200':
          description: Invocation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentInvokeResponse'
        '202':
          description: Async job accepted
          content:
            application/json:
              schema:
                type: object
                properties:
                  job_id:
                    $ref: '#/components/schemas/UUID'
                  status:
                    type: string
                    const: queued

  /agents/{agent_id}/capabilities:
    get:
      operationId: getAgentCapabilities
      tags: [agents]
      summary: Get agent capabilities
      parameters:
        - name: agent_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/AgentId'
      responses:
        '200':
          description: Capabilities
          content:
            application/json:
              schema:
                type: object
                properties:
                  capabilities:
                    type: array
                    items:
                      $ref: '#/components/schemas/AgentCapability'

  # ─────────────────────────────────────────────────────────────────────────────
  # CMO DOMAIN - CONTENT
  # ─────────────────────────────────────────────────────────────────────────────
  /cmo/content/generate:
    post:
      operationId: generateContent
      tags: [cmo.content]
      summary: Generate content
      description: |
        Generate brand-compliant content. Automatically verifies against brand
        guidelines and applies persona voice if specified.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContentGenerateRequest'
      responses:
        '200':
          description: Generated content
          content:
            application/json:
              schema:
                type: object
                properties:
                  content:
                    type: array
                    items:
                      $ref: '#/components/schemas/Content'
                  verification:
                    $ref: '#/components/schemas/BrandVerification'

  /cmo/content/{content_id}:
    get:
      operationId: getContent
      tags: [cmo.content]
      summary: Get content by ID
      parameters:
        - name: content_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Content
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Content'
        '404':
          $ref: '#/components/responses/NotFound'

  /cmo/content/{content_id}/adapt:
    post:
      operationId: adaptContent
      tags: [cmo.content]
      summary: Adapt content for platform
      parameters:
        - name: content_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [platforms]
              properties:
                platforms:
                  type: array
                  items:
                    $ref: '#/components/schemas/Platform'
      responses:
        '200':
          description: Adapted content per platform
          content:
            application/json:
              schema:
                type: object
                properties:
                  adapted:
                    type: object
                    additionalProperties:
                      $ref: '#/components/schemas/Content'

  /cmo/content/{content_id}/verify:
    post:
      operationId: verifyContent
      tags: [cmo.content]
      summary: Verify content against brand
      parameters:
        - name: content_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                brand_id:
                  $ref: '#/components/schemas/UUID'
                auto_fix:
                  type: boolean
                  default: false
      responses:
        '200':
          description: Verification result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BrandVerification'

  # ─────────────────────────────────────────────────────────────────────────────
  # CMO DOMAIN - PUBLISHING
  # ─────────────────────────────────────────────────────────────────────────────
  /cmo/publishing/publish:
    post:
      operationId: publishContent
      tags: [cmo.publishing]
      summary: Publish content to platforms
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PublishRequest'
      responses:
        '200':
          description: Immediate publish result
          content:
            application/json:
              schema:
                type: object
                properties:
                  jobs:
                    type: array
                    items:
                      $ref: '#/components/schemas/PublishJob'
        '202':
          description: Scheduled for later
          content:
            application/json:
              schema:
                type: object
                properties:
                  jobs:
                    type: array
                    items:
                      $ref: '#/components/schemas/PublishJob'

  /cmo/publishing/jobs/{job_id}:
    get:
      operationId: getPublishJob
      tags: [cmo.publishing]
      summary: Get publish job status
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Job status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublishJob'

    delete:
      operationId: cancelPublishJob
      tags: [cmo.publishing]
      summary: Cancel scheduled publish
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Cancelled

  /cmo/publishing/optimal-times:
    get:
      operationId: getOptimalPublishTimes
      tags: [cmo.publishing]
      summary: Get optimal posting times
      parameters:
        - name: platform
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/Platform'
        - name: brand_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Optimal times
          content:
            application/json:
              schema:
                type: object
                properties:
                  times:
                    type: array
                    items:
                      type: object
                      properties:
                        day_of_week:
                          type: integer
                        hour:
                          type: integer
                        score:
                          type: number
                        timezone:
                          type: string

  # ─────────────────────────────────────────────────────────────────────────────
  # CMO DOMAIN - ANALYTICS
  # ─────────────────────────────────────────────────────────────────────────────
  /cmo/analytics/query:
    post:
      operationId: queryAnalytics
      tags: [cmo.analytics]
      summary: Query analytics data
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnalyticsQuery'
      responses:
        '200':
          description: Analytics result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyticsResult'

  /cmo/analytics/content/{content_id}:
    get:
      operationId: getContentAnalytics
      tags: [cmo.analytics]
      summary: Get content performance
      parameters:
        - name: content_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Content analytics
          content:
            application/json:
              schema:
                type: object
                properties:
                  impressions:
                    type: integer
                  reach:
                    type: integer
                  engagement:
                    type: integer
                  engagement_rate:
                    type: number
                  clicks:
                    type: integer
                  ctr:
                    type: number
                  by_platform:
                    type: object
                    additionalProperties:
                      type: object

  # ─────────────────────────────────────────────────────────────────────────────
  # CMO DOMAIN - BRAND
  # ─────────────────────────────────────────────────────────────────────────────
  /cmo/brand/context:
    get:
      operationId: getBrandContext
      tags: [cmo.brand]
      summary: Get current brand context
      parameters:
        - name: brand_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - name: project_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Brand context
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BrandProfile'

  /cmo/brand/verify:
    post:
      operationId: verifyBrandCompliance
      tags: [cmo.brand]
      summary: Verify any content against brand
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content]
              properties:
                content:
                  type: string
                brand_id:
                  $ref: '#/components/schemas/UUID'
                auto_fix:
                  type: boolean
                  default: false
      responses:
        '200':
          description: Verification result
          content:
            application/json:
              schema:
                type: object
                properties:
                  verification:
                    $ref: '#/components/schemas/BrandVerification'
                  fixed_content:
                    type: string
                    description: Auto-fixed content (if auto_fix=true)

  # ─────────────────────────────────────────────────────────────────────────────
  # COMPOSITOR DOMAIN - RENDER
  # ─────────────────────────────────────────────────────────────────────────────
  /compositor/render:
    post:
      operationId: createRenderJob
      tags: [compositor.render]
      summary: Create render job
      description: |
        Submit a render job to the Weyl backend. Supports text-to-image,
        image-to-image, text-to-video, image-to-video, and edit tasks.

        **Model families:**
        - `flux`: FLUX.1/2 image models (dev, dev2, schnell)
        - `zimage`: Z-Image Turbo (sub-second)
        - `wan`: WAN 2.2 video models
        - `qwen`: Qwen-Image (superior editing)
        - `sdxl`: SDXL 1.0 (LoRA ecosystem)

        **Brand integration:**
        - Set `brand_id` to apply brand colors
        - Set `persona_id` to use persona LoRA for consistency
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RenderRequest'
            examples:
              text_to_image:
                summary: Text to image
                value:
                  prompt: "professional product photo, minimalist style"
                  modality: image
                  family: flux
                  model: schnell
                  task: t2i
                  format: "1024"
                  brand_id: "660e8400-e29b-41d4-a716-446655440001"
              image_to_video:
                summary: Image to video (persona)
                value:
                  prompt: "spokesperson turns to camera and smiles"
                  modality: video
                  family: wan
                  model: default
                  task: i2v
                  image: "https://cdn.straylight.cx/assets/persona-base.jpg"
                  format: "720p"
                  duration: 3
                  persona_id: "770e8400-e29b-41d4-a716-446655440002"
                  lora:
                    - id: "persona_lora_abc123"
                      weight: 0.8
      responses:
        '200':
          description: Sync render complete (small jobs)
          headers:
            X-Render-Duration-Ms:
              schema:
                type: integer
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RenderJob'
        '202':
          description: Async job queued
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RenderJob'

  /compositor/render/{job_id}:
    get:
      operationId: getRenderJob
      tags: [compositor.render]
      summary: Get render job status
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Job status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RenderJob'
        '303':
          description: Job complete - redirect to output
          headers:
            Location:
              schema:
                type: string
                format: uri

    delete:
      operationId: cancelRenderJob
      tags: [compositor.render]
      summary: Cancel render job
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Cancelled

  /compositor/render/{job_id}/events:
    get:
      operationId: subscribeRenderJob
      tags: [compositor.render]
      summary: Subscribe to render job (SSE)
      description: |
        Server-sent events stream for render progress.

        **Events:**
        - `queued`: Job in queue
        - `started`: Rendering begun
        - `progress`: Progress update (0-1)
        - `preview`: Intermediate frame
        - `complete`: Done, output URL
        - `error`: Failed
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Event stream
          content:
            text/event-stream:
              schema:
                type: string

  /compositor/render/models:
    get:
      operationId: listRenderModels
      tags: [compositor.render]
      summary: List available render models
      responses:
        '200':
          description: Model capabilities
          content:
            application/json:
              schema:
                type: object
                properties:
                  video:
                    type: array
                    items:
                      type: object
                      properties:
                        family:
                          type: string
                        model:
                          type: string
                        modality:
                          type: string
                        tasks:
                          type: array
                          items:
                            type: string
                        status:
                          type: string
                  image:
                    type: array
                    items:
                      type: object

  # ─────────────────────────────────────────────────────────────────────────────
  # COMPOSITOR DOMAIN - ASSETS
  # ─────────────────────────────────────────────────────────────────────────────
  /compositor/assets/upload:
    post:
      operationId: createAssetUpload
      tags: [compositor.assets]
      summary: Get presigned upload URL
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content_type, bytes]
              properties:
                content_type:
                  type: string
                  enum: [image/png, image/jpeg, image/webp, video/mp4]
                bytes:
                  type: integer
                  description: File size in bytes
      responses:
        '200':
          description: Presigned URLs
          content:
            application/json:
              schema:
                type: object
                properties:
                  upload_url:
                    type: string
                    format: uri
                  asset_url:
                    type: string
                    format: uri

  /compositor/assets/{asset_id}:
    get:
      operationId: getAsset
      tags: [compositor.assets]
      summary: Get asset metadata
      parameters:
        - name: asset_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Asset metadata
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    $ref: '#/components/schemas/UUID'
                  url:
                    type: string
                    format: uri
                  content_type:
                    type: string
                  size_bytes:
                    type: integer
                  width:
                    type: integer
                  height:
                    type: integer
                  duration_ms:
                    type: integer
                  content_hash:
                    $ref: '#/components/schemas/ContentHash'

  # ─────────────────────────────────────────────────────────────────────────────
  # INFRASTRUCTURE (FLY.IO)
  # ─────────────────────────────────────────────────────────────────────────────
  /infrastructure/machines:
    get:
      operationId: listMachines
      tags: [infrastructure]
      summary: List render worker machines
      parameters:
        - name: app
          in: query
          schema:
            type: string
            default: straylight-render
        - name: state
          in: query
          schema:
            type: string
            enum: [started, stopped, all]
            default: all
      responses:
        '200':
          description: Machine list
          content:
            application/json:
              schema:
                type: object
                properties:
                  machines:
                    type: array
                    items:
                      $ref: '#/components/schemas/Machine'

    post:
      operationId: createMachine
      tags: [infrastructure]
      summary: Create render worker machine
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                region:
                  type: string
                config:
                  $ref: '#/components/schemas/MachineConfig'
      responses:
        '201':
          description: Machine created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Machine'

  /infrastructure/machines/{machine_id}:
    get:
      operationId: getMachine
      tags: [infrastructure]
      summary: Get machine details
      parameters:
        - name: machine_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Machine details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Machine'

    delete:
      operationId: deleteMachine
      tags: [infrastructure]
      summary: Delete machine
      parameters:
        - name: machine_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Deleted

  /infrastructure/machines/{machine_id}/start:
    post:
      operationId: startMachine
      tags: [infrastructure]
      summary: Start machine
      parameters:
        - name: machine_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Started

  /infrastructure/machines/{machine_id}/stop:
    post:
      operationId: stopMachine
      tags: [infrastructure]
      summary: Stop machine
      parameters:
        - name: machine_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Stopped

  /infrastructure/scale:
    get:
      operationId: getScaleConfig
      tags: [infrastructure]
      summary: Get auto-scaling configuration
      responses:
        '200':
          description: Scale config
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScaleConfig'

    put:
      operationId: updateScaleConfig
      tags: [infrastructure]
      summary: Update auto-scaling configuration
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScaleConfig'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScaleConfig'

  /infrastructure/volumes:
    get:
      operationId: listVolumes
      tags: [infrastructure]
      summary: List persistent volumes
      responses:
        '200':
          description: Volume list
          content:
            application/json:
              schema:
                type: object
                properties:
                  volumes:
                    type: array
                    items:
                      $ref: '#/components/schemas/Volume'

  # ─────────────────────────────────────────────────────────────────────────────
  # BRANDS
  # ─────────────────────────────────────────────────────────────────────────────
  /brands:
    get:
      operationId: listBrands
      tags: [brands]
      summary: List brands
      responses:
        '200':
          description: Brand list
          content:
            application/json:
              schema:
                type: object
                properties:
                  brands:
                    type: array
                    items:
                      $ref: '#/components/schemas/BrandProfile'

    post:
      operationId: createBrand
      tags: [brands]
      summary: Create brand profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BrandProfile'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BrandProfile'

  /brands/{brand_id}:
    get:
      operationId: getBrand
      tags: [brands]
      summary: Get brand profile
      parameters:
        - name: brand_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Brand profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BrandProfile'

    put:
      operationId: updateBrand
      tags: [brands]
      summary: Update brand profile
      parameters:
        - name: brand_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BrandProfile'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BrandProfile'

  /brands/{brand_id}/personas:
    get:
      operationId: listBrandPersonas
      tags: [brands]
      summary: List brand personas
      parameters:
        - name: brand_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Persona list
          content:
            application/json:
              schema:
                type: object
                properties:
                  personas:
                    type: array
                    items:
                      $ref: '#/components/schemas/Persona'

    post:
      operationId: createPersona
      tags: [brands]
      summary: Create persona
      parameters:
        - name: brand_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Persona'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Persona'

  # ─────────────────────────────────────────────────────────────────────────────
  # MEMORY
  # ─────────────────────────────────────────────────────────────────────────────
  /memory:
    get:
      operationId: queryMemory
      tags: [memory]
      summary: Query memory entries
      parameters:
        - name: tier
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/MemoryTier'
        - name: namespace
          in: query
          schema:
            type: string
        - name: key_prefix
          in: query
          schema:
            type: string
        - name: scope_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Memory entries
          content:
            application/json:
              schema:
                type: object
                properties:
                  entries:
                    type: array
                    items:
                      $ref: '#/components/schemas/MemoryEntry'

    post:
      operationId: storeMemory
      tags: [memory]
      summary: Store memory entry
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MemoryEntry'
      responses:
        '201':
          description: Stored

  /memory/{tier}/{namespace}/{key}:
    get:
      operationId: getMemoryEntry
      tags: [memory]
      summary: Get memory entry
      parameters:
        - name: tier
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/MemoryTier'
        - name: namespace
          in: path
          required: true
          schema:
            type: string
        - name: key
          in: path
          required: true
          schema:
            type: string
        - name: scope_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Memory entry
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MemoryEntry'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      operationId: deleteMemoryEntry
      tags: [memory]
      summary: Delete memory entry
      parameters:
        - name: tier
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/MemoryTier'
        - name: namespace
          in: path
          required: true
          schema:
            type: string
        - name: key
          in: path
          required: true
          schema:
            type: string
        - name: scope_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Deleted

  /memory/context:
    get:
      operationId: getLLMContext
      tags: [memory]
      summary: Get LLM context from memory
      description: |
        Retrieve aggregated context for LLM prompts, pulling from all
        relevant memory tiers based on current scope.
      parameters:
        - name: session_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - name: project_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - name: user_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - name: namespaces
          in: query
          schema:
            type: array
            items:
              type: string
          description: Namespaces to include
      responses:
        '200':
          description: LLM context
          content:
            application/json:
              schema:
                type: object
                properties:
                  context:
                    type: object
                    additionalProperties: true
                  token_estimate:
                    type: integer

  # ─────────────────────────────────────────────────────────────────────────────
  # HEALTH & READINESS
  # ─────────────────────────────────────────────────────────────────────────────
  /health:
    get:
      operationId: healthCheck
      tags: [health]
      summary: Health check
      security: []
      description: |
        Returns service health status. Checks all dependencies:
        - Postgres connectivity
        - Weyl API availability
        - Fly.io Machines API
        - Cache layer
      responses:
        '200':
          description: Healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheck'
        '503':
          description: Unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheck'

  /ready:
    get:
      operationId: readinessCheck
      tags: [health]
      summary: Readiness check
      security: []
      description: |
        Returns whether service is ready to accept traffic.
        Used by load balancers and orchestrators.
      responses:
        '200':
          description: Ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReadinessCheck'
        '503':
          description: Not ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReadinessCheck'

  /health/live:
    get:
      operationId: livenessCheck
      tags: [health]
      summary: Liveness check
      security: []
      description: Simple liveness probe (is process running)
      responses:
        '200':
          description: Alive
          content:
            text/plain:
              schema:
                type: string
                example: ok

  # ─────────────────────────────────────────────────────────────────────────────
  # WORKFLOWS
  # ─────────────────────────────────────────────────────────────────────────────
  /workflows:
    get:
      operationId: listWorkflows
      tags: [workflows]
      summary: List workflow definitions
      parameters:
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Workflow list
          content:
            application/json:
              schema:
                type: object
                properties:
                  workflows:
                    type: array
                    items:
                      $ref: '#/components/schemas/WorkflowDefinition'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

    post:
      operationId: createWorkflow
      tags: [workflows]
      summary: Create workflow definition
      parameters:
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkflowDefinition'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowDefinition'

  /workflows/{workflow_id}:
    get:
      operationId: getWorkflow
      tags: [workflows]
      summary: Get workflow definition
      parameters:
        - name: workflow_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      responses:
        '200':
          description: Workflow definition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowDefinition'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      operationId: updateWorkflow
      tags: [workflows]
      summary: Update workflow definition
      parameters:
        - name: workflow_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkflowDefinition'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowDefinition'

    delete:
      operationId: deleteWorkflow
      tags: [workflows]
      summary: Delete workflow definition
      parameters:
        - name: workflow_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      responses:
        '204':
          description: Deleted

  /workflows/{workflow_id}/execute:
    post:
      operationId: executeWorkflow
      tags: [workflows]
      summary: Execute workflow
      parameters:
        - name: workflow_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                context:
                  type: object
                  additionalProperties: true
                  description: Initial context for workflow
                async:
                  type: boolean
                  default: true
      responses:
        '200':
          description: Sync execution complete
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowExecution'
        '202':
          description: Async execution started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowExecution'

  /workflows/executions:
    get:
      operationId: listWorkflowExecutions
      tags: [workflows]
      summary: List workflow executions
      parameters:
        - name: workflow_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID5'
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, running, paused, completed, failed, cancelled]
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Execution list
          content:
            application/json:
              schema:
                type: object
                properties:
                  executions:
                    type: array
                    items:
                      $ref: '#/components/schemas/WorkflowExecution'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

  /workflows/executions/{execution_id}:
    get:
      operationId: getWorkflowExecution
      tags: [workflows]
      summary: Get workflow execution
      parameters:
        - name: execution_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Execution details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowExecution'

  /workflows/executions/{execution_id}/cancel:
    post:
      operationId: cancelWorkflowExecution
      tags: [workflows]
      summary: Cancel workflow execution
      parameters:
        - name: execution_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowExecution'

  /workflows/executions/{execution_id}/pause:
    post:
      operationId: pauseWorkflowExecution
      tags: [workflows]
      summary: Pause workflow execution
      parameters:
        - name: execution_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Paused
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowExecution'

  /workflows/executions/{execution_id}/resume:
    post:
      operationId: resumeWorkflowExecution
      tags: [workflows]
      summary: Resume paused workflow
      parameters:
        - name: execution_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Resumed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowExecution'

  # ─────────────────────────────────────────────────────────────────────────────
  # VOICE
  # ─────────────────────────────────────────────────────────────────────────────
  /voice/sessions:
    post:
      operationId: createVoiceSession
      tags: [voice]
      summary: Create voice session
      description: |
        Create a new voice session for STT/TTS interaction.
        Returns WebSocket URL for real-time audio streaming.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                brand_id:
                  $ref: '#/components/schemas/UUID'
                voice_profile_id:
                  $ref: '#/components/schemas/UUID'
                audio_config:
                  $ref: '#/components/schemas/AudioConfig'
      responses:
        '201':
          description: Session created
          content:
            application/json:
              schema:
                type: object
                properties:
                  session:
                    $ref: '#/components/schemas/VoiceSession'
                  websocket_url:
                    type: string
                    format: uri
                    description: WebSocket URL for audio streaming

  /voice/sessions/{session_id}:
    get:
      operationId: getVoiceSession
      tags: [voice]
      summary: Get voice session
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Session details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoiceSession'

    delete:
      operationId: endVoiceSession
      tags: [voice]
      summary: End voice session
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Session ended

  /voice/stt:
    post:
      operationId: speechToText
      tags: [voice]
      summary: Speech to text (REST)
      description: |
        One-shot speech-to-text. For streaming STT, use WebSocket.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/STTRequest'
      responses:
        '200':
          description: Transcription result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/STTResult'

  /voice/tts:
    post:
      operationId: textToSpeech
      tags: [voice]
      summary: Text to speech
      description: |
        Generate audio from text using brand voice profile.
      parameters:
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TTSRequest'
      responses:
        '200':
          description: Audio generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TTSResult'

  /voice/profiles:
    get:
      operationId: listVoiceProfiles
      tags: [voice]
      summary: List voice profiles
      parameters:
        - name: brand_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Voice profile list
          content:
            application/json:
              schema:
                type: object
                properties:
                  profiles:
                    type: array
                    items:
                      $ref: '#/components/schemas/VoiceProfile'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

    post:
      operationId: createVoiceProfile
      tags: [voice]
      summary: Create voice profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VoiceProfile'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoiceProfile'

  # ─────────────────────────────────────────────────────────────────────────────
  # CMO DOMAIN - CAMPAIGNS (Full CRUD)
  # ─────────────────────────────────────────────────────────────────────────────
  /cmo/campaigns:
    get:
      operationId: listCampaigns
      tags: [cmo.campaigns]
      summary: List campaigns
      parameters:
        - name: brand_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/CampaignStatus'
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Campaign list
          content:
            application/json:
              schema:
                type: object
                properties:
                  campaigns:
                    type: array
                    items:
                      $ref: '#/components/schemas/Campaign'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

    post:
      operationId: createCampaign
      tags: [cmo.campaigns]
      summary: Create campaign
      parameters:
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Campaign'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Campaign'

  /cmo/campaigns/{campaign_id}:
    get:
      operationId: getCampaign
      tags: [cmo.campaigns]
      summary: Get campaign
      parameters:
        - name: campaign_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Campaign details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Campaign'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      operationId: updateCampaign
      tags: [cmo.campaigns]
      summary: Update campaign
      parameters:
        - name: campaign_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Campaign'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Campaign'

    delete:
      operationId: deleteCampaign
      tags: [cmo.campaigns]
      summary: Delete campaign
      parameters:
        - name: campaign_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Deleted

  /cmo/campaigns/{campaign_id}/start:
    post:
      operationId: startCampaign
      tags: [cmo.campaigns]
      summary: Start campaign
      parameters:
        - name: campaign_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Campaign'

  /cmo/campaigns/{campaign_id}/pause:
    post:
      operationId: pauseCampaign
      tags: [cmo.campaigns]
      summary: Pause campaign
      parameters:
        - name: campaign_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Paused
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Campaign'

  /cmo/campaigns/{campaign_id}/complete:
    post:
      operationId: completeCampaign
      tags: [cmo.campaigns]
      summary: Complete campaign
      parameters:
        - name: campaign_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Campaign'

  /cmo/campaigns/{campaign_id}/content:
    get:
      operationId: getCampaignContent
      tags: [cmo.campaigns]
      summary: Get campaign content
      parameters:
        - name: campaign_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Campaign content
          content:
            application/json:
              schema:
                type: object
                properties:
                  content:
                    type: array
                    items:
                      $ref: '#/components/schemas/Content'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

    post:
      operationId: addCampaignContent
      tags: [cmo.campaigns]
      summary: Add content to campaign
      parameters:
        - name: campaign_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content_ids]
              properties:
                content_ids:
                  type: array
                  items:
                    $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Content added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Campaign'

  /cmo/campaigns/{campaign_id}/analytics:
    get:
      operationId: getCampaignAnalytics
      tags: [cmo.campaigns]
      summary: Get campaign analytics
      parameters:
        - name: campaign_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Campaign analytics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignMetrics'

  # ─────────────────────────────────────────────────────────────────────────────
  # CMO DOMAIN - A/B TESTS
  # ─────────────────────────────────────────────────────────────────────────────
  /cmo/abtests:
    get:
      operationId: listABTests
      tags: [cmo.abtests]
      summary: List A/B tests
      parameters:
        - name: brand_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/ABTestStatus'
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: A/B test list
          content:
            application/json:
              schema:
                type: object
                properties:
                  tests:
                    type: array
                    items:
                      $ref: '#/components/schemas/ABTest'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

    post:
      operationId: createABTest
      tags: [cmo.abtests]
      summary: Create A/B test
      parameters:
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ABTest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ABTest'

  /cmo/abtests/{test_id}:
    get:
      operationId: getABTest
      tags: [cmo.abtests]
      summary: Get A/B test
      parameters:
        - name: test_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: A/B test details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ABTest'

    put:
      operationId: updateABTest
      tags: [cmo.abtests]
      summary: Update A/B test
      parameters:
        - name: test_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ABTest'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ABTest'

    delete:
      operationId: deleteABTest
      tags: [cmo.abtests]
      summary: Delete A/B test
      parameters:
        - name: test_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Deleted

  /cmo/abtests/{test_id}/start:
    post:
      operationId: startABTest
      tags: [cmo.abtests]
      summary: Start A/B test
      parameters:
        - name: test_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ABTest'

  /cmo/abtests/{test_id}/complete:
    post:
      operationId: completeABTest
      tags: [cmo.abtests]
      summary: Complete A/B test and pick winner
      parameters:
        - name: test_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                winner_variant_id:
                  type: string
                  description: Override automatic winner selection
      responses:
        '200':
          description: Completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ABTest'

  /cmo/abtests/{test_id}/results:
    get:
      operationId: getABTestResults
      tags: [cmo.abtests]
      summary: Get A/B test results
      parameters:
        - name: test_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Test results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ABTestResults'

  # ─────────────────────────────────────────────────────────────────────────────
  # CMO DOMAIN - TRENDS
  # ─────────────────────────────────────────────────────────────────────────────
  /cmo/trends:
    get:
      operationId: listTrends
      tags: [cmo.trends]
      summary: List current trends
      parameters:
        - name: platforms
          in: query
          schema:
            type: array
            items:
              $ref: '#/components/schemas/Platform'
        - name: category
          in: query
          schema:
            type: string
        - name: min_score
          in: query
          schema:
            type: number
            minimum: 0
            maximum: 100
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Trend list
          content:
            application/json:
              schema:
                type: object
                properties:
                  trends:
                    type: array
                    items:
                      $ref: '#/components/schemas/Trend'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

  /cmo/trends/{trend_id}:
    get:
      operationId: getTrend
      tags: [cmo.trends]
      summary: Get trend details
      parameters:
        - name: trend_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Trend details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Trend'

  /cmo/trends/research:
    post:
      operationId: researchTrends
      tags: [cmo.trends]
      summary: Research trends for topic
      description: |
        Analyze trends for a specific topic or keyword.
        Returns relevant trends and content opportunities.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [query]
              properties:
                query:
                  type: string
                platforms:
                  type: array
                  items:
                    $ref: '#/components/schemas/Platform'
                brand_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Research results
          content:
            application/json:
              schema:
                type: object
                properties:
                  trends:
                    type: array
                    items:
                      $ref: '#/components/schemas/Trend'
                  content_opportunities:
                    type: array
                    items:
                      type: object
                      properties:
                        trend_id:
                          $ref: '#/components/schemas/UUID'
                        suggestion:
                          type: string
                        platforms:
                          type: array
                          items:
                            $ref: '#/components/schemas/Platform'

  /cmo/trends/competitors:
    get:
      operationId: getCompetitorInsights
      tags: [cmo.trends]
      summary: Get competitor insights
      parameters:
        - name: brand_id
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: competitors
          in: query
          schema:
            type: array
            items:
              type: string
          description: Competitor names to analyze
        - $ref: '#/components/parameters/PageLimit'
      responses:
        '200':
          description: Competitor insights
          content:
            application/json:
              schema:
                type: object
                properties:
                  insights:
                    type: array
                    items:
                      $ref: '#/components/schemas/CompetitorInsight'

  # ─────────────────────────────────────────────────────────────────────────────
  # CAS (Content-Addressable Storage)
  # ─────────────────────────────────────────────────────────────────────────────
  /cas/{hash}:
    get:
      operationId: getCASObject
      tags: [cas]
      summary: Get object by content hash
      description: |
        Retrieve content by its SHA256 hash. Immutable storage -
        same hash always returns same content.
      parameters:
        - name: hash
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/ContentHash'
      responses:
        '200':
          description: Object found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CASObject'
        '404':
          $ref: '#/components/responses/NotFound'

    head:
      operationId: checkCASObject
      tags: [cas]
      summary: Check if object exists
      parameters:
        - name: hash
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/ContentHash'
      responses:
        '200':
          description: Exists
        '404':
          description: Not found

  /cas:
    post:
      operationId: putCASObject
      tags: [cas]
      summary: Store object in CAS
      description: |
        Store content and return its hash. Deduplicates automatically -
        storing same content returns existing hash.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CASPutRequest'
      responses:
        '200':
          description: Already exists (deduplicated)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CASObject'
        '201':
          description: Stored
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CASObject'

  /cas/{hash}/content:
    get:
      operationId: getCASContent
      tags: [cas]
      summary: Get raw content
      parameters:
        - name: hash
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/ContentHash'
      responses:
        '200':
          description: Raw content
          content:
            '*/*':
              schema:
                type: string
                format: binary
        '303':
          description: Redirect to CDN
          headers:
            Location:
              schema:
                type: string
                format: uri

  # ─────────────────────────────────────────────────────────────────────────────
  # ATTESTATIONS
  # ─────────────────────────────────────────────────────────────────────────────
  /attestations:
    post:
      operationId: createAttestation
      tags: [attestations]
      summary: Create attestation
      description: |
        Create a cryptographic attestation for content.
        Signs with Ed25519 key to prove authenticity.
      parameters:
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AttestationCreateRequest'
      responses:
        '201':
          description: Attestation created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Attestation'

  /attestations/{attestation_id}:
    get:
      operationId: getAttestation
      tags: [attestations]
      summary: Get attestation
      parameters:
        - name: attestation_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      responses:
        '200':
          description: Attestation details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Attestation'

  /attestations/verify:
    post:
      operationId: verifyAttestation
      tags: [attestations]
      summary: Verify attestation
      description: |
        Verify an attestation's signature and claims.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Attestation'
      responses:
        '200':
          description: Verification result
          content:
            application/json:
              schema:
                type: object
                properties:
                  valid:
                    type: boolean
                  errors:
                    type: array
                    items:
                      type: string

  /attestations/by-subject/{hash}:
    get:
      operationId: getAttestationsBySubject
      tags: [attestations]
      summary: Get attestations for content
      parameters:
        - name: hash
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/ContentHash'
        - name: type
          in: query
          schema:
            type: string
            enum: [content_created, content_verified, brand_compliant, human_reviewed, ai_generated]
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Attestation list
          content:
            application/json:
              schema:
                type: object
                properties:
                  attestations:
                    type: array
                    items:
                      $ref: '#/components/schemas/Attestation'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

  # ─────────────────────────────────────────────────────────────────────────────
  # EVENTS (Event Sourcing)
  # ─────────────────────────────────────────────────────────────────────────────
  /events:
    get:
      operationId: listEvents
      tags: [events]
      summary: List events
      description: |
        Query the event stream. Supports filtering by type and time range.
        Used for event sourcing replay and audit trails.
      parameters:
        - name: types
          in: query
          schema:
            type: array
            items:
              $ref: '#/components/schemas/EventType'
        - name: since
          in: query
          schema:
            type: string
            format: date-time
          description: Events after this timestamp
        - name: until
          in: query
          schema:
            type: string
            format: date-time
          description: Events before this timestamp
        - name: correlation_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Event list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventStream'

  /events/{event_id}:
    get:
      operationId: getEvent
      tags: [events]
      summary: Get event by ID
      parameters:
        - name: event_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      responses:
        '200':
          description: Event details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Event'

  /events/stream:
    get:
      operationId: subscribeEvents
      tags: [events]
      summary: Subscribe to events (SSE)
      description: |
        Server-sent events stream for real-time event updates.

        **Event format:**
        ```
        event: agent.registered
        data: {"id": "...", "type": "agent.registered", ...}
        ```
      parameters:
        - name: types
          in: query
          schema:
            type: array
            items:
              $ref: '#/components/schemas/EventType'
      responses:
        '200':
          description: Event stream
          content:
            text/event-stream:
              schema:
                type: string

  /events/replay:
    post:
      operationId: replayEvents
      tags: [events]
      summary: Replay events to rebuild state
      description: |
        Replay events from a specific point to rebuild state.
        Used for disaster recovery and state migration.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [target]
              properties:
                target:
                  type: string
                  enum: [agents, workflows, brands, all]
                since:
                  type: string
                  format: date-time
                dry_run:
                  type: boolean
                  default: true
      responses:
        '200':
          description: Replay result
          content:
            application/json:
              schema:
                type: object
                properties:
                  events_processed:
                    type: integer
                  state_hash:
                    $ref: '#/components/schemas/ContentHash'
                  errors:
                    type: array
                    items:
                      $ref: '#/components/schemas/Error'

  # ─────────────────────────────────────────────────────────────────────────────
  # MAESTRO WebSocket
  # ─────────────────────────────────────────────────────────────────────────────
  /maestro/ws:
    get:
      operationId: maestroWebSocket
      tags: [maestro]
      summary: MAESTRO WebSocket endpoint
      description: |
        WebSocket connection for real-time MAESTRO interaction.

        **Protocol:**
        1. Connect with Bearer token in query: `?token=...`
        2. Send partial input as user types
        3. Receive predictions and agent matches

        **Client → Server messages:**
        ```json
        {"type": "input", "text": "create a twitter", "context": {...}}
        {"type": "preload", "agent_ids": ["cmo.content.generator"]}
        {"type": "execute", "agent_id": "cmo.content.generator", "params": {...}}
        ```

        **Server → Client messages:**
        ```json
        {"type": "prediction", "agents": [...], "cache_hit": true}
        {"type": "preloaded", "agents": 3}
        {"type": "result", "status": "success", "data": {...}}
        {"type": "error", "code": "...", "message": "..."}
        ```
      parameters:
        - name: token
          in: query
          required: true
          schema:
            type: string
          description: Bearer token for authentication
      responses:
        '101':
          description: Switching Protocols (WebSocket upgrade)

  # ─────────────────────────────────────────────────────────────────────────────
  # MODULE REGISTRY
  # ─────────────────────────────────────────────────────────────────────────────
  /modules:
    get:
      operationId: listModules
      tags: [modules]
      summary: List UI modules
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: [widget, panel, modal, overlay, drawer]
        - name: status
          in: query
          schema:
            type: string
            enum: [registered, loading, ready, error, unloaded]
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Module list
          content:
            application/json:
              schema:
                type: object
                properties:
                  modules:
                    type: array
                    items:
                      $ref: '#/components/schemas/Module'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

    post:
      operationId: registerModule
      tags: [modules]
      summary: Register UI module
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Module'
      responses:
        '201':
          description: Registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Module'

  /modules/{module_id}:
    get:
      operationId: getModule
      tags: [modules]
      summary: Get module
      parameters:
        - name: module_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      responses:
        '200':
          description: Module details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Module'

    put:
      operationId: updateModule
      tags: [modules]
      summary: Update module
      parameters:
        - name: module_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Module'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Module'

    delete:
      operationId: unregisterModule
      tags: [modules]
      summary: Unregister module
      parameters:
        - name: module_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      responses:
        '204':
          description: Unregistered

  # ─────────────────────────────────────────────────────────────────────────────
  # SNAPSHOTS
  # ─────────────────────────────────────────────────────────────────────────────
  /snapshots:
    get:
      operationId: listSnapshots
      tags: [snapshots]
      summary: List state snapshots
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: [agents, modules, workflows, brands, full]
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Snapshot list
          content:
            application/json:
              schema:
                type: object
                properties:
                  snapshots:
                    type: array
                    items:
                      $ref: '#/components/schemas/Snapshot'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

    post:
      operationId: createSnapshot
      tags: [snapshots]
      summary: Create state snapshot
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [type]
              properties:
                type:
                  type: string
                  enum: [agents, modules, workflows, brands, full]
      responses:
        '201':
          description: Snapshot created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Snapshot'

  /snapshots/{snapshot_id}:
    get:
      operationId: getSnapshot
      tags: [snapshots]
      summary: Get snapshot
      parameters:
        - name: snapshot_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      responses:
        '200':
          description: Snapshot details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Snapshot'

  /snapshots/{snapshot_id}/restore:
    post:
      operationId: restoreSnapshot
      tags: [snapshots]
      summary: Restore from snapshot
      parameters:
        - name: snapshot_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                dry_run:
                  type: boolean
                  default: true
      responses:
        '200':
          description: Restore result
          content:
            application/json:
              schema:
                type: object
                properties:
                  restored:
                    type: boolean
                  changes:
                    type: integer

  # ─────────────────────────────────────────────────────────────────────────────
  # UI LAYOUTS
  # ─────────────────────────────────────────────────────────────────────────────
  /ui/layouts:
    get:
      operationId: listLayouts
      tags: [ui.layouts]
      summary: List Bento grid layouts
      parameters:
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Layout list
          content:
            application/json:
              schema:
                type: object
                properties:
                  layouts:
                    type: array
                    items:
                      $ref: '#/components/schemas/Layout'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

    post:
      operationId: createLayout
      tags: [ui.layouts]
      summary: Create layout
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Layout'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Layout'

  /ui/layouts/{layout_id}:
    get:
      operationId: getLayout
      tags: [ui.layouts]
      summary: Get layout
      parameters:
        - name: layout_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      responses:
        '200':
          description: Layout details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Layout'

    put:
      operationId: updateLayout
      tags: [ui.layouts]
      summary: Update layout
      parameters:
        - name: layout_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Layout'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Layout'

    delete:
      operationId: deleteLayout
      tags: [ui.layouts]
      summary: Delete layout
      parameters:
        - name: layout_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      responses:
        '204':
          description: Deleted

  # ─────────────────────────────────────────────────────────────────────────────
  # UI THEMES
  # ─────────────────────────────────────────────────────────────────────────────
  /ui/themes:
    get:
      operationId: listThemes
      tags: [ui.themes]
      summary: List themes
      responses:
        '200':
          description: Theme list
          content:
            application/json:
              schema:
                type: object
                properties:
                  themes:
                    type: array
                    items:
                      $ref: '#/components/schemas/Theme'

    post:
      operationId: createTheme
      tags: [ui.themes]
      summary: Create theme
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Theme'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Theme'

  /ui/themes/{theme_id}:
    get:
      operationId: getTheme
      tags: [ui.themes]
      summary: Get theme
      parameters:
        - name: theme_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      responses:
        '200':
          description: Theme details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Theme'

    put:
      operationId: updateTheme
      tags: [ui.themes]
      summary: Update theme
      parameters:
        - name: theme_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Theme'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Theme'

  /ui/themes/from-brand/{brand_id}:
    post:
      operationId: generateThemeFromBrand
      tags: [ui.themes]
      summary: Generate theme from brand
      parameters:
        - name: brand_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Generated theme
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Theme'

  # ─────────────────────────────────────────────────────────────────────────────
  # UI ANIMATIONS
  # ─────────────────────────────────────────────────────────────────────────────
  /ui/animations:
    get:
      operationId: listAnimationPresets
      tags: [ui.animations]
      summary: List animation presets
      parameters:
        - name: category
          in: query
          schema:
            type: string
            enum: [entrance, exit, attention, transition, micro]
      responses:
        '200':
          description: Animation preset list
          content:
            application/json:
              schema:
                type: object
                properties:
                  presets:
                    type: array
                    items:
                      $ref: '#/components/schemas/AnimationPreset'

    post:
      operationId: createAnimationPreset
      tags: [ui.animations]
      summary: Create animation preset
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnimationPreset'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnimationPreset'

  /ui/animations/{preset_id}:
    get:
      operationId: getAnimationPreset
      tags: [ui.animations]
      summary: Get animation preset
      parameters:
        - name: preset_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      responses:
        '200':
          description: Animation preset
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnimationPreset'

  # ─────────────────────────────────────────────────────────────────────────────
  # CMO - CALENDAR
  # ─────────────────────────────────────────────────────────────────────────────
  /cmo/calendar:
    get:
      operationId: getCalendar
      tags: [cmo.calendar]
      summary: Get calendar entries
      parameters:
        - name: brand_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - name: start_date
          in: query
          required: true
          schema:
            type: string
            format: date
        - name: end_date
          in: query
          required: true
          schema:
            type: string
            format: date
        - name: types
          in: query
          schema:
            type: array
            items:
              type: string
              enum: [content, campaign, event, reminder, deadline]
      responses:
        '200':
          description: Calendar entries
          content:
            application/json:
              schema:
                type: object
                properties:
                  entries:
                    type: array
                    items:
                      $ref: '#/components/schemas/CalendarEntry'

    post:
      operationId: createCalendarEntry
      tags: [cmo.calendar]
      summary: Create calendar entry
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CalendarEntry'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalendarEntry'

  /cmo/calendar/{entry_id}:
    get:
      operationId: getCalendarEntry
      tags: [cmo.calendar]
      summary: Get calendar entry
      parameters:
        - name: entry_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Calendar entry
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalendarEntry'

    put:
      operationId: updateCalendarEntry
      tags: [cmo.calendar]
      summary: Update calendar entry
      parameters:
        - name: entry_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CalendarEntry'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalendarEntry'

    delete:
      operationId: deleteCalendarEntry
      tags: [cmo.calendar]
      summary: Delete calendar entry
      parameters:
        - name: entry_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Deleted

  # ─────────────────────────────────────────────────────────────────────────────
  # CMO - AUDIENCES
  # ─────────────────────────────────────────────────────────────────────────────
  /cmo/audiences:
    get:
      operationId: listAudiences
      tags: [cmo.audiences]
      summary: List audience segments
      parameters:
        - name: brand_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Audience list
          content:
            application/json:
              schema:
                type: object
                properties:
                  audiences:
                    type: array
                    items:
                      $ref: '#/components/schemas/Audience'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

    post:
      operationId: createAudience
      tags: [cmo.audiences]
      summary: Create audience segment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Audience'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Audience'

  /cmo/audiences/{audience_id}:
    get:
      operationId: getAudience
      tags: [cmo.audiences]
      summary: Get audience
      parameters:
        - name: audience_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Audience details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Audience'

    put:
      operationId: updateAudience
      tags: [cmo.audiences]
      summary: Update audience
      parameters:
        - name: audience_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Audience'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Audience'

    delete:
      operationId: deleteAudience
      tags: [cmo.audiences]
      summary: Delete audience
      parameters:
        - name: audience_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Deleted

  # ─────────────────────────────────────────────────────────────────────────────
  # CMO - TEMPLATES
  # ─────────────────────────────────────────────────────────────────────────────
  /cmo/templates:
    get:
      operationId: listTemplates
      tags: [cmo.templates]
      summary: List templates
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: [content, brief, email, social, report]
        - name: brand_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Template list
          content:
            application/json:
              schema:
                type: object
                properties:
                  templates:
                    type: array
                    items:
                      $ref: '#/components/schemas/Template'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

    post:
      operationId: createTemplate
      tags: [cmo.templates]
      summary: Create template
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Template'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Template'

  /cmo/templates/{template_id}:
    get:
      operationId: getTemplate
      tags: [cmo.templates]
      summary: Get template
      parameters:
        - name: template_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      responses:
        '200':
          description: Template details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Template'

    put:
      operationId: updateTemplate
      tags: [cmo.templates]
      summary: Update template
      parameters:
        - name: template_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Template'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Template'

    delete:
      operationId: deleteTemplate
      tags: [cmo.templates]
      summary: Delete template
      parameters:
        - name: template_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      responses:
        '204':
          description: Deleted

  /cmo/templates/{template_id}/render:
    post:
      operationId: renderTemplate
      tags: [cmo.templates]
      summary: Render template with variables
      parameters:
        - name: template_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [variables]
              properties:
                variables:
                  type: object
                  additionalProperties: true
                brand_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Rendered content
          content:
            application/json:
              schema:
                type: object
                properties:
                  rendered:
                    type: string

  # ─────────────────────────────────────────────────────────────────────────────
  # CMO - APPROVALS
  # ─────────────────────────────────────────────────────────────────────────────
  /cmo/approvals/workflows:
    get:
      operationId: listApprovalWorkflows
      tags: [cmo.approvals]
      summary: List approval workflows
      parameters:
        - name: brand_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Workflow list
          content:
            application/json:
              schema:
                type: object
                properties:
                  workflows:
                    type: array
                    items:
                      $ref: '#/components/schemas/ApprovalWorkflow'

    post:
      operationId: createApprovalWorkflow
      tags: [cmo.approvals]
      summary: Create approval workflow
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApprovalWorkflow'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApprovalWorkflow'

  /cmo/approvals/requests:
    get:
      operationId: listApprovalRequests
      tags: [cmo.approvals]
      summary: List approval requests
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, approved, rejected, cancelled]
        - name: approver_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Request list
          content:
            application/json:
              schema:
                type: object
                properties:
                  requests:
                    type: array
                    items:
                      $ref: '#/components/schemas/ApprovalRequest'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

    post:
      operationId: submitForApproval
      tags: [cmo.approvals]
      summary: Submit content for approval
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content_id, workflow_id]
              properties:
                content_id:
                  $ref: '#/components/schemas/UUID'
                workflow_id:
                  $ref: '#/components/schemas/UUID5'
                comment:
                  type: string
      responses:
        '201':
          description: Submitted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApprovalRequest'

  /cmo/approvals/requests/{request_id}:
    get:
      operationId: getApprovalRequest
      tags: [cmo.approvals]
      summary: Get approval request
      parameters:
        - name: request_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Request details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApprovalRequest'

  /cmo/approvals/requests/{request_id}/decide:
    post:
      operationId: decideApproval
      tags: [cmo.approvals]
      summary: Approve or reject
      parameters:
        - name: request_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [decision]
              properties:
                decision:
                  type: string
                  enum: [approved, rejected]
                comment:
                  type: string
      responses:
        '200':
          description: Decision recorded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApprovalRequest'

  # ─────────────────────────────────────────────────────────────────────────────
  # CMO - IDEAS
  # ─────────────────────────────────────────────────────────────────────────────
  /cmo/ideas:
    get:
      operationId: listIdeas
      tags: [cmo.ideas]
      summary: List content ideas
      parameters:
        - name: brand_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - name: status
          in: query
          schema:
            type: string
            enum: [draft, proposed, approved, in_progress, published, archived]
        - name: pillar_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Idea list
          content:
            application/json:
              schema:
                type: object
                properties:
                  ideas:
                    type: array
                    items:
                      $ref: '#/components/schemas/Idea'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

    post:
      operationId: createIdea
      tags: [cmo.ideas]
      summary: Create idea
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Idea'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Idea'

  /cmo/ideas/generate:
    post:
      operationId: generateIdeas
      tags: [cmo.ideas]
      summary: AI-generate content ideas
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [brand_id]
              properties:
                brand_id:
                  $ref: '#/components/schemas/UUID'
                pillar_id:
                  $ref: '#/components/schemas/UUID'
                topic:
                  type: string
                platforms:
                  type: array
                  items:
                    $ref: '#/components/schemas/Platform'
                count:
                  type: integer
                  default: 5
      responses:
        '200':
          description: Generated ideas
          content:
            application/json:
              schema:
                type: object
                properties:
                  ideas:
                    type: array
                    items:
                      $ref: '#/components/schemas/Idea'

  /cmo/ideas/{idea_id}:
    get:
      operationId: getIdea
      tags: [cmo.ideas]
      summary: Get idea
      parameters:
        - name: idea_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Idea details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Idea'

    put:
      operationId: updateIdea
      tags: [cmo.ideas]
      summary: Update idea
      parameters:
        - name: idea_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Idea'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Idea'

    delete:
      operationId: deleteIdea
      tags: [cmo.ideas]
      summary: Delete idea
      parameters:
        - name: idea_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Deleted

  /cmo/ideas/{idea_id}/to-content:
    post:
      operationId: ideaToContent
      tags: [cmo.ideas]
      summary: Convert idea to content
      parameters:
        - name: idea_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                platform:
                  $ref: '#/components/schemas/Platform'
                persona_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Generated content
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Content'

  # ─────────────────────────────────────────────────────────────────────────────
  # CMO - PILLARS
  # ─────────────────────────────────────────────────────────────────────────────
  /cmo/pillars:
    get:
      operationId: listPillars
      tags: [cmo.pillars]
      summary: List content pillars
      parameters:
        - name: brand_id
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Pillar list
          content:
            application/json:
              schema:
                type: object
                properties:
                  pillars:
                    type: array
                    items:
                      $ref: '#/components/schemas/ContentPillar'

    post:
      operationId: createPillar
      tags: [cmo.pillars]
      summary: Create content pillar
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContentPillar'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContentPillar'

  /cmo/pillars/{pillar_id}:
    get:
      operationId: getPillar
      tags: [cmo.pillars]
      summary: Get pillar
      parameters:
        - name: pillar_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Pillar details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContentPillar'

    put:
      operationId: updatePillar
      tags: [cmo.pillars]
      summary: Update pillar
      parameters:
        - name: pillar_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContentPillar'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContentPillar'

    delete:
      operationId: deletePillar
      tags: [cmo.pillars]
      summary: Delete pillar
      parameters:
        - name: pillar_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Deleted

  # ─────────────────────────────────────────────────────────────────────────────
  # CMO - REPORTS
  # ─────────────────────────────────────────────────────────────────────────────
  /cmo/reports:
    get:
      operationId: listReports
      tags: [cmo.reports]
      summary: List reports
      parameters:
        - name: brand_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - name: type
          in: query
          schema:
            type: string
            enum: [performance, campaign, content, brand_health, competitive, custom]
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Report list
          content:
            application/json:
              schema:
                type: object
                properties:
                  reports:
                    type: array
                    items:
                      $ref: '#/components/schemas/Report'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

    post:
      operationId: createReport
      tags: [cmo.reports]
      summary: Create report
      parameters:
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Report'
      responses:
        '201':
          description: Created (generation started)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Report'

  /cmo/reports/{report_id}:
    get:
      operationId: getReport
      tags: [cmo.reports]
      summary: Get report
      parameters:
        - name: report_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Report details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Report'

    delete:
      operationId: deleteReport
      tags: [cmo.reports]
      summary: Delete report
      parameters:
        - name: report_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Deleted

  /cmo/reports/{report_id}/regenerate:
    post:
      operationId: regenerateReport
      tags: [cmo.reports]
      summary: Regenerate report
      parameters:
        - name: report_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '202':
          description: Regeneration started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Report'

  # ─────────────────────────────────────────────────────────────────────────────
  # CMO - HASHTAGS
  # ─────────────────────────────────────────────────────────────────────────────
  /cmo/hashtags/suggest:
    post:
      operationId: suggestHashtags
      tags: [cmo.hashtags]
      summary: Suggest hashtags for content
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content]
              properties:
                content:
                  type: string
                platform:
                  $ref: '#/components/schemas/Platform'
                brand_id:
                  $ref: '#/components/schemas/UUID'
                count:
                  type: integer
                  default: 10
      responses:
        '200':
          description: Suggested hashtags
          content:
            application/json:
              schema:
                type: object
                properties:
                  hashtags:
                    type: array
                    items:
                      $ref: '#/components/schemas/Hashtag'

  /cmo/hashtags/trending:
    get:
      operationId: getTrendingHashtags
      tags: [cmo.hashtags]
      summary: Get trending hashtags
      parameters:
        - name: platform
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/Platform'
        - name: category
          in: query
          schema:
            type: string
        - $ref: '#/components/parameters/PageLimit'
      responses:
        '200':
          description: Trending hashtags
          content:
            application/json:
              schema:
                type: object
                properties:
                  hashtags:
                    type: array
                    items:
                      $ref: '#/components/schemas/Hashtag'

  /cmo/hashtags/research:
    post:
      operationId: researchHashtag
      tags: [cmo.hashtags]
      summary: Research hashtag performance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [hashtag]
              properties:
                hashtag:
                  type: string
                platforms:
                  type: array
                  items:
                    $ref: '#/components/schemas/Platform'
      responses:
        '200':
          description: Hashtag research
          content:
            application/json:
              schema:
                type: object
                properties:
                  hashtag:
                    $ref: '#/components/schemas/Hashtag'
                  related:
                    type: array
                    items:
                      $ref: '#/components/schemas/Hashtag'
                  volume_history:
                    type: array
                    items:
                      type: object
                      properties:
                        date:
                          type: string
                          format: date
                        volume:
                          type: integer

  # ─────────────────────────────────────────────────────────────────────────────
  # COMPOSITOR - QUEUE
  # ─────────────────────────────────────────────────────────────────────────────
  /compositor/queue:
    get:
      operationId: getRenderQueueStats
      tags: [compositor.queue]
      summary: Get render queue stats
      responses:
        '200':
          description: Queue stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RenderQueueStats'

  /compositor/queue/jobs:
    get:
      operationId: listQueuedJobs
      tags: [compositor.queue]
      summary: List queued render jobs
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, running]
        - name: priority
          in: query
          schema:
            type: string
            enum: [low, normal, high, urgent]
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Queued jobs
          content:
            application/json:
              schema:
                type: object
                properties:
                  jobs:
                    type: array
                    items:
                      $ref: '#/components/schemas/RenderJob'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

  /compositor/queue/jobs/{job_id}/priority:
    put:
      operationId: updateJobPriority
      tags: [compositor.queue]
      summary: Update job priority
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [priority]
              properties:
                priority:
                  type: string
                  enum: [low, normal, high, urgent]
      responses:
        '200':
          description: Priority updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RenderJob'

  # ─────────────────────────────────────────────────────────────────────────────
  # COMPOSITOR - WORKERS
  # ─────────────────────────────────────────────────────────────────────────────
  /compositor/workers:
    get:
      operationId: listRenderWorkers
      tags: [compositor.workers]
      summary: List render workers
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [idle, busy, warming, error, offline]
        - name: region
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Worker list
          content:
            application/json:
              schema:
                type: object
                properties:
                  workers:
                    type: array
                    items:
                      $ref: '#/components/schemas/RenderWorker'

  /compositor/workers/{worker_id}:
    get:
      operationId: getRenderWorker
      tags: [compositor.workers]
      summary: Get worker details
      parameters:
        - name: worker_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Worker details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RenderWorker'

  /compositor/workers/{worker_id}/warm:
    post:
      operationId: warmWorker
      tags: [compositor.workers]
      summary: Warm up worker with model
      parameters:
        - name: worker_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [models]
              properties:
                models:
                  type: array
                  items:
                    type: string
      responses:
        '202':
          description: Warming started

  # ─────────────────────────────────────────────────────────────────────────────
  # COMPOSITOR - LORAS
  # ─────────────────────────────────────────────────────────────────────────────
  /compositor/loras:
    get:
      operationId: listLoRAs
      tags: [compositor.loras]
      summary: List LoRAs
      parameters:
        - name: brand_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - name: type
          in: query
          schema:
            type: string
            enum: [persona, style, object, concept]
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, training, ready, failed, archived]
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: LoRA list
          content:
            application/json:
              schema:
                type: object
                properties:
                  loras:
                    type: array
                    items:
                      $ref: '#/components/schemas/LoRA'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

    post:
      operationId: createLoRA
      tags: [compositor.loras]
      summary: Create LoRA (queue training)
      parameters:
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, type, training_images]
              properties:
                name:
                  type: string
                description:
                  type: string
                type:
                  type: string
                  enum: [persona, style, object, concept]
                base_model:
                  type: string
                  default: flux-dev
                persona_id:
                  $ref: '#/components/schemas/UUID'
                brand_id:
                  $ref: '#/components/schemas/UUID'
                training_images:
                  type: array
                  items:
                    type: string
                    format: uri
                  minItems: 5
                training_config:
                  $ref: '#/components/schemas/LoRATrainingConfig'
      responses:
        '202':
          description: Training queued
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoRA'

  /compositor/loras/{lora_id}:
    get:
      operationId: getLoRA
      tags: [compositor.loras]
      summary: Get LoRA
      parameters:
        - name: lora_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: LoRA details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoRA'

    delete:
      operationId: deleteLoRA
      tags: [compositor.loras]
      summary: Delete LoRA
      parameters:
        - name: lora_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Deleted

  /compositor/loras/{lora_id}/training:
    get:
      operationId: getLoRATrainingStatus
      tags: [compositor.loras]
      summary: Get training status
      parameters:
        - name: lora_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Training status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoRATrainingJob'

  # ─────────────────────────────────────────────────────────────────────────────
  # COMPOSITOR - CACHE
  # ─────────────────────────────────────────────────────────────────────────────
  /compositor/cache:
    get:
      operationId: getCacheStats
      tags: [compositor.cache]
      summary: Get render cache stats
      responses:
        '200':
          description: Cache stats
          content:
            application/json:
              schema:
                type: object
                properties:
                  size_bytes:
                    type: integer
                  entries:
                    type: integer
                  hit_rate:
                    type: number
                  by_model:
                    type: object
                    additionalProperties:
                      type: integer

  /compositor/cache/invalidate:
    post:
      operationId: invalidateCache
      tags: [compositor.cache]
      summary: Invalidate cache entries
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                model:
                  type: string
                brand_id:
                  $ref: '#/components/schemas/UUID'
                older_than:
                  type: string
                  format: date-time
                all:
                  type: boolean
                  default: false
      responses:
        '200':
          description: Invalidation result
          content:
            application/json:
              schema:
                type: object
                properties:
                  invalidated:
                    type: integer

  # ─────────────────────────────────────────────────────────────────────────────
  # COMPOSITOR - TRANSCODE
  # ─────────────────────────────────────────────────────────────────────────────
  /compositor/transcode:
    post:
      operationId: createTranscodeJob
      tags: [compositor.transcode]
      summary: Create transcode job
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [input_url, output_format]
              properties:
                input_url:
                  type: string
                  format: uri
                output_format:
                  type: string
                  enum: [mp4, webm, gif, mov]
                resolution:
                  type: string
                bitrate:
                  type: integer
                fps:
                  type: integer
      responses:
        '202':
          description: Transcode started
          content:
            application/json:
              schema:
                type: object
                properties:
                  job_id:
                    $ref: '#/components/schemas/UUID'
                  status:
                    type: string

  /compositor/transcode/{job_id}:
    get:
      operationId: getTranscodeJob
      tags: [compositor.transcode]
      summary: Get transcode job
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Transcode job status
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    $ref: '#/components/schemas/UUID'
                  status:
                    $ref: '#/components/schemas/JobStatus'
                  progress:
                    type: number
                  output_url:
                    type: string
                    format: uri

  # ─────────────────────────────────────────────────────────────────────────────
  # DISCOVERY
  # ─────────────────────────────────────────────────────────────────────────────
  /discovery/sessions:
    get:
      operationId: listDiscoverySessions
      tags: [discovery]
      summary: List discovery sessions
      parameters:
        - name: brand_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - name: status
          in: query
          schema:
            type: string
            enum: [active, paused, completed, abandoned]
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Session list
          content:
            application/json:
              schema:
                type: object
                properties:
                  sessions:
                    type: array
                    items:
                      $ref: '#/components/schemas/DiscoverySession'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

    post:
      operationId: createDiscoverySession
      tags: [discovery]
      summary: Start discovery session
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [brand_id]
              properties:
                brand_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '201':
          description: Session started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DiscoverySession'

  /discovery/sessions/{session_id}:
    get:
      operationId: getDiscoverySession
      tags: [discovery]
      summary: Get discovery session
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Session details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DiscoverySession'

  /discovery/sessions/{session_id}/questions/next:
    get:
      operationId: getNextQuestion
      tags: [discovery]
      summary: Get next discovery question
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Next question
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DiscoveryQuestion'

  /discovery/sessions/{session_id}/answer:
    post:
      operationId: answerDiscoveryQuestion
      tags: [discovery]
      summary: Submit answer
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [question_id, answer]
              properties:
                question_id:
                  $ref: '#/components/schemas/UUID5'
                answer:
                  type: string
      responses:
        '200':
          description: Answer processed
          content:
            application/json:
              schema:
                type: object
                properties:
                  extractions:
                    type: array
                    items:
                      $ref: '#/components/schemas/Extraction'
                  next_question:
                    $ref: '#/components/schemas/DiscoveryQuestion'

  /discovery/sessions/{session_id}/complete:
    post:
      operationId: completeDiscoverySession
      tags: [discovery]
      summary: Complete discovery session
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Session completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DiscoverySession'

  # ─────────────────────────────────────────────────────────────────────────────
  # INGESTION
  # ─────────────────────────────────────────────────────────────────────────────
  /ingestion/jobs:
    get:
      operationId: listIngestionJobs
      tags: [ingestion]
      summary: List ingestion jobs
      parameters:
        - name: brand_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, crawling, extracting, validating, complete, failed]
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Job list
          content:
            application/json:
              schema:
                type: object
                properties:
                  jobs:
                    type: array
                    items:
                      $ref: '#/components/schemas/IngestionJob'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

    post:
      operationId: createIngestionJob
      tags: [ingestion]
      summary: Start ingestion job
      parameters:
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [brand_id, source_type]
              properties:
                brand_id:
                  $ref: '#/components/schemas/UUID'
                source_type:
                  type: string
                  enum: [website, social, document, figma, salesforce, hubspot, manual]
                source_url:
                  type: string
                  format: uri
                config:
                  type: object
                  additionalProperties: true
      responses:
        '202':
          description: Job started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngestionJob'

  /ingestion/jobs/{job_id}:
    get:
      operationId: getIngestionJob
      tags: [ingestion]
      summary: Get ingestion job
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Job details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngestionJob'

  /ingestion/jobs/{job_id}/cancel:
    post:
      operationId: cancelIngestionJob
      tags: [ingestion]
      summary: Cancel ingestion job
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngestionJob'

  /ingestion/sources:
    get:
      operationId: listIngestionSources
      tags: [ingestion]
      summary: List ingestion sources
      parameters:
        - name: brand_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Source list
          content:
            application/json:
              schema:
                type: object
                properties:
                  sources:
                    type: array
                    items:
                      $ref: '#/components/schemas/IngestionSource'

    post:
      operationId: createIngestionSource
      tags: [ingestion]
      summary: Create ingestion source
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngestionSource'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngestionSource'

  # ─────────────────────────────────────────────────────────────────────────────
  # KNOWLEDGE GRAPH
  # ─────────────────────────────────────────────────────────────────────────────
  /graph/query:
    post:
      operationId: queryGraph
      tags: [graph]
      summary: Query knowledge graph
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GraphQuery'
      responses:
        '200':
          description: Query result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GraphQueryResult'

  /graph/entities:
    get:
      operationId: listGraphEntities
      tags: [graph]
      summary: List graph entities
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: [brand, persona, product, audience, competitor, theme, keyword]
        - name: brand_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Entity list
          content:
            application/json:
              schema:
                type: object
                properties:
                  entities:
                    type: array
                    items:
                      $ref: '#/components/schemas/GraphEntity'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

  /graph/entities/{entity_id}:
    get:
      operationId: getGraphEntity
      tags: [graph]
      summary: Get graph entity
      parameters:
        - name: entity_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
      responses:
        '200':
          description: Entity details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GraphEntity'

  /graph/entities/{entity_id}/relationships:
    get:
      operationId: getEntityRelationships
      tags: [graph]
      summary: Get entity relationships
      parameters:
        - name: entity_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID5'
        - name: direction
          in: query
          schema:
            type: string
            enum: [outgoing, incoming, both]
            default: both
      responses:
        '200':
          description: Relationships
          content:
            application/json:
              schema:
                type: object
                properties:
                  relationships:
                    type: array
                    items:
                      $ref: '#/components/schemas/GraphRelationship'

  # ─────────────────────────────────────────────────────────────────────────────
  # CONFIG / FEATURE FLAGS
  # ─────────────────────────────────────────────────────────────────────────────
  /config/flags:
    get:
      operationId: listFeatureFlags
      tags: [config]
      summary: List feature flags
      responses:
        '200':
          description: Flag list
          content:
            application/json:
              schema:
                type: object
                properties:
                  flags:
                    type: array
                    items:
                      $ref: '#/components/schemas/FeatureFlag'

    post:
      operationId: createFeatureFlag
      tags: [config]
      summary: Create feature flag
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FeatureFlag'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeatureFlag'

  /config/flags/{flag_key}:
    get:
      operationId: getFeatureFlag
      tags: [config]
      summary: Get feature flag
      parameters:
        - name: flag_key
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Flag details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeatureFlag'

    put:
      operationId: updateFeatureFlag
      tags: [config]
      summary: Update feature flag
      parameters:
        - name: flag_key
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FeatureFlag'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeatureFlag'

    delete:
      operationId: deleteFeatureFlag
      tags: [config]
      summary: Delete feature flag
      parameters:
        - name: flag_key
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Deleted

  /config/flags/evaluate:
    post:
      operationId: evaluateFlags
      tags: [config]
      summary: Evaluate flags for context
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  $ref: '#/components/schemas/UUID'
                brand_id:
                  $ref: '#/components/schemas/UUID'
                flags:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Evaluated flags
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: boolean

  # ─────────────────────────────────────────────────────────────────────────────
  # SCHEDULER
  # ─────────────────────────────────────────────────────────────────────────────
  /scheduler/jobs:
    get:
      operationId: listScheduledJobs
      tags: [scheduler]
      summary: List scheduled jobs
      parameters:
        - name: enabled
          in: query
          schema:
            type: boolean
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Job list
          content:
            application/json:
              schema:
                type: object
                properties:
                  jobs:
                    type: array
                    items:
                      $ref: '#/components/schemas/ScheduledJob'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

    post:
      operationId: createScheduledJob
      tags: [scheduler]
      summary: Create scheduled job
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScheduledJob'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScheduledJob'

  /scheduler/jobs/{job_id}:
    get:
      operationId: getScheduledJob
      tags: [scheduler]
      summary: Get scheduled job
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Job details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScheduledJob'

    put:
      operationId: updateScheduledJob
      tags: [scheduler]
      summary: Update scheduled job
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScheduledJob'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScheduledJob'

    delete:
      operationId: deleteScheduledJob
      tags: [scheduler]
      summary: Delete scheduled job
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Deleted

  /scheduler/jobs/{job_id}/run:
    post:
      operationId: runScheduledJobNow
      tags: [scheduler]
      summary: Run job immediately
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '202':
          description: Job triggered

  # ─────────────────────────────────────────────────────────────────────────────
  # QUEUES
  # ─────────────────────────────────────────────────────────────────────────────
  /queues:
    get:
      operationId: listQueues
      tags: [queues]
      summary: List job queues
      responses:
        '200':
          description: Queue list
          content:
            application/json:
              schema:
                type: object
                properties:
                  queues:
                    type: array
                    items:
                      $ref: '#/components/schemas/QueueStats'

  /queues/{queue_name}:
    get:
      operationId: getQueueStats
      tags: [queues]
      summary: Get queue stats
      parameters:
        - name: queue_name
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Queue stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueueStats'

  /queues/{queue_name}/dlq:
    get:
      operationId: getDeadLetterQueue
      tags: [queues]
      summary: Get dead letter queue items
      parameters:
        - name: queue_name
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: DLQ items
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/DeadLetterItem'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

  /queues/{queue_name}/dlq/{item_id}/retry:
    post:
      operationId: retryDeadLetterItem
      tags: [queues]
      summary: Retry dead letter item
      parameters:
        - name: queue_name
          in: path
          required: true
          schema:
            type: string
        - name: item_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '202':
          description: Retrying

  # ─────────────────────────────────────────────────────────────────────────────
  # AUTH
  # ─────────────────────────────────────────────────────────────────────────────
  /auth/token:
    post:
      operationId: createToken
      tags: [auth]
      summary: Create access token
      security: []
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required: [grant_type]
              properties:
                grant_type:
                  type: string
                  enum: [client_credentials, refresh_token]
                client_id:
                  type: string
                client_secret:
                  type: string
                refresh_token:
                  type: string
      responses:
        '200':
          description: Token created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'

  /auth/token/revoke:
    post:
      operationId: revokeToken
      tags: [auth]
      summary: Revoke token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
                token_type_hint:
                  type: string
                  enum: [access_token, refresh_token]
      responses:
        '200':
          description: Revoked

  # ─────────────────────────────────────────────────────────────────────────────
  # API KEYS
  # ─────────────────────────────────────────────────────────────────────────────
  /apikeys:
    get:
      operationId: listAPIKeys
      tags: [apikeys]
      summary: List API keys
      responses:
        '200':
          description: API key list
          content:
            application/json:
              schema:
                type: object
                properties:
                  keys:
                    type: array
                    items:
                      $ref: '#/components/schemas/APIKey'

    post:
      operationId: createAPIKey
      tags: [apikeys]
      summary: Create API key
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                scopes:
                  type: array
                  items:
                    type: string
                expires_in_days:
                  type: integer
      responses:
        '201':
          description: Created (key shown once)
          content:
            application/json:
              schema:
                type: object
                properties:
                  key:
                    type: string
                    description: Full key (shown only once)
                  api_key:
                    $ref: '#/components/schemas/APIKey'

  /apikeys/{key_id}:
    get:
      operationId: getAPIKey
      tags: [apikeys]
      summary: Get API key
      parameters:
        - name: key_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: API key details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIKey'

    delete:
      operationId: revokeAPIKey
      tags: [apikeys]
      summary: Revoke API key
      parameters:
        - name: key_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Revoked

  # ─────────────────────────────────────────────────────────────────────────────
  # SESSIONS
  # ─────────────────────────────────────────────────────────────────────────────
  /sessions:
    get:
      operationId: listSessions
      tags: [sessions]
      summary: List active sessions
      responses:
        '200':
          description: Session list
          content:
            application/json:
              schema:
                type: object
                properties:
                  sessions:
                    type: array
                    items:
                      $ref: '#/components/schemas/Session'

  /sessions/{session_id}:
    delete:
      operationId: revokeSession
      tags: [sessions]
      summary: Revoke session
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Revoked

  # ─────────────────────────────────────────────────────────────────────────────
  # PERMISSIONS
  # ─────────────────────────────────────────────────────────────────────────────
  /permissions/roles:
    get:
      operationId: listRoles
      tags: [permissions]
      summary: List roles
      responses:
        '200':
          description: Role list
          content:
            application/json:
              schema:
                type: object
                properties:
                  roles:
                    type: array
                    items:
                      $ref: '#/components/schemas/Role'

  /permissions/check:
    post:
      operationId: checkPermission
      tags: [permissions]
      summary: Check permission
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [permission]
              properties:
                permission:
                  type: string
                resource_type:
                  type: string
                resource_id:
                  type: string
      responses:
        '200':
          description: Permission check result
          content:
            application/json:
              schema:
                type: object
                properties:
                  allowed:
                    type: boolean

  # ─────────────────────────────────────────────────────────────────────────────
  # INTEGRATIONS
  # ─────────────────────────────────────────────────────────────────────────────
  /integrations:
    get:
      operationId: listIntegrations
      tags: [integrations]
      summary: List platform integrations
      parameters:
        - name: brand_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Integration list
          content:
            application/json:
              schema:
                type: object
                properties:
                  integrations:
                    type: array
                    items:
                      $ref: '#/components/schemas/Integration'

  /integrations/{platform}/connect:
    get:
      operationId: initiateOAuth
      tags: [integrations]
      summary: Initiate OAuth flow
      parameters:
        - name: platform
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/Platform'
        - name: brand_id
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: redirect_uri
          in: query
          required: true
          schema:
            type: string
            format: uri
      responses:
        '302':
          description: Redirect to OAuth provider

  /integrations/{platform}/callback:
    get:
      operationId: handleOAuthCallback
      tags: [integrations]
      summary: OAuth callback
      parameters:
        - name: platform
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/Platform'
        - name: code
          in: query
          required: true
          schema:
            type: string
        - name: state
          in: query
          required: true
          schema:
            type: string
      responses:
        '302':
          description: Redirect to app

  /integrations/{integration_id}:
    get:
      operationId: getIntegration
      tags: [integrations]
      summary: Get integration
      parameters:
        - name: integration_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Integration details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Integration'

    delete:
      operationId: disconnectIntegration
      tags: [integrations]
      summary: Disconnect integration
      parameters:
        - name: integration_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Disconnected

  # ─────────────────────────────────────────────────────────────────────────────
  # WEBHOOKS
  # ─────────────────────────────────────────────────────────────────────────────
  /webhooks:
    get:
      operationId: listWebhooks
      tags: [webhooks]
      summary: List webhooks
      responses:
        '200':
          description: Webhook list
          content:
            application/json:
              schema:
                type: object
                properties:
                  webhooks:
                    type: array
                    items:
                      $ref: '#/components/schemas/Webhook'

    post:
      operationId: createWebhook
      tags: [webhooks]
      summary: Create webhook
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [url, events]
              properties:
                url:
                  type: string
                  format: uri
                events:
                  type: array
                  items:
                    $ref: '#/components/schemas/EventType'
      responses:
        '201':
          description: Created (secret shown once)
          content:
            application/json:
              schema:
                type: object
                properties:
                  webhook:
                    $ref: '#/components/schemas/Webhook'
                  secret:
                    type: string

  /webhooks/{webhook_id}:
    get:
      operationId: getWebhook
      tags: [webhooks]
      summary: Get webhook
      parameters:
        - name: webhook_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Webhook details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Webhook'

    put:
      operationId: updateWebhook
      tags: [webhooks]
      summary: Update webhook
      parameters:
        - name: webhook_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                url:
                  type: string
                  format: uri
                events:
                  type: array
                  items:
                    $ref: '#/components/schemas/EventType'
                enabled:
                  type: boolean
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Webhook'

    delete:
      operationId: deleteWebhook
      tags: [webhooks]
      summary: Delete webhook
      parameters:
        - name: webhook_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Deleted

  /webhooks/{webhook_id}/test:
    post:
      operationId: testWebhook
      tags: [webhooks]
      summary: Test webhook
      parameters:
        - name: webhook_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Test result
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  response_code:
                    type: integer
                  response_time_ms:
                    type: integer

  /webhooks/{webhook_id}/deliveries:
    get:
      operationId: listWebhookDeliveries
      tags: [webhooks]
      summary: List webhook deliveries
      parameters:
        - name: webhook_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Delivery list
          content:
            application/json:
              schema:
                type: object
                properties:
                  deliveries:
                    type: array
                    items:
                      $ref: '#/components/schemas/WebhookDelivery'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

  /webhooks/{webhook_id}/deliveries/{delivery_id}/redeliver:
    post:
      operationId: redeliverWebhook
      tags: [webhooks]
      summary: Redeliver webhook
      parameters:
        - name: webhook_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - name: delivery_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '202':
          description: Redelivering

  # ─────────────────────────────────────────────────────────────────────────────
  # SEARCH
  # ─────────────────────────────────────────────────────────────────────────────
  /search:
    post:
      operationId: search
      tags: [search]
      summary: Full-text search
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchQuery'
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResult'

  # ─────────────────────────────────────────────────────────────────────────────
  # SCHEMAS / MIGRATIONS
  # ─────────────────────────────────────────────────────────────────────────────
  /schemas/versions:
    get:
      operationId: listSchemaVersions
      tags: [schemas]
      summary: List schema versions
      responses:
        '200':
          description: Version list
          content:
            application/json:
              schema:
                type: object
                properties:
                  versions:
                    type: array
                    items:
                      $ref: '#/components/schemas/SchemaVersion'
                  current:
                    type: string

  /schemas/migrations:
    get:
      operationId: listMigrations
      tags: [schemas]
      summary: List pending migrations
      responses:
        '200':
          description: Migration list
          content:
            application/json:
              schema:
                type: object
                properties:
                  pending:
                    type: array
                    items:
                      $ref: '#/components/schemas/Migration'
                  applied:
                    type: array
                    items:
                      $ref: '#/components/schemas/Migration'

    post:
      operationId: runMigrations
      tags: [schemas]
      summary: Run pending migrations
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                dry_run:
                  type: boolean
                  default: true
                target_version:
                  type: string
      responses:
        '200':
          description: Migration result
          content:
            application/json:
              schema:
                type: object
                properties:
                  applied:
                    type: array
                    items:
                      $ref: '#/components/schemas/Migration'

  # ─────────────────────────────────────────────────────────────────────────────
  # AUDIT
  # ─────────────────────────────────────────────────────────────────────────────
  /audit:
    get:
      operationId: listAuditEntries
      tags: [audit]
      summary: List audit entries
      parameters:
        - name: user_id
          in: query
          schema:
            $ref: '#/components/schemas/UUID'
        - name: action
          in: query
          schema:
            type: string
        - name: resource_type
          in: query
          schema:
            type: string
        - name: since
          in: query
          schema:
            type: string
            format: date-time
        - $ref: '#/components/parameters/PageLimit'
        - $ref: '#/components/parameters/PageCursor'
      responses:
        '200':
          description: Audit entries
          content:
            application/json:
              schema:
                type: object
                properties:
                  entries:
                    type: array
                    items:
                      $ref: '#/components/schemas/AuditEntry'
                  page_info:
                    $ref: '#/components/schemas/PageInfo'

  /audit/{entry_id}:
    get:
      operationId: getAuditEntry
      tags: [audit]
      summary: Get audit entry
      parameters:
        - name: entry_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Audit entry
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditEntry'

  # ─────────────────────────────────────────────────────────────────────────────
  # EXPORT
  # ─────────────────────────────────────────────────────────────────────────────
  /export:
    post:
      operationId: createExportJob
      tags: [export]
      summary: Create data export
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [type]
              properties:
                type:
                  type: string
                  enum: [brand, content, analytics, full]
                brand_id:
                  $ref: '#/components/schemas/UUID'
                format:
                  type: string
                  enum: [json, csv, zip]
                  default: zip
      responses:
        '202':
          description: Export started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExportJob'

  /export/{job_id}:
    get:
      operationId: getExportJob
      tags: [export]
      summary: Get export job
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Export job status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExportJob'
        '303':
          description: Export ready - redirect to download
          headers:
            Location:
              schema:
                type: string
                format: uri

  # ─────────────────────────────────────────────────────────────────────────────
  # BULK OPERATIONS
  # ─────────────────────────────────────────────────────────────────────────────
  /bulk/content:
    post:
      operationId: bulkCreateContent
      tags: [bulk]
      summary: Bulk create content
      parameters:
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [items]
              properties:
                items:
                  type: array
                  items:
                    $ref: '#/components/schemas/ContentGenerateRequest'
                  maxItems: 100
      responses:
        '202':
          description: Bulk operation started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkOperation'

  /bulk/publish:
    post:
      operationId: bulkPublish
      tags: [bulk]
      summary: Bulk publish content
      parameters:
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content_ids, platforms]
              properties:
                content_ids:
                  type: array
                  items:
                    $ref: '#/components/schemas/UUID'
                  maxItems: 100
                platforms:
                  type: array
                  items:
                    $ref: '#/components/schemas/Platform'
      responses:
        '202':
          description: Bulk operation started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkOperation'

  /bulk/{operation_id}:
    get:
      operationId: getBulkOperation
      tags: [bulk]
      summary: Get bulk operation status
      parameters:
        - name: operation_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Operation status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkOperation'

  # ─────────────────────────────────────────────────────────────────────────────
  # SANDBOX
  # ─────────────────────────────────────────────────────────────────────────────
  /sandbox/reset:
    post:
      operationId: resetSandbox
      tags: [sandbox]
      summary: Reset sandbox environment
      responses:
        '200':
          description: Sandbox reset
          content:
            application/json:
              schema:
                type: object
                properties:
                  reset_at:
                    type: string
                    format: date-time

  /sandbox/seed:
    post:
      operationId: seedSandbox
      tags: [sandbox]
      summary: Seed sandbox with test data
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                brands:
                  type: integer
                  default: 1
                content_per_brand:
                  type: integer
                  default: 10
                campaigns_per_brand:
                  type: integer
                  default: 2
      responses:
        '200':
          description: Sandbox seeded
          content:
            application/json:
              schema:
                type: object
                properties:
                  created:
                    type: object
                    additionalProperties:
                      type: integer

  # ─────────────────────────────────────────────────────────────────────────────
  # SDK
  # ─────────────────────────────────────────────────────────────────────────────
  /sdk/config:
    get:
      operationId: getSDKConfig
      tags: [sdk]
      summary: Get SDK configuration
      security: []
      responses:
        '200':
          description: SDK config
          content:
            application/json:
              schema:
                type: object
                properties:
                  api_version:
                    type: string
                  endpoints:
                    type: object
                    properties:
                      rest:
                        type: string
                        format: uri
                      websocket:
                        type: string
                        format: uri
                  features:
                    type: object
                    additionalProperties:
                      type: boolean

  /openapi.json:
    get:
      operationId: getOpenAPISpec
      tags: [sdk]
      summary: Get OpenAPI specification
      security: []
      responses:
        '200':
          description: OpenAPI spec
          content:
            application/json:
              schema:
                type: object

  # ─────────────────────────────────────────────────────────────────────────────
  # DEBUG
  # ─────────────────────────────────────────────────────────────────────────────
  /debug/traces/{trace_id}:
    get:
      operationId: getTrace
      tags: [debug]
      summary: Get distributed trace
      parameters:
        - name: trace_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Trace details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Trace'

  /debug/requests/{request_id}:
    get:
      operationId: getRequestDebug
      tags: [debug]
      summary: Get request debug info
      parameters:
        - name: request_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Request debug info
          content:
            application/json:
              schema:
                type: object
                properties:
                  request_id:
                    $ref: '#/components/schemas/UUID'
                  trace:
                    $ref: '#/components/schemas/Trace'
                  logs:
                    type: array
                    items:
                      type: object
                  coeffects:
                    $ref: '#/components/schemas/Coeffect'
