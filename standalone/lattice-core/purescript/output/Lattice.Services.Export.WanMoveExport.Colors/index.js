// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_EuclideanRing from "../Data.EuclideanRing/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
var min = /* #__PURE__ */ Data_Ord.min(Data_Ord.ordNumber);
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordNumber);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var mod = /* #__PURE__ */ Data_EuclideanRing.mod(Data_EuclideanRing.euclideanRingInt);
var viridisGradient = {
    stops: [ {
        position: 0.0,
        color: {
            r: 68,
            g: 1,
            b: 84
        }
    }, {
        position: 0.25,
        color: {
            r: 59,
            g: 82,
            b: 139
        }
    }, {
        position: 0.5,
        color: {
            r: 33,
            g: 145,
            b: 140
        }
    }, {
        position: 0.75,
        color: {
            r: 94,
            g: 201,
            b: 98
        }
    }, {
        position: 1.0,
        color: {
            r: 253,
            g: 231,
            b: 37
        }
    } ]
};
var rainbowGradient = {
    stops: [ {
        position: 0.0,
        color: {
            r: 255,
            g: 0,
            b: 0
        }
    }, {
        position: 0.2,
        color: {
            r: 255,
            g: 165,
            b: 0
        }
    }, {
        position: 0.4,
        color: {
            r: 255,
            g: 255,
            b: 0
        }
    }, {
        position: 0.6,
        color: {
            r: 0,
            g: 255,
            b: 0
        }
    }, {
        position: 0.8,
        color: {
            r: 0,
            g: 0,
            b: 255
        }
    }, {
        position: 1.0,
        color: {
            r: 128,
            g: 0,
            b: 128
        }
    } ]
};
var plasmaGradient = {
    stops: [ {
        position: 0.0,
        color: {
            r: 13,
            g: 8,
            b: 135
        }
    }, {
        position: 0.25,
        color: {
            r: 126,
            g: 3,
            b: 168
        }
    }, {
        position: 0.5,
        color: {
            r: 204,
            g: 71,
            b: 120
        }
    }, {
        position: 0.75,
        color: {
            r: 248,
            g: 149,
            b: 64
        }
    }, {
        position: 1.0,
        color: {
            r: 240,
            g: 249,
            b: 33
        }
    } ]
};
var normalizeData = function (values) {
    var minVal = Data_Array.foldl(min)(0.0)(values);
    var maxVal = Data_Array.foldl(max)(0.0)(values);
    var range = maxVal - minVal;
    var safeRange = (function () {
        var $21 = range > 0.0;
        if ($21) {
            return range;
        };
        return 1.0;
    })();
    return map(function (v) {
        return (v - minVal) / safeRange;
    })(values);
};
var interpolateGradient = function (stops) {
    return function (t) {
        var first = Data_Maybe.fromMaybe({
            position: 0.0,
            color: {
                r: 0,
                g: 0,
                b: 0
            }
        })(Data_Array.index(stops)(0));
        var last = Data_Maybe.fromMaybe(first)(Data_Array.index(stops)(Data_Array.length(stops) - 1 | 0));
        var findStops = function ($copy_lower) {
            return function ($copy_upper) {
                return function ($copy_idx) {
                    var $tco_var_lower = $copy_lower;
                    var $tco_var_upper = $copy_upper;
                    var $tco_done = false;
                    var $tco_result;
                    function $tco_loop(lower, upper, idx) {
                        var $22 = idx >= (Data_Array.length(stops) - 1 | 0);
                        if ($22) {
                            $tco_done = true;
                            return {
                                lower: lower,
                                upper: upper
                            };
                        };
                        var current = Data_Maybe.fromMaybe(lower)(Data_Array.index(stops)(idx));
                        var next = Data_Maybe.fromMaybe(current)(Data_Array.index(stops)(idx + 1 | 0));
                        var $23 = t >= current.position && t <= next.position;
                        if ($23) {
                            $tco_done = true;
                            return {
                                lower: current,
                                upper: next
                            };
                        };
                        $tco_var_lower = lower;
                        $tco_var_upper = upper;
                        $copy_idx = idx + 1 | 0;
                        return;
                    };
                    while (!$tco_done) {
                        $tco_result = $tco_loop($tco_var_lower, $tco_var_upper, $copy_idx);
                    };
                    return $tco_result;
                };
            };
        };
        var v = findStops(first)(last)(0);
        var range = v.upper.position - v.lower.position;
        var localT = (function () {
            var $25 = range > 0.0;
            if ($25) {
                return (t - v.lower.position) / range;
            };
            return 0.0;
        })();
        return {
            r: Data_Int.round(Data_Int.toNumber(v.lower.color.r) + (Data_Int.toNumber(v.upper.color.r) - Data_Int.toNumber(v.lower.color.r)) * localT),
            g: Data_Int.round(Data_Int.toNumber(v.lower.color.g) + (Data_Int.toNumber(v.upper.color.g) - Data_Int.toNumber(v.lower.color.g)) * localT),
            b: Data_Int.round(Data_Int.toNumber(v.lower.color.b) + (Data_Int.toNumber(v.upper.color.b) - Data_Int.toNumber(v.lower.color.b)) * localT)
        };
    };
};
var sampleGradient = function (gradient) {
    return function (t) {
        var n = Data_Array.length(gradient.stops);
        var clampedT = max(0.0)(min(1.0)(t));
        var $28 = n === 0;
        if ($28) {
            return {
                r: 128,
                g: 128,
                b: 128
            };
        };
        var $29 = n === 1;
        if ($29) {
            var firstStop = Data_Maybe.fromMaybe({
                position: 0.0,
                color: {
                    r: 128,
                    g: 128,
                    b: 128
                }
            })(Data_Array.index(gradient.stops)(0));
            return firstStop.color;
        };
        return interpolateGradient(gradient.stops)(clampedT);
    };
};
var infernoGradient = {
    stops: [ {
        position: 0.0,
        color: {
            r: 0,
            g: 0,
            b: 4
        }
    }, {
        position: 0.25,
        color: {
            r: 87,
            g: 16,
            b: 110
        }
    }, {
        position: 0.5,
        color: {
            r: 188,
            g: 55,
            b: 84
        }
    }, {
        position: 0.75,
        color: {
            r: 249,
            g: 142,
            b: 9
        }
    }, {
        position: 1.0,
        color: {
            r: 252,
            g: 255,
            b: 164
        }
    } ]
};
var depthGradient = {
    stops: [ {
        position: 0.0,
        color: {
            r: 0,
            g: 0,
            b: 0
        }
    }, {
        position: 1.0,
        color: {
            r: 255,
            g: 255,
            b: 255
        }
    } ]
};
var coolWarmGradient = {
    stops: [ {
        position: 0.0,
        color: {
            r: 59,
            g: 76,
            b: 192
        }
    }, {
        position: 0.5,
        color: {
            r: 221,
            g: 221,
            b: 221
        }
    }, {
        position: 1.0,
        color: {
            r: 180,
            g: 4,
            b: 38
        }
    } ]
};
var getGradient = function (name) {
    if (name === "viridis") {
        return viridisGradient;
    };
    if (name === "plasma") {
        return plasmaGradient;
    };
    if (name === "inferno") {
        return infernoGradient;
    };
    if (name === "cool-warm") {
        return coolWarmGradient;
    };
    if (name === "rainbow") {
        return rainbowGradient;
    };
    if (name === "depth") {
        return depthGradient;
    };
    return viridisGradient;
};
var addTimeColorToTrajectory = function (trajectory) {
    return function (gradientName) {
        var numTracks = Data_Array.length(trajectory.tracks);
        var gradient = getGradient(gradientName);
        var colors = map(function (i) {
            var trackLen = (function () {
                var v = Data_Array.index(trajectory.tracks)(i);
                if (v instanceof Data_Maybe.Just) {
                    return Data_Array.length(v.value0);
                };
                if (v instanceof Data_Maybe.Nothing) {
                    return 0;
                };
                throw new Error("Failed pattern match at Lattice.Services.Export.WanMoveExport.Colors (line 234, column 20 - line 236, column 23): " + [ v.constructor.name ]);
            })();
            return map(function (f) {
                var t = (function () {
                    var $33 = trajectory.metadata.numFrames > 1;
                    if ($33) {
                        return Data_Int.toNumber(f) / Data_Int.toNumber(trajectory.metadata.numFrames - 1 | 0);
                    };
                    return 0.0;
                })();
                return sampleGradient(gradient)(t);
            })(Data_Array.range(0)(trackLen - 1 | 0));
        })(Data_Array.range(0)(numTracks - 1 | 0));
        return {
            tracks: trajectory.tracks,
            visibility: trajectory.visibility,
            metadata: trajectory.metadata,
            colors: new Data_Maybe.Just(colors),
            dataValues: Data_Maybe.Nothing.value,
            trailLength: Data_Maybe.Nothing.value
        };
    };
};
var addColorToTrajectory = function (trajectory) {
    return function (dataValues) {
        return function (gradientName) {
            var numTracks = Data_Array.length(trajectory.tracks);
            var normalized = normalizeData(dataValues);
            var numData = Data_Array.length(normalized);
            var gradient = getGradient(gradientName);
            var colors = map(function (i) {
                var trackLen = (function () {
                    var v = Data_Array.index(trajectory.tracks)(i);
                    if (v instanceof Data_Maybe.Just) {
                        return Data_Array.length(v.value0);
                    };
                    if (v instanceof Data_Maybe.Nothing) {
                        return 0;
                    };
                    throw new Error("Failed pattern match at Lattice.Services.Export.WanMoveExport.Colors (line 205, column 20 - line 207, column 23): " + [ v.constructor.name ]);
                })();
                var dataIdx = mod(i)(numData);
                var normalizedValue = Data_Maybe.fromMaybe(0.5)(Data_Array.index(normalized)(dataIdx));
                var color = sampleGradient(gradient)(normalizedValue);
                return map(function (v) {
                    return color;
                })(Data_Array.range(0)(trackLen - 1 | 0));
            })(Data_Array.range(0)(numTracks - 1 | 0));
            return {
                tracks: trajectory.tracks,
                visibility: trajectory.visibility,
                metadata: trajectory.metadata,
                colors: new Data_Maybe.Just(colors),
                dataValues: new Data_Maybe.Just(dataValues),
                trailLength: Data_Maybe.Nothing.value
            };
        };
    };
};
export {
    viridisGradient,
    plasmaGradient,
    infernoGradient,
    coolWarmGradient,
    rainbowGradient,
    depthGradient,
    getGradient,
    sampleGradient,
    normalizeData,
    addColorToTrajectory,
    addTimeColorToTrajectory
};
//# sourceMappingURL=index.js.map
