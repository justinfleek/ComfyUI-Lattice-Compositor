// Generated by purs version 0.15.15
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Boolean from "../Data.Boolean/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Identity from "../Data.Identity/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Effect_Aff from "../Effect.Aff/index.js";
import * as Test_Lattice_TestHelpers from "../Test.Lattice.TestHelpers/index.js";
import * as Test_Spec from "../Test.Spec/index.js";
import * as Test_Spec_Assertions from "../Test.Spec.Assertions/index.js";
var describe = /* #__PURE__ */ Test_Spec.describe(Data_Identity.monadIdentity);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit);
var discard1 = /* #__PURE__ */ discard(/* #__PURE__ */ Test_Spec.bindSpecT(Data_Identity.bindIdentity));
var it = /* #__PURE__ */ Test_Spec.it(Data_Identity.monadIdentity)(Test_Spec.exampleMUnit);
var shouldEqual = /* #__PURE__ */ Test_Spec_Assertions.shouldEqual(Effect_Aff.monadThrowAff)(Data_Show.showBoolean)(Data_Eq.eqBoolean);
var discard2 = /* #__PURE__ */ discard(Effect_Aff.bindAff);
var visibilityInteractionTests = /* #__PURE__ */ describe("visibility and opacity interaction")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("invisible layer skips render regardless of opacity")(/* #__PURE__ */ (function () {
    var shouldRender = false && 100.0 > 0.0;
    return shouldEqual(shouldRender)(false);
})()))(function () {
    return discard1(it("visible layer with opacity > 0 renders")((function () {
        var shouldRender = true && 50.0 > 0.0;
        return shouldEqual(shouldRender)(true);
    })()))(function () {
        return discard1(it("visible layer with opacity = 0 skips render")((function () {
            var shouldRender = true && 0.0 > 0.0;
            return shouldEqual(shouldRender)(false);
        })()))(function () {
            return it("group * layer opacity multiplication")((function () {
                var combined = (80.0 / 100.0) * (50.0 / 100.0);
                return Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(0.4)(combined);
            })());
        });
    });
}));
var opacityToAlpha = function (opacity) {
    return opacity / 100.0;
};
var conversionTests = /* #__PURE__ */ describe("opacity conversion formula")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("0% opacity converts to 0.0 alpha")(/* #__PURE__ */ Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(0.0)(/* #__PURE__ */ opacityToAlpha(0.0))))(function () {
    return discard1(it("100% opacity converts to 1.0 alpha")(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(1.0)(opacityToAlpha(100.0))))(function () {
        return discard1(it("50% opacity converts to 0.5 alpha")(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(0.5)(opacityToAlpha(50.0))))(function () {
            return discard1(it("75.5% opacity converts correctly")(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(0.755)(opacityToAlpha(75.5))))(function () {
                return it("common opacity values convert correctly")(discard2(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(0.1)(opacityToAlpha(10.0)))(function () {
                    return discard2(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(0.25)(opacityToAlpha(25.0)))(function () {
                        return discard2(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(0.33)(opacityToAlpha(33.0)))(function () {
                            return discard2(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(0.66)(opacityToAlpha(66.0)))(function () {
                                return discard2(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(0.75)(opacityToAlpha(75.0)))(function () {
                                    return Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(0.9)(opacityToAlpha(90.0));
                                });
                            });
                        });
                    });
                }));
            });
        });
    });
}));
var clamp = function (lo) {
    return function (hi) {
        return function (x) {
            if (x < lo) {
                return lo;
            };
            if (x > hi) {
                return hi;
            };
            if (Data_Boolean.otherwise) {
                return x;
            };
            throw new Error("Failed pattern match at Test.Lattice.Export.OpacityRange (line 29, column 1 - line 29, column 46): " + [ lo.constructor.name, hi.constructor.name, x.constructor.name ]);
        };
    };
};
var safeOpacityToAlpha = function (opacity) {
    var $20 = Data_Number["isNaN"](opacity);
    if ($20) {
        return 0.0;
    };
    return clamp(0.0)(1.0)(opacity / 100.0);
};
var clampingTests = /* #__PURE__ */ (function () {
    return describe("invalid opacity clamping")(discard1(it("clamps negative to 0")(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(0.0)(safeOpacityToAlpha(-50.0))))(function () {
        return discard1(it("clamps >100 to 1")(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(1.0)(safeOpacityToAlpha(200.0))))(function () {
            return it("NaN converts to 0")((function () {
                var nan = 0.0 / 0.0;
                return Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(0.0)(safeOpacityToAlpha(nan));
            })());
        });
    }));
})();
var regressionTests = /* #__PURE__ */ describe("opacity regression prevention")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("globalAlpha never exceeds 1.0")(/* #__PURE__ */ (function () {
    var alpha = safeOpacityToAlpha(150.0);
    return shouldEqual(alpha <= 1.0)(true);
})()))(function () {
    return discard1(it("opacity 100 means fully opaque")(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(1.0)(opacityToAlpha(100.0))))(function () {
        return it("opacity 1 is 0.01, not 1.0")(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(1.0e-2)(opacityToAlpha(1.0)));
    });
}));
var spec = /* #__PURE__ */ describe("OpacityRange")(/* #__PURE__ */ discard1(conversionTests)(function () {
    return discard1(clampingTests)(function () {
        return discard1(visibilityInteractionTests)(function () {
            return regressionTests;
        });
    });
}));
export {
    spec
};
//# sourceMappingURL=index.js.map
