// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Identity from "../Data.Identity/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_String_CodeUnits from "../Data.String.CodeUnits/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Effect_Aff from "../Effect.Aff/index.js";
import * as Lattice_Services_Export_ATI from "../Lattice.Services.Export.ATI/index.js";
import * as Test_Spec from "../Test.Spec/index.js";
import * as Test_Spec_Assertions from "../Test.Spec.Assertions/index.js";
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var describe = /* #__PURE__ */ Test_Spec.describe(Data_Identity.monadIdentity);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit);
var discard1 = /* #__PURE__ */ discard(/* #__PURE__ */ Test_Spec.bindSpecT(Data_Identity.bindIdentity));
var it = /* #__PURE__ */ Test_Spec.it(Data_Identity.monadIdentity)(Test_Spec.exampleMUnit);
var shouldEqual = /* #__PURE__ */ Test_Spec_Assertions.shouldEqual(Effect_Aff.monadThrowAff);
var shouldEqual1 = /* #__PURE__ */ shouldEqual(Data_Show.showBoolean)(Data_Eq.eqBoolean);
var shouldEqual2 = /* #__PURE__ */ shouldEqual(Data_Show.showInt)(Data_Eq.eqInt);
var discard2 = /* #__PURE__ */ discard(Effect_Aff.bindAff);
var fail = /* #__PURE__ */ Test_Spec_Assertions.fail(Effect_Aff.monadThrowAff);
var pure = /* #__PURE__ */ Control_Applicative.pure(Effect_Aff.applicativeAff);
var mkTestTrajectory = function (numPoints) {
    return function (numFrames) {
        return function (width) {
            return function (height) {
                var safeDiv = function (a) {
                    return function (b) {
                        var $25 = b === 0.0;
                        if ($25) {
                            return 0.0;
                        };
                        return a / b;
                    };
                };
                var mkPoint = function (f) {
                    return function (p) {
                        return [ Data_Int.toNumber(p) * safeDiv(Data_Int.toNumber(width))(Data_Int.toNumber(numPoints)), Data_Int.toNumber(f) * safeDiv(Data_Int.toNumber(height))(Data_Int.toNumber(numFrames)) ];
                    };
                };
                var mkTrack = function (p) {
                    return map(function (f) {
                        return mkPoint(f)(p);
                    })(Data_Array.range(0)(numFrames - 1 | 0));
                };
                var tracks = map(mkTrack)(Data_Array.range(0)(numPoints - 1 | 0));
                return {
                    tracks: tracks,
                    width: width,
                    height: height,
                    frameCount: numFrames
                };
            };
        };
    };
};
var validateTests = /* #__PURE__ */ describe("validateForATI")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("valid trajectory passes validation")(/* #__PURE__ */ (function () {
    var traj = mkTestTrajectory(3)(20)(512)(512);
    var result = Lattice_Services_Export_ATI.validateForATI(traj);
    return shouldEqual1(result.valid)(true);
})()))(function () {
    return discard1(it("empty trajectory fails validation (or returns warnings)")((function () {
        var traj = mkTestTrajectory(0)(0)(512)(512);
        var result = Lattice_Services_Export_ATI.validateForATI(traj);
        var hasIssues = Data_Array.length(result.warnings) > 0 || (Data_Array.length(result.errors) > 0 || result.valid === false);
        return shouldEqual1(hasIssues)(true);
    })()))(function () {
        return discard1(it("trajectory with out-of-bounds coordinates returns warnings")((function () {
            var outOfBounds = {
                tracks: [ [ [ -100.0, -200.0 ], [ 9999.0, 9999.0 ] ] ],
                width: 512,
                height: 512,
                frameCount: 2
            };
            var result = Lattice_Services_Export_ATI.validateForATI(outOfBounds);
            var hasWarningsOrErrors = Data_Array.length(result.warnings) > 0 || Data_Array.length(result.errors) > 0;
            return shouldEqual1(hasWarningsOrErrors)(true);
        })()))(function () {
            return discard1(it("valid flag is true for valid input")((function () {
                var traj = mkTestTrajectory(5)(30)(512)(512);
                var result = Lattice_Services_Export_ATI.validateForATI(traj);
                return shouldEqual1(result.valid)(true);
            })()))(function () {
                return it("errors array is empty for valid input")((function () {
                    var traj = mkTestTrajectory(5)(30)(512)(512);
                    var result = Lattice_Services_Export_ATI.validateForATI(traj);
                    return shouldEqual2(Data_Array.length(result.errors))(0);
                })());
            });
        });
    });
}));
var exportNormalizedTests = /* #__PURE__ */ describe("exportAsNormalizedATI")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("normalized tracks have x,y in expected range")(/* #__PURE__ */ (function () {
    var traj = mkTestTrajectory(3)(20)(512)(512);
    var result = Lattice_Services_Export_ATI.exportAsNormalizedATI(traj)(Data_Maybe.Nothing.value);
    var v = Data_Array.index(result.tracks)(0);
    if (v instanceof Data_Maybe.Just) {
        var v1 = Data_Array.index(v.value0)(0);
        if (v1 instanceof Data_Maybe.Just) {
            return discard2(shouldEqual1(Data_Number["isFinite"](v1.value0.x))(true))(function () {
                return shouldEqual1(Data_Number["isFinite"](v1.value0.y))(true);
            });
        };
        if (v1 instanceof Data_Maybe.Nothing) {
            return fail("Expected at least one point in track");
        };
        throw new Error("Failed pattern match at Test.Lattice.Export.ATIExport (line 228, column 23 - line 233, column 65): " + [ v1.constructor.name ]);
    };
    if (v instanceof Data_Maybe.Nothing) {
        return fail("Expected at least one track");
    };
    throw new Error("Failed pattern match at Test.Lattice.Export.ATIExport (line 227, column 7 - line 234, column 54): " + [ v.constructor.name ]);
})()))(function () {
    return discard1(it("metadata has correct shortEdge (min of width, height)")((function () {
        var traj = mkTestTrajectory(3)(20)(1024)(768);
        var result = Lattice_Services_Export_ATI.exportAsNormalizedATI(traj)(Data_Maybe.Nothing.value);
        return shouldEqual2(result.metadata.shortEdge)(768);
    })()))(function () {
        return it("timeRange has correct length")((function () {
            var traj = mkTestTrajectory(3)(20)(512)(512);
            var result = Lattice_Services_Export_ATI.exportAsNormalizedATI(traj)(Data_Maybe.Nothing.value);
            return shouldEqual2(Data_Array.length(result.timeRange))(Lattice_Services_Export_ATI.atiFixedFrames);
        })());
    });
}));
var createTrajectoryTests = /* #__PURE__ */ describe("createATITrajectory")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("creates trajectory with correct number of tracks")(/* #__PURE__ */ (function () {
    var points = [ [ {
        x: 10.0,
        y: 20.0
    }, {
        x: 30.0,
        y: 40.0
    } ], [ {
        x: 50.0,
        y: 60.0
    }, {
        x: 70.0,
        y: 80.0
    } ], [ {
        x: 90.0,
        y: 100.0
    }, {
        x: 110.0,
        y: 120.0
    } ] ];
    var traj = Lattice_Services_Export_ATI.createATITrajectory(points)(512)(512)(16);
    return shouldEqual2(Data_Array.length(traj.tracks))(3);
})()))(function () {
    return discard1(it("creates trajectory with correct width/height")((function () {
        var points = [ [ {
            x: 10.0,
            y: 20.0
        } ] ];
        var traj = Lattice_Services_Export_ATI.createATITrajectory(points)(1024)(768)(16);
        return discard2(shouldEqual2(traj.width)(1024))(function () {
            return shouldEqual2(traj.height)(768);
        });
    })()))(function () {
        return discard1(it("creates trajectory with correct frameCount")((function () {
            var points = [ [ {
                x: 10.0,
                y: 20.0
            }, {
                x: 30.0,
                y: 40.0
            } ] ];
            var traj = Lattice_Services_Export_ATI.createATITrajectory(points)(512)(512)(24);
            return shouldEqual2(traj.frameCount)(2);
        })()))(function () {
            return it("empty tracks array creates empty trajectory")((function () {
                var traj = Lattice_Services_Export_ATI.createATITrajectory([  ])(512)(512)(16);
                return shouldEqual2(Data_Array.length(traj.tracks))(0);
            })());
        });
    });
}));
var constantTests = /* #__PURE__ */ describe("constants")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("atiFixedFrames equals 121")(/* #__PURE__ */ shouldEqual2(Lattice_Services_Export_ATI.atiFixedFrames)(121)))(function () {
    return it("atiFixedFrames is a positive number")(shouldEqual1(Lattice_Services_Export_ATI.atiFixedFrames > 0)(true));
}));
var assertNonEmpty = function (s) {
    var $30 = Data_String_CodeUnits.length(s) > 0;
    if ($30) {
        return pure(Data_Unit.unit);
    };
    return fail("Expected non-empty string");
};
var exportJSONTests = /* #__PURE__ */ describe("exportATITrackCoordsJSON")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("returns non-empty string")(/* #__PURE__ */ (function () {
    var traj = mkTestTrajectory(3)(20)(512)(512);
    var json = Lattice_Services_Export_ATI.exportATITrackCoordsJSON(traj);
    return assertNonEmpty(json);
})()))(function () {
    return discard1(it("result contains coordinate data")((function () {
        var traj = mkTestTrajectory(2)(10)(512)(512);
        var json = Lattice_Services_Export_ATI.exportATITrackCoordsJSON(traj);
        return shouldEqual1(Data_String_CodeUnits.length(json) > 2)(true);
    })()))(function () {
        return it("tracks are padded/truncated to 121 frames")((function () {
            var traj = mkTestTrajectory(2)(10)(512)(512);
            var pkg = Lattice_Services_Export_ATI.exportATIPackage(traj);
            return assertNonEmpty(pkg.tracks);
        })());
    });
}));
var exportPackageTests = /* #__PURE__ */ describe("exportATIPackage")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("package has correct width/height from trajectory metadata")(/* #__PURE__ */ (function () {
    var traj = mkTestTrajectory(3)(20)(1024)(768);
    var pkg = Lattice_Services_Export_ATI.exportATIPackage(traj);
    return discard2(shouldEqual2(pkg.width)(1024))(function () {
        return shouldEqual2(pkg.height)(768);
    });
})()))(function () {
    return discard1(it("package has correct numTracks")((function () {
        var traj = mkTestTrajectory(5)(20)(512)(512);
        var pkg = Lattice_Services_Export_ATI.exportATIPackage(traj);
        return shouldEqual2(pkg.numTracks)(5);
    })()))(function () {
        return it("trackCoords is non-empty string")((function () {
            var traj = mkTestTrajectory(3)(20)(512)(512);
            var pkg = Lattice_Services_Export_ATI.exportATIPackage(traj);
            return assertNonEmpty(pkg.tracks);
        })());
    });
}));
var spec = /* #__PURE__ */ describe("ATIExport")(/* #__PURE__ */ discard1(constantTests)(function () {
    return discard1(createTrajectoryTests)(function () {
        return discard1(validateTests)(function () {
            return discard1(exportJSONTests)(function () {
                return discard1(exportPackageTests)(function () {
                    return exportNormalizedTests;
                });
            });
        });
    });
}));
export {
    spec
};
//# sourceMappingURL=index.js.map
