// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Boolean from "../Data.Boolean/index.js";
import * as Data_EuclideanRing from "../Data.EuclideanRing/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Tuple from "../Data.Tuple/index.js";
import * as $$Math from "../Math/index.js";
var div = /* #__PURE__ */ Data_EuclideanRing.div(Data_EuclideanRing.euclideanRingInt);
var mod = /* #__PURE__ */ Data_EuclideanRing.mod(Data_EuclideanRing.euclideanRingInt);
var bind = /* #__PURE__ */ Control_Bind.bind(Control_Bind.bindArray);
var pure = /* #__PURE__ */ Control_Applicative.pure(Control_Applicative.applicativeArray);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var append1 = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var ConstraintStructural = /* #__PURE__ */ (function () {
    function ConstraintStructural() {

    };
    ConstraintStructural.value = new ConstraintStructural();
    return ConstraintStructural;
})();
var ConstraintShear = /* #__PURE__ */ (function () {
    function ConstraintShear() {

    };
    ConstraintShear.value = new ConstraintShear();
    return ConstraintShear;
})();
var ConstraintBend = /* #__PURE__ */ (function () {
    function ConstraintBend() {

    };
    ConstraintBend.value = new ConstraintBend();
    return ConstraintBend;
})();
var showClothConstraintType = {
    show: function (v) {
        if (v instanceof ConstraintStructural) {
            return "ConstraintStructural";
        };
        if (v instanceof ConstraintShear) {
            return "ConstraintShear";
        };
        if (v instanceof ConstraintBend) {
            return "ConstraintBend";
        };
        throw new Error("Failed pattern match at Lattice.Services.Physics.Cloth (line 49, column 1 - line 52, column 41): " + [ v.constructor.name ]);
    }
};
var particlePosition = function (config) {
    return function (row) {
        return function (col) {
            return new Data_Tuple.Tuple(config.originX + Data_Int.toNumber(col) * config.spacing, config.originY + Data_Int.toNumber(row) * config.spacing);
        };
    };
};
var indexToGrid = function (index) {
    return function (width) {
        return new Data_Tuple.Tuple(div(index)(width), mod(index)(width));
    };
};
var gridToIndex = function (row) {
    return function (col) {
        return function (width) {
            return (row * width | 0) + col | 0;
        };
    };
};
var generateStructuralConstraints = function (config) {
    return function (clothId) {
        var horizontal = bind(Data_Array.range(0)(config.height - 1 | 0))(function (r) {
            return bind(Data_Array.range(0)(config.width - 2 | 0))(function (c) {
                return pure({
                    id: clothId + ("_h_" + show(gridToIndex(r)(c)(config.width))),
                    indexA: gridToIndex(r)(c)(config.width),
                    indexB: gridToIndex(r)(c + 1 | 0)(config.width),
                    constraintType: ConstraintStructural.value,
                    restLength: config.spacing,
                    stiffness: config.structuralStiffness,
                    tearThreshold: config.tearThreshold
                });
            });
        });
        var vertical = bind(Data_Array.range(0)(config.height - 2 | 0))(function (r) {
            return bind(Data_Array.range(0)(config.width - 1 | 0))(function (c) {
                return pure({
                    id: clothId + ("_v_" + show(gridToIndex(r)(c)(config.width))),
                    indexA: gridToIndex(r)(c)(config.width),
                    indexB: gridToIndex(r + 1 | 0)(c)(config.width),
                    constraintType: ConstraintStructural.value,
                    restLength: config.spacing,
                    stiffness: config.structuralStiffness,
                    tearThreshold: config.tearThreshold
                });
            });
        });
        return append1(horizontal)(vertical);
    };
};
var generateShearConstraints = function (config) {
    return function (clothId) {
        if (config.shearStiffness <= 0.0) {
            return [  ];
        };
        if (Data_Boolean.otherwise) {
            var diagLength = config.spacing * $$Math.sqrt(2.0);
            var diagonal1 = bind(Data_Array.range(0)(config.height - 2 | 0))(function (r) {
                return bind(Data_Array.range(0)(config.width - 2 | 0))(function (c) {
                    return pure({
                        id: clothId + ("_s1_" + show(gridToIndex(r)(c)(config.width))),
                        indexA: gridToIndex(r)(c)(config.width),
                        indexB: gridToIndex(r + 1 | 0)(c + 1 | 0)(config.width),
                        constraintType: ConstraintShear.value,
                        restLength: diagLength,
                        stiffness: config.shearStiffness,
                        tearThreshold: Data_Maybe.Nothing.value
                    });
                });
            });
            var diagonal2 = bind(Data_Array.range(0)(config.height - 2 | 0))(function (r) {
                return bind(Data_Array.range(0)(config.width - 2 | 0))(function (c) {
                    return pure({
                        id: clothId + ("_s2_" + show(gridToIndex(r)(c)(config.width))),
                        indexA: gridToIndex(r)(c + 1 | 0)(config.width),
                        indexB: gridToIndex(r + 1 | 0)(c)(config.width),
                        constraintType: ConstraintShear.value,
                        restLength: diagLength,
                        stiffness: config.shearStiffness,
                        tearThreshold: Data_Maybe.Nothing.value
                    });
                });
            });
            return append1(diagonal1)(diagonal2);
        };
        throw new Error("Failed pattern match at Lattice.Services.Physics.Cloth (line 173, column 1 - line 173, column 75): " + [ config.constructor.name, clothId.constructor.name ]);
    };
};
var generateBendConstraints = function (config) {
    return function (clothId) {
        if (config.bendStiffness <= 0.0) {
            return [  ];
        };
        if (Data_Boolean.otherwise) {
            var skipLength = config.spacing * 2.0;
            var bendV = bind(Data_Array.range(0)(config.height - 3 | 0))(function (r) {
                return bind(Data_Array.range(0)(config.width - 1 | 0))(function (c) {
                    return pure({
                        id: clothId + ("_bv_" + show(gridToIndex(r)(c)(config.width))),
                        indexA: gridToIndex(r)(c)(config.width),
                        indexB: gridToIndex(r + 2 | 0)(c)(config.width),
                        constraintType: ConstraintBend.value,
                        restLength: skipLength,
                        stiffness: config.bendStiffness,
                        tearThreshold: Data_Maybe.Nothing.value
                    });
                });
            });
            var bendH = bind(Data_Array.range(0)(config.height - 1 | 0))(function (r) {
                return bind(Data_Array.range(0)(config.width - 3 | 0))(function (c) {
                    return pure({
                        id: clothId + ("_bh_" + show(gridToIndex(r)(c)(config.width))),
                        indexA: gridToIndex(r)(c)(config.width),
                        indexB: gridToIndex(r)(c + 2 | 0)(config.width),
                        constraintType: ConstraintBend.value,
                        restLength: skipLength,
                        stiffness: config.bendStiffness,
                        tearThreshold: Data_Maybe.Nothing.value
                    });
                });
            });
            return append1(bendH)(bendV);
        };
        throw new Error("Failed pattern match at Lattice.Services.Physics.Cloth (line 210, column 1 - line 210, column 74): " + [ config.constructor.name, clothId.constructor.name ]);
    };
};
var generateAllConstraints = function (config) {
    return function (clothId) {
        return append1(generateStructuralConstraints(config)(clothId))(append1(generateShearConstraints(config)(clothId))(generateBendConstraints(config)(clothId)));
    };
};
var eqClothConstraintType = {
    eq: function (x) {
        return function (y) {
            if (x instanceof ConstraintStructural && y instanceof ConstraintStructural) {
                return true;
            };
            if (x instanceof ConstraintShear && y instanceof ConstraintShear) {
                return true;
            };
            if (x instanceof ConstraintBend && y instanceof ConstraintBend) {
                return true;
            };
            return false;
        };
    }
};
var defaultClothConfig = /* #__PURE__ */ (function () {
    return {
        width: 20,
        height: 20,
        spacing: 10.0,
        originX: 100.0,
        originY: 50.0,
        particleMass: 1.0,
        structuralStiffness: 0.9,
        shearStiffness: 0.5,
        bendStiffness: 0.3,
        damping: 0.98,
        collisionRadius: 2.0,
        iterations: 3,
        tearThreshold: Data_Maybe.Nothing.value,
        pinnedParticles: [  ]
    };
})();
var checkTear = function (constraint) {
    return function (currentDist) {
        if (constraint.tearThreshold instanceof Data_Maybe.Nothing) {
            return false;
        };
        if (constraint.tearThreshold instanceof Data_Maybe.Just) {
            return currentDist > constraint.restLength * constraint.tearThreshold.value0;
        };
        throw new Error("Failed pattern match at Lattice.Services.Physics.Cloth (line 260, column 3 - line 262, column 70): " + [ constraint.tearThreshold.constructor.name ]);
    };
};
export {
    ConstraintStructural,
    ConstraintShear,
    ConstraintBend,
    defaultClothConfig,
    gridToIndex,
    indexToGrid,
    particlePosition,
    generateStructuralConstraints,
    generateShearConstraints,
    generateBendConstraints,
    generateAllConstraints,
    checkTear,
    eqClothConstraintType,
    showClothConstraintType
};
//# sourceMappingURL=index.js.map
