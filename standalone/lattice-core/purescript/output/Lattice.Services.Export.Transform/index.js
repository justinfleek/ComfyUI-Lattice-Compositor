// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Boolean from "../Data.Boolean/index.js";
import * as Data_Either from "../Data.Either/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Lattice_Services_Export_Types from "../Lattice.Services.Export.Types/index.js";
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var bind = /* #__PURE__ */ Control_Bind.bind(Data_Either.bindEither);
var pure = /* #__PURE__ */ Control_Applicative.pure(Data_Either.applicativeEither);
var show1 = /* #__PURE__ */ Data_Show.show(Lattice_Services_Export_Types.showModelTarget);
var validateFrameCount = function (expected) {
    return function (trajectory) {
        var $23 = trajectory.frameCount === expected;
        if ($23) {
            return new Data_Either.Right(trajectory);
        };
        return new Data_Either.Left("Frame count mismatch: expected " + (show(expected) + (", got " + show(trajectory.frameCount))));
    };
};
var toNumber = Data_Int.toNumber;
var validateTrajectoryBounds = function (width) {
    return function (height) {
        return function (trajectory) {
            var isInBounds = function (arr) {
                var v = Data_Array.index(arr)(1);
                var v1 = Data_Array.index(arr)(0);
                if (v1 instanceof Data_Maybe.Just && v instanceof Data_Maybe.Just) {
                    return v1.value0 >= 0.0 && (v1.value0 <= toNumber(width) && (v.value0 >= 0.0 && v.value0 <= toNumber(height)));
                };
                return false;
            };
            var allInBounds = Data_Array.all(Data_Array.all(isInBounds))(trajectory.tracks);
            if (allInBounds) {
                return new Data_Either.Right(trajectory);
            };
            return new Data_Either.Left("Trajectory contains points outside bounds");
        };
    };
};
var pointToArray = function (p) {
    return [ p.x, p.y ];
};
var pointsToTracks = /* #__PURE__ */ map(/* #__PURE__ */ map(pointToArray));
var pixelToNormalized = function (dimension) {
    return function (pixel) {
        if (dimension <= 0.0) {
            return 0.0;
        };
        if (Data_Boolean.otherwise) {
            return pixel / dimension;
        };
        throw new Error("Failed pattern match at Lattice.Services.Export.Transform (line 174, column 1 - line 174, column 48): " + [ dimension.constructor.name, pixel.constructor.name ]);
    };
};
var normalizedToPixel = function (dimension) {
    return function (normalized) {
        return normalized * dimension;
    };
};
var normalizePoint = function (width) {
    return function (height) {
        return function (arr) {
            var v = Data_Array.index(arr)(1);
            var v1 = Data_Array.index(arr)(0);
            if (v1 instanceof Data_Maybe.Just && v instanceof Data_Maybe.Just) {
                return [ pixelToNormalized(toNumber(width))(v1.value0), pixelToNormalized(toNumber(height))(v.value0) ];
            };
            return arr;
        };
    };
};
var normalizeTrajectory = function (width) {
    return function (height) {
        return function (trajectory) {
            var normalizedTracks = map(map(normalizePoint(width)(height)))(trajectory.tracks);
            return {
                width: trajectory.width,
                height: trajectory.height,
                frameCount: trajectory.frameCount,
                tracks: normalizedTracks
            };
        };
    };
};
var flipYCoordinate = function (height) {
    return function (y) {
        return height - y;
    };
};
var denormalizePoint = function (width) {
    return function (height) {
        return function (arr) {
            var v = Data_Array.index(arr)(1);
            var v1 = Data_Array.index(arr)(0);
            if (v1 instanceof Data_Maybe.Just && v instanceof Data_Maybe.Just) {
                return [ normalizedToPixel(toNumber(width))(v1.value0), normalizedToPixel(toNumber(height))(v.value0) ];
            };
            return arr;
        };
    };
};
var denormalizeTrajectory = function (width) {
    return function (height) {
        return function (trajectory) {
            var denormalizedTracks = map(map(denormalizePoint(width)(height)))(trajectory.tracks);
            return {
                width: trajectory.width,
                height: trajectory.height,
                frameCount: trajectory.frameCount,
                tracks: denormalizedTracks
            };
        };
    };
};
var arrayToPoint = function (arr) {
    var v = Data_Array.index(arr)(1);
    var v1 = Data_Array.index(arr)(0);
    if (v1 instanceof Data_Maybe.Just && v instanceof Data_Maybe.Just) {
        return {
            x: v1.value0,
            y: v.value0
        };
    };
    return {
        x: 0.0,
        y: 0.0
    };
};
var trackToPoints = /* #__PURE__ */ map(arrayToPoint);
var tracksToPoints = /* #__PURE__ */ map(trackToPoints);
var transformATIToMotionData = function (result) {
    if (result.data instanceof Data_Maybe.Nothing) {
        return new Data_Either.Left("Cannot transform: no data in export result");
    };
    if (result.data instanceof Data_Maybe.Just) {
        var formattedTrajectories = map(trackToPoints)(result.data.value0.tracks);
        return new Data_Either.Right({
            trajectories: formattedTrajectories
        });
    };
    throw new Error("Failed pattern match at Lattice.Services.Export.Transform (line 78, column 3 - line 84, column 54): " + [ result.data.constructor.name ]);
};
var transformWanMoveToMotionData = function (result) {
    if (result.data instanceof Data_Maybe.Nothing) {
        return new Data_Either.Left("Cannot transform: no data in export result");
    };
    if (result.data instanceof Data_Maybe.Just) {
        var formattedTracks = map(trackToPoints)(result.data.value0.tracks);
        return new Data_Either.Right({
            tracks: formattedTracks
        });
    };
    throw new Error("Failed pattern match at Lattice.Services.Export.Transform (line 66, column 3 - line 72, column 42): " + [ result.data.constructor.name ]);
};
var transformExportToMotionData = function (target) {
    return function (result) {
        if (target instanceof Lattice_Services_Export_Types.TargetWanMove) {
            return bind(transformWanMoveToMotionData(result))(function (motionData) {
                return pure({
                    tracks: new Data_Maybe.Just(motionData.tracks),
                    trajectories: Data_Maybe.Nothing.value
                });
            });
        };
        if (target instanceof Lattice_Services_Export_Types.TargetATI) {
            return bind(transformATIToMotionData(result))(function (motionData) {
                return pure({
                    tracks: Data_Maybe.Nothing.value,
                    trajectories: new Data_Maybe.Just(motionData.trajectories)
                });
            });
        };
        return new Data_Either.Left("Unsupported target for motion data transformation: " + show1(target));
    };
};
export {
    transformWanMoveToMotionData,
    transformATIToMotionData,
    transformExportToMotionData,
    tracksToPoints,
    pointsToTracks,
    normalizeTrajectory,
    denormalizeTrajectory,
    pixelToNormalized,
    normalizedToPixel,
    flipYCoordinate,
    validateTrajectoryBounds,
    validateFrameCount
};
//# sourceMappingURL=index.js.map
