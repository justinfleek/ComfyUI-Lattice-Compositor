// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Identity from "../Data.Identity/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Effect_Aff from "../Effect.Aff/index.js";
import * as Lattice_State_HistoryOps from "../Lattice.State.HistoryOps/index.js";
import * as Test_Spec from "../Test.Spec/index.js";
import * as Test_Spec_Assertions from "../Test.Spec.Assertions/index.js";
var describe = /* #__PURE__ */ Test_Spec.describe(Data_Identity.monadIdentity);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit);
var discard1 = /* #__PURE__ */ discard(/* #__PURE__ */ Test_Spec.bindSpecT(Data_Identity.bindIdentity));
var it = /* #__PURE__ */ Test_Spec.it(Data_Identity.monadIdentity)(Test_Spec.exampleMUnit);
var shouldEqual = /* #__PURE__ */ Test_Spec_Assertions.shouldEqual(Effect_Aff.monadThrowAff);
var shouldEqual1 = /* #__PURE__ */ shouldEqual(Data_Show.showString)(Data_Eq.eqString);
var fail = /* #__PURE__ */ Test_Spec_Assertions.fail(Effect_Aff.monadThrowAff);
var discard2 = /* #__PURE__ */ discard(Effect_Aff.bindAff);
var shouldEqual2 = /* #__PURE__ */ shouldEqual(Data_Show.showBoolean)(Data_Eq.eqBoolean);
var shouldEqual3 = /* #__PURE__ */ shouldEqual(Data_Show.showInt)(Data_Eq.eqInt);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var pure = /* #__PURE__ */ Control_Applicative.pure(Effect_Aff.applicativeAff);
var undoRedoTests = /* #__PURE__ */ describe("undo / redo")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("undo returns previous snapshot")(/* #__PURE__ */ (function () {
    var s0 = Lattice_State_HistoryOps.mkHistoryState("first");
    var s1 = Lattice_State_HistoryOps.pushHistory("second")(s0);
    var v = Lattice_State_HistoryOps.undo(s1);
    if (v.snapshot instanceof Data_Maybe.Just) {
        return shouldEqual1(v.snapshot.value0)("first");
    };
    if (v.snapshot instanceof Data_Maybe.Nothing) {
        return fail("Expected undo snapshot");
    };
    throw new Error("Failed pattern match at Test.Lattice.State.HistoryOps (line 124, column 7 - line 126, column 63): " + [ v.constructor.name ]);
})()))(function () {
    return discard1(it("redo returns next snapshot")((function () {
        var s0 = Lattice_State_HistoryOps.mkHistoryState("first");
        var s1 = Lattice_State_HistoryOps.pushHistory("second")(s0);
        var v = Lattice_State_HistoryOps.undo(s1);
        var v1 = Lattice_State_HistoryOps.redo(v.state);
        if (v1.snapshot instanceof Data_Maybe.Just) {
            return shouldEqual1(v1.snapshot.value0)("second");
        };
        if (v1.snapshot instanceof Data_Maybe.Nothing) {
            return fail("Expected redo snapshot");
        };
        throw new Error("Failed pattern match at Test.Lattice.State.HistoryOps (line 132, column 7 - line 134, column 63): " + [ v1.constructor.name ]);
    })()))(function () {
        return discard1(it("multiple undo steps work")((function () {
            var s0 = Lattice_State_HistoryOps.mkHistoryState("a");
            var s1 = Lattice_State_HistoryOps.pushHistory("b")(s0);
            var s2 = Lattice_State_HistoryOps.pushHistory("c")(s1);
            var v = Lattice_State_HistoryOps.undo(s2);
            return discard2((function () {
                if (v.snapshot instanceof Data_Maybe.Just) {
                    return shouldEqual1(v.snapshot.value0)("b");
                };
                if (v.snapshot instanceof Data_Maybe.Nothing) {
                    return fail("Expected snapshot");
                };
                throw new Error("Failed pattern match at Test.Lattice.State.HistoryOps (line 141, column 7 - line 143, column 44): " + [ v.snapshot.constructor.name ]);
            })())(function () {
                var v1 = Lattice_State_HistoryOps.undo(v.state);
                if (v1.snapshot instanceof Data_Maybe.Just) {
                    return shouldEqual1(v1.snapshot.value0)("a");
                };
                if (v1.snapshot instanceof Data_Maybe.Nothing) {
                    return fail("Expected snapshot");
                };
                throw new Error("Failed pattern match at Test.Lattice.State.HistoryOps (line 145, column 7 - line 147, column 44): " + [ v1.snapshot.constructor.name ]);
            });
        })()))(function () {
            return discard1(it("undo at beginning returns Nothing")((function () {
                var state = Lattice_State_HistoryOps.mkHistoryState("only");
                var v = Lattice_State_HistoryOps.undo(state);
                return shouldEqual2(Data_Maybe.isNothing(v.snapshot))(true);
            })()))(function () {
                return discard1(it("redo at end returns Nothing")((function () {
                    var state = Lattice_State_HistoryOps.mkHistoryState("only");
                    var v = Lattice_State_HistoryOps.redo(state);
                    return shouldEqual2(Data_Maybe.isNothing(v.snapshot))(true);
                })()))(function () {
                    return discard1(it("undo then redo returns to same state")((function () {
                        var s0 = Lattice_State_HistoryOps.mkHistoryState("first");
                        var s1 = Lattice_State_HistoryOps.pushHistory("second")(s0);
                        var v = Lattice_State_HistoryOps.undo(s1);
                        var v1 = Lattice_State_HistoryOps.redo(v.state);
                        if (v1.snapshot instanceof Data_Maybe.Just) {
                            return shouldEqual1(v1.snapshot.value0)("second");
                        };
                        if (v1.snapshot instanceof Data_Maybe.Nothing) {
                            return fail("Expected redo snapshot");
                        };
                        throw new Error("Failed pattern match at Test.Lattice.State.HistoryOps (line 164, column 7 - line 166, column 49): " + [ v1.snapshot.constructor.name ]);
                    })()))(function () {
                        return it("canUndo/canRedo update correctly through sequence")((function () {
                            var s0 = Lattice_State_HistoryOps.mkHistoryState("a");
                            return discard2(shouldEqual2(Lattice_State_HistoryOps.canUndo(s0))(false))(function () {
                                return discard2(shouldEqual2(Lattice_State_HistoryOps.canRedo(s0))(false))(function () {
                                    var s1 = Lattice_State_HistoryOps.pushHistory("b")(s0);
                                    return discard2(shouldEqual2(Lattice_State_HistoryOps.canUndo(s1))(true))(function () {
                                        return discard2(shouldEqual2(Lattice_State_HistoryOps.canRedo(s1))(false))(function () {
                                            var v = Lattice_State_HistoryOps.undo(s1);
                                            return discard2(shouldEqual2(Lattice_State_HistoryOps.canUndo(v.state))(false))(function () {
                                                return shouldEqual2(Lattice_State_HistoryOps.canRedo(v.state))(true);
                                            });
                                        });
                                    });
                                });
                            });
                        })());
                    });
                });
            });
        });
    });
}));
var pushTests = /* #__PURE__ */ describe("pushHistory")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("adds a state to the stack")(/* #__PURE__ */ (function () {
    var state = Lattice_State_HistoryOps.pushHistory("state2")(Lattice_State_HistoryOps.mkHistoryState("state1"));
    return shouldEqual3(Lattice_State_HistoryOps.historyLength(state))(2);
})()))(function () {
    return discard1(it("updates index to latest")((function () {
        var state = Lattice_State_HistoryOps.pushHistory("state2")(Lattice_State_HistoryOps.mkHistoryState("state1"));
        return shouldEqual3(state.index)(1);
    })()))(function () {
        return discard1(it("can undo after push")((function () {
            var state = Lattice_State_HistoryOps.pushHistory("state2")(Lattice_State_HistoryOps.mkHistoryState("state1"));
            return shouldEqual2(Lattice_State_HistoryOps.canUndo(state))(true);
        })()))(function () {
            return discard1(it("truncates future states on push after undo")((function () {
                var s0 = Lattice_State_HistoryOps.mkHistoryState("s0");
                var s1 = Lattice_State_HistoryOps.pushHistory("s1")(s0);
                var s2 = Lattice_State_HistoryOps.pushHistory("s2")(s1);
                var v = Lattice_State_HistoryOps.undo(s2);
                var v1 = Lattice_State_HistoryOps.undo(v.state);
                var s5 = Lattice_State_HistoryOps.pushHistory("s_new")(v1.state);
                return discard2(shouldEqual3(Lattice_State_HistoryOps.historyLength(s5))(2))(function () {
                    return shouldEqual2(Lattice_State_HistoryOps.canRedo(s5))(false);
                });
            })()))(function () {
                return discard1(it("enforces maximum history size")((function () {
                    var buildHistory = function ($copy_n) {
                        return function ($copy_state) {
                            var $tco_var_n = $copy_n;
                            var $tco_done = false;
                            var $tco_result;
                            function $tco_loop(n, state) {
                                var $81 = n <= 0;
                                if ($81) {
                                    $tco_done = true;
                                    return state;
                                };
                                $tco_var_n = n - 1 | 0;
                                $copy_state = Lattice_State_HistoryOps.pushHistory("state" + show(n))(state);
                                return;
                            };
                            while (!$tco_done) {
                                $tco_result = $tco_loop($tco_var_n, $copy_state);
                            };
                            return $tco_result;
                        };
                    };
                    var state = buildHistory(60)(Lattice_State_HistoryOps.mkHistoryState("initial"));
                    return shouldEqual3(Lattice_State_HistoryOps.historyLength(state))(Lattice_State_HistoryOps.maxHistorySize);
                })()))(function () {
                    return it("deep clones state (independent snapshots)")((function () {
                        var s0 = Lattice_State_HistoryOps.mkHistoryState("original");
                        var s1 = Lattice_State_HistoryOps.pushHistory("modified")(s0);
                        var v = Lattice_State_HistoryOps.undo(s1);
                        if (v.snapshot instanceof Data_Maybe.Just) {
                            return shouldEqual1(v.snapshot.value0)("original");
                        };
                        if (v.snapshot instanceof Data_Maybe.Nothing) {
                            return fail("Expected undo snapshot");
                        };
                        throw new Error("Failed pattern match at Test.Lattice.State.HistoryOps (line 109, column 7 - line 111, column 63): " + [ v.constructor.name ]);
                    })());
                });
            });
        });
    });
}));
var initTests = /* #__PURE__ */ describe("mkHistoryState")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("creates state with one entry")(/* #__PURE__ */ (function () {
    var state = Lattice_State_HistoryOps.mkHistoryState("initial");
    return shouldEqual3(Lattice_State_HistoryOps.historyLength(state))(1);
})()))(function () {
    return discard1(it("starts at index 0")((function () {
        var state = Lattice_State_HistoryOps.mkHistoryState("initial");
        return shouldEqual3(state.index)(0);
    })()))(function () {
        return discard1(it("cannot undo from initial state")((function () {
            var state = Lattice_State_HistoryOps.mkHistoryState("initial");
            return shouldEqual2(Lattice_State_HistoryOps.canUndo(state))(false);
        })()))(function () {
            return it("cannot redo from initial state")((function () {
                var state = Lattice_State_HistoryOps.mkHistoryState("initial");
                return shouldEqual2(Lattice_State_HistoryOps.canRedo(state))(false);
            })());
        });
    });
}));
var edgeCaseTests = /* #__PURE__ */ describe("edge cases")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("rapid push/undo/redo sequence works")(/* #__PURE__ */ (function () {
    var s0 = Lattice_State_HistoryOps.mkHistoryState("s0");
    var buildN = function ($copy_n) {
        return function ($copy_st) {
            var $tco_var_n = $copy_n;
            var $tco_done = false;
            var $tco_result;
            function $tco_loop(n, st) {
                var $86 = n <= 0;
                if ($86) {
                    $tco_done = true;
                    return st;
                };
                $tco_var_n = n - 1 | 0;
                $copy_st = Lattice_State_HistoryOps.pushHistory("s" + show(n))(st);
                return;
            };
            while (!$tco_done) {
                $tco_result = $tco_loop($tco_var_n, $copy_st);
            };
            return $tco_result;
        };
    };
    var s10 = buildN(10)(s0);
    var v = Lattice_State_HistoryOps.undo(s10);
    var v1 = Lattice_State_HistoryOps.undo(v.state);
    var v2 = Lattice_State_HistoryOps.redo(v1.state);
    var d = Lattice_State_HistoryOps.pushHistory("new")(v2.state);
    var v3 = Lattice_State_HistoryOps.undo(d);
    var v4 = Lattice_State_HistoryOps.undo(v3.state);
    var v5 = Lattice_State_HistoryOps.undo(v4.state);
    var v6 = Lattice_State_HistoryOps.redo(v5.state);
    var v7 = Lattice_State_HistoryOps.redo(v6.state);
    return discard2(shouldEqual2(v7.state.index >= 0)(true))(function () {
        return shouldEqual2(v7.state.index < Lattice_State_HistoryOps.historyLength(v7.state))(true);
    });
})()))(function () {
    return it("determinism: same operations produce identical results")((function () {
        var ops = function (init) {
            var s1 = Lattice_State_HistoryOps.pushHistory("x")(init);
            var s2 = Lattice_State_HistoryOps.pushHistory("y")(s1);
            var s3 = Lattice_State_HistoryOps.pushHistory("z")(s2);
            var v = Lattice_State_HistoryOps.undo(s3);
            var v1 = Lattice_State_HistoryOps.undo(v.state);
            var s6 = Lattice_State_HistoryOps.pushHistory("w")(v1.state);
            return s6;
        };
        var r1 = ops(Lattice_State_HistoryOps.mkHistoryState("a"));
        var r2 = ops(Lattice_State_HistoryOps.mkHistoryState("a"));
        return discard2(shouldEqual3(r1.index)(r2.index))(function () {
            return shouldEqual3(Lattice_State_HistoryOps.historyLength(r1))(Lattice_State_HistoryOps.historyLength(r2));
        });
    })());
}));
var clearTests = /* #__PURE__ */ describe("clearHistory")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("reduces to single entry")(/* #__PURE__ */ (function () {
    var s0 = Lattice_State_HistoryOps.mkHistoryState("a");
    var s1 = Lattice_State_HistoryOps.pushHistory("b")(s0);
    var s2 = Lattice_State_HistoryOps.pushHistory("c")(s1);
    var cleared = Lattice_State_HistoryOps.clearHistory(s2);
    return shouldEqual3(Lattice_State_HistoryOps.historyLength(cleared))(1);
})()))(function () {
    return discard1(it("sets index to 0")((function () {
        var s0 = Lattice_State_HistoryOps.mkHistoryState("a");
        var s1 = Lattice_State_HistoryOps.pushHistory("b")(s0);
        var cleared = Lattice_State_HistoryOps.clearHistory(s1);
        return shouldEqual3(cleared.index)(0);
    })()))(function () {
        return it("preserves current state")((function () {
            var s0 = Lattice_State_HistoryOps.mkHistoryState("a");
            var s1 = Lattice_State_HistoryOps.pushHistory("b")(s0);
            var cleared = Lattice_State_HistoryOps.clearHistory(s1);
            var v = Lattice_State_HistoryOps.undo(cleared);
            if (v.snapshot instanceof Data_Maybe.Nothing) {
                return pure(Data_Unit.unit);
            };
            if (v.snapshot instanceof Data_Maybe.Just) {
                return fail("Should not be able to undo after clear");
            };
            throw new Error("Failed pattern match at Test.Lattice.State.HistoryOps (line 205, column 7 - line 207, column 78): " + [ v.constructor.name ]);
        })());
    });
}));
var spec = /* #__PURE__ */ describe("HistoryOps")(/* #__PURE__ */ discard1(initTests)(function () {
    return discard1(pushTests)(function () {
        return discard1(undoRedoTests)(function () {
            return discard1(clearTests)(function () {
                return edgeCaseTests;
            });
        });
    });
}));
export {
    spec
};
//# sourceMappingURL=index.js.map
