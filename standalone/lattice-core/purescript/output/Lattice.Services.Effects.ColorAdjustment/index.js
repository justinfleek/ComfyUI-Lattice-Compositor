// Generated by purs version 0.15.15
import * as Data_Boolean from "../Data.Boolean/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Tuple from "../Data.Tuple/index.js";
import * as $$Math from "../Math/index.js";
var min3 = function (a) {
    return function (b) {
        return function (c) {
            return $$Math.min(a)($$Math.min(b)(c));
        };
    };
};
var max3 = function (a) {
    return function (b) {
        return function (c) {
            return $$Math.max(a)($$Math.max(b)(c));
        };
    };
};
var rgbToHsl = function (v) {
    var minC = min3(v.value0)(v.value1.value0)(v.value1.value1);
    var maxC = max3(v.value0)(v.value1.value0)(v.value1.value1);
    var l = (maxC + minC) / 2.0;
    var d = maxC - minC;
    var v1 = (function () {
        var $19 = d === 0.0;
        if ($19) {
            return {
                h: 0.0,
                s: 0.0
            };
        };
        var s$prime = (function () {
            var $20 = l > 0.5;
            if ($20) {
                return d / (2.0 - maxC - minC);
            };
            return d / (maxC + minC);
        })();
        var h$prime = (function () {
            var $21 = maxC === v.value0;
            if ($21) {
                return ((v.value1.value0 - v.value1.value1) / d + (function () {
                    var $22 = v.value1.value0 < v.value1.value1;
                    if ($22) {
                        return 6.0;
                    };
                    return 0.0;
                })()) / 6.0;
            };
            var $23 = maxC === v.value1.value0;
            if ($23) {
                return ((v.value1.value1 - v.value0) / d + 2.0) / 6.0;
            };
            return ((v.value0 - v.value1.value0) / d + 4.0) / 6.0;
        })();
        return {
            h: h$prime,
            s: s$prime
        };
    })();
    return new Data_Tuple.Tuple(v1.h, new Data_Tuple.Tuple(v1.s, l));
};
var luminance = function (r) {
    return function (g) {
        return function (b) {
            return r * 0.299 + g * 0.587 + b * 0.114;
        };
    };
};
var hslToRgb = function (v) {
    var $32 = v.value1.value0 === 0.0;
    if ($32) {
        return new Data_Tuple.Tuple(v.value1.value1, new Data_Tuple.Tuple(v.value1.value1, v.value1.value1));
    };
    var q = (function () {
        var $33 = v.value1.value1 < 0.5;
        if ($33) {
            return v.value1.value1 * (1.0 + v.value1.value0);
        };
        return (v.value1.value1 + v.value1.value0) - v.value1.value1 * v.value1.value0;
    })();
    var p = 2.0 * v.value1.value1 - q;
    var hue2rgb = function ($copy_t) {
        var $tco_done = false;
        var $tco_result;
        function $tco_loop(t) {
            if (t < 0.0) {
                $copy_t = t + 1.0;
                return;
            };
            if (t > 1.0) {
                $copy_t = t - 1.0;
                return;
            };
            if (t < 1.0 / 6.0) {
                $tco_done = true;
                return p + (q - p) * 6.0 * t;
            };
            if (t < 1.0 / 2.0) {
                $tco_done = true;
                return q;
            };
            if (t < 2.0 / 3.0) {
                $tco_done = true;
                return p + (q - p) * (2.0 / 3.0 - t) * 6.0;
            };
            if (Data_Boolean.otherwise) {
                $tco_done = true;
                return p;
            };
            throw new Error("Failed pattern match at Lattice.Services.Effects.ColorAdjustment (line 166, column 9 - line 172, column 26): " + [ t.constructor.name ]);
        };
        while (!$tco_done) {
            $tco_result = $tco_loop($copy_t);
        };
        return $tco_result;
    };
    return new Data_Tuple.Tuple(hue2rgb(v.value0 + 1.0 / 3.0), new Data_Tuple.Tuple(hue2rgb(v.value0), hue2rgb(v.value0 - 1.0 / 3.0)));
};
var defaultVibranceParams = {
    vibrance: 0.0,
    saturation: 0.0
};
var defaultTintParams = {
    blackR: 0.0,
    blackG: 0.0,
    blackB: 0.0,
    whiteR: 1.0,
    whiteG: 1.0,
    whiteB: 1.0,
    amount: 1.0
};
var defaultHueSatParams = {
    hueShift: 0.0,
    saturationShift: 0.0,
    lightnessShift: 0.0,
    colorize: false
};
var defaultColorBalanceParams = {
    shadowR: 0.0,
    shadowG: 0.0,
    shadowB: 0.0,
    midtoneR: 0.0,
    midtoneG: 0.0,
    midtoneB: 0.0,
    highlightR: 0.0,
    highlightG: 0.0,
    highlightB: 0.0,
    preserveLuminosity: true
};
var clamp01 = /* #__PURE__ */ (function () {
    var $78 = $$Math.max(0.0);
    var $79 = $$Math.min(1.0);
    return function ($80) {
        return $78($79($80));
    };
})();
var colorBalance = function (params) {
    return function (v) {
        var lum = luminance(v.value0)(v.value1.value0)(v.value1.value1);
        var shadowWeight = $$Math.max(0.0)(1.0 - lum * 3.0);
        var highlightWeight = $$Math.max(0.0)((lum - 0.67) * 3.0);
        var midtoneWeight = 1.0 - shadowWeight - highlightWeight;
        var rAdj = params.shadowR * shadowWeight + params.midtoneR * midtoneWeight + params.highlightR * highlightWeight;
        var r$prime = v.value0 + rAdj;
        var gAdj = params.shadowG * shadowWeight + params.midtoneG * midtoneWeight + params.highlightG * highlightWeight;
        var g$prime = v.value1.value0 + gAdj;
        var bAdj = params.shadowB * shadowWeight + params.midtoneB * midtoneWeight + params.highlightB * highlightWeight;
        var b$prime = v.value1.value1 + bAdj;
        var v1 = (function () {
            if (params.preserveLuminosity) {
                var newLum = luminance(r$prime)(g$prime)(b$prime);
                var ratio = (function () {
                    var $42 = newLum > 1.0e-3;
                    if ($42) {
                        return lum / newLum;
                    };
                    return 1.0;
                })();
                return {
                    rFinal: r$prime * ratio,
                    gFinal: g$prime * ratio,
                    bFinal: b$prime * ratio
                };
            };
            return {
                rFinal: r$prime,
                gFinal: g$prime,
                bFinal: b$prime
            };
        })();
        return new Data_Tuple.Tuple(clamp01(v1.rFinal), new Data_Tuple.Tuple(clamp01(v1.gFinal), clamp01(v1.bFinal)));
    };
};
var hueSaturation = function (params) {
    return function (v) {
        var v1 = rgbToHsl(new Data_Tuple.Tuple(v.value0, new Data_Tuple.Tuple(v.value1.value0, v.value1.value1)));
        var v2 = (function () {
            if (params.colorize) {
                return {
                    h: params.hueShift,
                    s: Data_Number.abs(params.saturationShift) + 0.25
                };
            };
            var h$prime = v1.value0 + params.hueShift;
            var hWrapped = h$prime - Data_Int.toNumber(Data_Int.floor(h$prime));
            return {
                h: hWrapped,
                s: v1.value1.value0 + v1.value1.value0 * params.saturationShift
            };
        })();
        var sClamped = clamp01(v2.s);
        var l = v1.value1.value1 + v1.value1.value1 * params.lightnessShift;
        var lClamped = clamp01(l);
        return hslToRgb(new Data_Tuple.Tuple(v2.h, new Data_Tuple.Tuple(sClamped, lClamped)));
    };
};
var tint = function (params) {
    return function (v) {
        var lum = luminance(v.value0)(v.value1.value0)(v.value1.value1);
        var tintB = params.blackB + (params.whiteB - params.blackB) * lum;
        var tintG = params.blackG + (params.whiteG - params.blackG) * lum;
        var tintR = params.blackR + (params.whiteR - params.blackR) * lum;
        var b$prime = v.value1.value1 + (tintB - v.value1.value1) * params.amount;
        var g$prime = v.value1.value0 + (tintG - v.value1.value0) * params.amount;
        var r$prime = v.value0 + (tintR - v.value0) * params.amount;
        return new Data_Tuple.Tuple(clamp01(r$prime), new Data_Tuple.Tuple(clamp01(g$prime), clamp01(b$prime)));
    };
};
var vibrance = function (params) {
    return function (v) {
        var skinProtection = 1.0 - $$Math.max(0.0)($$Math.min(1.0)(Data_Number.abs(v.value0 - 0.8) * 2.0 + Data_Number.abs(v.value1.value0 - 0.5) * 2.0 + Data_Number.abs(v.value1.value1 - 0.3) * 3.0));
        var minC = min3(v.value0)(v.value1.value0)(v.value1.value1);
        var maxC = max3(v.value0)(v.value1.value0)(v.value1.value1);
        var lum = luminance(v.value0)(v.value1.value0)(v.value1.value1);
        var currentSat = maxC - minC;
        var vibranceAmount = params.vibrance * (1.0 - currentSat) * (1.0 - skinProtection * 0.5);
        var satAdjust = 1.0 + params.saturation + vibranceAmount;
        var g$prime = lum + (v.value1.value0 - lum) * satAdjust;
        var r$prime = lum + (v.value0 - lum) * satAdjust;
        var b$prime = lum + (v.value1.value1 - lum) * satAdjust;
        return new Data_Tuple.Tuple(clamp01(r$prime), new Data_Tuple.Tuple(clamp01(g$prime), clamp01(b$prime)));
    };
};
export {
    defaultHueSatParams,
    defaultVibranceParams,
    defaultTintParams,
    defaultColorBalanceParams,
    hueSaturation,
    vibrance,
    tint,
    colorBalance,
    rgbToHsl,
    hslToRgb
};
//# sourceMappingURL=index.js.map
