// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Boolean from "../Data.Boolean/index.js";
import * as Data_Either from "../Data.Either/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Lattice_Schemas_SharedValidation from "../Lattice.Schemas.SharedValidation/index.js";
var bind = /* #__PURE__ */ Control_Bind.bind(Data_Either.bindEither);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit)(Data_Either.bindEither);
var pure = /* #__PURE__ */ Control_Applicative.pure(Data_Either.applicativeEither);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var traverse_ = /* #__PURE__ */ Data_Foldable.traverse_(Data_Either.applicativeEither)(Data_Foldable.foldableArray);
var validateStatusConstraints = function (status) {
    if (status.callsToday > status.maxPerDay) {
        return new Data_Either.Left(Lattice_Schemas_SharedValidation.mkError("callsToday")("must be <= maxPerDay"));
    };
    if (Data_Boolean.otherwise) {
        if (status.maxPerSession instanceof Data_Maybe.Just && status.callsThisSession > status.maxPerSession.value0) {
            return new Data_Either.Left(Lattice_Schemas_SharedValidation.mkError("callsThisSession")("must be <= maxPerSession"));
        };
        return new Data_Either.Right(Data_Unit.unit);
    };
    throw new Error("Failed pattern match at Lattice.Schemas.Settings.RateLimitsSchema (line 102, column 1 - line 102, column 76): " + [ status.constructor.name ]);
};
var maxVramCostMB = 1000000.0;
var maxRateLimitKeys = 1000;
var maxCallsPerSession = 10000;
var maxCallsPerDay = 100000;
var validateRateLimitConfig = function (config) {
    return bind(Lattice_Schemas_SharedValidation.validateNonEmptyString("toolName")(Lattice_Schemas_SharedValidation.maxNameLength)(config.toolName))(function () {
        return bind(Lattice_Schemas_SharedValidation.validatePositiveInt("maxPerDay")(maxCallsPerDay)(config.maxPerDay))(function () {
            return discard((function () {
                if (config.maxPerSession instanceof Data_Maybe.Just) {
                    return bind(Lattice_Schemas_SharedValidation.validatePositiveInt("maxPerSession")(maxCallsPerSession)(config.maxPerSession.value0))(function () {
                        return pure(Data_Unit.unit);
                    });
                };
                if (config.maxPerSession instanceof Data_Maybe.Nothing) {
                    return pure(Data_Unit.unit);
                };
                throw new Error("Failed pattern match at Lattice.Schemas.Settings.RateLimitsSchema (line 72, column 3 - line 76, column 25): " + [ config.maxPerSession.constructor.name ]);
            })())(function () {
                return discard((function () {
                    if (config.vramCostMB instanceof Data_Maybe.Just) {
                        return bind(Lattice_Schemas_SharedValidation.validatePositiveFloat("vramCostMB")(maxVramCostMB)(config.vramCostMB.value0))(function () {
                            return pure(Data_Unit.unit);
                        });
                    };
                    if (config.vramCostMB instanceof Data_Maybe.Nothing) {
                        return pure(Data_Unit.unit);
                    };
                    throw new Error("Failed pattern match at Lattice.Schemas.Settings.RateLimitsSchema (line 77, column 3 - line 81, column 25): " + [ config.vramCostMB.constructor.name ]);
                })())(function () {
                    return pure(config);
                });
            });
        });
    });
};
var validateRateLimitStatus = function (status) {
    return bind(Lattice_Schemas_SharedValidation.validateNonEmptyString("toolName")(Lattice_Schemas_SharedValidation.maxNameLength)(status.toolName))(function () {
        return bind(Lattice_Schemas_SharedValidation.validateNonNegativeInt("callsToday")(maxCallsPerDay)(status.callsToday))(function () {
            return bind(Lattice_Schemas_SharedValidation.validatePositiveInt("maxPerDay")(maxCallsPerDay)(status.maxPerDay))(function () {
                return bind(Lattice_Schemas_SharedValidation.validateNonNegativeInt("callsThisSession")(maxCallsPerSession)(status.callsThisSession))(function () {
                    return discard((function () {
                        if (status.maxPerSession instanceof Data_Maybe.Just) {
                            return bind(Lattice_Schemas_SharedValidation.validatePositiveInt("maxPerSession")(maxCallsPerSession)(status.maxPerSession.value0))(function () {
                                return pure(Data_Unit.unit);
                            });
                        };
                        if (status.maxPerSession instanceof Data_Maybe.Nothing) {
                            return pure(Data_Unit.unit);
                        };
                        throw new Error("Failed pattern match at Lattice.Schemas.Settings.RateLimitsSchema (line 118, column 3 - line 122, column 25): " + [ status.maxPerSession.constructor.name ]);
                    })())(function () {
                        return discard((function () {
                            if (status.blockedReason instanceof Data_Maybe.Just) {
                                return bind(Lattice_Schemas_SharedValidation.validateString("blockedReason")(500)(status.blockedReason.value0))(function () {
                                    return pure(Data_Unit.unit);
                                });
                            };
                            if (status.blockedReason instanceof Data_Maybe.Nothing) {
                                return pure(Data_Unit.unit);
                            };
                            throw new Error("Failed pattern match at Lattice.Schemas.Settings.RateLimitsSchema (line 123, column 3 - line 127, column 25): " + [ status.blockedReason.constructor.name ]);
                        })())(function () {
                            return bind(Lattice_Schemas_SharedValidation.validateDateTime("resetsAt")(status.resetsAt))(function () {
                                return bind(Lattice_Schemas_SharedValidation.validateString("resetsIn")(100)(status.resetsIn))(function () {
                                    return discard(validateStatusConstraints(status))(function () {
                                        return pure(status);
                                    });
                                });
                            });
                        });
                    });
                });
            });
        });
    });
};
var validateStoredRateLimits = function (limits) {
    var validateCount = function (v) {
        return bind(Lattice_Schemas_SharedValidation.validateString("counts.key")(Lattice_Schemas_SharedValidation.maxNameLength)(v.value0))(function () {
            return bind(Lattice_Schemas_SharedValidation.validateNonNegativeInt("counts.value")(maxCallsPerDay)(v.value1))(function () {
                return pure(Data_Unit.unit);
            });
        });
    };
    return bind(Lattice_Schemas_SharedValidation.validateDate("date")(limits.date))(function () {
        return bind(Lattice_Schemas_SharedValidation.validateDateTime("lastReset")(limits.lastReset))(function () {
            var $25 = Data_Array.length(limits.counts) > maxRateLimitKeys;
            if ($25) {
                return new Data_Either.Left(Lattice_Schemas_SharedValidation.mkError("counts")("must have at most " + (show(maxRateLimitKeys) + " keys")));
            };
            return discard(traverse_(validateCount)(limits.counts))(function () {
                return pure(limits);
            });
        });
    });
};
var safeValidateStoredRateLimits = function (limits) {
    var v = validateStoredRateLimits(limits);
    if (v instanceof Data_Either.Right) {
        return new Data_Maybe.Just(v.value0);
    };
    if (v instanceof Data_Either.Left) {
        return Data_Maybe.Nothing.value;
    };
    throw new Error("Failed pattern match at Lattice.Schemas.Settings.RateLimitsSchema (line 164, column 3 - line 166, column 22): " + [ v.constructor.name ]);
};
export {
    maxCallsPerDay,
    maxCallsPerSession,
    maxVramCostMB,
    maxRateLimitKeys,
    validateRateLimitConfig,
    validateRateLimitStatus,
    validateStoredRateLimits,
    safeValidateStoredRateLimits
};
//# sourceMappingURL=index.js.map
