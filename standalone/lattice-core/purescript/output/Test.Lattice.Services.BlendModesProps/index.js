// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Identity from "../Data.Identity/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Effect_Aff from "../Effect.Aff/index.js";
import * as $$Math from "../Math/index.js";
import * as Test_Lattice_TestHelpers from "../Test.Lattice.TestHelpers/index.js";
import * as Test_Spec from "../Test.Spec/index.js";
import * as Test_Spec_Assertions from "../Test.Spec.Assertions/index.js";
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordInt);
var min = /* #__PURE__ */ Data_Ord.min(Data_Ord.ordInt);
var describe = /* #__PURE__ */ Test_Spec.describe(Data_Identity.monadIdentity);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit);
var discard1 = /* #__PURE__ */ discard(/* #__PURE__ */ Test_Spec.bindSpecT(Data_Identity.bindIdentity));
var it = /* #__PURE__ */ Test_Spec.it(Data_Identity.monadIdentity)(Test_Spec.exampleMUnit);
var for_ = /* #__PURE__ */ Data_Foldable.for_(Effect_Aff.applicativeAff)(Data_Foldable.foldableArray);
var pure = /* #__PURE__ */ Control_Applicative.pure(Effect_Aff.applicativeAff);
var fail = /* #__PURE__ */ Test_Spec_Assertions.fail(Effect_Aff.monadThrowAff);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var shouldEqual = /* #__PURE__ */ Test_Spec_Assertions.shouldEqual(Effect_Aff.monadThrowAff);
var shouldEqual1 = /* #__PURE__ */ shouldEqual(Data_Show.showInt)(Data_Eq.eqInt);
var show1 = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var shouldEqual2 = /* #__PURE__ */ shouldEqual(Data_Show.showNumber)(Data_Eq.eqNumber);
var discard2 = /* #__PURE__ */ discard(Effect_Aff.bindAff);
var rgbToHsl = function (ri) {
    return function (gi) {
        return function (bi) {
            var r = Data_Int.toNumber(ri) / 255.0;
            var g = Data_Int.toNumber(gi) / 255.0;
            var b = Data_Int.toNumber(bi) / 255.0;
            var mn = $$Math.min(r)($$Math.min(g)(b));
            var mx = $$Math.max(r)($$Math.max(g)(b));
            var l = (mx + mn) / 2.0;
            var $36 = mx === mn;
            if ($36) {
                return {
                    h: 0.0,
                    s: 0.0,
                    l: l
                };
            };
            var d = mx - mn;
            var h$prime = (function () {
                var $37 = mx === r;
                if ($37) {
                    return ((g - b) / d + (function () {
                        var $38 = g < b;
                        if ($38) {
                            return 6.0;
                        };
                        return 0.0;
                    })()) / 6.0;
                };
                var $39 = mx === g;
                if ($39) {
                    return ((b - r) / d + 2.0) / 6.0;
                };
                return ((r - g) / d + 4.0) / 6.0;
            })();
            var s = (function () {
                var $40 = l > 0.5;
                if ($40) {
                    return d / (2.0 - mx - mn);
                };
                return d / (mx + mn);
            })();
            return {
                h: h$prime,
                s: s,
                l: l
            };
        };
    };
};
var normalizedSamples = [ 0.0, 0.1, 0.25, 0.5, 0.75, 0.9, 1.0 ];
var hueSamples = [ 0.0, 0.1, 0.25, 0.33, 0.5, 0.67, 0.75, 0.9, 1.0 ];
var hslToRgb = function (h) {
    return function (s) {
        return function (l) {
            var $41 = s === 0.0;
            if ($41) {
                var v = Data_Int.round(l * 255.0);
                return {
                    r: v,
                    g: v,
                    b: v
                };
            };
            var q = (function () {
                var $42 = l < 0.5;
                if ($42) {
                    return l * (1.0 + s);
                };
                return (l + s) - l * s;
            })();
            var p = 2.0 * l - q;
            var hue2rgb = function (pp) {
                return function (qq) {
                    return function (t$prime) {
                        var t = (function () {
                            var $43 = t$prime < 0.0;
                            if ($43) {
                                return t$prime + 1.0;
                            };
                            var $44 = t$prime > 1.0;
                            if ($44) {
                                return t$prime - 1.0;
                            };
                            return t$prime;
                        })();
                        var $45 = t < 1.0 / 6.0;
                        if ($45) {
                            return pp + (qq - pp) * 6.0 * t;
                        };
                        var $46 = t < 1.0 / 2.0;
                        if ($46) {
                            return qq;
                        };
                        var $47 = t < 2.0 / 3.0;
                        if ($47) {
                            return pp + (qq - pp) * (2.0 / 3.0 - t) * 6.0;
                        };
                        return pp;
                    };
                };
            };
            var r = hue2rgb(p)(q)(h + 1.0 / 3.0);
            var g = hue2rgb(p)(q)(h);
            var b = hue2rgb(p)(q)(h - 1.0 / 3.0);
            return {
                r: Data_Int.round(r * 255.0),
                g: Data_Int.round(g * 255.0),
                b: Data_Int.round(b * 255.0)
            };
        };
    };
};
var getLuminance = function (r) {
    return function (g) {
        return function (b) {
            return 0.299 * Data_Int.toNumber(r) + 0.587 * Data_Int.toNumber(g) + 0.114 * Data_Int.toNumber(b);
        };
    };
};
var clamp = function (v) {
    return max(0)(min(255)(Data_Int.round(v)));
};
var channels = [ 0, 1, 32, 64, 100, 127, 128, 200, 254, 255 ];
var clampFunction = /* #__PURE__ */ (function () {
    return describe("clamp function")(discard1(it("clamp always returns value in [0, 255]")(for_([ -1000.0, -1.0, 0.0, 127.5, 255.0, 256.0, 1000.0 ])(function (v) {
        var result = clamp(v);
        var $48 = result >= 0 && result <= 255;
        if ($48) {
            return pure(Data_Unit.unit);
        };
        return fail("Clamp out of bounds: " + show(result));
    })))(function () {
        return discard1(it("clamp preserves values already in range")(for_(channels)(function (v) {
            return shouldEqual1(clamp(Data_Int.toNumber(v)))(v);
        })))(function () {
            return discard1(it("clamp caps values > 255 to 255")(for_([ 256.0, 300.0, 1000.0 ])(function (v) {
                return shouldEqual1(clamp(v))(255);
            })))(function () {
                return it("clamp floors values < 0 to 0")(for_([ -1.0, -100.0, -1000.0 ])(function (v) {
                    return shouldEqual1(clamp(v))(0);
                }));
            });
        });
    }));
})();
var luminanceCalculation = /* #__PURE__ */ describe("luminance calculation")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("luminance is bounded 0-255")(/* #__PURE__ */ for_(channels)(function (r) {
    return for_(channels)(function (g) {
        return for_(channels)(function (b) {
            var lum = getLuminance(r)(g)(b);
            var $49 = lum >= 0.0 && lum <= 255.0;
            if ($49) {
                return pure(Data_Unit.unit);
            };
            return fail("Luminance out of bounds: " + show1(lum));
        });
    });
})))(function () {
    return discard1(it("grayscale luminance equals the gray value")(for_(channels)(function (gray) {
        var lum = getLuminance(gray)(gray)(gray);
        return Test_Lattice_TestHelpers.assertCloseTo(1.0e-6)(Data_Int.toNumber(gray))(lum);
    })))(function () {
        return discard1(it("pure white has maximum luminance")((function () {
            var lum = getLuminance(255)(255)(255);
            return shouldEqual2(lum)(255.0);
        })()))(function () {
            return discard1(it("pure black has minimum luminance")((function () {
                var lum = getLuminance(0)(0)(0);
                return shouldEqual2(lum)(0.0);
            })()))(function () {
                return it("green has higher luminance weight than red or blue")((function () {
                    var redLum = getLuminance(255)(0)(0);
                    var greenLum = getLuminance(0)(255)(0);
                    var blueLum = getLuminance(0)(0)(255);
                    var $50 = greenLum > redLum && greenLum > blueLum;
                    if ($50) {
                        return pure(Data_Unit.unit);
                    };
                    return fail("Green does not have highest luminance weight");
                })());
            });
        });
    });
}));
var rgbHslRoundtrip = /* #__PURE__ */ describe("RGB <-> HSL conversion roundtrip")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("RGB -> HSL -> RGB preserves color (within rounding)")(/* #__PURE__ */ for_(channels)(function (r) {
    return for_(channels)(function (g) {
        return for_(channels)(function (b) {
            var hsl = rgbToHsl(r)(g)(b);
            var rgb = hslToRgb(hsl.h)(hsl.s)(hsl.l);
            var $51 = Data_Number.abs(Data_Int.toNumber(r - rgb.r | 0)) <= 1.0 && (Data_Number.abs(Data_Int.toNumber(g - rgb.g | 0)) <= 1.0 && Data_Number.abs(Data_Int.toNumber(b - rgb.b | 0)) <= 1.0);
            if ($51) {
                return pure(Data_Unit.unit);
            };
            return fail("Roundtrip failed for (" + (show(r) + ("," + (show(g) + ("," + (show(b) + (") -> (" + (show(rgb.r) + ("," + (show(rgb.g) + ("," + (show(rgb.b) + ")"))))))))))));
        });
    });
})))(function () {
    return discard1(it("grayscale colors have saturation = 0")(for_(channels)(function (gray) {
        var hsl = rgbToHsl(gray)(gray)(gray);
        return shouldEqual2(hsl.s)(0.0);
    })))(function () {
        return discard1(it("pure white has L = 1")((function () {
            var hsl = rgbToHsl(255)(255)(255);
            return shouldEqual2(hsl.l)(1.0);
        })()))(function () {
            return discard1(it("pure black has L = 0")((function () {
                var hsl = rgbToHsl(0)(0)(0);
                return shouldEqual2(hsl.l)(0.0);
            })()))(function () {
                return it("HSL with S=0 produces grayscale")(for_(hueSamples)(function (h) {
                    return for_(normalizedSamples)(function (l) {
                        var rgb = hslToRgb(h)(0.0)(l);
                        return discard2(shouldEqual1(rgb.r)(rgb.g))(function () {
                            return shouldEqual1(rgb.g)(rgb.b);
                        });
                    });
                }));
            });
        });
    });
}));
var blendScreen = function (base) {
    return function (blend) {
        return Data_Int.round(255.0 - ((255.0 - Data_Int.toNumber(base)) * (255.0 - Data_Int.toNumber(blend))) / 255.0);
    };
};
var blendNormal = function (base) {
    return function (blend) {
        return function (opacity) {
            return Data_Int.round(Data_Int.toNumber(base) * (1.0 - opacity) + Data_Int.toNumber(blend) * opacity);
        };
    };
};
var blendMultiply = function (base) {
    return function (blend) {
        return Data_Int.round((Data_Int.toNumber(base) * Data_Int.toNumber(blend)) / 255.0);
    };
};
var blendAdd = function (a) {
    return function (b) {
        return min(255)(a + b | 0);
    };
};
var basicBlendInvariants = /* #__PURE__ */ describe("basic blend invariants")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("normal blend at opacity 0 returns base")(/* #__PURE__ */ for_(channels)(function (base) {
    return for_(channels)(function (blend) {
        return shouldEqual1(blendNormal(base)(blend)(0.0))(base);
    });
})))(function () {
    return discard1(it("normal blend at opacity 1 returns blend")(for_(channels)(function (base) {
        return for_(channels)(function (blend) {
            return shouldEqual1(blendNormal(base)(blend)(1.0))(blend);
        });
    })))(function () {
        return discard1(it("multiply is commutative")(for_(channels)(function (a) {
            return for_(channels)(function (b) {
                return shouldEqual1(blendMultiply(a)(b))(blendMultiply(b)(a));
            });
        })))(function () {
            return discard1(it("screen is commutative")(for_(channels)(function (a) {
                return for_(channels)(function (b) {
                    return shouldEqual1(blendScreen(a)(b))(blendScreen(b)(a));
                });
            })))(function () {
                return discard1(it("add is commutative")(for_(channels)(function (a) {
                    return for_(channels)(function (b) {
                        return shouldEqual1(blendAdd(a)(b))(blendAdd(b)(a));
                    });
                })))(function () {
                    return discard1(it("multiply with white returns original")(for_(channels)(function (base) {
                        return shouldEqual1(blendMultiply(base)(255))(base);
                    })))(function () {
                        return discard1(it("multiply with black returns black")(for_(channels)(function (base) {
                            return shouldEqual1(blendMultiply(base)(0))(0);
                        })))(function () {
                            return discard1(it("screen with black returns original")(for_(channels)(function (base) {
                                return shouldEqual1(blendScreen(base)(0))(base);
                            })))(function () {
                                return discard1(it("screen with white returns white")(for_(channels)(function (base) {
                                    return shouldEqual1(blendScreen(base)(255))(255);
                                })))(function () {
                                    return it("add result is bounded by 255")(for_(channels)(function (a) {
                                        return for_(channels)(function (b) {
                                            var result = blendAdd(a)(b);
                                            var $52 = result >= 0 && result <= 255;
                                            if ($52) {
                                                return pure(Data_Unit.unit);
                                            };
                                            return fail("add result out of bounds: " + show(result));
                                        });
                                    }));
                                });
                            });
                        });
                    });
                });
            });
        });
    });
}));
var spec = /* #__PURE__ */ describe("BLEND MODE Properties")(/* #__PURE__ */ discard1(rgbHslRoundtrip)(function () {
    return discard1(luminanceCalculation)(function () {
        return discard1(basicBlendInvariants)(function () {
            return clampFunction;
        });
    });
}));
export {
    spec
};
//# sourceMappingURL=index.js.map
