// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Either from "../Data.Either/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Generic_Rep from "../Data.Generic.Rep/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Show_Generic from "../Data.Show.Generic/index.js";
import * as Data_String_CodePoints from "../Data.String.CodePoints/index.js";
import * as Data_String_Common from "../Data.String.Common/index.js";
import * as Data_Tuple from "../Data.Tuple/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showBoolean);
var show1 = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var show2 = /* #__PURE__ */ Data_Show.show(Data_Show.showString);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var genericShowConstructor = /* #__PURE__ */ Data_Show_Generic.genericShowConstructor(/* #__PURE__ */ Data_Show_Generic.genericShowArgsArgument(Data_Show.showString));
var eqTuple = /* #__PURE__ */ Data_Tuple.eqTuple(Data_Eq.eqString);
var bind = /* #__PURE__ */ Control_Bind.bind(Data_Either.bindEither);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit)(Data_Either.bindEither);
var pure = /* #__PURE__ */ Control_Applicative.pure(Data_Either.applicativeEither);
var map1 = /* #__PURE__ */ Data_Functor.map(Data_Maybe.functorMaybe);
var elem = /* #__PURE__ */ Data_Array.elem(Data_Eq.eqString);
var eq3 = /* #__PURE__ */ Data_Eq.eq(Data_String_CodePoints.eqCodePoint);
var append1 = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var URLValid = /* #__PURE__ */ (function () {
    function URLValid() {

    };
    URLValid.value = new URLValid();
    return URLValid;
})();
var URLInvalidProtocol = /* #__PURE__ */ (function () {
    function URLInvalidProtocol(value0) {
        this.value0 = value0;
    };
    URLInvalidProtocol.create = function (value0) {
        return new URLInvalidProtocol(value0);
    };
    return URLInvalidProtocol;
})();
var URLBlockedHostname = /* #__PURE__ */ (function () {
    function URLBlockedHostname(value0) {
        this.value0 = value0;
    };
    URLBlockedHostname.create = function (value0) {
        return new URLBlockedHostname(value0);
    };
    return URLBlockedHostname;
})();
var URLPrivateIP = /* #__PURE__ */ (function () {
    function URLPrivateIP(value0) {
        this.value0 = value0;
    };
    URLPrivateIP.create = function (value0) {
        return new URLPrivateIP(value0);
    };
    return URLPrivateIP;
})();
var URLParseError = /* #__PURE__ */ (function () {
    function URLParseError(value0) {
        this.value0 = value0;
    };
    URLParseError.create = function (value0) {
        return new URLParseError(value0);
    };
    return URLParseError;
})();
var JSONNull = /* #__PURE__ */ (function () {
    function JSONNull() {

    };
    JSONNull.value = new JSONNull();
    return JSONNull;
})();
var JSONBool = /* #__PURE__ */ (function () {
    function JSONBool(value0) {
        this.value0 = value0;
    };
    JSONBool.create = function (value0) {
        return new JSONBool(value0);
    };
    return JSONBool;
})();
var JSONNumber = /* #__PURE__ */ (function () {
    function JSONNumber(value0) {
        this.value0 = value0;
    };
    JSONNumber.create = function (value0) {
        return new JSONNumber(value0);
    };
    return JSONNumber;
})();
var JSONString = /* #__PURE__ */ (function () {
    function JSONString(value0) {
        this.value0 = value0;
    };
    JSONString.create = function (value0) {
        return new JSONString(value0);
    };
    return JSONString;
})();
var JSONArray = /* #__PURE__ */ (function () {
    function JSONArray(value0) {
        this.value0 = value0;
    };
    JSONArray.create = function (value0) {
        return new JSONArray(value0);
    };
    return JSONArray;
})();
var JSONObject = /* #__PURE__ */ (function () {
    function JSONObject(value0) {
        this.value0 = value0;
    };
    JSONObject.create = function (value0) {
        return new JSONObject(value0);
    };
    return JSONObject;
})();
var showJSONValue = {
    show: function (v) {
        if (v instanceof JSONNull) {
            return "JSONNull";
        };
        if (v instanceof JSONBool) {
            return "(JSONBool " + (show(v.value0) + ")");
        };
        if (v instanceof JSONNumber) {
            return "(JSONNumber " + (show1(v.value0) + ")");
        };
        if (v instanceof JSONString) {
            return "(JSONString " + (show2(v.value0) + ")");
        };
        if (v instanceof JSONArray) {
            return "(JSONArray [" + (Data_String_Common.joinWith(", ")(map(Data_Show.show(showJSONValue))(v.value0)) + "])");
        };
        if (v instanceof JSONObject) {
            var showField = function (v1) {
                return "(Tuple " + (show2(v1.value0) + (" " + (Data_Show.show(showJSONValue)(v1.value1) + ")")));
            };
            return "(JSONObject [" + (Data_String_Common.joinWith(", ")(map(showField)(v.value0)) + "])");
        };
        throw new Error("Failed pattern match at Lattice.Utils.Security (line 252, column 1 - line 260, column 74): " + [ v.constructor.name ]);
    }
};
var genericURLValidationResul = {
    to: function (x) {
        if (x instanceof Data_Generic_Rep.Inl) {
            return URLValid.value;
        };
        if (x instanceof Data_Generic_Rep.Inr && x.value0 instanceof Data_Generic_Rep.Inl) {
            return new URLInvalidProtocol(x.value0.value0);
        };
        if (x instanceof Data_Generic_Rep.Inr && (x.value0 instanceof Data_Generic_Rep.Inr && x.value0.value0 instanceof Data_Generic_Rep.Inl)) {
            return new URLBlockedHostname(x.value0.value0.value0);
        };
        if (x instanceof Data_Generic_Rep.Inr && (x.value0 instanceof Data_Generic_Rep.Inr && (x.value0.value0 instanceof Data_Generic_Rep.Inr && x.value0.value0.value0 instanceof Data_Generic_Rep.Inl))) {
            return new URLPrivateIP(x.value0.value0.value0.value0);
        };
        if (x instanceof Data_Generic_Rep.Inr && (x.value0 instanceof Data_Generic_Rep.Inr && (x.value0.value0 instanceof Data_Generic_Rep.Inr && x.value0.value0.value0 instanceof Data_Generic_Rep.Inr))) {
            return new URLParseError(x.value0.value0.value0.value0);
        };
        throw new Error("Failed pattern match at Lattice.Utils.Security (line 102, column 1 - line 102, column 46): " + [ x.constructor.name ]);
    },
    from: function (x) {
        if (x instanceof URLValid) {
            return new Data_Generic_Rep.Inl(Data_Generic_Rep.NoArguments.value);
        };
        if (x instanceof URLInvalidProtocol) {
            return new Data_Generic_Rep.Inr(new Data_Generic_Rep.Inl(x.value0));
        };
        if (x instanceof URLBlockedHostname) {
            return new Data_Generic_Rep.Inr(new Data_Generic_Rep.Inr(new Data_Generic_Rep.Inl(x.value0)));
        };
        if (x instanceof URLPrivateIP) {
            return new Data_Generic_Rep.Inr(new Data_Generic_Rep.Inr(new Data_Generic_Rep.Inr(new Data_Generic_Rep.Inl(x.value0))));
        };
        if (x instanceof URLParseError) {
            return new Data_Generic_Rep.Inr(new Data_Generic_Rep.Inr(new Data_Generic_Rep.Inr(new Data_Generic_Rep.Inr(x.value0))));
        };
        throw new Error("Failed pattern match at Lattice.Utils.Security (line 102, column 1 - line 102, column 46): " + [ x.constructor.name ]);
    }
};
var showURLValidationResult = {
    show: /* #__PURE__ */ Data_Show_Generic.genericShow(genericURLValidationResul)(/* #__PURE__ */ Data_Show_Generic.genericShowSum(/* #__PURE__ */ Data_Show_Generic.genericShowConstructor(Data_Show_Generic.genericShowArgsNoArguments)({
        reflectSymbol: function () {
            return "URLValid";
        }
    }))(/* #__PURE__ */ Data_Show_Generic.genericShowSum(/* #__PURE__ */ genericShowConstructor({
        reflectSymbol: function () {
            return "URLInvalidProtocol";
        }
    }))(/* #__PURE__ */ Data_Show_Generic.genericShowSum(/* #__PURE__ */ genericShowConstructor({
        reflectSymbol: function () {
            return "URLBlockedHostname";
        }
    }))(/* #__PURE__ */ Data_Show_Generic.genericShowSum(/* #__PURE__ */ genericShowConstructor({
        reflectSymbol: function () {
            return "URLPrivateIP";
        }
    }))(/* #__PURE__ */ genericShowConstructor({
        reflectSymbol: function () {
            return "URLParseError";
        }
    }))))))
};
var eqURLValidationResult = {
    eq: function (x) {
        return function (y) {
            if (x instanceof URLValid && y instanceof URLValid) {
                return true;
            };
            if (x instanceof URLInvalidProtocol && y instanceof URLInvalidProtocol) {
                return x.value0 === y.value0;
            };
            if (x instanceof URLBlockedHostname && y instanceof URLBlockedHostname) {
                return x.value0 === y.value0;
            };
            if (x instanceof URLPrivateIP && y instanceof URLPrivateIP) {
                return x.value0 === y.value0;
            };
            if (x instanceof URLParseError && y instanceof URLParseError) {
                return x.value0 === y.value0;
            };
            return false;
        };
    }
};
var eqJSONValue = {
    eq: function (x) {
        return function (y) {
            if (x instanceof JSONNull && y instanceof JSONNull) {
                return true;
            };
            if (x instanceof JSONBool && y instanceof JSONBool) {
                return x.value0 === y.value0;
            };
            if (x instanceof JSONNumber && y instanceof JSONNumber) {
                return x.value0 === y.value0;
            };
            if (x instanceof JSONString && y instanceof JSONString) {
                return x.value0 === y.value0;
            };
            if (x instanceof JSONArray && y instanceof JSONArray) {
                return Data_Eq.eq(Data_Eq.eqArray(eqJSONValue))(x.value0)(y.value0);
            };
            if (x instanceof JSONObject && y instanceof JSONObject) {
                return Data_Eq.eq(Data_Eq.eqArray(eqTuple(eqJSONValue)))(x.value0)(y.value0);
            };
            return false;
        };
    }
};
var parseURL = function (url) {
    var v = Data_String_Common.split("://")(url);
    if (v.length === 2) {
        var protocolWithColon = v[0] + ":";
        var $152 = protocolWithColon === "data:" || protocolWithColon === "blob:";
        if ($152) {
            return new Data_Maybe.Just({
                protocol: protocolWithColon,
                hostname: "",
                port: Data_Maybe.Nothing.value,
                path: v[1]
            });
        };
        var v1 = Data_String_Common.split("/")(v[1]);
        if (v1.length === 0) {
            return Data_Maybe.Nothing.value;
        };
        var pathParts = Data_Array.drop(1)(v1);
        var hostPart = (function () {
            var v2 = Data_Array.head(v1);
            if (v2 instanceof Data_Maybe.Just) {
                return v2.value0;
            };
            if (v2 instanceof Data_Maybe.Nothing) {
                return "";
            };
            throw new Error("Failed pattern match at Lattice.Utils.Security (line 133, column 29 - line 135, column 33): " + [ v2.constructor.name ]);
        })();
        var hostPort = (function () {
            var v2 = Data_String_Common.split(":")(hostPart);
            if (v2.length === 1) {
                return {
                    host: v2[0],
                    port: Data_Maybe.Nothing.value
                };
            };
            if (v2.length === 2) {
                return {
                    host: v2[0],
                    port: Data_Int.fromString(v2[1])
                };
            };
            return {
                host: hostPart,
                port: Data_Maybe.Nothing.value
            };
        })();
        return new Data_Maybe.Just({
            protocol: protocolWithColon,
            hostname: Data_String_Common.toLower(hostPort.host),
            port: hostPort.port,
            path: "/" + Data_String_Common.joinWith("/")(pathParts)
        });
    };
    return Data_Maybe.Nothing.value;
};
var mkValidationError = function (message) {
    return function (path) {
        return {
            message: message,
            path: path
        };
    };
};
var jsonIsObject = function (v) {
    if (v instanceof JSONObject) {
        return true;
    };
    return false;
};
var jsonIsArray = function (v) {
    if (v instanceof JSONArray) {
        return true;
    };
    return false;
};
var jsonGetItems = function (v) {
    if (v instanceof JSONArray) {
        return new Data_Maybe.Just(v.value0);
    };
    return Data_Maybe.Nothing.value;
};
var jsonGetFields = function (v) {
    if (v instanceof JSONObject) {
        return new Data_Maybe.Just(v.value0);
    };
    return Data_Maybe.Nothing.value;
};
var validateProjectStructure = function (val) {
    return bind((function () {
        var v = jsonGetFields(val);
        if (v instanceof Data_Maybe.Just) {
            return new Data_Either.Right(v.value0);
        };
        if (v instanceof Data_Maybe.Nothing) {
            return new Data_Either.Left(mkValidationError("Expected object")([  ]));
        };
        throw new Error("Failed pattern match at Lattice.Utils.Security (line 296, column 13 - line 298, column 61): " + [ v.constructor.name ]);
    })())(function (fields) {
        var hasVersion = Data_Array.any(function (v) {
            return v.value0 === "version";
        })(fields);
        return discard((function () {
            var $175 = !hasVersion;
            if ($175) {
                return new Data_Either.Left(mkValidationError("Missing required field 'version'")([  ]));
            };
            return pure(Data_Unit.unit);
        })())(function () {
            var hasLayers = Data_Array.any(function (v) {
                return v.value0 === "layers";
            })(fields);
            var hasComps = Data_Array.any(function (v) {
                return v.value0 === "compositions";
            })(fields);
            var $182 = !hasComps && !hasLayers;
            if ($182) {
                return new Data_Either.Left(mkValidationError("Missing required field 'compositions' or 'layers'")([  ]));
            };
            return pure(Data_Unit.unit);
        });
    });
};
var jsonField = function (v) {
    return function (v1) {
        if (v instanceof JSONObject) {
            return map1(function (v2) {
                return v2.value1;
            })(Data_Array.find(function (v2) {
                return v2.value0 === v1;
            })(v.value0));
        };
        return Data_Maybe.Nothing.value;
    };
};
var isPrivateIP = function (hostname) {
    var is172Private = function (h) {
        var v = Data_String_Common.split(".")(h);
        if (v.length === 4 && v[0] === "172") {
            var v1 = Data_Int.fromString(v[1]);
            if (v1 instanceof Data_Maybe.Just) {
                return v1.value0 >= 16 && v1.value0 <= 31;
            };
            if (v1 instanceof Data_Maybe.Nothing) {
                return false;
            };
            throw new Error("Failed pattern match at Lattice.Utils.Security (line 74, column 11 - line 76, column 29): " + [ v1.constructor.name ]);
        };
        return false;
    };
    return Data_String_CodePoints.take(3)(hostname) === "10." || (is172Private(hostname) || (Data_String_CodePoints.take(8)(hostname) === "192.168." || (Data_String_CodePoints.take(8)(hostname) === "169.254." || Data_String_CodePoints.take(4)(hostname) === "127.")));
};
var invalidFilenameChars = [ "<", ">", ":", "\"", "/", "\\", "|", "?", "*" ];
var sanitizeFilename = function (filename) {
    var s1 = Data_String_Common.replaceAll("..")("")(filename);
    var s2 = Data_String_Common.joinWith("")(Data_Array.filter(function (c) {
        return !elem(c)(invalidFilenameChars);
    })(Data_String_Common.split("")(s1)));
    var s3 = Data_String_CodePoints.dropWhile(function (v) {
        return eq3(v)(Data_String_CodePoints.codePointFromChar("."));
    })(s2);
    var s4 = Data_String_Common.trim(s3);
    var $199 = Data_String_Common["null"](s4);
    if ($199) {
        return "unnamed";
    };
    return s4;
};
var htmlEntities = [ {
    "char": "&",
    entity: "&amp;"
}, {
    "char": "<",
    entity: "&lt;"
}, {
    "char": ">",
    entity: "&gt;"
}, {
    "char": "\"",
    entity: "&quot;"
}, {
    "char": "'",
    entity: "&#39;"
} ];
var formatPath = function (path) {
    var $200 = Data_Array["null"](path);
    if ($200) {
        return "root";
    };
    return Data_String_Common.joinWith(".")(path);
};
var escapeHTML = function (input) {
    return Data_Array.foldl(function (acc) {
        return function (ent) {
            return Data_String_Common.replaceAll(ent["char"])(ent.entity)(acc);
        };
    })(input)(htmlEntities);
};
var defaultURLOptions = {
    allowData: true,
    allowBlob: true,
    allowHttp: false
};
var blockedHostnames = [ "localhost", "127.0.0.1", "0.0.0.0", "::1" ];
var validateURL = function (url) {
    return function (options) {
        var v = parseURL(url);
        if (v instanceof Data_Maybe.Nothing) {
            return new URLParseError("Invalid URL format");
        };
        if (v instanceof Data_Maybe.Just) {
            var allowed = append1([ "https:" ])(append1((function () {
                if (options.allowHttp) {
                    return [ "http:" ];
                };
                return [  ];
            })())(append1((function () {
                if (options.allowData) {
                    return [ "data:" ];
                };
                return [  ];
            })())((function () {
                if (options.allowBlob) {
                    return [ "blob:" ];
                };
                return [  ];
            })())));
            var $205 = !elem(v.value0.protocol)(allowed);
            if ($205) {
                return new URLInvalidProtocol(v.value0.protocol);
            };
            var $206 = v.value0.protocol === "data:" || v.value0.protocol === "blob:";
            if ($206) {
                return URLValid.value;
            };
            var $207 = elem(v.value0.hostname)(blockedHostnames);
            if ($207) {
                return new URLBlockedHostname(v.value0.hostname);
            };
            var $208 = isPrivateIP(v.value0.hostname);
            if ($208) {
                return new URLPrivateIP(v.value0.hostname);
            };
            return URLValid.value;
        };
        throw new Error("Failed pattern match at Lattice.Utils.Security (line 152, column 3 - line 167, column 23): " + [ v.constructor.name ]);
    };
};
var isValidURL = function (url) {
    return function (options) {
        var v = validateURL(url)(options);
        if (v instanceof URLValid) {
            return true;
        };
        return false;
    };
};
export {
    defaultURLOptions,
    URLValid,
    URLInvalidProtocol,
    URLBlockedHostname,
    URLPrivateIP,
    URLParseError,
    parseURL,
    validateURL,
    isValidURL,
    isPrivateIP,
    blockedHostnames,
    sanitizeFilename,
    escapeHTML,
    mkValidationError,
    formatPath,
    JSONNull,
    JSONBool,
    JSONNumber,
    JSONString,
    JSONArray,
    JSONObject,
    jsonIsObject,
    jsonIsArray,
    jsonGetFields,
    jsonGetItems,
    jsonField,
    validateProjectStructure,
    genericURLValidationResul,
    showURLValidationResult,
    eqURLValidationResult,
    eqJSONValue,
    showJSONValue
};
//# sourceMappingURL=index.js.map
