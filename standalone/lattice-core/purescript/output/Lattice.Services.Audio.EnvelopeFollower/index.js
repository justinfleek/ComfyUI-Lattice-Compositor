// Generated by purs version 0.15.15
import * as Data_Boolean from "../Data.Boolean/index.js";
import * as $$Math from "../Math/index.js";
var smoothingStep = function (currentValue) {
    return function (previousSmoothed) {
        return function (smoothing) {
            return previousSmoothed * smoothing + currentValue * (1.0 - smoothing);
        };
    };
};
var smoothingFromTimeConstant = function (tau) {
    if (tau <= 0.0) {
        return 0.0;
    };
    if (Data_Boolean.otherwise) {
        return $$Math.exp(-1.0 / tau);
    };
    throw new Error("Failed pattern match at Lattice.Services.Audio.EnvelopeFollower (line 84, column 1 - line 84, column 46): " + [ tau.constructor.name ]);
};
var peakHoldStep = function (currentValue) {
    return function (peakValue) {
        return function (holdCounter) {
            return function (holdFrames) {
                return function (decayRate) {
                    if (currentValue > peakValue) {
                        return {
                            newPeak: currentValue,
                            newHoldCounter: holdFrames
                        };
                    };
                    if (holdCounter > 0) {
                        return {
                            newPeak: peakValue,
                            newHoldCounter: holdCounter - 1 | 0
                        };
                    };
                    if (Data_Boolean.otherwise) {
                        return {
                            newPeak: peakValue * decayRate,
                            newHoldCounter: 0
                        };
                    };
                    throw new Error("Failed pattern match at Lattice.Services.Audio.EnvelopeFollower (line 98, column 1 - line 99, column 60): " + [ currentValue.constructor.name, peakValue.constructor.name, holdCounter.constructor.name, holdFrames.constructor.name, decayRate.constructor.name ]);
                };
            };
        };
    };
};
var envelopeStep = function (currentValue) {
    return function (envelopeValue) {
        return function (release) {
            if (currentValue > envelopeValue) {
                return currentValue;
            };
            if (Data_Boolean.otherwise) {
                var decayRate = 1.0 - release * 0.98;
                return envelopeValue * decayRate;
            };
            throw new Error("Failed pattern match at Lattice.Services.Audio.EnvelopeFollower (line 42, column 1 - line 42, column 53): " + [ currentValue.constructor.name, envelopeValue.constructor.name, release.constructor.name ]);
        };
    };
};
var envelopeOutput = function (currentValue) {
    return function (envelopeValue) {
        return $$Math.max(currentValue)(envelopeValue);
    };
};
var envelopeFollowerStep = function (currentValue) {
    return function (envelopeValue) {
        return function (release) {
            var newEnvelope = envelopeStep(currentValue)(envelopeValue)(release);
            var output = envelopeOutput(currentValue)(newEnvelope);
            return {
                newEnvelope: newEnvelope,
                output: output
            };
        };
    };
};
var processWithEnvelopeAndSmoothing = function (currentValue) {
    return function (envelopeValue) {
        return function (previousSmoothed) {
            return function (release) {
                return function (smoothing) {
                    var result = envelopeFollowerStep(currentValue)(envelopeValue)(release);
                    var smoothedOutput = smoothingStep(result.output)(previousSmoothed)(smoothing);
                    return {
                        newEnvelope: result.newEnvelope,
                        smoothedOutput: smoothedOutput
                    };
                };
            };
        };
    };
};
export {
    envelopeStep,
    envelopeOutput,
    envelopeFollowerStep,
    smoothingStep,
    smoothingFromTimeConstant,
    peakHoldStep,
    processWithEnvelopeAndSmoothing
};
//# sourceMappingURL=index.js.map
