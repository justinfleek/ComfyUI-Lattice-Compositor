// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Boolean from "../Data.Boolean/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Tuple from "../Data.Tuple/index.js";
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordInt);
var min = /* #__PURE__ */ Data_Ord.min(Data_Ord.ordInt);
var min1 = /* #__PURE__ */ Data_Ord.min(Data_Ord.ordNumber);
var max1 = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordNumber);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var InvertRGB = /* #__PURE__ */ (function () {
    function InvertRGB() {

    };
    InvertRGB.value = new InvertRGB();
    return InvertRGB;
})();
var InvertRed = /* #__PURE__ */ (function () {
    function InvertRed() {

    };
    InvertRed.value = new InvertRed();
    return InvertRed;
})();
var InvertGreen = /* #__PURE__ */ (function () {
    function InvertGreen() {

    };
    InvertGreen.value = new InvertGreen();
    return InvertGreen;
})();
var InvertBlue = /* #__PURE__ */ (function () {
    function InvertBlue() {

    };
    InvertBlue.value = new InvertBlue();
    return InvertBlue;
})();
var InvertHue = /* #__PURE__ */ (function () {
    function InvertHue() {

    };
    InvertHue.value = new InvertHue();
    return InvertHue;
})();
var InvertSat = /* #__PURE__ */ (function () {
    function InvertSat() {

    };
    InvertSat.value = new InvertSat();
    return InvertSat;
})();
var InvertLight = /* #__PURE__ */ (function () {
    function InvertLight() {

    };
    InvertLight.value = new InvertLight();
    return InvertLight;
})();
var showInvertChannel = {
    show: function (v) {
        if (v instanceof InvertRGB) {
            return "InvertRGB";
        };
        if (v instanceof InvertRed) {
            return "InvertRed";
        };
        if (v instanceof InvertGreen) {
            return "InvertGreen";
        };
        if (v instanceof InvertBlue) {
            return "InvertBlue";
        };
        if (v instanceof InvertHue) {
            return "InvertHue";
        };
        if (v instanceof InvertSat) {
            return "InvertSat";
        };
        if (v instanceof InvertLight) {
            return "InvertLight";
        };
        throw new Error("Failed pattern match at Lattice.Services.Effects.ColorThreshold (line 50, column 1 - line 57, column 35): " + [ v.constructor.name ]);
    }
};
var posterizePixel = function (levels) {
    return function (value) {
        if (levels >= 256) {
            return value;
        };
        if (levels <= 1) {
            return 0.0;
        };
        if (Data_Boolean.otherwise) {
            var lvls = Data_Int.toNumber(max(2)(min(256)(levels)));
            var step = 1.0 / (lvls - 1.0);
            var level = Data_Int.toNumber(Data_Int.round(value * (lvls - 1.0)));
            return level * step;
        };
        throw new Error("Failed pattern match at Lattice.Services.Effects.ColorThreshold (line 193, column 1 - line 193, column 42): " + [ levels.constructor.name, value.constructor.name ]);
    };
};
var posterize = function (params) {
    return function (v) {
        return new Data_Tuple.Tuple(posterizePixel(params.levels)(v.value0), new Data_Tuple.Tuple(posterizePixel(params.levels)(v.value1.value0), posterizePixel(params.levels)(v.value1.value1)));
    };
};
var min3 = function (a) {
    return function (b) {
        return function (c) {
            return min1(a)(min1(b)(c));
        };
    };
};
var max3 = function (a) {
    return function (b) {
        return function (c) {
            return max1(a)(max1(b)(c));
        };
    };
};
var rgbToHsl = function (v) {
    var minC = min3(v.value0)(v.value1.value0)(v.value1.value1);
    var maxC = max3(v.value0)(v.value1.value0)(v.value1.value1);
    var l = (maxC + minC) / 2.0;
    var d = maxC - minC;
    var v1 = (function () {
        var $39 = d === 0.0;
        if ($39) {
            return {
                h: 0.0,
                s: 0.0
            };
        };
        var s$prime = (function () {
            var $40 = l > 0.5;
            if ($40) {
                return d / (2.0 - maxC - minC);
            };
            return d / (maxC + minC);
        })();
        var h$prime = (function () {
            var $41 = maxC === v.value0;
            if ($41) {
                return ((v.value1.value0 - v.value1.value1) / d + (function () {
                    var $42 = v.value1.value0 < v.value1.value1;
                    if ($42) {
                        return 6.0;
                    };
                    return 0.0;
                })()) / 6.0;
            };
            var $43 = maxC === v.value1.value0;
            if ($43) {
                return ((v.value1.value1 - v.value0) / d + 2.0) / 6.0;
            };
            return ((v.value0 - v.value1.value0) / d + 4.0) / 6.0;
        })();
        return {
            h: h$prime,
            s: s$prime
        };
    })();
    return new Data_Tuple.Tuple(v1.h, new Data_Tuple.Tuple(v1.s, l));
};
var luminance = function (r) {
    return function (g) {
        return function (b) {
            return r * 0.299 + g * 0.587 + b * 0.114;
        };
    };
};
var threshold = function (params) {
    return function (v) {
        var lum = luminance(v.value0)(v.value1.value0)(v.value1.value1);
        var value = (function () {
            var $53 = lum >= params.threshold;
            if ($53) {
                return 1.0;
            };
            return 0.0;
        })();
        return new Data_Tuple.Tuple(value, new Data_Tuple.Tuple(value, value));
    };
};
var lerp = function (a) {
    return function (b) {
        return function (t) {
            return a + (b - a) * t;
        };
    };
};
var hslToRgb = function (v) {
    var $59 = v.value1.value0 === 0.0;
    if ($59) {
        return new Data_Tuple.Tuple(v.value1.value1, new Data_Tuple.Tuple(v.value1.value1, v.value1.value1));
    };
    var q = (function () {
        var $60 = v.value1.value1 < 0.5;
        if ($60) {
            return v.value1.value1 * (1.0 + v.value1.value0);
        };
        return (v.value1.value1 + v.value1.value0) - v.value1.value1 * v.value1.value0;
    })();
    var p = 2.0 * v.value1.value1 - q;
    var hue2rgb = function ($copy_t) {
        var $tco_done = false;
        var $tco_result;
        function $tco_loop(t) {
            if (t < 0.0) {
                $copy_t = t + 1.0;
                return;
            };
            if (t > 1.0) {
                $copy_t = t - 1.0;
                return;
            };
            if (t < 1.0 / 6.0) {
                $tco_done = true;
                return p + (q - p) * 6.0 * t;
            };
            if (t < 1.0 / 2.0) {
                $tco_done = true;
                return q;
            };
            if (t < 2.0 / 3.0) {
                $tco_done = true;
                return p + (q - p) * (2.0 / 3.0 - t) * 6.0;
            };
            if (Data_Boolean.otherwise) {
                $tco_done = true;
                return p;
            };
            throw new Error("Failed pattern match at Lattice.Services.Effects.ColorThreshold (line 150, column 9 - line 156, column 26): " + [ t.constructor.name ]);
        };
        while (!$tco_done) {
            $tco_result = $tco_loop($copy_t);
        };
        return $tco_result;
    };
    return new Data_Tuple.Tuple(hue2rgb(v.value0 + 1.0 / 3.0), new Data_Tuple.Tuple(hue2rgb(v.value0), hue2rgb(v.value0 - 1.0 / 3.0)));
};
var eqInvertChannel = {
    eq: function (x) {
        return function (y) {
            if (x instanceof InvertRGB && y instanceof InvertRGB) {
                return true;
            };
            if (x instanceof InvertRed && y instanceof InvertRed) {
                return true;
            };
            if (x instanceof InvertGreen && y instanceof InvertGreen) {
                return true;
            };
            if (x instanceof InvertBlue && y instanceof InvertBlue) {
                return true;
            };
            if (x instanceof InvertHue && y instanceof InvertHue) {
                return true;
            };
            if (x instanceof InvertSat && y instanceof InvertSat) {
                return true;
            };
            if (x instanceof InvertLight && y instanceof InvertLight) {
                return true;
            };
            return false;
        };
    }
};
var defaultThresholdParams = {
    threshold: 0.5
};
var defaultPosterizeParams = {
    levels: 6
};
var defaultInvertParams = /* #__PURE__ */ (function () {
    return {
        channel: InvertRGB.value,
        blend: 1.0
    };
})();
var clamp01 = /* #__PURE__ */ (function () {
    var $96 = max1(0.0);
    var $97 = min1(1.0);
    return function ($98) {
        return $96($97($98));
    };
})();
var invert = function (params) {
    return function (v) {
        var v1 = (function () {
            if (params.channel instanceof InvertRGB) {
                return new Data_Tuple.Tuple(1.0 - v.value0, new Data_Tuple.Tuple(1.0 - v.value1.value0, 1.0 - v.value1.value1));
            };
            if (params.channel instanceof InvertRed) {
                return new Data_Tuple.Tuple(1.0 - v.value0, new Data_Tuple.Tuple(v.value1.value0, v.value1.value1));
            };
            if (params.channel instanceof InvertGreen) {
                return new Data_Tuple.Tuple(v.value0, new Data_Tuple.Tuple(1.0 - v.value1.value0, v.value1.value1));
            };
            if (params.channel instanceof InvertBlue) {
                return new Data_Tuple.Tuple(v.value0, new Data_Tuple.Tuple(v.value1.value0, 1.0 - v.value1.value1));
            };
            if (params.channel instanceof InvertHue) {
                var v2 = rgbToHsl(new Data_Tuple.Tuple(v.value0, new Data_Tuple.Tuple(v.value1.value0, v.value1.value1)));
                var h$prime = (function () {
                    var hNew = v2.value0 + 0.5;
                    var $72 = hNew > 1.0;
                    if ($72) {
                        return hNew - 1.0;
                    };
                    return hNew;
                })();
                return hslToRgb(new Data_Tuple.Tuple(h$prime, new Data_Tuple.Tuple(v2.value1.value0, v2.value1.value1)));
            };
            if (params.channel instanceof InvertSat) {
                var v2 = rgbToHsl(new Data_Tuple.Tuple(v.value0, new Data_Tuple.Tuple(v.value1.value0, v.value1.value1)));
                return hslToRgb(new Data_Tuple.Tuple(v2.value0, new Data_Tuple.Tuple(1.0 - v2.value1.value0, v2.value1.value1)));
            };
            if (params.channel instanceof InvertLight) {
                var v2 = rgbToHsl(new Data_Tuple.Tuple(v.value0, new Data_Tuple.Tuple(v.value1.value0, v.value1.value1)));
                return hslToRgb(new Data_Tuple.Tuple(v2.value0, new Data_Tuple.Tuple(v2.value1.value0, 1.0 - v2.value1.value1)));
            };
            throw new Error("Failed pattern match at Lattice.Services.Effects.ColorThreshold (line 167, column 32 - line 181, column 52): " + [ params.channel.constructor.name ]);
        })();
        var rFinal = lerp(v.value0)(v1.value0)(params.blend);
        var gFinal = lerp(v.value1.value0)(v1.value1.value0)(params.blend);
        var bFinal = lerp(v.value1.value1)(v1.value1.value1)(params.blend);
        return new Data_Tuple.Tuple(clamp01(rFinal), new Data_Tuple.Tuple(clamp01(gFinal), clamp01(bFinal)));
    };
};
var buildPosterizeLUT = function (levels) {
    return map(function (i) {
        var normalized = Data_Int.toNumber(i) / 255.0;
        var result = posterizePixel(levels)(normalized);
        return Data_Int.round(max1(0.0)(min1(255.0)(result * 255.0)));
    })(Data_Array.range(0)(255));
};
export {
    InvertRGB,
    InvertRed,
    InvertGreen,
    InvertBlue,
    InvertHue,
    InvertSat,
    InvertLight,
    defaultInvertParams,
    defaultPosterizeParams,
    defaultThresholdParams,
    invert,
    posterize,
    posterizePixel,
    threshold,
    buildPosterizeLUT,
    eqInvertChannel,
    showInvertChannel
};
//# sourceMappingURL=index.js.map
