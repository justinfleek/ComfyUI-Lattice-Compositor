// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Number from "../Data.Number/index.js";
var mod$prime = function (x) {
    return function (y) {
        return x - Data_Number.floor(x / y) * y;
    };
};
var normalizeAngle = function (angle) {
    var normalized = mod$prime(angle)(360.0);
    var $14 = normalized < 0.0;
    if ($14) {
        return normalized + 360.0;
    };
    return normalized;
};
var lerpAngle = function (a) {
    return function (b) {
        return function (t) {
            var diff0 = b - a;
            var diff1 = (function () {
                var $15 = diff0 > 180.0;
                if ($15) {
                    return diff0 - 360.0;
                };
                return diff0;
            })();
            var diff = (function () {
                var $16 = diff1 < -180.0;
                if ($16) {
                    return diff1 + 360.0;
                };
                return diff1;
            })();
            var result = a + diff * t;
            return normalizeAngle(result);
        };
    };
};
var lerpAngleVec3 = function (a) {
    return function (b) {
        return function (t) {
            return {
                x: lerpAngle(a.x)(b.x)(t),
                y: lerpAngle(a.y)(b.y)(t),
                z: lerpAngle(a.z)(b.z)(t)
            };
        };
    };
};
var lerp = function (a) {
    return function (b) {
        return function (t) {
            return a + (b - a) * t;
        };
    };
};
var lerpVec3 = function (a) {
    return function (b) {
        return function (t) {
            return {
                x: lerp(a.x)(b.x)(t),
                y: lerp(a.y)(b.y)(t),
                z: lerp(a.z)(b.z)(t)
            };
        };
    };
};
var keyframeToInterpolated = function (cam) {
    return function (kf) {
        return {
            position: Data_Maybe.fromMaybe(cam.position)(kf.position),
            rotation: Data_Maybe.fromMaybe(cam.orientation)(kf.orientation),
            focalLength: Data_Maybe.fromMaybe(cam.focalLength)(kf.focalLength),
            zoom: Data_Maybe.fromMaybe(cam.zoom)(kf.zoom),
            focusDistance: Data_Maybe.fromMaybe(cam.focusDistance)(kf.focusDistance)
        };
    };
};
var interpolateBetween = function (cam) {
    return function (prev) {
        return function (next) {
            return function (frame) {
                var prevZoom = Data_Maybe.fromMaybe(cam.zoom)(prev.zoom);
                var prevPos = Data_Maybe.fromMaybe(cam.position)(prev.position);
                var prevOri = Data_Maybe.fromMaybe(cam.orientation)(prev.orientation);
                var prevFocus = Data_Maybe.fromMaybe(cam.focusDistance)(prev.focusDistance);
                var prevFocal = Data_Maybe.fromMaybe(cam.focalLength)(prev.focalLength);
                var nextZoom = Data_Maybe.fromMaybe(cam.zoom)(next.zoom);
                var nextPos = Data_Maybe.fromMaybe(cam.position)(next.position);
                var nextOri = Data_Maybe.fromMaybe(cam.orientation)(next.orientation);
                var t = Data_Int.toNumber(frame - prev.frame | 0) / Data_Int.toNumber(next.frame - prev.frame | 0);
                var nextFocus = Data_Maybe.fromMaybe(cam.focusDistance)(next.focusDistance);
                var nextFocal = Data_Maybe.fromMaybe(cam.focalLength)(next.focalLength);
                return {
                    position: lerpVec3(prevPos)(nextPos)(t),
                    rotation: lerpAngleVec3(prevOri)(nextOri)(t),
                    focalLength: lerp(prevFocal)(nextFocal)(t),
                    zoom: lerp(prevZoom)(nextZoom)(t),
                    focusDistance: lerp(prevFocus)(nextFocus)(t)
                };
            };
        };
    };
};
var findSurroundingKeyframes = function (keyframes) {
    return function (frame) {
        return Data_Array.foldl(function (acc) {
            return function (kf) {
                return {
                    prev: (function () {
                        var $17 = kf.frame <= frame;
                        if ($17) {
                            return new Data_Maybe.Just(kf);
                        };
                        return acc.prev;
                    })(),
                    next: (function () {
                        if (acc.next instanceof Data_Maybe.Nothing) {
                            var $19 = kf.frame >= frame;
                            if ($19) {
                                return new Data_Maybe.Just(kf);
                            };
                            return Data_Maybe.Nothing.value;
                        };
                        if (acc.next instanceof Data_Maybe.Just) {
                            var $20 = kf.frame >= frame && kf.frame < acc.next.value0.frame;
                            if ($20) {
                                return new Data_Maybe.Just(kf);
                            };
                            return acc.next;
                        };
                        throw new Error("Failed pattern match at Lattice.Services.Export.CameraExport.Interpolation (line 86, column 11 - line 88, column 106): " + [ acc.next.constructor.name ]);
                    })()
                };
            };
        })({
            prev: Data_Maybe.Nothing.value,
            next: Data_Maybe.Nothing.value
        })(keyframes);
    };
};
var cameraToInterpolated = function (cam) {
    return {
        position: cam.position,
        rotation: cam.orientation,
        focalLength: cam.focalLength,
        zoom: cam.zoom,
        focusDistance: cam.focusDistance
    };
};
var interpolateCameraAtFrame = function (camera) {
    return function (keyframes) {
        return function (frame) {
            var v = findSurroundingKeyframes(keyframes)(frame);
            if (v.prev instanceof Data_Maybe.Nothing && v.next instanceof Data_Maybe.Nothing) {
                return cameraToInterpolated(camera);
            };
            if (v.prev instanceof Data_Maybe.Just && v.next instanceof Data_Maybe.Nothing) {
                return keyframeToInterpolated(camera)(v.prev.value0);
            };
            if (v.prev instanceof Data_Maybe.Nothing && v.next instanceof Data_Maybe.Just) {
                return keyframeToInterpolated(camera)(v.next.value0);
            };
            if (v.prev instanceof Data_Maybe.Just && v.next instanceof Data_Maybe.Just) {
                var $31 = v.prev.value0.frame === v.next.value0.frame;
                if ($31) {
                    return keyframeToInterpolated(camera)(v.prev.value0);
                };
                return interpolateBetween(camera)(v.prev.value0)(v.next.value0)(frame);
            };
            throw new Error("Failed pattern match at Lattice.Services.Export.CameraExport.Interpolation (line 63, column 3 - line 74, column 44): " + [ v.constructor.name ]);
        };
    };
};
export {
    interpolateCameraAtFrame,
    lerp,
    lerpAngle,
    normalizeAngle
};
//# sourceMappingURL=index.js.map
