{"comments":"Lattice.Utils.CanvasPool - Canvas buffer pool for effect processing\n\n@module Lattice.Utils.CanvasPool\n@description Reuses canvas elements to reduce allocation overhead and\nprevent memory leaks. Used by effect processors and layer style renderers.\n\n## Architecture\n\nThe pool maintains a fixed-size collection of canvas elements that can be\nborrowed and returned. When a canvas is requested:\n\n1. Check if an unused canvas with matching dimensions exists\n2. If yes, mark it in-use and return it\n3. If no matching canvas exists, return Nothing (canvas must be provided externally)\n4. Old unused canvases are periodically cleaned up\n\n## Canvas Creation\n\nThis module does NOT create canvas elements - canvas creation requires\nDOM access which should be handled by the rendering system. Use `register`\nto add externally-created canvases to the pool.\n\nSource: ui/src/utils/canvasPool.ts\n","declarations":[{"children":[],"comments":"Result of acquiring a canvas from the pool\n\n@field canvas The canvas element to draw on\n@field ctx The 2D rendering context for drawing operations\n","info":{"arguments":[],"declType":"typeSynonym","type":{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Record"],"tag":"TypeConstructor"},{"annotation":[],"contents":["canvas",{"annotation":[],"contents":[["Graphics","Canvas"],"CanvasElement"],"tag":"TypeConstructor"},{"annotation":[],"contents":["ctx",{"annotation":[],"contents":[["Graphics","Canvas"],"Context2D"],"tag":"TypeConstructor"},{"annotation":[],"tag":"REmpty"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[67,4],"name":"src/Lattice/Utils/CanvasPool.purs","start":[64,1]},"title":"CanvasResult"},{"children":[],"comments":"Internal pooled canvas record\n\n@field canvas The canvas element\n@field ctx The rendering context\n@field width Canvas width in pixels\n@field height Canvas height in pixels\n@field inUse Whether the canvas is currently borrowed\n@field lastUsed Timestamp of last use (for cleanup)\n","info":{"arguments":[],"declType":"typeSynonym","type":{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Record"],"tag":"TypeConstructor"},{"annotation":[],"contents":["canvas",{"annotation":[],"contents":[["Graphics","Canvas"],"CanvasElement"],"tag":"TypeConstructor"},{"annotation":[],"contents":["ctx",{"annotation":[],"contents":[["Graphics","Canvas"],"Context2D"],"tag":"TypeConstructor"},{"annotation":[],"contents":["width",{"annotation":[],"contents":[["Prim"],"Int"],"tag":"TypeConstructor"},{"annotation":[],"contents":["height",{"annotation":[],"contents":[["Prim"],"Int"],"tag":"TypeConstructor"},{"annotation":[],"contents":["inUse",{"annotation":[],"contents":[["Prim"],"Boolean"],"tag":"TypeConstructor"},{"annotation":[],"contents":["lastUsed",{"annotation":[],"contents":[["Prim"],"Number"],"tag":"TypeConstructor"},{"annotation":[],"tag":"REmpty"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[84,4],"name":"src/Lattice/Utils/CanvasPool.purs","start":[77,1]},"title":"PooledCanvas"},{"children":[],"comments":"Canvas pool state\n\nWraps a mutable reference to the pool array plus configuration.\n","info":{"dataDeclType":"newtype","declType":"data","roles":[],"typeArguments":[]},"kind":null,"sourceSpan":{"end":[112,4],"name":"src/Lattice/Utils/CanvasPool.purs","start":[109,1]},"title":"CanvasPool"},{"children":[],"comments":"Pool statistics for monitoring\n\n@field total Total canvases in pool\n@field inUse Number currently borrowed\n@field available Number available for borrowing\n","info":{"arguments":[],"declType":"typeSynonym","type":{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Record"],"tag":"TypeConstructor"},{"annotation":[],"contents":["total",{"annotation":[],"contents":[["Prim"],"Int"],"tag":"TypeConstructor"},{"annotation":[],"contents":["inUse",{"annotation":[],"contents":[["Prim"],"Int"],"tag":"TypeConstructor"},{"annotation":[],"contents":["available",{"annotation":[],"contents":[["Prim"],"Int"],"tag":"TypeConstructor"},{"annotation":[],"tag":"REmpty"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"RCons"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[95,4],"name":"src/Lattice/Utils/CanvasPool.purs","start":[91,1]},"title":"PoolStats"},{"children":[],"comments":"Create a new canvas pool\n\n@returns A new empty pool with default configuration\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Lattice","Utils","CanvasPool"],"CanvasPool"],"tag":"TypeConstructor"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[131,34],"name":"src/Lattice/Utils/CanvasPool.purs","start":[131,1]},"title":"mkCanvasPool"},{"children":[],"comments":"Register an externally-created canvas with the pool\n\nSince canvas creation requires DOM access, canvases must be created\nexternally (e.g., via Halogen refs or document.createElement) and then\nregistered with the pool for reuse.\n\n@param pool The pool to register with\n@param canvas The canvas element to add\n@param ctx The 2D context for the canvas\n@param width Canvas width in pixels\n@param height Canvas height in pixels\n\n@postcondition Canvas is added to pool and marked as available\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Lattice","Utils","CanvasPool"],"CanvasPool"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Graphics","Canvas"],"CanvasElement"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Graphics","Canvas"],"Context2D"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Int"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Int"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Data","Unit"],"Unit"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[158,96],"name":"src/Lattice/Utils/CanvasPool.purs","start":[158,1]},"title":"register"},{"children":[],"comments":"Acquire a canvas of specified dimensions\n\nLooks for an available canvas in the pool with matching dimensions.\nIf no matching canvas is available, returns Nothing.\n\nTo use this effectively:\n1. Call acquire with desired dimensions\n2. If Nothing, create a canvas externally and register it\n3. Call acquire again to get the newly registered canvas\n\n@param pool The canvas pool to borrow from\n@param width Desired canvas width in pixels\n@param height Desired canvas height in pixels\n@returns A canvas result with the element and context, or Nothing if none available\n\n@postcondition If Just, canvas is cleared before returning\n@postcondition If Just, canvas is marked as in-use in the pool\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Lattice","Utils","CanvasPool"],"CanvasPool"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Int"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Int"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":{"annotation":[],"contents":[{"annotation":[],"contents":[["Data","Maybe"],"Maybe"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Lattice","Utils","CanvasPool"],"CanvasResult"],"tag":"TypeConstructor"}],"tag":"TypeApp"},"tag":"ParensInType"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[191,67],"name":"src/Lattice/Utils/CanvasPool.purs","start":[191,1]},"title":"acquire"},{"children":[],"comments":"Release a canvas back to the pool\n\n@param pool The pool the canvas belongs to\n@param canvas The canvas to release\n\n@postcondition Canvas is marked as not in-use\n@postcondition lastUsed is updated to current time\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Lattice","Utils","CanvasPool"],"CanvasPool"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Graphics","Canvas"],"CanvasElement"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Data","Unit"],"Unit"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[257,61],"name":"src/Lattice/Utils/CanvasPool.purs","start":[257,1]},"title":"release"},{"children":[],"comments":"Clean up old unused canvases\n\nRemoves canvases that have been unused for longer than maxAge.\n\n@param pool The pool to clean up\n@postcondition Old unused canvases are removed\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Lattice","Utils","CanvasPool"],"CanvasPool"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Data","Unit"],"Unit"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[272,37],"name":"src/Lattice/Utils/CanvasPool.purs","start":[272,1]},"title":"cleanup"},{"children":[],"comments":"Clear all pooled canvases\n\nRemoves all canvases from the pool. Use when shutting down\nor when memory pressure requires releasing all resources.\n\n@param pool The pool to clear\n@postcondition Pool is empty\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Lattice","Utils","CanvasPool"],"CanvasPool"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Data","Unit"],"Unit"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[286,35],"name":"src/Lattice/Utils/CanvasPool.purs","start":[286,1]},"title":"clear"},{"children":[],"comments":"Get pool statistics\n\n@param pool The pool to inspect\n@returns Statistics about pool state\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Lattice","Utils","CanvasPool"],"CanvasPool"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[["Effect"],"Effect"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Lattice","Utils","CanvasPool"],"PoolStats"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[294,43],"name":"src/Lattice/Utils/CanvasPool.purs","start":[294,1]},"title":"getStats"}],"name":"Lattice.Utils.CanvasPool","reExports":[]}