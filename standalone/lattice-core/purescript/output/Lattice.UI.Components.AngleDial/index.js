// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Control_Monad_State_Class from "../Control.Monad.State.Class/index.js";
import * as DOM_HTML_Indexed_InputType from "../DOM.HTML.Indexed.InputType/index.js";
import * as Data_Function from "../Data.Function/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Halogen_Component from "../Halogen.Component/index.js";
import * as Halogen_HTML_Core from "../Halogen.HTML.Core/index.js";
import * as Halogen_HTML_Elements from "../Halogen.HTML.Elements/index.js";
import * as Halogen_HTML_Events from "../Halogen.HTML.Events/index.js";
import * as Halogen_HTML_Properties from "../Halogen.HTML.Properties/index.js";
import * as Halogen_Query_HalogenM from "../Halogen.Query.HalogenM/index.js";
import * as Lattice_UI_Core from "../Lattice.UI.Core/index.js";
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var pure = /* #__PURE__ */ Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM);
var modify_ = /* #__PURE__ */ Control_Monad_State_Class.modify_(Halogen_Query_HalogenM.monadStateHalogenM);
var bind = /* #__PURE__ */ Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM);
var get = /* #__PURE__ */ Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM);
var when = /* #__PURE__ */ Control_Applicative.when(Halogen_Query_HalogenM.applicativeHalogenM);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM);
var show1 = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var type_ = /* #__PURE__ */ Halogen_HTML_Properties.type_(Halogen_HTML_Core.isPropInputType);
var value = /* #__PURE__ */ Halogen_HTML_Properties.value(Halogen_HTML_Core.isPropString);
var AngleChanged = /* #__PURE__ */ (function () {
    function AngleChanged(value0) {
        this.value0 = value0;
    };
    AngleChanged.create = function (value0) {
        return new AngleChanged(value0);
    };
    return AngleChanged;
})();
var Initialize = /* #__PURE__ */ (function () {
    function Initialize() {

    };
    Initialize.value = new Initialize();
    return Initialize;
})();
var Receive = /* #__PURE__ */ (function () {
    function Receive(value0) {
        this.value0 = value0;
    };
    Receive.create = function (value0) {
        return new Receive(value0);
    };
    return Receive;
})();
var StartDrag = /* #__PURE__ */ (function () {
    function StartDrag(value0) {
        this.value0 = value0;
    };
    StartDrag.create = function (value0) {
        return new StartDrag(value0);
    };
    return StartDrag;
})();
var OnInputChange = /* #__PURE__ */ (function () {
    function OnInputChange(value0) {
        this.value0 = value0;
    };
    OnInputChange.create = function (value0) {
        return new OnInputChange(value0);
    };
    return OnInputChange;
})();
var OnInputBlur = /* #__PURE__ */ (function () {
    function OnInputBlur() {

    };
    OnInputBlur.value = new OnInputBlur();
    return OnInputBlur;
})();
var valueContainerStyle = "display: flex; align-items: center; gap: 2px;";
var unitStyle = "font-size: 13px; color: var(--lattice-text-muted);";
var roundAngle = function (angle) {
    return Data_Number.round(angle * 10.0) / 10.0;
};
var ringStyle = /* #__PURE__ */ (function () {
    return "position: absolute; inset: 4px; " + "border: 2px solid var(--lattice-border-default); border-radius: 50%;";
})();
var normalizeAngle = function (angle) {
    var modAngle = angle - Data_Number.floor(angle / 360.0) * 360.0;
    var $29 = modAngle < 0.0;
    if ($29) {
        return modAngle + 360.0;
    };
    return modAngle;
};
var marksContainerStyle = "position: absolute; inset: 0;";
var markStyle = function (idx) {
    var angle = Data_Int.toNumber(idx) * 45.0;
    return "position: absolute; top: 2px; left: 50%; " + ("width: 1px; height: 4px; background: var(--lattice-text-muted); " + ("transform-origin: center calc(50% - 2px); " + ("transform: translateX(-50%) rotate(" + (show(angle) + "deg);"))));
};
var renderMark = function (idx) {
    return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-dial-mark" ]), Halogen_HTML_Properties.attr("style")(markStyle(idx)) ])([  ]);
};
var inputStyle = /* #__PURE__ */ (function () {
    return "width: 50px; padding: 4px 6px; " + ("border: 1px solid var(--lattice-border-subtle); border-radius: 3px; " + ("background: var(--lattice-surface-2); color: var(--lattice-text-primary); " + "font-size: 13px; text-align: right;"));
})();
var initialState = function (input) {
    return {
        value: input.value,
        size: input.size,
        showValue: input.showValue,
        disabled: input.disabled,
        isDragging: false
    };
};
var indicatorStyle = function (angle) {
    return "position: absolute; top: 50%; left: 50%; " + ("width: 2px; height: 45%; background: var(--lattice-accent); " + ("border-radius: 1px; transform-origin: center bottom; " + ("transform: translateX(-50%) rotate(" + (show(angle) + "deg);"))));
};
var handleAction = function (dictMonadAff) {
    return function (v) {
        if (v instanceof Initialize) {
            return pure(Data_Unit.unit);
        };
        if (v instanceof Receive) {
            return modify_(function (v1) {
                var $31 = {};
                for (var $32 in v1) {
                    if ({}.hasOwnProperty.call(v1, $32)) {
                        $31[$32] = v1[$32];
                    };
                };
                $31.value = v.value0.value;
                $31.size = v.value0.size;
                $31.showValue = v.value0.showValue;
                $31.disabled = v.value0.disabled;
                return $31;
            });
        };
        if (v instanceof StartDrag) {
            return bind(get)(function (state) {
                return when(!state.disabled)(modify_(function (v1) {
                    var $35 = {};
                    for (var $36 in v1) {
                        if ({}.hasOwnProperty.call(v1, $36)) {
                            $35[$36] = v1[$36];
                        };
                    };
                    $35.isDragging = true;
                    return $35;
                }));
            });
        };
        if (v instanceof OnInputChange) {
            var v1 = Data_Number.fromString(v.value0);
            if (v1 instanceof Data_Maybe.Just) {
                var newAngle = normalizeAngle(v1.value0);
                return discard(modify_(function (v2) {
                    var $40 = {};
                    for (var $41 in v2) {
                        if ({}.hasOwnProperty.call(v2, $41)) {
                            $40[$41] = v2[$41];
                        };
                    };
                    $40.value = newAngle;
                    return $40;
                }))(function () {
                    return Halogen_Query_HalogenM.raise(new AngleChanged(newAngle));
                });
            };
            if (v1 instanceof Data_Maybe.Nothing) {
                return pure(Data_Unit.unit);
            };
            throw new Error("Failed pattern match at Lattice.UI.Components.AngleDial (line 260, column 5 - line 265, column 27): " + [ v1.constructor.name ]);
        };
        if (v instanceof OnInputBlur) {
            return pure(Data_Unit.unit);
        };
        throw new Error("Failed pattern match at Lattice.UI.Components.AngleDial (line 239, column 16 - line 267, column 27): " + [ v.constructor.name ]);
    };
};
var dialStyle = function (size) {
    return "position: relative; cursor: grab; " + ("width: " + (show1(size) + ("px; height: " + (show1(size) + "px;"))));
};
var containerStyle = "display: flex; align-items: center; gap: 8px;";
var centerStyle = /* #__PURE__ */ (function () {
    return "position: absolute; top: 50%; left: 50%; " + ("width: 6px; height: 6px; background: var(--lattice-text-muted); " + "border-radius: 50%; transform: translate(-50%, -50%);");
})();
var render = function (state) {
    return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-angle-dial" ]), Halogen_HTML_Properties.attr("data-state")((function () {
        if (state.disabled) {
            return "disabled";
        };
        return "enabled";
    })()), Halogen_HTML_Properties.attr("style")(containerStyle) ])([ Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-dial" ]), Halogen_HTML_Properties.attr("style")(dialStyle(state.size)), Halogen_HTML_Events.onMouseDown(StartDrag.create) ])([ Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-dial-ring" ]), Halogen_HTML_Properties.attr("style")(ringStyle) ])([  ]), Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-dial-center" ]), Halogen_HTML_Properties.attr("style")(centerStyle) ])([  ]), Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-dial-indicator" ]), Halogen_HTML_Properties.attr("style")(indicatorStyle(state.value)) ])([  ]), Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-dial-marks" ]), Halogen_HTML_Properties.attr("style")(marksContainerStyle) ])(map(renderMark)([ 0, 1, 2, 3, 4, 5, 6, 7 ])) ]), (function () {
        if (state.showValue) {
            return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-angle-value" ]), Halogen_HTML_Properties.attr("style")(valueContainerStyle) ])([ Halogen_HTML_Elements.input([ Lattice_UI_Core.cls([ "lattice-angle-input" ]), type_(DOM_HTML_Indexed_InputType.InputNumber.value), value(show(roundAngle(state.value))), Halogen_HTML_Properties.disabled(state.disabled), Halogen_HTML_Properties.attr("style")(inputStyle), Halogen_HTML_Events.onValueInput(OnInputChange.create), Halogen_HTML_Events.onBlur(Data_Function["const"](OnInputBlur.value)) ]), Halogen_HTML_Elements.span([ Lattice_UI_Core.cls([ "lattice-angle-unit" ]), Halogen_HTML_Properties.attr("style")(unitStyle) ])([ Halogen_HTML_Core.text("\xb0") ]) ]);
        };
        return Halogen_HTML_Core.text("");
    })() ]);
};
var component = function (dictMonadAff) {
    return Halogen_Component.mkComponent({
        initialState: initialState,
        render: render,
        "eval": Halogen_Component.mkEval({
            handleQuery: Halogen_Component.defaultEval.handleQuery,
            finalize: Halogen_Component.defaultEval.finalize,
            handleAction: handleAction(dictMonadAff),
            initialize: new Data_Maybe.Just(Initialize.value),
            receive: function ($47) {
                return Data_Maybe.Just.create(Receive.create($47));
            }
        })
    });
};
export {
    component,
    AngleChanged
};
//# sourceMappingURL=index.js.map
