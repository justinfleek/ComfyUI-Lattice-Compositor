// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Boolean from "../Data.Boolean/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Ring from "../Data.Ring/index.js";
import * as Data_Tuple from "../Data.Tuple/index.js";
import * as $$Math from "../Math/index.js";
var abs = /* #__PURE__ */ Data_Ord.abs(Data_Ord.ordInt)(Data_Ring.ringInt);
var compare = /* #__PURE__ */ Data_Ord.compare(Data_Ord.ordInt);
var map = /* #__PURE__ */ Data_Functor.map(Data_Maybe.functorMaybe);
var map1 = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var foldl = /* #__PURE__ */ Data_Foldable.foldl(Data_Foldable.foldableArray);
var min = /* #__PURE__ */ Data_Ord.min(Data_Ord.ordInt);
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordInt);
var mkFrameBufferStats = function (count) {
    return function (oldest) {
        return function (newest) {
            return {
                frameCount: count,
                oldestFrame: oldest,
                newestFrame: newest
            };
        };
    };
};
var mkFrameBufferEntry = function (imgData) {
    return function (fr) {
        return function (storedAt) {
            return {
                imageData: imgData,
                frame: fr,
                storedAtFrame: storedAt
            };
        };
    };
};
var mkEchoFrameResult = function (imgData) {
    return function (fr) {
        return function (idx) {
            return {
                imageData: imgData,
                frame: fr,
                echoIndex: idx
            };
        };
    };
};
var maxBufferFrames = 64;
var shouldTrimBuffer = function (bufferLength) {
    return bufferLength > maxBufferFrames;
};
var isFrameInRange = function (frameNum) {
    return function (currentFrame) {
        return function (maxDistance) {
            return abs(currentFrame - frameNum | 0) < maxDistance;
        };
    };
};
var findClosestFrameIndex = function (entries) {
    return function (targetFrame) {
        if (Data_Array.length(entries) === 0) {
            return Data_Maybe.Nothing.value;
        };
        if (Data_Boolean.otherwise) {
            var indexed = Data_Array.mapWithIndex(function (i) {
                return function (e) {
                    return new Data_Tuple.Tuple(i, abs(e.frame - targetFrame | 0));
                };
            })(entries);
            var sorted = Data_Array.sortBy(function (a) {
                return function (b) {
                    return compare(Data_Tuple.snd(a))(Data_Tuple.snd(b));
                };
            })(indexed);
            return map(Data_Tuple.fst)(Data_Array.head(sorted));
        };
        throw new Error("Failed pattern match at Lattice.Services.Time.FrameBuffer (line 163, column 1 - line 163, column 82): " + [ entries.constructor.name, targetFrame.constructor.name ]);
    };
};
var findClosestFrame = function (entries) {
    return function (targetFrame) {
        if (Data_Array.length(entries) === 0) {
            return Data_Maybe.Nothing.value;
        };
        if (Data_Boolean.otherwise) {
            var withDist = map1(function (e) {
                return new Data_Tuple.Tuple(abs(e.frame - targetFrame | 0), e);
            })(entries);
            var sorted = Data_Array.sortBy(function (a) {
                return function (b) {
                    return compare(Data_Tuple.fst(a))(Data_Tuple.fst(b));
                };
            })(withDist);
            return map(Data_Tuple.snd)(Data_Array.head(sorted));
        };
        throw new Error("Failed pattern match at Lattice.Services.Time.FrameBuffer (line 154, column 1 - line 154, column 94): " + [ entries.constructor.name, targetFrame.constructor.name ]);
    };
};
var fbsOldestFrame = function (s) {
    return s.oldestFrame;
};
var fbsNewestFrame = function (s) {
    return s.newestFrame;
};
var fbsFrameCount = function (s) {
    return s.frameCount;
};
var fbeStoredAtFrame = function (e) {
    return e.storedAtFrame;
};
var fbeImageData = function (e) {
    return e.imageData;
};
var fbeFrame = function (e) {
    return e.frame;
};
var emptyBufferStats = /* #__PURE__ */ (function () {
    return {
        frameCount: 0,
        oldestFrame: -1 | 0,
        newestFrame: -1 | 0
    };
})();
var efrImageData = function (r) {
    return r.imageData;
};
var efrFrame = function (r) {
    return r.frame;
};
var efrEchoIndex = function (r) {
    return r.echoIndex;
};
var defaultMaxFrameDistance = /* #__PURE__ */ (function () {
    return maxBufferFrames * 2 | 0;
})();
var frameDistanceInRange = function (storedAtFrame) {
    return function (currentFrame) {
        return abs(currentFrame - storedAtFrame | 0) < defaultMaxFrameDistance;
    };
};
var calculateEchoTargetFrames = function (currentFrame) {
    return function (echoTimeFrames) {
        return function (numEchoes) {
            var indices = map1(function (v) {
                return v + 1 | 0;
            })(Data_Array.range(0)(numEchoes - 1 | 0));
            var calcTarget = function (i) {
                return Data_Int.round(Data_Int.toNumber(currentFrame) + echoTimeFrames * Data_Int.toNumber(i));
            };
            return map1(function (i) {
                return new Data_Tuple.Tuple(calcTarget(i), i);
            })(indices);
        };
    };
};
var calculateEchoIntensity = function (startingIntensity) {
    return function (decay) {
        return function (echoIndex) {
            return startingIntensity * $$Math.pow(1.0 - decay)(Data_Int.toNumber(echoIndex));
        };
    };
};
var calculateBufferStats = function (entries) {
    if (Data_Array.length(entries) === 0) {
        return emptyBufferStats;
    };
    if (Data_Boolean.otherwise) {
        var frames = map1(function (v) {
            return v.frame;
        })(entries);
        var minMax = foldl(function (acc) {
            return function (f) {
                return {
                    minF: min(acc.minF)(f),
                    maxF: max(acc.maxF)(f)
                };
            };
        })({
            minF: 2147483647,
            maxF: -2147483648 | 0
        })(frames);
        return {
            frameCount: Data_Array.length(entries),
            oldestFrame: minMax.minF,
            newestFrame: minMax.maxF
        };
    };
    throw new Error("Failed pattern match at Lattice.Services.Time.FrameBuffer (line 190, column 1 - line 190, column 81): " + [ entries.constructor.name ]);
};
export {
    mkFrameBufferEntry,
    fbeImageData,
    fbeFrame,
    fbeStoredAtFrame,
    mkFrameBufferStats,
    fbsFrameCount,
    fbsOldestFrame,
    fbsNewestFrame,
    mkEchoFrameResult,
    efrImageData,
    efrFrame,
    efrEchoIndex,
    maxBufferFrames,
    defaultMaxFrameDistance,
    shouldTrimBuffer,
    isFrameInRange,
    frameDistanceInRange,
    findClosestFrame,
    findClosestFrameIndex,
    calculateEchoTargetFrames,
    calculateEchoIntensity,
    calculateBufferStats,
    emptyBufferStats
};
//# sourceMappingURL=index.js.map
