// Generated by purs version 0.15.15
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Identity from "../Data.Identity/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Effect_Aff from "../Effect.Aff/index.js";
import * as Lattice_Services_Export_CameraExport_Formats_Common from "../Lattice.Services.Export.CameraExport.Formats.Common/index.js";
import * as Lattice_Services_Export_CameraExport_Formats_MotionCtrl from "../Lattice.Services.Export.CameraExport.Formats.MotionCtrl/index.js";
import * as Lattice_Services_Export_CameraExport_Formats_Wan22 from "../Lattice.Services.Export.CameraExport.Formats.Wan22/index.js";
import * as Lattice_Services_Export_CameraExport_Interpolation from "../Lattice.Services.Export.CameraExport.Interpolation/index.js";
import * as Lattice_Services_Export_CameraExport_Matrix from "../Lattice.Services.Export.CameraExport.Matrix/index.js";
import * as Lattice_Services_Export_CameraExport_MotionAnalysis from "../Lattice.Services.Export.CameraExport.MotionAnalysis/index.js";
import * as Lattice_Services_Export_CameraExport_Types from "../Lattice.Services.Export.CameraExport.Types/index.js";
import * as Test_Lattice_TestHelpers from "../Test.Lattice.TestHelpers/index.js";
import * as Test_Spec from "../Test.Spec/index.js";
import * as Test_Spec_Assertions from "../Test.Spec.Assertions/index.js";
var describe = /* #__PURE__ */ Test_Spec.describe(Data_Identity.monadIdentity);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit);
var discard1 = /* #__PURE__ */ discard(/* #__PURE__ */ Test_Spec.bindSpecT(Data_Identity.bindIdentity));
var it = /* #__PURE__ */ Test_Spec.it(Data_Identity.monadIdentity)(Test_Spec.exampleMUnit);
var discard2 = /* #__PURE__ */ discard(Effect_Aff.bindAff);
var shouldEqual = /* #__PURE__ */ Test_Spec_Assertions.shouldEqual(Effect_Aff.monadThrowAff);
var shouldEqual1 = /* #__PURE__ */ shouldEqual(Data_Show.showBoolean)(Data_Eq.eqBoolean);
var shouldEqual2 = /* #__PURE__ */ shouldEqual(/* #__PURE__ */ Data_Maybe.showMaybe(Lattice_Services_Export_CameraExport_Types.showZoomDirection))(/* #__PURE__ */ Data_Maybe.eqMaybe(Lattice_Services_Export_CameraExport_Types.eqZoomDirection));
var shouldEqual3 = /* #__PURE__ */ shouldEqual(Data_Show.showString)(Data_Eq.eqString);
var shouldEqual4 = /* #__PURE__ */ shouldEqual(Lattice_Services_Export_CameraExport_Types.showWan22CameraMotion)(Lattice_Services_Export_CameraExport_Types.eqWan22CameraMotion);
var shouldEqual5 = /* #__PURE__ */ shouldEqual(Data_Show.showInt)(Data_Eq.eqInt);
var fail = /* #__PURE__ */ Test_Spec_Assertions.fail(Effect_Aff.monadThrowAff);
var shouldEqual6 = /* #__PURE__ */ shouldEqual(Lattice_Services_Export_CameraExport_Types.showMotionCtrlSVDPreset)(Lattice_Services_Export_CameraExport_Types.eqMotionCtrlSVDPreset);
var unsafeIndex = function (arr) {
    return function (i) {
        var v = Data_Array.index(arr)(i);
        if (v instanceof Data_Maybe.Just) {
            return v.value0;
        };
        if (v instanceof Data_Maybe.Nothing) {
            return 0.0;
        };
        throw new Error("Failed pattern match at Test.Lattice.Export.CameraFormats (line 417, column 21 - line 419, column 17): " + [ v.constructor.name ]);
    };
};
var unsafeIndex2 = function (m) {
    return function (r) {
        return function (c) {
            var v = Data_Array.index(m)(r);
            if (v instanceof Data_Maybe.Just) {
                return unsafeIndex(v.value0)(c);
            };
            if (v instanceof Data_Maybe.Nothing) {
                return 0.0;
            };
            throw new Error("Failed pattern match at Test.Lattice.Export.CameraFormats (line 422, column 22 - line 424, column 17): " + [ v.constructor.name ]);
        };
    };
};
var motionAnalysisTests = /* #__PURE__ */ describe("motion analysis")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("empty keyframes returns no motion")(/* #__PURE__ */ (function () {
    var result = Lattice_Services_Export_CameraExport_MotionAnalysis.analyzeCameraMotion([  ]);
    return discard2(shouldEqual1(result.hasPan)(false))(function () {
        return discard2(shouldEqual1(result.hasZoom)(false))(function () {
            return shouldEqual1(result.hasOrbit)(false);
        });
    });
})()))(function () {
    return discard1(it("single keyframe returns no motion")((function () {
        var result = Lattice_Services_Export_CameraExport_MotionAnalysis.analyzeCameraMotion([ {
            frame: 0,
            position: Data_Maybe.Nothing.value,
            orientation: Data_Maybe.Nothing.value
        } ]);
        return discard2(shouldEqual1(result.hasPan)(false))(function () {
            return shouldEqual1(result.hasZoom)(false);
        });
    })()))(function () {
        return discard1(it("detects zoom in (negative deltaZ)")((function () {
            var kfs = [ {
                frame: 0,
                position: new Data_Maybe.Just({
                    x: 0.0,
                    y: 0.0,
                    z: 0.0
                }),
                orientation: Data_Maybe.Nothing.value
            }, {
                frame: 10,
                position: new Data_Maybe.Just({
                    x: 0.0,
                    y: 0.0,
                    z: -100.0
                }),
                orientation: Data_Maybe.Nothing.value
            } ];
            var result = Lattice_Services_Export_CameraExport_MotionAnalysis.analyzeCameraMotion(kfs);
            return discard2(shouldEqual1(result.hasZoom)(true))(function () {
                return shouldEqual2(result.zoomDirection)(new Data_Maybe.Just(Lattice_Services_Export_CameraExport_Types.ZoomIn.value));
            });
        })()))(function () {
            return discard1(it("detects zoom out (positive deltaZ)")((function () {
                var kfs = [ {
                    frame: 0,
                    position: new Data_Maybe.Just({
                        x: 0.0,
                        y: 0.0,
                        z: -100.0
                    }),
                    orientation: Data_Maybe.Nothing.value
                }, {
                    frame: 10,
                    position: new Data_Maybe.Just({
                        x: 0.0,
                        y: 0.0,
                        z: 0.0
                    }),
                    orientation: Data_Maybe.Nothing.value
                } ];
                var result = Lattice_Services_Export_CameraExport_MotionAnalysis.analyzeCameraMotion(kfs);
                return discard2(shouldEqual1(result.hasZoom)(true))(function () {
                    return shouldEqual2(result.zoomDirection)(new Data_Maybe.Just(Lattice_Services_Export_CameraExport_Types.ZoomOut.value));
                });
            })()))(function () {
                return discard1(it("detects pan from horizontal movement")((function () {
                    var kfs = [ {
                        frame: 0,
                        position: new Data_Maybe.Just({
                            x: 0.0,
                            y: 0.0,
                            z: -500.0
                        }),
                        orientation: Data_Maybe.Nothing.value
                    }, {
                        frame: 10,
                        position: new Data_Maybe.Just({
                            x: 100.0,
                            y: 0.0,
                            z: -500.0
                        }),
                        orientation: Data_Maybe.Nothing.value
                    } ];
                    var result = Lattice_Services_Export_CameraExport_MotionAnalysis.analyzeCameraMotion(kfs);
                    return shouldEqual1(result.hasPan)(true);
                })()))(function () {
                    return it("detectDominantMotion returns static for no motion")(shouldEqual3(Lattice_Services_Export_CameraExport_MotionAnalysis.detectDominantMotion(Lattice_Services_Export_CameraExport_Types.defaultMotionAnalysis))("static"));
                });
            });
        });
    });
}));
var mkKeyframe = function (frame) {
    return {
        frame: frame,
        position: Data_Maybe.Nothing.value,
        orientation: Data_Maybe.Nothing.value,
        focalLength: Data_Maybe.Nothing.value,
        zoom: Data_Maybe.Nothing.value,
        focusDistance: Data_Maybe.Nothing.value
    };
};
var mkKeyframeWithOri = function (frame) {
    return function (ori) {
        var v = mkKeyframe(frame);
        return {
            frame: v.frame,
            position: v.position,
            focalLength: v.focalLength,
            zoom: v.zoom,
            focusDistance: v.focusDistance,
            orientation: new Data_Maybe.Just(ori)
        };
    };
};
var mkKeyframeWithPos = function (frame) {
    return function (pos) {
        var v = mkKeyframe(frame);
        return {
            frame: v.frame,
            orientation: v.orientation,
            focalLength: v.focalLength,
            zoom: v.zoom,
            focusDistance: v.focusDistance,
            position: new Data_Maybe.Just(pos)
        };
    };
};
var mkKeyframeWithPosOri = function (frame) {
    return function (pos) {
        return function (ori) {
            var v = mkKeyframe(frame);
            return {
                frame: v.frame,
                focalLength: v.focalLength,
                zoom: v.zoom,
                focusDistance: v.focusDistance,
                position: new Data_Maybe.Just(pos),
                orientation: new Data_Maybe.Just(ori)
            };
        };
    };
};
var wan22Tests = /* #__PURE__ */ describe("Wan22 FunCamera")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("returns Static for no keyframes")(/* #__PURE__ */ (function () {
    var result = Lattice_Services_Export_CameraExport_Formats_Wan22.mapToWan22FunCamera([  ]);
    return shouldEqual4(result.cameraMotion)(Lattice_Services_Export_CameraExport_Types.Wan22Static.value);
})()))(function () {
    return discard1(it("returns Static for single keyframe")((function () {
        var result = Lattice_Services_Export_CameraExport_Formats_Wan22.mapToWan22FunCamera([ mkKeyframe(0) ]);
        return shouldEqual4(result.cameraMotion)(Lattice_Services_Export_CameraExport_Types.Wan22Static.value);
    })()))(function () {
        return discard1(it("detects zoom in")((function () {
            var kfs = [ mkKeyframeWithPos(0)({
                x: 0.0,
                y: 0.0,
                z: 0.0
            }), mkKeyframeWithPos(10)({
                x: 0.0,
                y: 0.0,
                z: -100.0
            }) ];
            var result = Lattice_Services_Export_CameraExport_Formats_Wan22.mapToWan22FunCamera(kfs);
            return shouldEqual4(result.cameraMotion)(Lattice_Services_Export_CameraExport_Types.Wan22ZoomIn.value);
        })()))(function () {
            return it("detects pan right")((function () {
                var kfs = [ mkKeyframeWithPos(0)({
                    x: 0.0,
                    y: 0.0,
                    z: -500.0
                }), mkKeyframeWithPos(10)({
                    x: 100.0,
                    y: 0.0,
                    z: -500.0
                }) ];
                var result = Lattice_Services_Export_CameraExport_Formats_Wan22.mapToWan22FunCamera(kfs);
                return shouldEqual4(result.cameraMotion)(Lattice_Services_Export_CameraExport_Types.Wan22PanRight.value);
            })());
        });
    });
}));
var mkCamera = /* #__PURE__ */ (function () {
    return {
        position: {
            x: 0.0,
            y: 0.0,
            z: -500.0
        },
        orientation: {
            x: 0.0,
            y: 0.0,
            z: 0.0
        },
        focalLength: 50.0,
        filmSize: 36.0,
        zoom: 1.0,
        focusDistance: 1000.0,
        cameraType: "perspective"
    };
})();
var motionCtrlTests = /* #__PURE__ */ describe("MotionCtrl export")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("exports correct number of poses")(/* #__PURE__ */ (function () {
    var result = Lattice_Services_Export_CameraExport_Formats_MotionCtrl.exportToMotionCtrl(mkCamera)([  ])(24);
    return shouldEqual5(Data_Array.length(result.cameraPoses))(24);
})()))(function () {
    return discard1(it("exports single pose for frame count 1")((function () {
        var result = Lattice_Services_Export_CameraExport_Formats_MotionCtrl.exportToMotionCtrl(mkCamera)([  ])(1);
        return shouldEqual5(Data_Array.length(result.cameraPoses))(1);
    })()))(function () {
        return discard1(it("each pose has 4x4 RT matrix")((function () {
            var result = Lattice_Services_Export_CameraExport_Formats_MotionCtrl.exportToMotionCtrl(mkCamera)([  ])(5);
            var v = Data_Array.index(result.cameraPoses)(0);
            if (v instanceof Data_Maybe.Just) {
                return discard2(shouldEqual5(Data_Array.length(v.value0.rt))(4))(function () {
                    var v1 = Data_Array.index(v.value0.rt)(0);
                    if (v1 instanceof Data_Maybe.Just) {
                        return shouldEqual5(Data_Array.length(v1.value0))(4);
                    };
                    if (v1 instanceof Data_Maybe.Nothing) {
                        return fail("Expected 4-element row");
                    };
                    throw new Error("Failed pattern match at Test.Lattice.Export.CameraFormats (line 327, column 11 - line 329, column 53): " + [ v1.constructor.name ]);
                });
            };
            if (v instanceof Data_Maybe.Nothing) {
                return fail("Expected at least one pose");
            };
            throw new Error("Failed pattern match at Test.Lattice.Export.CameraFormats (line 324, column 7 - line 330, column 53): " + [ v.constructor.name ]);
        })()))(function () {
            return discard1(it("detectMotionCtrlSVDPreset returns static for empty")(shouldEqual6(Lattice_Services_Export_CameraExport_Formats_MotionCtrl.detectMotionCtrlSVDPreset([  ]))(Lattice_Services_Export_CameraExport_Types.SVDStatic.value)))(function () {
                return discard1(it("detectMotionCtrlSVDPreset returns static for single")(shouldEqual6(Lattice_Services_Export_CameraExport_Formats_MotionCtrl.detectMotionCtrlSVDPreset([ mkKeyframe(0) ]))(Lattice_Services_Export_CameraExport_Types.SVDStatic.value)))(function () {
                    return discard1(it("detectMotionCtrlSVDPreset detects zoom in")((function () {
                        var kfs = [ mkKeyframeWithPos(0)({
                            x: 0.0,
                            y: 0.0,
                            z: -500.0
                        }), mkKeyframeWithPos(10)({
                            x: 0.0,
                            y: 0.0,
                            z: -400.0
                        }) ];
                        return shouldEqual6(Lattice_Services_Export_CameraExport_Formats_MotionCtrl.detectMotionCtrlSVDPreset(kfs))(Lattice_Services_Export_CameraExport_Types.SVDZoomIn.value);
                    })()))(function () {
                        return it("detectMotionCtrlSVDPreset detects zoom out")((function () {
                            var kfs = [ mkKeyframeWithPos(0)({
                                x: 0.0,
                                y: 0.0,
                                z: -500.0
                            }), mkKeyframeWithPos(10)({
                                x: 0.0,
                                y: 0.0,
                                z: -600.0
                            }) ];
                            return shouldEqual6(Lattice_Services_Export_CameraExport_Formats_MotionCtrl.detectMotionCtrlSVDPreset(kfs))(Lattice_Services_Export_CameraExport_Types.SVDZoomOut.value);
                        })());
                    });
                });
            });
        });
    });
}));
var interpolationTests = /* #__PURE__ */ describe("camera interpolation")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("returns camera defaults with no keyframes")(/* #__PURE__ */ (function () {
    var result = Lattice_Services_Export_CameraExport_Formats_Common.interpolateCameraAtFrame(mkCamera)([  ])(5);
    return discard2(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(mkCamera.position.x)(result.position.x))(function () {
        return Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(mkCamera.position.z)(result.position.z);
    });
})()))(function () {
    return discard1(it("returns keyframe values at keyframe frame")((function () {
        var kf = mkKeyframeWithPos(5)({
            x: 100.0,
            y: 0.0,
            z: -500.0
        });
        var result = Lattice_Services_Export_CameraExport_Formats_Common.interpolateCameraAtFrame(mkCamera)([ kf ])(5);
        return Test_Lattice_TestHelpers.assertCloseTo(1.0e-5)(100.0)(result.position.x);
    })()))(function () {
        return discard1(it("interpolates position between two keyframes")((function () {
            var kf1 = mkKeyframeWithPos(0)({
                x: 0.0,
                y: 0.0,
                z: -500.0
            });
            var kf2 = mkKeyframeWithPos(10)({
                x: 100.0,
                y: 0.0,
                z: -500.0
            });
            var result = Lattice_Services_Export_CameraExport_Formats_Common.interpolateCameraAtFrame(mkCamera)([ kf1, kf2 ])(5);
            return Test_Lattice_TestHelpers.assertCloseTo(1.0)(50.0)(result.position.x);
        })()))(function () {
            return discard1(it("clamps before first keyframe")((function () {
                var kf = mkKeyframeWithPos(5)({
                    x: 100.0,
                    y: 0.0,
                    z: -500.0
                });
                var result = Lattice_Services_Export_CameraExport_Formats_Common.interpolateCameraAtFrame(mkCamera)([ kf ])(0);
                return Test_Lattice_TestHelpers.assertCloseTo(1.0e-5)(100.0)(result.position.x);
            })()))(function () {
                return discard1(it("clamps after last keyframe")((function () {
                    var kf = mkKeyframeWithPos(5)({
                        x: 100.0,
                        y: 0.0,
                        z: -500.0
                    });
                    var result = Lattice_Services_Export_CameraExport_Formats_Common.interpolateCameraAtFrame(mkCamera)([ kf ])(10);
                    return Test_Lattice_TestHelpers.assertCloseTo(1.0e-5)(100.0)(result.position.x);
                })()))(function () {
                    return it("uses camera default for missing keyframe fields")((function () {
                        var kf = mkKeyframe(5);
                        var result = Lattice_Services_Export_CameraExport_Formats_Common.interpolateCameraAtFrame(mkCamera)([ kf ])(5);
                        return Test_Lattice_TestHelpers.assertCloseTo(1.0e-5)(mkCamera.position.x)(result.position.x);
                    })());
                });
            });
        });
    });
}));
var interpolationMathTests = /* #__PURE__ */ describe("interpolation math")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("lerp at t=0 returns start")(/* #__PURE__ */ Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(10.0)(/* #__PURE__ */ Lattice_Services_Export_CameraExport_Interpolation.lerp(10.0)(20.0)(0.0))))(function () {
    return discard1(it("lerp at t=1 returns end")(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(20.0)(Lattice_Services_Export_CameraExport_Interpolation.lerp(10.0)(20.0)(1.0))))(function () {
        return discard1(it("lerp at t=0.5 returns midpoint")(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(15.0)(Lattice_Services_Export_CameraExport_Interpolation.lerp(10.0)(20.0)(0.5))))(function () {
            return discard1(it("normalizeAngle wraps negative to [0,360)")((function () {
                var a = Lattice_Services_Export_CameraExport_Interpolation.normalizeAngle(-10.0);
                return discard2(shouldEqual1(a >= 0.0 && a < 360.0)(true))(function () {
                    return Test_Lattice_TestHelpers.assertCloseTo(1.0e-5)(350.0)(a);
                });
            })()))(function () {
                return discard1(it("normalizeAngle wraps >360 to [0,360)")((function () {
                    var a = Lattice_Services_Export_CameraExport_Interpolation.normalizeAngle(370.0);
                    return Test_Lattice_TestHelpers.assertCloseTo(1.0e-5)(10.0)(a);
                })()))(function () {
                    return discard1(it("lerpAngle takes shortest path across 360 boundary")((function () {
                        var a = Lattice_Services_Export_CameraExport_Interpolation.lerpAngle(350.0)(10.0)(0.5);
                        return Test_Lattice_TestHelpers.assertCloseTo(5.0)(0.0)(a);
                    })()))(function () {
                        return discard1(it("degreesToRadians converts correctly")(discard2(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(Data_Number.pi)(Lattice_Services_Export_CameraExport_Matrix.degreesToRadians(180.0)))(function () {
                            return Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(Data_Number.pi / 2.0)(Lattice_Services_Export_CameraExport_Matrix.degreesToRadians(90.0));
                        })))(function () {
                            return discard1(it("focalLengthToFOV returns valid FOV")((function () {
                                var fov = Lattice_Services_Export_CameraExport_Matrix.focalLengthToFOV(50.0)(36.0);
                                return shouldEqual1(fov > 0.0 && fov < Data_Number.pi)(true);
                            })()))(function () {
                                return it("focalLengthToFOV guards against invalid focal")((function () {
                                    var fov = Lattice_Services_Export_CameraExport_Matrix.focalLengthToFOV(0.0)(36.0);
                                    return shouldEqual1(fov > 0.0 && fov < Data_Number.pi)(true);
                                })());
                            });
                        });
                    });
                });
            });
        });
    });
}));
var allOfImpl = function ($copy_f) {
    return function ($copy_arr) {
        return function ($copy_i) {
            var $tco_var_f = $copy_f;
            var $tco_var_arr = $copy_arr;
            var $tco_done = false;
            var $tco_result;
            function $tco_loop(f, arr, i) {
                var $55 = i >= Data_Array.length(arr);
                if ($55) {
                    $tco_done = true;
                    return true;
                };
                var v = Data_Array.index(arr)(i);
                if (v instanceof Data_Maybe.Nothing) {
                    $tco_done = true;
                    return true;
                };
                if (v instanceof Data_Maybe.Just) {
                    var $57 = f(v.value0);
                    if ($57) {
                        $tco_var_f = f;
                        $tco_var_arr = arr;
                        $copy_i = i + 1 | 0;
                        return;
                    };
                    $tco_done = true;
                    return false;
                };
                throw new Error("Failed pattern match at Test.Lattice.Export.CameraFormats (line 446, column 8 - line 448, column 61): " + [ v.constructor.name ]);
            };
            while (!$tco_done) {
                $tco_result = $tco_loop($tco_var_f, $tco_var_arr, $copy_i);
            };
            return $tco_result;
        };
    };
};
var allOf = function (f) {
    return function (arr) {
        var v = Data_Array.index(arr)(0);
        if (v instanceof Data_Maybe.Nothing) {
            return true;
        };
        if (v instanceof Data_Maybe.Just) {
            return allOfImpl(f)(arr)(0);
        };
        throw new Error("Failed pattern match at Test.Lattice.Export.CameraFormats (line 439, column 15 - line 441, column 30): " + [ v.constructor.name ]);
    };
};
var allFinite = function (arr) {
    return allOf(Data_Number["isFinite"])(arr);
};
var checkAllFinite = function (m) {
    var checkRow = function (row) {
        if (row.length === 0) {
            return true;
        };
        return allFinite(row);
    };
    return allOf(checkRow)(m);
};
var matrixTests = /* #__PURE__ */ describe("matrix computation")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("view matrix is 4x4")(/* #__PURE__ */ (function () {
    var m = Lattice_Services_Export_CameraExport_Matrix.computeViewMatrix(Lattice_Services_Export_CameraExport_Types.defaultInterpolatedCamera);
    return discard2(shouldEqual5(Data_Array.length(m))(4))(function () {
        var v = Data_Array.index(m)(0);
        if (v instanceof Data_Maybe.Just) {
            return shouldEqual5(Data_Array.length(v.value0))(4);
        };
        if (v instanceof Data_Maybe.Nothing) {
            return fail("Expected 4x4 matrix");
        };
        throw new Error("Failed pattern match at Test.Lattice.Export.CameraFormats (line 214, column 7 - line 216, column 46): " + [ v.constructor.name ]);
    });
})()))(function () {
    return discard1(it("view matrix at identity produces identity-like result")((function () {
        var m = Lattice_Services_Export_CameraExport_Matrix.computeViewMatrix(Lattice_Services_Export_CameraExport_Types.defaultInterpolatedCamera);
        var v = Data_Array.index(m)(3);
        if (v instanceof Data_Maybe.Just) {
            return discard2(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(0.0)(unsafeIndex(v.value0)(0)))(function () {
                return discard2(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(0.0)(unsafeIndex(v.value0)(1)))(function () {
                    return discard2(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(0.0)(unsafeIndex(v.value0)(2)))(function () {
                        return Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(1.0)(unsafeIndex(v.value0)(3));
                    });
                });
            });
        };
        if (v instanceof Data_Maybe.Nothing) {
            return fail("Expected row 3");
        };
        throw new Error("Failed pattern match at Test.Lattice.Export.CameraFormats (line 222, column 7 - line 228, column 41): " + [ v.constructor.name ]);
    })()))(function () {
        return discard1(it("projection matrix is 4x4")((function () {
            var m = Lattice_Services_Export_CameraExport_Matrix.computeProjectionMatrix(Lattice_Services_Export_CameraExport_Types.defaultInterpolatedCamera)(1.777)(0.1)(1000.0);
            return discard2(shouldEqual5(Data_Array.length(m))(4))(function () {
                var v = Data_Array.index(m)(0);
                if (v instanceof Data_Maybe.Just) {
                    return shouldEqual5(Data_Array.length(v.value0))(4);
                };
                if (v instanceof Data_Maybe.Nothing) {
                    return fail("Expected 4x4 matrix");
                };
                throw new Error("Failed pattern match at Test.Lattice.Export.CameraFormats (line 233, column 7 - line 235, column 46): " + [ v.constructor.name ]);
            });
        })()))(function () {
            return discard1(it("projection matrix has finite values")((function () {
                var m = Lattice_Services_Export_CameraExport_Matrix.computeProjectionMatrix(Lattice_Services_Export_CameraExport_Types.defaultInterpolatedCamera)(1.777)(0.1)(1000.0);
                var allFinite1 = checkAllFinite(m);
                return shouldEqual1(allFinite1)(true);
            })()))(function () {
                return discard1(it("view matrix with rotation has finite values")((function () {
                    var cam = {
                        focalLength: Lattice_Services_Export_CameraExport_Types.defaultInterpolatedCamera.focalLength,
                        focusDistance: Lattice_Services_Export_CameraExport_Types.defaultInterpolatedCamera.focusDistance,
                        position: Lattice_Services_Export_CameraExport_Types.defaultInterpolatedCamera.position,
                        zoom: Lattice_Services_Export_CameraExport_Types.defaultInterpolatedCamera.zoom,
                        rotation: {
                            x: 30.0,
                            y: 45.0,
                            z: 0.0
                        }
                    };
                    var m = Lattice_Services_Export_CameraExport_Matrix.computeViewMatrix(cam);
                    var allFinite1 = checkAllFinite(m);
                    return shouldEqual1(allFinite1)(true);
                })()))(function () {
                    return it("view matrix with translation differs from identity")((function () {
                        var cam = {
                            focalLength: Lattice_Services_Export_CameraExport_Types.defaultInterpolatedCamera.focalLength,
                            focusDistance: Lattice_Services_Export_CameraExport_Types.defaultInterpolatedCamera.focusDistance,
                            rotation: Lattice_Services_Export_CameraExport_Types.defaultInterpolatedCamera.rotation,
                            zoom: Lattice_Services_Export_CameraExport_Types.defaultInterpolatedCamera.zoom,
                            position: {
                                x: 100.0,
                                y: 50.0,
                                z: -500.0
                            }
                        };
                        var m = Lattice_Services_Export_CameraExport_Matrix.computeViewMatrix(cam);
                        var tx = unsafeIndex2(m)(0)(3);
                        var ty = unsafeIndex2(m)(1)(3);
                        return shouldEqual1(Data_Number.abs(tx) > 1.0e-2 || Data_Number.abs(ty) > 1.0e-2)(true);
                    })());
                });
            });
        });
    });
}));
var adversarialTests = /* #__PURE__ */ describe("adversarial edge cases")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("keyframes at same frame does not crash")(/* #__PURE__ */ (function () {
    var kfs = [ mkKeyframeWithPos(5)({
        x: 0.0,
        y: 0.0,
        z: -500.0
    }), mkKeyframeWithPos(5)({
        x: 100.0,
        y: 0.0,
        z: -500.0
    }) ];
    var result = Lattice_Services_Export_CameraExport_Formats_Common.interpolateCameraAtFrame(mkCamera)(kfs)(5);
    return shouldEqual1(Data_Number["isFinite"](result.position.x))(true);
})()))(function () {
    return discard1(it("projection with zero aspect uses fallback")((function () {
        var m = Lattice_Services_Export_CameraExport_Matrix.computeProjectionMatrix(Lattice_Services_Export_CameraExport_Types.defaultInterpolatedCamera)(0.0)(0.1)(1000.0);
        var allFinite1 = checkAllFinite(m);
        return shouldEqual1(allFinite1)(true);
    })()))(function () {
        return it("view matrix guards against extreme positions")((function () {
            var cam = {
                focalLength: Lattice_Services_Export_CameraExport_Types.defaultInterpolatedCamera.focalLength,
                focusDistance: Lattice_Services_Export_CameraExport_Types.defaultInterpolatedCamera.focusDistance,
                rotation: Lattice_Services_Export_CameraExport_Types.defaultInterpolatedCamera.rotation,
                zoom: Lattice_Services_Export_CameraExport_Types.defaultInterpolatedCamera.zoom,
                position: {
                    x: 1.0e10,
                    y: 1.0e10,
                    z: 1.0e10
                }
            };
            var m = Lattice_Services_Export_CameraExport_Matrix.computeViewMatrix(cam);
            var allFinite1 = checkAllFinite(m);
            return shouldEqual1(allFinite1)(true);
        })());
    });
}));
var spec = /* #__PURE__ */ describe("CameraFormats")(/* #__PURE__ */ discard1(interpolationMathTests)(function () {
    return discard1(interpolationTests)(function () {
        return discard1(matrixTests)(function () {
            return discard1(motionAnalysisTests)(function () {
                return discard1(motionCtrlTests)(function () {
                    return discard1(wan22Tests)(function () {
                        return adversarialTests;
                    });
                });
            });
        });
    });
}));
export {
    spec
};
//# sourceMappingURL=index.js.map
