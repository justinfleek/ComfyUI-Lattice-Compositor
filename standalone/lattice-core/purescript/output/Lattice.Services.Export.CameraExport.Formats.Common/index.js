// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
var min = function (a) {
    return function (b) {
        var $11 = a < b;
        if ($11) {
            return a;
        };
        return b;
    };
};
var lerp = function (a) {
    return function (b) {
        return function (t) {
            return a + (b - a) * t;
        };
    };
};
var lerpVec3 = function (a) {
    return function (b) {
        return function (t) {
            return {
                x: lerp(a.x)(b.x)(t),
                y: lerp(a.y)(b.y)(t),
                z: lerp(a.z)(b.z)(t)
            };
        };
    };
};
var keyframeToInterpolated = function (cam) {
    return function (kf) {
        return {
            position: Data_Maybe.fromMaybe(cam.position)(kf.position),
            rotation: Data_Maybe.fromMaybe(cam.orientation)(kf.orientation),
            focalLength: Data_Maybe.fromMaybe(cam.focalLength)(kf.focalLength),
            zoom: Data_Maybe.fromMaybe(cam.zoom)(kf.zoom),
            focusDistance: Data_Maybe.fromMaybe(cam.focusDistance)(kf.focusDistance)
        };
    };
};
var interpolateBetween = function (cam) {
    return function (prev) {
        return function (next) {
            return function (frame) {
                var t = (function () {
                    var $12 = prev.frame === next.frame;
                    if ($12) {
                        return 0.0;
                    };
                    return Data_Int.toNumber(frame - prev.frame | 0) / Data_Int.toNumber(next.frame - prev.frame | 0);
                })();
                var prevPos = Data_Maybe.fromMaybe(cam.position)(prev.position);
                var prevOri = Data_Maybe.fromMaybe(cam.orientation)(prev.orientation);
                var nextPos = Data_Maybe.fromMaybe(cam.position)(next.position);
                var nextOri = Data_Maybe.fromMaybe(cam.orientation)(next.orientation);
                return {
                    position: lerpVec3(prevPos)(nextPos)(t),
                    rotation: lerpVec3(prevOri)(nextOri)(t),
                    focalLength: lerp(Data_Maybe.fromMaybe(cam.focalLength)(prev.focalLength))(Data_Maybe.fromMaybe(cam.focalLength)(next.focalLength))(t),
                    zoom: lerp(Data_Maybe.fromMaybe(cam.zoom)(prev.zoom))(Data_Maybe.fromMaybe(cam.zoom)(next.zoom))(t),
                    focusDistance: lerp(Data_Maybe.fromMaybe(cam.focusDistance)(prev.focusDistance))(Data_Maybe.fromMaybe(cam.focusDistance)(next.focusDistance))(t)
                };
            };
        };
    };
};
var floor = Data_Int.floor;
var round = function (n) {
    return floor(n + 0.5);
};
var findSurrounding = function (keyframes) {
    return function (frame) {
        return Data_Array.foldl(function (acc) {
            return function (kf) {
                return {
                    prev: (function () {
                        var $13 = kf.frame <= frame;
                        if ($13) {
                            return new Data_Maybe.Just(kf);
                        };
                        return acc.prev;
                    })(),
                    next: (function () {
                        if (acc.next instanceof Data_Maybe.Nothing) {
                            var $15 = kf.frame >= frame;
                            if ($15) {
                                return new Data_Maybe.Just(kf);
                            };
                            return Data_Maybe.Nothing.value;
                        };
                        if (acc.next instanceof Data_Maybe.Just) {
                            var $16 = kf.frame >= frame && kf.frame < acc.next.value0.frame;
                            if ($16) {
                                return new Data_Maybe.Just(kf);
                            };
                            return acc.next;
                        };
                        throw new Error("Failed pattern match at Lattice.Services.Export.CameraExport.Formats.Common (line 81, column 15 - line 83, column 104): " + [ acc.next.constructor.name ]);
                    })()
                };
            };
        })({
            prev: Data_Maybe.Nothing.value,
            next: Data_Maybe.Nothing.value
        })(keyframes);
    };
};
var interpolateCameraAtFrame = function (camera) {
    return function (keyframes) {
        return function (frame) {
            var v = findSurrounding(keyframes)(frame);
            if (v.prev instanceof Data_Maybe.Nothing && v.next instanceof Data_Maybe.Nothing) {
                return {
                    position: camera.position,
                    rotation: camera.orientation,
                    focalLength: camera.focalLength,
                    zoom: camera.zoom,
                    focusDistance: camera.focusDistance
                };
            };
            if (v.prev instanceof Data_Maybe.Just && v.next instanceof Data_Maybe.Nothing) {
                return keyframeToInterpolated(camera)(v.prev.value0);
            };
            if (v.prev instanceof Data_Maybe.Nothing && v.next instanceof Data_Maybe.Just) {
                return keyframeToInterpolated(camera)(v.next.value0);
            };
            if (v.prev instanceof Data_Maybe.Just && v.next instanceof Data_Maybe.Just) {
                return interpolateBetween(camera)(v.prev.value0)(v.next.value0)(frame);
            };
            throw new Error("Failed pattern match at Lattice.Services.Export.CameraExport.Formats.Common (line 61, column 3 - line 74, column 42): " + [ v.constructor.name ]);
        };
    };
};
export {
    interpolateCameraAtFrame,
    min,
    round,
    floor
};
//# sourceMappingURL=index.js.map
