// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Identity from "../Data.Identity/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_String_CodePoints from "../Data.String.CodePoints/index.js";
import * as Data_String_CodeUnits from "../Data.String.CodeUnits/index.js";
import * as Data_String_Common from "../Data.String.Common/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Effect_Aff from "../Effect.Aff/index.js";
import * as Lattice_Services_Security_JsonSanitizer from "../Lattice.Services.Security.JsonSanitizer/index.js";
import * as Lattice_Services_Security_UrlValidator from "../Lattice.Services.Security.UrlValidator/index.js";
import * as Test_Spec from "../Test.Spec/index.js";
import * as Test_Spec_Assertions from "../Test.Spec.Assertions/index.js";
var describe = /* #__PURE__ */ Test_Spec.describe(Data_Identity.monadIdentity);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit);
var discard1 = /* #__PURE__ */ discard(/* #__PURE__ */ Test_Spec.bindSpecT(Data_Identity.bindIdentity));
var it = /* #__PURE__ */ Test_Spec.it(Data_Identity.monadIdentity)(Test_Spec.exampleMUnit);
var discard2 = /* #__PURE__ */ discard(Effect_Aff.bindAff);
var shouldEqual = /* #__PURE__ */ Test_Spec_Assertions.shouldEqual(Effect_Aff.monadThrowAff);
var shouldEqual1 = /* #__PURE__ */ shouldEqual(Data_Show.showBoolean)(Data_Eq.eqBoolean);
var pure = /* #__PURE__ */ Control_Applicative.pure(Effect_Aff.applicativeAff);
var fail = /* #__PURE__ */ Test_Spec_Assertions.fail(Effect_Aff.monadThrowAff);
var shouldEqual2 = /* #__PURE__ */ shouldEqual(Data_Show.showInt)(Data_Eq.eqInt);
var foldl = /* #__PURE__ */ Data_Foldable.foldl(Data_Foldable.foldableArray);
var validFrameRange = function (startFrame) {
    return function (endFrame) {
        return startFrame >= 0 && endFrame > startFrame;
    };
};
var validFrameCount = function (n) {
    return n > 0 && n <= 10000;
};
var validDimension = function (n) {
    return n > 0 && n <= 8192;
};
var urlInjectionDefenseTests = /* #__PURE__ */ describe("URL Injection Defense")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("should block javascript: URLs in export paths")(/* #__PURE__ */ (function () {
    var result = Lattice_Services_Security_UrlValidator.validateURL("javascript:alert(1)")(Lattice_Services_Security_UrlValidator.CtxAsset.value);
    return discard2(shouldEqual1(result.valid)(false))(function () {
        if (result.error instanceof Data_Maybe.Just) {
            var $29 = Data_String_CodeUnits.contains("javascript:")(result.error.value0);
            if ($29) {
                return pure(Data_Unit.unit);
            };
            return fail("Expected error mentioning 'javascript:', got: " + result.error.value0);
        };
        if (result.error instanceof Data_Maybe.Nothing) {
            return fail("Expected error about javascript: protocol");
        };
        throw new Error("Failed pattern match at Test.Lattice.Security.AttackSurface (line 236, column 7 - line 241, column 68): " + [ result.error.constructor.name ]);
    });
})()))(function () {
    return it("should block data: URLs with HTML content")((function () {
        var result = Lattice_Services_Security_UrlValidator.validateURL("data:text/html,<script>alert(1)</script>")(Lattice_Services_Security_UrlValidator.CtxAsset.value);
        return discard2(shouldEqual1(result.valid)(false))(function () {
            if (result.error instanceof Data_Maybe.Just) {
                var $32 = Data_String_CodeUnits.contains("blocked")(result.error.value0);
                if ($32) {
                    return pure(Data_Unit.unit);
                };
                return fail("Expected error mentioning 'blocked', got: " + result.error.value0);
            };
            if (result.error instanceof Data_Maybe.Nothing) {
                return fail("Expected error about blocked data URL");
            };
            throw new Error("Failed pattern match at Test.Lattice.Security.AttackSurface (line 246, column 7 - line 251, column 64): " + [ result.error.constructor.name ]);
        });
    })());
}));
var prototypePollutionDefenseTests = /* #__PURE__ */ describe("Prototype Pollution Defense")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("should strip __proto__ from parsed JSON")(/* #__PURE__ */ (function () {
    var result = Lattice_Services_Security_JsonSanitizer.parseAndSanitize("{\"__proto__\": {\"isAdmin\": true}, \"name\": \"safe\"}")(Lattice_Services_Security_JsonSanitizer.defaultOptions);
    return discard2(shouldEqual1(result.valid)(true))(function () {
        return shouldEqual2(result.stats.prototypeKeysRemoved)(1);
    });
})()))(function () {
    return discard1(it("should strip constructor from parsed JSON")((function () {
        var result = Lattice_Services_Security_JsonSanitizer.parseAndSanitize("{\"constructor\": {\"prototype\": {\"evil\": true}}}")(Lattice_Services_Security_JsonSanitizer.defaultOptions);
        return discard2(shouldEqual1(result.valid)(true))(function () {
            return shouldEqual2(result.stats.prototypeKeysRemoved)(1);
        });
    })()))(function () {
        return it("should strip __defineGetter__ from parsed JSON")((function () {
            var result = Lattice_Services_Security_JsonSanitizer.parseAndSanitize("{\"__defineGetter__\": \"evil\", \"safe\": 1}")(Lattice_Services_Security_JsonSanitizer.defaultOptions);
            return discard2(shouldEqual1(result.valid)(true))(function () {
                return shouldEqual2(result.stats.prototypeKeysRemoved)(1);
            });
        })());
    });
}));
var inputValidationDefenseTests = /* #__PURE__ */ describe("Input Validation Defense")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("should validate numeric bounds for export dimensions")(/* #__PURE__ */ discard2(/* #__PURE__ */ shouldEqual1(/* #__PURE__ */ validDimension(1920))(true))(function () {
    return discard2(shouldEqual1(validDimension(8192))(true))(function () {
        return discard2(shouldEqual1(validDimension(0))(false))(function () {
            return discard2(shouldEqual1(validDimension(-1 | 0))(false))(function () {
                return discard2(shouldEqual1(validDimension(8193))(false))(function () {
                    return discard2(shouldEqual1(validFrameCount(1))(true))(function () {
                        return discard2(shouldEqual1(validFrameCount(10000))(true))(function () {
                            return discard2(shouldEqual1(validFrameCount(0))(false))(function () {
                                return shouldEqual1(validFrameCount(10001))(false);
                            });
                        });
                    });
                });
            });
        });
    });
})))(function () {
    return discard1(it("should reject negative frame ranges")(discard2(shouldEqual1(validFrameRange(0)(100))(true))(function () {
        return discard2(shouldEqual1(validFrameRange(10)(20))(true))(function () {
            return discard2(shouldEqual1(validFrameRange(-1 | 0)(10))(false))(function () {
                return discard2(shouldEqual1(validFrameRange(10)(10))(false))(function () {
                    return shouldEqual1(validFrameRange(20)(10))(false);
                });
            });
        });
    })))(function () {
        return it("should reject non-finite numbers")((function () {
            var nan = 0.0 / 0.0;
            var posInf = 1.0 / 0.0;
            var negInf = -1.0 / 0.0;
            return discard2(shouldEqual1(Data_Number["isFinite"](nan))(false))(function () {
                return discard2(shouldEqual1(Data_Number["isFinite"](posInf))(false))(function () {
                    return discard2(shouldEqual1(Data_Number["isFinite"](negInf))(false))(function () {
                        return discard2(shouldEqual1(Data_Number["isFinite"](42.0))(true))(function () {
                            return discard2(shouldEqual1(Data_Number["isFinite"](0.0))(true))(function () {
                                return shouldEqual1(Data_Number["isFinite"](-3.14))(true);
                            });
                        });
                    });
                });
            });
        })());
    });
}));
var hasPathTraversal = function (path) {
    return Data_String_CodeUnits.contains("..")(path) || Data_String_CodePoints.take(1)(path) === "/";
};
var hasEncodedTraversal = function (path) {
    return Data_String_CodeUnits.contains("%2e")(path) || Data_String_CodeUnits.contains("%2E")(path);
};
var pathTraversalDefenseTests = /* #__PURE__ */ describe("Path Traversal Defense")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("should detect path traversal patterns")(/* #__PURE__ */ discard2(/* #__PURE__ */ shouldEqual1(/* #__PURE__ */ hasPathTraversal("../../../etc/passwd"))(true))(function () {
    return discard2(shouldEqual1(hasPathTraversal("..\\..\\Windows"))(true))(function () {
        return discard2(shouldEqual1(hasPathTraversal("/etc/passwd"))(true))(function () {
            return shouldEqual1(hasPathTraversal("images/photo.png"))(false);
        });
    });
})))(function () {
    return it("should detect URL-encoded traversal")(discard2(shouldEqual1(hasEncodedTraversal("%2e%2e%2fetc%2fpasswd"))(true))(function () {
        return discard2(shouldEqual1(hasEncodedTraversal("%2E%2E%2Fetc%2Fpasswd"))(true))(function () {
            return shouldEqual1(hasEncodedTraversal("images/photo.png"))(false);
        });
    }));
}));
var buildNestedJson = function (depth) {
    var suffix = foldl(function (acc) {
        return function (v) {
            return acc + "}";
        };
    })("")(Data_Array.replicate(depth)(Data_Unit.unit));
    var prefix = foldl(function (acc) {
        return function (v) {
            return acc + "{\"nested\": ";
        };
    })("")(Data_Array.replicate(depth)(Data_Unit.unit));
    return prefix + ("{\"value\": 1}" + suffix);
};
var buildArrayJson = function (n) {
    var elements = Data_String_Common.joinWith(", ")(Data_Array.replicate(n)("1"));
    return "[" + (elements + "]");
};
var jsonBombDefenseTests = /* #__PURE__ */ describe("JSON Bomb Defense")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("should reject deeply nested JSON (JSON bomb)")(/* #__PURE__ */ (function () {
    var json = buildNestedJson(60);
    var result = Lattice_Services_Security_JsonSanitizer.parseAndSanitize(json)(Lattice_Services_Security_JsonSanitizer.defaultOptions);
    return discard2(shouldEqual1(result.valid)(false))(function () {
        if (result.err instanceof Data_Maybe.Just) {
            var $35 = Data_String_CodeUnits.contains("depth")(result.err.value0);
            if ($35) {
                return pure(Data_Unit.unit);
            };
            return fail("Expected error about depth, got: " + result.err.value0);
        };
        if (result.err instanceof Data_Maybe.Nothing) {
            return fail("Expected error about depth but got no error");
        };
        throw new Error("Failed pattern match at Test.Lattice.Security.AttackSurface (line 107, column 7 - line 112, column 70): " + [ result.err.constructor.name ]);
    });
})()))(function () {
    return discard1(it("should reject large array JSON")((function () {
        var opts = {
            maxDepth: Lattice_Services_Security_JsonSanitizer.defaultOptions.maxDepth,
            maxKeyLength: Lattice_Services_Security_JsonSanitizer.defaultOptions.maxKeyLength,
            maxStringLength: Lattice_Services_Security_JsonSanitizer.defaultOptions.maxStringLength,
            maxTotalKeys: Lattice_Services_Security_JsonSanitizer.defaultOptions.maxTotalKeys,
            removeNullBytes: Lattice_Services_Security_JsonSanitizer.defaultOptions.removeNullBytes,
            removePrototypeKeys: Lattice_Services_Security_JsonSanitizer.defaultOptions.removePrototypeKeys,
            maxArrayLength: 10
        };
        var json = buildArrayJson(20);
        var result = Lattice_Services_Security_JsonSanitizer.parseAndSanitize(json)(opts);
        return discard2(shouldEqual1(result.valid)(false))(function () {
            if (result.err instanceof Data_Maybe.Just) {
                var $38 = Data_String_CodeUnits.contains("Array exceeds")(result.err.value0);
                if ($38) {
                    return pure(Data_Unit.unit);
                };
                return fail("Expected error about array exceeds, got: " + result.err.value0);
            };
            if (result.err instanceof Data_Maybe.Nothing) {
                return fail("Expected error about array exceeds but got no error");
            };
            throw new Error("Failed pattern match at Test.Lattice.Security.AttackSurface (line 120, column 7 - line 125, column 78): " + [ result.err.constructor.name ]);
        });
    })()))(function () {
        return it("should reject __proto__ pollution via sanitizer")((function () {
            var result = Lattice_Services_Security_JsonSanitizer.parseAndSanitize("{\"__proto__\": {\"polluted\": true}, \"safe\": 1}")(Lattice_Services_Security_JsonSanitizer.defaultOptions);
            return discard2(shouldEqual1(result.valid)(true))(function () {
                return shouldEqual2(result.stats.prototypeKeysRemoved)(1);
            });
        })());
    });
}));
var spec = /* #__PURE__ */ describe("Attack Surface - Security Concepts")(/* #__PURE__ */ discard1(jsonBombDefenseTests)(function () {
    return discard1(pathTraversalDefenseTests)(function () {
        return discard1(inputValidationDefenseTests)(function () {
            return discard1(prototypePollutionDefenseTests)(function () {
                return urlInjectionDefenseTests;
            });
        });
    });
}));
export {
    spec
};
//# sourceMappingURL=index.js.map
