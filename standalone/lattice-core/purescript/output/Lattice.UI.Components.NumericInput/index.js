// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Control_Monad_State_Class from "../Control.Monad.State.Class/index.js";
import * as DOM_HTML_Indexed_InputType from "../DOM.HTML.Indexed.InputType/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Halogen_Component from "../Halogen.Component/index.js";
import * as Halogen_HTML_Core from "../Halogen.HTML.Core/index.js";
import * as Halogen_HTML_Elements from "../Halogen.HTML.Elements/index.js";
import * as Halogen_HTML_Events from "../Halogen.HTML.Events/index.js";
import * as Halogen_HTML_Properties from "../Halogen.HTML.Properties/index.js";
import * as Halogen_Query_HalogenM from "../Halogen.Query.HalogenM/index.js";
import * as Lattice_UI_Core from "../Lattice.UI.Core/index.js";
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var type_ = /* #__PURE__ */ Halogen_HTML_Properties.type_(Halogen_HTML_Core.isPropInputType);
var value = /* #__PURE__ */ Halogen_HTML_Properties.value(Halogen_HTML_Core.isPropString);
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordNumber);
var min = /* #__PURE__ */ Data_Ord.min(Data_Ord.ordNumber);
var pure = /* #__PURE__ */ Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM);
var modify_ = /* #__PURE__ */ Control_Monad_State_Class.modify_(Halogen_Query_HalogenM.monadStateHalogenM);
var bind = /* #__PURE__ */ Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM);
var get = /* #__PURE__ */ Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM);
var when = /* #__PURE__ */ Control_Applicative.when(Halogen_Query_HalogenM.applicativeHalogenM);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM);
var ValueChanged = /* #__PURE__ */ (function () {
    function ValueChanged(value0) {
        this.value0 = value0;
    };
    ValueChanged.create = function (value0) {
        return new ValueChanged(value0);
    };
    return ValueChanged;
})();
var Initialize = /* #__PURE__ */ (function () {
    function Initialize() {

    };
    Initialize.value = new Initialize();
    return Initialize;
})();
var Receive = /* #__PURE__ */ (function () {
    function Receive(value0) {
        this.value0 = value0;
    };
    Receive.create = function (value0) {
        return new Receive(value0);
    };
    return Receive;
})();
var StartDrag = /* #__PURE__ */ (function () {
    function StartDrag(value0) {
        this.value0 = value0;
    };
    StartDrag.create = function (value0) {
        return new StartDrag(value0);
    };
    return StartDrag;
})();
var Drag = /* #__PURE__ */ (function () {
    function Drag(value0) {
        this.value0 = value0;
    };
    Drag.create = function (value0) {
        return new Drag(value0);
    };
    return Drag;
})();
var EndDrag = /* #__PURE__ */ (function () {
    function EndDrag() {

    };
    EndDrag.value = new EndDrag();
    return EndDrag;
})();
var StartEdit = /* #__PURE__ */ (function () {
    function StartEdit() {

    };
    StartEdit.value = new StartEdit();
    return StartEdit;
})();
var UpdateEditValue = /* #__PURE__ */ (function () {
    function UpdateEditValue(value0) {
        this.value0 = value0;
    };
    UpdateEditValue.create = function (value0) {
        return new UpdateEditValue(value0);
    };
    return UpdateEditValue;
})();
var CommitEdit = /* #__PURE__ */ (function () {
    function CommitEdit() {

    };
    CommitEdit.value = new CommitEdit();
    return CommitEdit;
})();
var CancelEdit = /* #__PURE__ */ (function () {
    function CancelEdit() {

    };
    CancelEdit.value = new CancelEdit();
    return CancelEdit;
})();
var Increment = /* #__PURE__ */ (function () {
    function Increment() {

    };
    Increment.value = new Increment();
    return Increment;
})();
var Decrement = /* #__PURE__ */ (function () {
    function Decrement() {

    };
    Decrement.value = new Decrement();
    return Decrement;
})();
var valueStyle = /* #__PURE__ */ (function () {
    return "font-family: var(--lattice-font-mono); font-size: var(--lattice-text-sm); " + "color: var(--lattice-text-primary);";
})();
var labelStyle = /* #__PURE__ */ (function () {
    return "color: var(--lattice-text-secondary); font-size: var(--lattice-text-xs); " + "min-width: 24px; text-transform: uppercase;";
})();
var initialState = function (input) {
    return {
        value: input.value,
        label: input.label,
        min: input.min,
        max: input.max,
        step: input.step,
        precision: input.precision,
        suffix: input.suffix,
        isDragging: false,
        isEditing: false,
        editValue: "",
        dragStartX: 0.0,
        dragStartValue: 0.0
    };
};
var formatValue = function (value1) {
    return function (precision) {
        var pow = function (base) {
            return function (exp) {
                var $38 = exp <= 0;
                if ($38) {
                    return 1;
                };
                return base * pow(base)(exp - 1 | 0) | 0;
            };
        };
        var multiplier = Data_Int.toNumber(pow(10)(precision));
        var rounded = Data_Int.toNumber(Data_Int.round(value1 * multiplier)) / multiplier;
        return show(rounded);
    };
};
var editStyle = /* #__PURE__ */ (function () {
    return "flex: 1; background: var(--lattice-surface-3); " + ("border: 1px solid var(--lattice-accent); border-radius: var(--lattice-radius-sm); " + ("padding: var(--lattice-space-1) var(--lattice-space-2); " + ("font-family: var(--lattice-font-mono); font-size: var(--lattice-text-sm); " + "color: var(--lattice-text-primary); outline: none;")));
})();
var renderEditMode = function (state) {
    return Halogen_HTML_Elements.input([ Lattice_UI_Core.cls([ "lattice-numeric-edit" ]), Halogen_HTML_Properties.attr("style")(editStyle), type_(DOM_HTML_Indexed_InputType.InputText.value), value(state.editValue), Halogen_HTML_Properties.autofocus(true), Halogen_HTML_Events.onValueInput(UpdateEditValue.create), Halogen_HTML_Events.onBlur(function (v) {
        return CommitEdit.value;
    }) ]);
};
var displayStyle = /* #__PURE__ */ (function () {
    return "flex: 1; display: flex; align-items: center; " + ("background: var(--lattice-surface-2); border-radius: var(--lattice-radius-sm); " + ("padding: var(--lattice-space-1) var(--lattice-space-2); " + "cursor: ew-resize; user-select: none;"));
})();
var renderDisplayMode = function (state) {
    return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-numeric-display" ]), Halogen_HTML_Properties.attr("style")(displayStyle), Halogen_HTML_Events.onDoubleClick(function (v) {
        return StartEdit.value;
    }) ])([ Halogen_HTML_Elements.span([ Lattice_UI_Core.cls([ "lattice-numeric-value" ]), Halogen_HTML_Properties.attr("style")(valueStyle) ])([ Halogen_HTML_Core.text(formatValue(state.value)(state.precision) + state.suffix) ]) ]);
};
var containerStyle = /* #__PURE__ */ (function () {
    return "display: flex; align-items: center; gap: var(--lattice-space-2); " + "min-width: 120px;";
})();
var render = function (state) {
    return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-numeric-input" ]), Halogen_HTML_Properties.attr("style")(containerStyle) ])([ Halogen_HTML_Elements.span([ Lattice_UI_Core.cls([ "lattice-numeric-label" ]), Halogen_HTML_Properties.attr("style")(labelStyle) ])([ Halogen_HTML_Core.text(state.label) ]), (function () {
        if (state.isEditing) {
            return renderEditMode(state);
        };
        return renderDisplayMode(state);
    })() ]);
};
var clampValue = function (state) {
    return function (value1) {
        var minClamped = (function () {
            if (state.min instanceof Data_Maybe.Just) {
                return max(state.min.value0)(value1);
            };
            if (state.min instanceof Data_Maybe.Nothing) {
                return value1;
            };
            throw new Error("Failed pattern match at Lattice.UI.Components.NumericInput (line 209, column 18 - line 211, column 23): " + [ state.min.constructor.name ]);
        })();
        if (state.max instanceof Data_Maybe.Just) {
            return min(state.max.value0)(minClamped);
        };
        if (state.max instanceof Data_Maybe.Nothing) {
            return minClamped;
        };
        throw new Error("Failed pattern match at Lattice.UI.Components.NumericInput (line 213, column 3 - line 215, column 26): " + [ state.max.constructor.name ]);
    };
};
var handleAction = function (dictMonadAff) {
    return function (v) {
        if (v instanceof Initialize) {
            return pure(Data_Unit.unit);
        };
        if (v instanceof Receive) {
            return modify_(function (v1) {
                var $45 = {};
                for (var $46 in v1) {
                    if ({}.hasOwnProperty.call(v1, $46)) {
                        $45[$46] = v1[$46];
                    };
                };
                $45.value = v.value0.value;
                $45.label = v.value0.label;
                $45.min = v.value0.min;
                $45.max = v.value0.max;
                $45.step = v.value0.step;
                $45.precision = v.value0.precision;
                $45.suffix = v.value0.suffix;
                return $45;
            });
        };
        if (v instanceof StartDrag) {
            return bind(get)(function (state) {
                return modify_(function (v1) {
                    var $49 = {};
                    for (var $50 in v1) {
                        if ({}.hasOwnProperty.call(v1, $50)) {
                            $49[$50] = v1[$50];
                        };
                    };
                    $49.isDragging = true;
                    $49.dragStartX = v.value0;
                    $49.dragStartValue = state.value;
                    return $49;
                });
            });
        };
        if (v instanceof Drag) {
            return bind(get)(function (state) {
                return when(state.isDragging)((function () {
                    var delta = (v.value0 - state.dragStartX) * state.step * 0.1;
                    var newValue = clampValue(state)(state.dragStartValue + delta);
                    return discard(modify_(function (v1) {
                        var $53 = {};
                        for (var $54 in v1) {
                            if ({}.hasOwnProperty.call(v1, $54)) {
                                $53[$54] = v1[$54];
                            };
                        };
                        $53.value = newValue;
                        return $53;
                    }))(function () {
                        return Halogen_Query_HalogenM.raise(new ValueChanged(newValue));
                    });
                })());
            });
        };
        if (v instanceof EndDrag) {
            return modify_(function (v1) {
                var $57 = {};
                for (var $58 in v1) {
                    if ({}.hasOwnProperty.call(v1, $58)) {
                        $57[$58] = v1[$58];
                    };
                };
                $57.isDragging = false;
                return $57;
            });
        };
        if (v instanceof StartEdit) {
            return bind(get)(function (state) {
                return modify_(function (v1) {
                    var $60 = {};
                    for (var $61 in v1) {
                        if ({}.hasOwnProperty.call(v1, $61)) {
                            $60[$61] = v1[$61];
                        };
                    };
                    $60.isEditing = true;
                    $60.editValue = formatValue(state.value)(state.precision);
                    return $60;
                });
            });
        };
        if (v instanceof UpdateEditValue) {
            return modify_(function (v1) {
                var $63 = {};
                for (var $64 in v1) {
                    if ({}.hasOwnProperty.call(v1, $64)) {
                        $63[$64] = v1[$64];
                    };
                };
                $63.editValue = v.value0;
                return $63;
            });
        };
        if (v instanceof CommitEdit) {
            return bind(get)(function (state) {
                var parsed = Data_Number.fromString(state.editValue);
                var newValue = clampValue(state)(Data_Maybe.fromMaybe(state.value)(parsed));
                return discard(modify_(function (v1) {
                    var $67 = {};
                    for (var $68 in v1) {
                        if ({}.hasOwnProperty.call(v1, $68)) {
                            $67[$68] = v1[$68];
                        };
                    };
                    $67.isEditing = false;
                    $67.value = newValue;
                    return $67;
                }))(function () {
                    return Halogen_Query_HalogenM.raise(new ValueChanged(newValue));
                });
            });
        };
        if (v instanceof CancelEdit) {
            return modify_(function (v1) {
                var $70 = {};
                for (var $71 in v1) {
                    if ({}.hasOwnProperty.call(v1, $71)) {
                        $70[$71] = v1[$71];
                    };
                };
                $70.isEditing = false;
                return $70;
            });
        };
        if (v instanceof Increment) {
            return bind(get)(function (state) {
                var newValue = clampValue(state)(state.value + state.step);
                return discard(modify_(function (v1) {
                    var $73 = {};
                    for (var $74 in v1) {
                        if ({}.hasOwnProperty.call(v1, $74)) {
                            $73[$74] = v1[$74];
                        };
                    };
                    $73.value = newValue;
                    return $73;
                }))(function () {
                    return Halogen_Query_HalogenM.raise(new ValueChanged(newValue));
                });
            });
        };
        if (v instanceof Decrement) {
            return bind(get)(function (state) {
                var newValue = clampValue(state)(state.value - state.step);
                return discard(modify_(function (v1) {
                    var $76 = {};
                    for (var $77 in v1) {
                        if ({}.hasOwnProperty.call(v1, $77)) {
                            $76[$77] = v1[$77];
                        };
                    };
                    $76.value = newValue;
                    return $76;
                }))(function () {
                    return Halogen_Query_HalogenM.raise(new ValueChanged(newValue));
                });
            });
        };
        throw new Error("Failed pattern match at Lattice.UI.Components.NumericInput (line 222, column 16 - line 287, column 36): " + [ v.constructor.name ]);
    };
};
var component = function (dictMonadAff) {
    return Halogen_Component.mkComponent({
        initialState: initialState,
        render: render,
        "eval": Halogen_Component.mkEval({
            handleQuery: Halogen_Component.defaultEval.handleQuery,
            finalize: Halogen_Component.defaultEval.finalize,
            handleAction: handleAction(dictMonadAff),
            initialize: new Data_Maybe.Just(Initialize.value),
            receive: function ($79) {
                return Data_Maybe.Just.create(Receive.create($79));
            }
        })
    });
};
export {
    component,
    ValueChanged
};
//# sourceMappingURL=index.js.map
