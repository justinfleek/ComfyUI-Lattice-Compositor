// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Lattice_Services_Export_CameraExport_Formats_CameraCtrl from "../Lattice.Services.Export.CameraExport.Formats.CameraCtrl/index.js";
import * as Lattice_Services_Export_CameraExport_Formats_Common from "../Lattice.Services.Export.CameraExport.Formats.Common/index.js";
import * as Lattice_Services_Export_CameraExport_Formats_MotionCtrl from "../Lattice.Services.Export.CameraExport.Formats.MotionCtrl/index.js";
import * as Lattice_Services_Export_CameraExport_Formats_Uni3C from "../Lattice.Services.Export.CameraExport.Formats.Uni3C/index.js";
import * as Lattice_Services_Export_CameraExport_Formats_Wan22 from "../Lattice.Services.Export.CameraExport.Formats.Wan22/index.js";
import * as Lattice_Services_Export_CameraExport_Matrix from "../Lattice.Services.Export.CameraExport.Matrix/index.js";
import * as Lattice_Services_Export_CameraExport_Types from "../Lattice.Services.Export.CameraExport.Types/index.js";
var show = /* #__PURE__ */ Data_Show.show(Lattice_Services_Export_CameraExport_Types.showMotionCtrlSVDPreset);
var show1 = /* #__PURE__ */ Data_Show.show(Lattice_Services_Export_CameraExport_Types.showWan22CameraMotion);
var show2 = /* #__PURE__ */ Data_Show.show(Lattice_Services_Export_CameraExport_Types.showUni3CTrajType);
var show3 = /* #__PURE__ */ Data_Show.show(Lattice_Services_Export_CameraExport_Types.showCameraCtrlMotionType);
var show4 = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var exportCameraMatrices = function (camera) {
    return function (keyframes) {
        return function (options) {
            var metadata = {
                width: options.width,
                height: options.height,
                fps: options.fps,
                totalFrames: options.frameCount,
                cameraType: camera.cameraType,
                filmSize: camera.filmSize
            };
            var aspectRatio = Data_Int.toNumber(options.width) / Data_Int.toNumber(options.height);
            var frames = Data_Array.mapWithIndex(function (frame) {
                return function (v) {
                    var cam = Lattice_Services_Export_CameraExport_Formats_Common.interpolateCameraAtFrame(camera)(keyframes)(frame);
                    var projMatrix = Lattice_Services_Export_CameraExport_Matrix.computeProjectionMatrix(cam)(aspectRatio)(0.1)(1000.0);
                    var viewMatrix = Lattice_Services_Export_CameraExport_Matrix.computeViewMatrix(cam);
                    return {
                        frame: frame,
                        timestamp: Data_Int.toNumber(frame) / options.fps,
                        viewMatrix: viewMatrix,
                        projectionMatrix: projMatrix,
                        position: [ cam.position.x, cam.position.y, cam.position.z ],
                        rotation: [ cam.rotation.x, cam.rotation.y, cam.rotation.z ],
                        fov: Lattice_Services_Export_CameraExport_Matrix.focalLengthToFOV(cam.focalLength)(camera.filmSize),
                        focalLength: cam.focalLength,
                        focusDistance: cam.focusDistance
                    };
                };
            })(Data_Array.range(0)(options.frameCount - 1 | 0));
            return {
                frames: frames,
                metadata: metadata
            };
        };
    };
};
var exportCameraForTarget = function (target) {
    return function (camera) {
        return function (keyframes) {
            return function (frameCount) {
                return function (compWidth) {
                    return function (compHeight) {
                        return function (fps) {
                            if (target instanceof Lattice_Services_Export_CameraExport_Types.TargetMotionCtrl) {
                                var result = Lattice_Services_Export_CameraExport_Formats_MotionCtrl.exportToMotionCtrl(camera)(keyframes)(frameCount);
                                return {
                                    format: "motionctrl",
                                    data: Lattice_Services_Export_CameraExport_Formats_MotionCtrl.serializePoses(result.cameraPoses)
                                };
                            };
                            if (target instanceof Lattice_Services_Export_CameraExport_Types.TargetMotionCtrlSVD) {
                                var result = Lattice_Services_Export_CameraExport_Formats_MotionCtrl.exportToMotionCtrlSVD(camera)(keyframes)(frameCount);
                                return {
                                    format: "motionctrl-svd",
                                    data: show(result.motionCamera)
                                };
                            };
                            if (target instanceof Lattice_Services_Export_CameraExport_Types.TargetWan22FunCamera) {
                                var result = Lattice_Services_Export_CameraExport_Formats_Wan22.mapToWan22FunCamera(keyframes);
                                return {
                                    format: "wan22-fun-camera",
                                    data: show1(result.cameraMotion)
                                };
                            };
                            if (target instanceof Lattice_Services_Export_CameraExport_Types.TargetUni3CCamera) {
                                var result = Lattice_Services_Export_CameraExport_Formats_Uni3C.exportToUni3C(camera)(keyframes)(frameCount)(compWidth)(compHeight);
                                return {
                                    format: "uni3c-camera",
                                    data: show2(result.trajType)
                                };
                            };
                            if (target instanceof Lattice_Services_Export_CameraExport_Types.TargetUni3CMotion) {
                                var result = Lattice_Services_Export_CameraExport_Formats_Uni3C.exportToUni3C(camera)(keyframes)(frameCount)(compWidth)(compHeight);
                                return {
                                    format: "uni3c-motion",
                                    data: show2(result.trajType)
                                };
                            };
                            if (target instanceof Lattice_Services_Export_CameraExport_Types.TargetAnimateDiffCameraCtrl) {
                                var result = Lattice_Services_Export_CameraExport_Formats_CameraCtrl.exportToCameraCtrl(keyframes)(frameCount);
                                return {
                                    format: "cameractrl",
                                    data: show3(result.motionType) + (" speed=" + show4(result.speed))
                                };
                            };
                            if (target instanceof Lattice_Services_Export_CameraExport_Types.TargetFullMatrices) {
                                var result = exportCameraMatrices(camera)(keyframes)({
                                    frameCount: frameCount,
                                    width: compWidth,
                                    height: compHeight,
                                    fps: fps
                                });
                                return {
                                    format: "full-matrices",
                                    data: "frames=" + show4(Data_Array.length(result.frames))
                                };
                            };
                            throw new Error("Failed pattern match at Lattice.Services.Export.CameraExport.Formats.Full (line 97, column 3 - line 118, column 85): " + [ target.constructor.name ]);
                        };
                    };
                };
            };
        };
    };
};
export {
    exportCameraMatrices,
    exportCameraForTarget
};
//# sourceMappingURL=index.js.map
