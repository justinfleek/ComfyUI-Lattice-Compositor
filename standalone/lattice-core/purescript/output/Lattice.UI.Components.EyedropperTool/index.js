// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Control_Monad_State_Class from "../Control.Monad.State.Class/index.js";
import * as Data_Function from "../Data.Function/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Halogen_Component from "../Halogen.Component/index.js";
import * as Halogen_HTML_Core from "../Halogen.HTML.Core/index.js";
import * as Halogen_HTML_Elements from "../Halogen.HTML.Elements/index.js";
import * as Halogen_HTML_Events from "../Halogen.HTML.Events/index.js";
import * as Halogen_HTML_Properties from "../Halogen.HTML.Properties/index.js";
import * as Halogen_Query_HalogenM from "../Halogen.Query.HalogenM/index.js";
import * as Lattice_UI_Core from "../Lattice.UI.Core/index.js";
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var show1 = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var pure = /* #__PURE__ */ Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM);
var modify_ = /* #__PURE__ */ Control_Monad_State_Class.modify_(Halogen_Query_HalogenM.monadStateHalogenM);
var bind = /* #__PURE__ */ Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM);
var get = /* #__PURE__ */ Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM);
var CorrectionApplied = /* #__PURE__ */ (function () {
    function CorrectionApplied(value0) {
        this.value0 = value0;
    };
    CorrectionApplied.create = function (value0) {
        return new CorrectionApplied(value0);
    };
    return CorrectionApplied;
})();
var Initialize = /* #__PURE__ */ (function () {
    function Initialize() {

    };
    Initialize.value = new Initialize();
    return Initialize;
})();
var ToggleEyedropper = /* #__PURE__ */ (function () {
    function ToggleEyedropper() {

    };
    ToggleEyedropper.value = new ToggleEyedropper();
    return ToggleEyedropper;
})();
var ApplyCorrection = /* #__PURE__ */ (function () {
    function ApplyCorrection() {

    };
    ApplyCorrection.value = new ApplyCorrection();
    return ApplyCorrection;
})();
var ClearSample = /* #__PURE__ */ (function () {
    function ClearSample() {

    };
    ClearSample.value = new ClearSample();
    return ClearSample;
})();
var toRgbString = function (color) {
    return "rgb(" + (show(color.r) + (", " + (show(color.g) + (", " + (show(color.b) + ")")))));
};
var swatchStyle = function (colorHex) {
    return "width: 32px; height: 32px; border-radius: var(--lattice-radius-sm); " + ("border: 1px solid var(--lattice-border-default); " + ("background-color: " + (colorHex + ";")));
};
var previewStyle = /* #__PURE__ */ (function () {
    return "display: flex; flex-wrap: wrap; align-items: center; gap: 8px; " + ("padding: 8px; background: var(--lattice-surface-2); " + "border-radius: var(--lattice-radius-sm);");
})();
var initialState = /* #__PURE__ */ (function () {
    return {
        isActive: false,
        sampledColor: Data_Maybe.Nothing.value
    };
})();
var infoStyle = /* #__PURE__ */ (function () {
    return "display: flex; flex-direction: column; gap: 2px; " + ("font-size: var(--lattice-font-size-xs); font-family: monospace; " + "color: var(--lattice-text-secondary);");
})();
var formatNumber = function (val) {
    return function (decimals) {
        var factor = Data_Number.pow(10.0)(Data_Int.toNumber(decimals));
        var rounded = Data_Number.round(val * factor) / factor;
        return show1(rounded);
    };
};
var correctionStyle = /* #__PURE__ */ (function () {
    return "display: flex; flex-direction: column; gap: 2px; " + ("font-size: var(--lattice-font-size-xs); font-family: monospace; " + "color: var(--lattice-accent);");
})();
var containerStyle = "display: flex; flex-direction: column; gap: 8px;";
var clearBtnStyle = /* #__PURE__ */ (function () {
    return "padding: 4px 8px; background: var(--lattice-surface-3); " + ("border: 1px solid var(--lattice-border-default); " + ("border-radius: var(--lattice-radius-sm); " + ("color: var(--lattice-text-secondary); " + "font-size: var(--lattice-font-size-sm); cursor: pointer;")));
})();
var calculateWhiteBalanceCorrection = function (color) {
    var r = Data_Int.toNumber(color.r);
    var g = Data_Int.toNumber(color.g);
    var b = Data_Int.toNumber(color.b);
    var temperature = (r - b) / 2.55;
    var tint = (r + b) / 2.0 - g;
    var tintScaled = tint / 2.55;
    return {
        temperature: -temperature,
        tint: -tintScaled
    };
};
var handleAction = function (dictMonadAff) {
    return function (v) {
        if (v instanceof Initialize) {
            return pure(Data_Unit.unit);
        };
        if (v instanceof ToggleEyedropper) {
            return modify_(function (s) {
                var $21 = {};
                for (var $22 in s) {
                    if ({}.hasOwnProperty.call(s, $22)) {
                        $21[$22] = s[$22];
                    };
                };
                $21.isActive = !s.isActive;
                return $21;
            });
        };
        if (v instanceof ApplyCorrection) {
            return bind(get)(function (state) {
                if (state.sampledColor instanceof Data_Maybe.Just) {
                    var correction = calculateWhiteBalanceCorrection(state.sampledColor.value0);
                    return Halogen_Query_HalogenM.raise(new CorrectionApplied(correction));
                };
                if (state.sampledColor instanceof Data_Maybe.Nothing) {
                    return pure(Data_Unit.unit);
                };
                throw new Error("Failed pattern match at Lattice.UI.Components.EyedropperTool (line 282, column 5 - line 286, column 27): " + [ state.sampledColor.constructor.name ]);
            });
        };
        if (v instanceof ClearSample) {
            return modify_(function (v1) {
                var $26 = {};
                for (var $27 in v1) {
                    if ({}.hasOwnProperty.call(v1, $27)) {
                        $26[$27] = v1[$27];
                    };
                };
                $26.sampledColor = Data_Maybe.Nothing.value;
                return $26;
            });
        };
        throw new Error("Failed pattern match at Lattice.UI.Components.EyedropperTool (line 268, column 16 - line 289, column 43): " + [ v.constructor.name ]);
    };
};
var buttonStyle = function (active) {
    var color = (function () {
        if (active) {
            return "var(--lattice-accent)";
        };
        return "var(--lattice-text-primary)";
    })();
    var border = (function () {
        if (active) {
            return "var(--lattice-accent)";
        };
        return "var(--lattice-border-default)";
    })();
    var bg = (function () {
        if (active) {
            return "var(--lattice-accent-muted)";
        };
        return "var(--lattice-surface-2)";
    })();
    return "display: flex; align-items: center; gap: 6px; " + ("padding: 6px 12px; border-radius: var(--lattice-radius-sm); " + ("cursor: pointer; transition: all 0.15s ease; " + ("background: " + (bg + ("; " + ("border: 1px solid " + (border + ("; " + ("color: " + (color + ("; " + "font-size: var(--lattice-font-size-sm);")))))))))));
};
var applyBtnStyle = /* #__PURE__ */ (function () {
    return "padding: 4px 12px; background: var(--lattice-accent); " + ("border: none; border-radius: var(--lattice-radius-sm); " + "color: white; font-size: var(--lattice-font-size-sm); cursor: pointer;");
})();
var renderSampledPreview = function (color) {
    var correction = calculateWhiteBalanceCorrection(color);
    var colorHex = toRgbString(color);
    return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-sampled-preview" ]), Halogen_HTML_Properties.attr("style")(previewStyle) ])([ Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-color-swatch" ]), Halogen_HTML_Properties.attr("style")(swatchStyle(colorHex)) ])([  ]), Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-color-info" ]), Halogen_HTML_Properties.attr("style")(infoStyle) ])([ Halogen_HTML_Elements.span_([ Halogen_HTML_Core.text("R: " + show(color.r)) ]), Halogen_HTML_Elements.span_([ Halogen_HTML_Core.text("G: " + show(color.g)) ]), Halogen_HTML_Elements.span_([ Halogen_HTML_Core.text("B: " + show(color.b)) ]) ]), Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-correction-values" ]), Halogen_HTML_Properties.attr("style")(correctionStyle) ])([ Halogen_HTML_Elements.span_([ Halogen_HTML_Core.text("Temp: " + formatNumber(correction.temperature)(1)) ]), Halogen_HTML_Elements.span_([ Halogen_HTML_Core.text("Tint: " + formatNumber(correction.tint)(1)) ]) ]), Halogen_HTML_Elements.button([ Lattice_UI_Core.cls([ "lattice-apply-button" ]), Halogen_HTML_Properties.attr("style")(applyBtnStyle), Halogen_HTML_Events.onClick(Data_Function["const"](ApplyCorrection.value)) ])([ Halogen_HTML_Core.text("Apply") ]), Halogen_HTML_Elements.button([ Lattice_UI_Core.cls([ "lattice-clear-button" ]), Halogen_HTML_Properties.attr("style")(clearBtnStyle), Halogen_HTML_Events.onClick(Data_Function["const"](ClearSample.value)) ])([ Halogen_HTML_Core.text("Clear") ]) ]);
};
var render = function (state) {
    return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-eyedropper-tool" ]), Halogen_HTML_Properties.attr("style")(containerStyle) ])([ Halogen_HTML_Elements.button([ Lattice_UI_Core.cls([ "lattice-eyedropper-button" ]), Halogen_HTML_Properties.attr("data-state")((function () {
        if (state.isActive) {
            return "active";
        };
        return "inactive";
    })()), Halogen_HTML_Properties.attr("style")(buttonStyle(state.isActive)), Halogen_HTML_Properties.title((function () {
        if (state.isActive) {
            return "Click on canvas to sample";
        };
        return "Sample color for white balance";
    })()), Halogen_HTML_Events.onClick(Data_Function["const"](ToggleEyedropper.value)) ])([ Halogen_HTML_Elements.span([ Lattice_UI_Core.cls([ "lattice-icon" ]) ])([ Halogen_HTML_Core.text((function () {
        if (state.isActive) {
            return "\u2731";
        };
        return "\u2299";
    })()) ]), Halogen_HTML_Elements.span([ Lattice_UI_Core.cls([ "lattice-label" ]) ])([ Halogen_HTML_Core.text((function () {
        if (state.isActive) {
            return "Sampling...";
        };
        return "White Balance";
    })()) ]) ]), (function () {
        if (state.sampledColor instanceof Data_Maybe.Just) {
            return renderSampledPreview(state.sampledColor.value0);
        };
        if (state.sampledColor instanceof Data_Maybe.Nothing) {
            return Halogen_HTML_Core.text("");
        };
        throw new Error("Failed pattern match at Lattice.UI.Components.EyedropperTool (line 112, column 7 - line 114, column 30): " + [ state.sampledColor.constructor.name ]);
    })() ]);
};
var component = function (dictMonadAff) {
    return Halogen_Component.mkComponent({
        initialState: Data_Function["const"](initialState),
        render: render,
        "eval": Halogen_Component.mkEval({
            handleQuery: Halogen_Component.defaultEval.handleQuery,
            receive: Halogen_Component.defaultEval.receive,
            finalize: Halogen_Component.defaultEval.finalize,
            handleAction: handleAction(dictMonadAff),
            initialize: new Data_Maybe.Just(Initialize.value)
        })
    });
};
export {
    component,
    CorrectionApplied
};
//# sourceMappingURL=index.js.map
