// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Control_Monad_State_Class from "../Control.Monad.State.Class/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Halogen_Component from "../Halogen.Component/index.js";
import * as Halogen_HTML_Core from "../Halogen.HTML.Core/index.js";
import * as Halogen_HTML_Elements from "../Halogen.HTML.Elements/index.js";
import * as Halogen_HTML_Events from "../Halogen.HTML.Events/index.js";
import * as Halogen_HTML_Properties from "../Halogen.HTML.Properties/index.js";
import * as Halogen_Query_HalogenM from "../Halogen.Query.HalogenM/index.js";
import * as Lattice_Services_Math3D_Vec3 from "../Lattice.Services.Math3D.Vec3/index.js";
import * as Lattice_UI_Core from "../Lattice.UI.Core/index.js";
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM);
var modify_ = /* #__PURE__ */ Control_Monad_State_Class.modify_(Halogen_Query_HalogenM.monadStateHalogenM);
var pure = /* #__PURE__ */ Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM);
var value = /* #__PURE__ */ Halogen_HTML_Properties.value(Halogen_HTML_Core.isPropString);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordNumber);
var min = /* #__PURE__ */ Data_Ord.min(Data_Ord.ordNumber);
var bind = /* #__PURE__ */ Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM);
var get = /* #__PURE__ */ Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM);
var min1 = /* #__PURE__ */ Data_Ord.min(Data_Ord.ordInt);
var when = /* #__PURE__ */ Control_Applicative.when(Halogen_Query_HalogenM.applicativeHalogenM);
var ViewActiveCamera = /* #__PURE__ */ (function () {
    function ViewActiveCamera() {

    };
    ViewActiveCamera.value = new ViewActiveCamera();
    return ViewActiveCamera;
})();
var ViewCustom1 = /* #__PURE__ */ (function () {
    function ViewCustom1() {

    };
    ViewCustom1.value = new ViewCustom1();
    return ViewCustom1;
})();
var ViewCustom2 = /* #__PURE__ */ (function () {
    function ViewCustom2() {

    };
    ViewCustom2.value = new ViewCustom2();
    return ViewCustom2;
})();
var ViewCustom3 = /* #__PURE__ */ (function () {
    function ViewCustom3() {

    };
    ViewCustom3.value = new ViewCustom3();
    return ViewCustom3;
})();
var ViewFront = /* #__PURE__ */ (function () {
    function ViewFront() {

    };
    ViewFront.value = new ViewFront();
    return ViewFront;
})();
var ViewBack = /* #__PURE__ */ (function () {
    function ViewBack() {

    };
    ViewBack.value = new ViewBack();
    return ViewBack;
})();
var ViewLeft = /* #__PURE__ */ (function () {
    function ViewLeft() {

    };
    ViewLeft.value = new ViewLeft();
    return ViewLeft;
})();
var ViewRight = /* #__PURE__ */ (function () {
    function ViewRight() {

    };
    ViewRight.value = new ViewRight();
    return ViewRight;
})();
var ViewTop = /* #__PURE__ */ (function () {
    function ViewTop() {

    };
    ViewTop.value = new ViewTop();
    return ViewTop;
})();
var ViewBottom = /* #__PURE__ */ (function () {
    function ViewBottom() {

    };
    ViewBottom.value = new ViewBottom();
    return ViewBottom;
})();
var Layout1View = /* #__PURE__ */ (function () {
    function Layout1View() {

    };
    Layout1View.value = new Layout1View();
    return Layout1View;
})();
var Layout2ViewHorizontal = /* #__PURE__ */ (function () {
    function Layout2ViewHorizontal() {

    };
    Layout2ViewHorizontal.value = new Layout2ViewHorizontal();
    return Layout2ViewHorizontal;
})();
var Layout2ViewVertical = /* #__PURE__ */ (function () {
    function Layout2ViewVertical() {

    };
    Layout2ViewVertical.value = new Layout2ViewVertical();
    return Layout2ViewVertical;
})();
var Layout4View = /* #__PURE__ */ (function () {
    function Layout4View() {

    };
    Layout4View.value = new Layout4View();
    return Layout4View;
})();
var ViewChanged = /* #__PURE__ */ (function () {
    function ViewChanged(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    ViewChanged.create = function (value0) {
        return function (value1) {
            return new ViewChanged(value0, value1);
        };
    };
    return ViewChanged;
})();
var LayoutChanged = /* #__PURE__ */ (function () {
    function LayoutChanged(value0) {
        this.value0 = value0;
    };
    LayoutChanged.create = function (value0) {
        return new LayoutChanged(value0);
    };
    return LayoutChanged;
})();
var CustomViewUpdated = /* #__PURE__ */ (function () {
    function CustomViewUpdated(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    CustomViewUpdated.create = function (value0) {
        return function (value1) {
            return new CustomViewUpdated(value0, value1);
        };
    };
    return CustomViewUpdated;
})();
var Initialize = /* #__PURE__ */ (function () {
    function Initialize() {

    };
    Initialize.value = new Initialize();
    return Initialize;
})();
var Receive = /* #__PURE__ */ (function () {
    function Receive(value0) {
        this.value0 = value0;
    };
    Receive.create = function (value0) {
        return new Receive(value0);
    };
    return Receive;
})();
var SetActiveView = /* #__PURE__ */ (function () {
    function SetActiveView(value0) {
        this.value0 = value0;
    };
    SetActiveView.create = function (value0) {
        return new SetActiveView(value0);
    };
    return SetActiveView;
})();
var UpdateViewType = /* #__PURE__ */ (function () {
    function UpdateViewType(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    UpdateViewType.create = function (value0) {
        return function (value1) {
            return new UpdateViewType(value0, value1);
        };
    };
    return UpdateViewType;
})();
var SetLayout = /* #__PURE__ */ (function () {
    function SetLayout(value0) {
        this.value0 = value0;
    };
    SetLayout.create = function (value0) {
        return new SetLayout(value0);
    };
    return SetLayout;
})();
var ResetCustomView = /* #__PURE__ */ (function () {
    function ResetCustomView(value0) {
        this.value0 = value0;
    };
    ResetCustomView.create = function (value0) {
        return new ResetCustomView(value0);
    };
    return ResetCustomView;
})();
var HandleMouseDown = /* #__PURE__ */ (function () {
    function HandleMouseDown(value0, value1, value2, value3) {
        this.value0 = value0;
        this.value1 = value1;
        this.value2 = value2;
        this.value3 = value3;
    };
    HandleMouseDown.create = function (value0) {
        return function (value1) {
            return function (value2) {
                return function (value3) {
                    return new HandleMouseDown(value0, value1, value2, value3);
                };
            };
        };
    };
    return HandleMouseDown;
})();
var HandleMouseMove = /* #__PURE__ */ (function () {
    function HandleMouseMove(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    HandleMouseMove.create = function (value0) {
        return function (value1) {
            return new HandleMouseMove(value0, value1);
        };
    };
    return HandleMouseMove;
})();
var HandleMouseUp = /* #__PURE__ */ (function () {
    function HandleMouseUp() {

    };
    HandleMouseUp.value = new HandleMouseUp();
    return HandleMouseUp;
})();
var HandleWheel = /* #__PURE__ */ (function () {
    function HandleWheel(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    HandleWheel.create = function (value0) {
        return function (value1) {
            return new HandleWheel(value0, value1);
        };
    };
    return HandleWheel;
})();
var RenderFrame = /* #__PURE__ */ (function () {
    function RenderFrame() {

    };
    RenderFrame.value = new RenderFrame();
    return RenderFrame;
})();
var viewPanelStyle = /* #__PURE__ */ (function () {
    return "display: flex; flex-direction: column; position: relative; " + ("background: #1a1a1a; border: 1px solid transparent; " + "transition: border-color 0.15s;");
})();
var viewDisplayName = function (v) {
    if (v instanceof ViewActiveCamera) {
        return "Camera";
    };
    if (v instanceof ViewCustom1) {
        return "Custom 1";
    };
    if (v instanceof ViewCustom2) {
        return "Custom 2";
    };
    if (v instanceof ViewCustom3) {
        return "Custom 3";
    };
    if (v instanceof ViewFront) {
        return "Front";
    };
    if (v instanceof ViewBack) {
        return "Back";
    };
    if (v instanceof ViewLeft) {
        return "Left";
    };
    if (v instanceof ViewRight) {
        return "Right";
    };
    if (v instanceof ViewTop) {
        return "Top";
    };
    if (v instanceof ViewBottom) {
        return "Bottom";
    };
    throw new Error("Failed pattern match at Lattice.UI.Components.ViewportRenderer (line 368, column 19 - line 378, column 25): " + [ v.constructor.name ]);
};
var updateCustomViewState = function (dictMonadAff) {
    return function (viewType) {
        return function (newState) {
            if (viewType instanceof ViewCustom1) {
                return discard(modify_(function (v) {
                    var $64 = {};
                    for (var $65 in v) {
                        if ({}.hasOwnProperty.call(v, $65)) {
                            $64[$65] = v[$65];
                        };
                    };
                    $64.customViews = (function () {
                        var $61 = {};
                        for (var $62 in v.customViews) {
                            if ({}.hasOwnProperty.call(v.customViews, $62)) {
                                $61[$62] = v["customViews"][$62];
                            };
                        };
                        $61.custom1 = newState;
                        return $61;
                    })();
                    return $64;
                }))(function () {
                    return Halogen_Query_HalogenM.raise(new CustomViewUpdated("custom-1", newState));
                });
            };
            if (viewType instanceof ViewCustom2) {
                return discard(modify_(function (v) {
                    var $70 = {};
                    for (var $71 in v) {
                        if ({}.hasOwnProperty.call(v, $71)) {
                            $70[$71] = v[$71];
                        };
                    };
                    $70.customViews = (function () {
                        var $67 = {};
                        for (var $68 in v.customViews) {
                            if ({}.hasOwnProperty.call(v.customViews, $68)) {
                                $67[$68] = v["customViews"][$68];
                            };
                        };
                        $67.custom2 = newState;
                        return $67;
                    })();
                    return $70;
                }))(function () {
                    return Halogen_Query_HalogenM.raise(new CustomViewUpdated("custom-2", newState));
                });
            };
            if (viewType instanceof ViewCustom3) {
                return discard(modify_(function (v) {
                    var $76 = {};
                    for (var $77 in v) {
                        if ({}.hasOwnProperty.call(v, $77)) {
                            $76[$77] = v[$77];
                        };
                    };
                    $76.customViews = (function () {
                        var $73 = {};
                        for (var $74 in v.customViews) {
                            if ({}.hasOwnProperty.call(v.customViews, $74)) {
                                $73[$74] = v["customViews"][$74];
                            };
                        };
                        $73.custom3 = newState;
                        return $73;
                    })();
                    return $76;
                }))(function () {
                    return Halogen_Query_HalogenM.raise(new CustomViewUpdated("custom-3", newState));
                });
            };
            return pure(Data_Unit.unit);
        };
    };
};
var updateAt = function (idx) {
    return function (val) {
        return function (arr) {
            return Data_Array.mapWithIndex(function (i) {
                return function (v) {
                    var $79 = i === idx;
                    if ($79) {
                        return val;
                    };
                    return v;
                };
            })(arr);
        };
    };
};
var showViewType = {
    show: function (v) {
        if (v instanceof ViewActiveCamera) {
            return "active-camera";
        };
        if (v instanceof ViewCustom1) {
            return "custom-1";
        };
        if (v instanceof ViewCustom2) {
            return "custom-2";
        };
        if (v instanceof ViewCustom3) {
            return "custom-3";
        };
        if (v instanceof ViewFront) {
            return "front";
        };
        if (v instanceof ViewBack) {
            return "back";
        };
        if (v instanceof ViewLeft) {
            return "left";
        };
        if (v instanceof ViewRight) {
            return "right";
        };
        if (v instanceof ViewTop) {
            return "top";
        };
        if (v instanceof ViewBottom) {
            return "bottom";
        };
        throw new Error("Failed pattern match at Lattice.UI.Components.ViewportRenderer (line 60, column 10 - line 70, column 27): " + [ v.constructor.name ]);
    }
};
var show1 = /* #__PURE__ */ Data_Show.show(showViewType);
var selectStyle = /* #__PURE__ */ (function () {
    return "flex: 1; background: transparent; color: white; border: none; " + "font-size: 11px; cursor: pointer; outline: none;";
})();
var parseViewType = function (v) {
    if (v === "active-camera") {
        return new Data_Maybe.Just(ViewActiveCamera.value);
    };
    if (v === "custom-1") {
        return new Data_Maybe.Just(ViewCustom1.value);
    };
    if (v === "custom-2") {
        return new Data_Maybe.Just(ViewCustom2.value);
    };
    if (v === "custom-3") {
        return new Data_Maybe.Just(ViewCustom3.value);
    };
    if (v === "front") {
        return new Data_Maybe.Just(ViewFront.value);
    };
    if (v === "back") {
        return new Data_Maybe.Just(ViewBack.value);
    };
    if (v === "left") {
        return new Data_Maybe.Just(ViewLeft.value);
    };
    if (v === "right") {
        return new Data_Maybe.Just(ViewRight.value);
    };
    if (v === "top") {
        return new Data_Maybe.Just(ViewTop.value);
    };
    if (v === "bottom") {
        return new Data_Maybe.Just(ViewBottom.value);
    };
    return Data_Maybe.Nothing.value;
};
var panelsStyle = /* #__PURE__ */ (function () {
    return "display: grid; flex: 1; gap: 2px; " + "grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));";
})();
var layoutControlsStyle = "position: absolute; top: 4px; right: 4px; display: flex; gap: 2px; z-index: 10;";
var layoutClass = function (v) {
    if (v instanceof Layout1View) {
        return "layout-1-view";
    };
    if (v instanceof Layout2ViewHorizontal) {
        return "layout-2-view-horizontal";
    };
    if (v instanceof Layout2ViewVertical) {
        return "layout-2-view-vertical";
    };
    if (v instanceof Layout4View) {
        return "layout-4-view";
    };
    throw new Error("Failed pattern match at Lattice.UI.Components.ViewportRenderer (line 248, column 15 - line 252, column 33): " + [ v.constructor.name ]);
};
var layoutBtnStyle = /* #__PURE__ */ (function () {
    return "padding: 2px 6px; background: rgba(0,0,0,0.5); color: white; " + ("border: 1px solid rgba(255,255,255,0.2); border-radius: 2px; " + "font-size: 10px; cursor: pointer;");
})();
var isCustomView = function (v) {
    if (v instanceof ViewCustom1) {
        return true;
    };
    if (v instanceof ViewCustom2) {
        return true;
    };
    if (v instanceof ViewCustom3) {
        return true;
    };
    return false;
};
var infoStyle = /* #__PURE__ */ (function () {
    return "position: absolute; bottom: 4px; left: 8px; display: flex; gap: 8px; " + "font-size: 10px; color: rgba(255,255,255,0.5); pointer-events: none;";
})();
var headerStyle = /* #__PURE__ */ (function () {
    return "display: flex; align-items: center; gap: 4px; padding: 4px 8px; " + "background: rgba(0,0,0,0.3); border-bottom: 1px solid rgba(255,255,255,0.1);";
})();
var renderViewHeader = function (state) {
    return function (idx) {
        return function (viewType) {
            return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "view-header" ]), Halogen_HTML_Properties.attr("style")(headerStyle) ])([ Halogen_HTML_Elements.select([ Lattice_UI_Core.cls([ "view-select" ]), Halogen_HTML_Properties.attr("style")(selectStyle), value(show1(viewType)), Halogen_HTML_Events.onValueChange(UpdateViewType.create(idx)) ])([ Halogen_HTML_Elements.option([ value("active-camera") ])([ Halogen_HTML_Core.text("Active Camera") ]), Halogen_HTML_Elements.option([ value("custom-1") ])([ Halogen_HTML_Core.text("Custom View 1") ]), Halogen_HTML_Elements.option([ value("custom-2") ])([ Halogen_HTML_Core.text("Custom View 2") ]), Halogen_HTML_Elements.option([ value("custom-3") ])([ Halogen_HTML_Core.text("Custom View 3") ]), Halogen_HTML_Elements.option([ value("front") ])([ Halogen_HTML_Core.text("Front") ]), Halogen_HTML_Elements.option([ value("back") ])([ Halogen_HTML_Core.text("Back") ]), Halogen_HTML_Elements.option([ value("left") ])([ Halogen_HTML_Core.text("Left") ]), Halogen_HTML_Elements.option([ value("right") ])([ Halogen_HTML_Core.text("Right") ]), Halogen_HTML_Elements.option([ value("top") ])([ Halogen_HTML_Core.text("Top") ]), Halogen_HTML_Elements.option([ value("bottom") ])([ Halogen_HTML_Core.text("Bottom") ]) ]), (function () {
                var $84 = isCustomView(viewType);
                if ($84) {
                    return Halogen_HTML_Elements.button([ Lattice_UI_Core.cls([ "reset-btn" ]), Halogen_HTML_Properties.title("Reset View"), Halogen_HTML_Events.onClick(function (v) {
                        return new ResetCustomView(viewType);
                    }) ])([ Halogen_HTML_Core.text("R") ]);
                };
                return Halogen_HTML_Core.text("");
            })() ]);
        };
    };
};
var getCustomViewState = function (state) {
    return function (v) {
        if (v instanceof ViewCustom1) {
            return state.customViews.custom1;
        };
        if (v instanceof ViewCustom2) {
            return state.customViews.custom2;
        };
        if (v instanceof ViewCustom3) {
            return state.customViews.custom3;
        };
        return state.customViews.custom1;
    };
};
var eqViewType = {
    eq: function (x) {
        return function (y) {
            if (x instanceof ViewActiveCamera && y instanceof ViewActiveCamera) {
                return true;
            };
            if (x instanceof ViewCustom1 && y instanceof ViewCustom1) {
                return true;
            };
            if (x instanceof ViewCustom2 && y instanceof ViewCustom2) {
                return true;
            };
            if (x instanceof ViewCustom3 && y instanceof ViewCustom3) {
                return true;
            };
            if (x instanceof ViewFront && y instanceof ViewFront) {
                return true;
            };
            if (x instanceof ViewBack && y instanceof ViewBack) {
                return true;
            };
            if (x instanceof ViewLeft && y instanceof ViewLeft) {
                return true;
            };
            if (x instanceof ViewRight && y instanceof ViewRight) {
                return true;
            };
            if (x instanceof ViewTop && y instanceof ViewTop) {
                return true;
            };
            if (x instanceof ViewBottom && y instanceof ViewBottom) {
                return true;
            };
            return false;
        };
    }
};
var eqViewLayout = {
    eq: function (x) {
        return function (y) {
            if (x instanceof Layout1View && y instanceof Layout1View) {
                return true;
            };
            if (x instanceof Layout2ViewHorizontal && y instanceof Layout2ViewHorizontal) {
                return true;
            };
            if (x instanceof Layout2ViewVertical && y instanceof Layout2ViewVertical) {
                return true;
            };
            if (x instanceof Layout4View && y instanceof Layout4View) {
                return true;
            };
            return false;
        };
    }
};
var eq1 = /* #__PURE__ */ Data_Eq.eq(eqViewLayout);
var layoutButton = function (state) {
    return function (layout) {
        return function (label) {
            return Halogen_HTML_Elements.button([ Lattice_UI_Core.cls([ "layout-btn", (function () {
                var $90 = eq1(state.layout)(layout);
                if ($90) {
                    return "active";
                };
                return "";
            })() ]), Halogen_HTML_Properties.attr("style")(layoutBtnStyle), Halogen_HTML_Events.onClick(function (v) {
                return new SetLayout(layout);
            }) ])([ Halogen_HTML_Core.text(label) ]);
        };
    };
};
var renderLayoutControls = function (state) {
    return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "layout-controls" ]), Halogen_HTML_Properties.attr("style")(layoutControlsStyle) ])([ layoutButton(state)(Layout1View.value)("1"), layoutButton(state)(Layout2ViewHorizontal.value)("2H"), layoutButton(state)(Layout2ViewVertical.value)("2V"), layoutButton(state)(Layout4View.value)("4") ]);
};
var defaultCustomView = function (w) {
    return function (h) {
        return {
            orbitCenter: Lattice_Services_Math3D_Vec3.vec3(Data_Int.toNumber(w) / 2.0)(Data_Int.toNumber(h) / 2.0)(0.0),
            orbitDistance: 2000.0,
            orbitPhi: 60.0,
            orbitTheta: 45.0,
            orthoZoom: 1.0,
            orthoOffset: {
                x: 0.0,
                y: 0.0
            }
        };
    };
};
var initialState = function (input) {
    return {
        compWidth: input.compWidth,
        compHeight: input.compHeight,
        camera: input.camera,
        layers: input.layers,
        viewOptions: input.viewOptions,
        layout: Layout1View.value,
        views: [ ViewActiveCamera.value, ViewTop.value, ViewFront.value, ViewRight.value ],
        activeViewIndex: 0,
        customViews: {
            custom1: defaultCustomView(input.compWidth)(input.compHeight),
            custom2: defaultCustomView(input.compWidth)(input.compHeight),
            custom3: defaultCustomView(input.compWidth)(input.compHeight)
        },
        isDragging: false,
        dragStartPos: {
            x: 0.0,
            y: 0.0
        },
        dragViewIndex: 0,
        dragButton: 0
    };
};
var customViewCoords = function (state) {
    return function (viewType) {
        var customState = getCustomViewState(state)(viewType);
        return "t:" + (show(Data_Int.floor(customState.orbitTheta)) + (" p:" + show(Data_Int.floor(customState.orbitPhi))));
    };
};
var renderViewInfo = function (state) {
    return function (viewType) {
        return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "view-info" ]), Halogen_HTML_Properties.attr("style")(infoStyle) ])([ Halogen_HTML_Elements.span([ Lattice_UI_Core.cls([ "view-name" ]) ])([ Halogen_HTML_Core.text(viewDisplayName(viewType)) ]), (function () {
            var $91 = isCustomView(viewType);
            if ($91) {
                return Halogen_HTML_Elements.span([ Lattice_UI_Core.cls([ "view-coords" ]) ])([ Halogen_HTML_Core.text(customViewCoords(state)(viewType)) ]);
            };
            return Halogen_HTML_Core.text("");
        })() ]);
    };
};
var containerStyle = /* #__PURE__ */ (function () {
    return "display: flex; flex-direction: column; width: 100%; height: 100%; " + "background: var(--lattice-void, #0a0a0a); position: relative;";
})();
var clamp = function (minVal) {
    return function (maxVal) {
        return function (val) {
            return max(minVal)(min(maxVal)(val));
        };
    };
};
var canvasStyle = "flex: 1; width: 100%; display: block; background: #1a1a1a;";
var renderViewCanvas = function (state) {
    return function (idx) {
        return function (viewType) {
            return Halogen_HTML_Elements.canvas([ Lattice_UI_Core.cls([ "view-canvas" ]), Halogen_HTML_Properties.id("viewport-canvas-" + show(idx)), Halogen_HTML_Properties.attr("style")(canvasStyle) ]);
        };
    };
};
var renderViewPanel = function (state) {
    return function (idx) {
        return function (viewType) {
            return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "view-panel", (function () {
                var $92 = idx === state.activeViewIndex;
                if ($92) {
                    return "active";
                };
                return "";
            })() ]), Halogen_HTML_Properties.attr("style")(viewPanelStyle), Halogen_HTML_Events.onClick(function (v) {
                return new SetActiveView(idx);
            }) ])([ renderViewHeader(state)(idx)(viewType), renderViewCanvas(state)(idx)(viewType), renderViewInfo(state)(viewType) ]);
        };
    };
};
var activeViews = function (state) {
    if (state.layout instanceof Layout1View) {
        return Data_Array.take(1)(state.views);
    };
    if (state.layout instanceof Layout2ViewHorizontal) {
        return Data_Array.take(2)(state.views);
    };
    if (state.layout instanceof Layout2ViewVertical) {
        return Data_Array.take(2)(state.views);
    };
    if (state.layout instanceof Layout4View) {
        return Data_Array.take(4)(state.views);
    };
    throw new Error("Failed pattern match at Lattice.UI.Components.ViewportRenderer (line 263, column 21 - line 267, column 36): " + [ state.layout.constructor.name ]);
};
var handleAction = function (dictMonadAff) {
    var updateCustomViewState1 = updateCustomViewState(dictMonadAff);
    return function (v) {
        if (v instanceof Initialize) {
            return pure(Data_Unit.unit);
        };
        if (v instanceof Receive) {
            return modify_(function (v1) {
                var $95 = {};
                for (var $96 in v1) {
                    if ({}.hasOwnProperty.call(v1, $96)) {
                        $95[$96] = v1[$96];
                    };
                };
                $95.compWidth = v.value0.compWidth;
                $95.compHeight = v.value0.compHeight;
                $95.camera = v.value0.camera;
                $95.layers = v.value0.layers;
                $95.viewOptions = v.value0.viewOptions;
                return $95;
            });
        };
        if (v instanceof SetActiveView) {
            return modify_(function (v1) {
                var $99 = {};
                for (var $100 in v1) {
                    if ({}.hasOwnProperty.call(v1, $100)) {
                        $99[$100] = v1[$100];
                    };
                };
                $99.activeViewIndex = v.value0;
                return $99;
            });
        };
        if (v instanceof UpdateViewType) {
            var v1 = parseViewType(v.value1);
            if (v1 instanceof Data_Maybe.Nothing) {
                return pure(Data_Unit.unit);
            };
            if (v1 instanceof Data_Maybe.Just) {
                return bind(get)(function (state) {
                    var newViews = updateAt(v.value0)(v1.value0)(state.views);
                    return discard(modify_(function (v2) {
                        var $104 = {};
                        for (var $105 in v2) {
                            if ({}.hasOwnProperty.call(v2, $105)) {
                                $104[$105] = v2[$105];
                            };
                        };
                        $104.views = newViews;
                        return $104;
                    }))(function () {
                        return Halogen_Query_HalogenM.raise(new ViewChanged(v.value0, v1.value0));
                    });
                });
            };
            throw new Error("Failed pattern match at Lattice.UI.Components.ViewportRenderer (line 466, column 5 - line 472, column 42): " + [ v1.constructor.name ]);
        };
        if (v instanceof SetLayout) {
            return bind(get)(function (state) {
                var maxIdx = (function () {
                    if (v.value0 instanceof Layout1View) {
                        return 0;
                    };
                    if (v.value0 instanceof Layout2ViewHorizontal) {
                        return 1;
                    };
                    if (v.value0 instanceof Layout2ViewVertical) {
                        return 1;
                    };
                    if (v.value0 instanceof Layout4View) {
                        return 3;
                    };
                    throw new Error("Failed pattern match at Lattice.UI.Components.ViewportRenderer (line 476, column 18 - line 480, column 27): " + [ v.value0.constructor.name ]);
                })();
                return discard(modify_(function (v1) {
                    var $111 = {};
                    for (var $112 in v1) {
                        if ({}.hasOwnProperty.call(v1, $112)) {
                            $111[$112] = v1[$112];
                        };
                    };
                    $111.layout = v.value0;
                    $111.activeViewIndex = min1(state.activeViewIndex)(maxIdx);
                    return $111;
                }))(function () {
                    return Halogen_Query_HalogenM.raise(new LayoutChanged(v.value0));
                });
            });
        };
        if (v instanceof ResetCustomView) {
            return bind(get)(function (state) {
                var newCustom = defaultCustomView(state.compWidth)(state.compHeight);
                if (v.value0 instanceof ViewCustom1) {
                    return discard(modify_(function (v1) {
                        var $119 = {};
                        for (var $120 in v1) {
                            if ({}.hasOwnProperty.call(v1, $120)) {
                                $119[$120] = v1[$120];
                            };
                        };
                        $119.customViews = (function () {
                            var $116 = {};
                            for (var $117 in v1.customViews) {
                                if ({}.hasOwnProperty.call(v1.customViews, $117)) {
                                    $116[$117] = v1["customViews"][$117];
                                };
                            };
                            $116.custom1 = newCustom;
                            return $116;
                        })();
                        return $119;
                    }))(function () {
                        return Halogen_Query_HalogenM.raise(new CustomViewUpdated("custom-1", newCustom));
                    });
                };
                if (v.value0 instanceof ViewCustom2) {
                    return discard(modify_(function (v1) {
                        var $125 = {};
                        for (var $126 in v1) {
                            if ({}.hasOwnProperty.call(v1, $126)) {
                                $125[$126] = v1[$126];
                            };
                        };
                        $125.customViews = (function () {
                            var $122 = {};
                            for (var $123 in v1.customViews) {
                                if ({}.hasOwnProperty.call(v1.customViews, $123)) {
                                    $122[$123] = v1["customViews"][$123];
                                };
                            };
                            $122.custom2 = newCustom;
                            return $122;
                        })();
                        return $125;
                    }))(function () {
                        return Halogen_Query_HalogenM.raise(new CustomViewUpdated("custom-2", newCustom));
                    });
                };
                if (v.value0 instanceof ViewCustom3) {
                    return discard(modify_(function (v1) {
                        var $131 = {};
                        for (var $132 in v1) {
                            if ({}.hasOwnProperty.call(v1, $132)) {
                                $131[$132] = v1[$132];
                            };
                        };
                        $131.customViews = (function () {
                            var $128 = {};
                            for (var $129 in v1.customViews) {
                                if ({}.hasOwnProperty.call(v1.customViews, $129)) {
                                    $128[$129] = v1["customViews"][$129];
                                };
                            };
                            $128.custom3 = newCustom;
                            return $128;
                        })();
                        return $131;
                    }))(function () {
                        return Halogen_Query_HalogenM.raise(new CustomViewUpdated("custom-3", newCustom));
                    });
                };
                return pure(Data_Unit.unit);
            });
        };
        if (v instanceof HandleMouseDown) {
            return modify_(function (v1) {
                var $135 = {};
                for (var $136 in v1) {
                    if ({}.hasOwnProperty.call(v1, $136)) {
                        $135[$136] = v1[$136];
                    };
                };
                $135.isDragging = true;
                $135.dragStartPos = {
                    x: Data_Int.toNumber(v.value2),
                    y: Data_Int.toNumber(v.value3)
                };
                $135.dragViewIndex = v.value0;
                $135.dragButton = v.value1;
                return $135;
            });
        };
        if (v instanceof HandleMouseMove) {
            return bind(get)(function (state) {
                return when(state.isDragging)((function () {
                    var views = activeViews(state);
                    var v1 = Data_Array.index(views)(state.dragViewIndex);
                    if (v1 instanceof Data_Maybe.Nothing) {
                        return pure(Data_Unit.unit);
                    };
                    if (v1 instanceof Data_Maybe.Just) {
                        return when(isCustomView(v1.value0))((function () {
                            var customState = getCustomViewState(state)(v1.value0);
                            var $143 = state.dragButton === 0;
                            if ($143) {
                                var newTheta = customState.orbitTheta + Data_Int.toNumber(v.value0) * 0.5;
                                var newPhi = clamp(1.0)(179.0)(customState.orbitPhi + Data_Int.toNumber(v.value1) * 0.5);
                                var newCustom = {
                                    orbitCenter: customState.orbitCenter,
                                    orbitDistance: customState.orbitDistance,
                                    orthoOffset: customState.orthoOffset,
                                    orthoZoom: customState.orthoZoom,
                                    orbitTheta: newTheta,
                                    orbitPhi: newPhi
                                };
                                return updateCustomViewState1(v1.value0)(newCustom);
                            };
                            var newOffset = {
                                x: customState.orthoOffset.x + Data_Int.toNumber(v.value0),
                                y: customState.orthoOffset.y + Data_Int.toNumber(v.value1)
                            };
                            var newCustom = {
                                orbitCenter: customState.orbitCenter,
                                orbitDistance: customState.orbitDistance,
                                orbitPhi: customState.orbitPhi,
                                orbitTheta: customState.orbitTheta,
                                orthoZoom: customState.orthoZoom,
                                orthoOffset: newOffset
                            };
                            return updateCustomViewState1(v1.value0)(newCustom);
                        })());
                    };
                    throw new Error("Failed pattern match at Lattice.UI.Components.ViewportRenderer (line 514, column 7 - line 533, column 57): " + [ v1.constructor.name ]);
                })());
            });
        };
        if (v instanceof HandleMouseUp) {
            return modify_(function (v1) {
                var $147 = {};
                for (var $148 in v1) {
                    if ({}.hasOwnProperty.call(v1, $148)) {
                        $147[$148] = v1[$148];
                    };
                };
                $147.isDragging = false;
                return $147;
            });
        };
        if (v instanceof HandleWheel) {
            return bind(get)(function (state) {
                var views = activeViews(state);
                var v1 = Data_Array.index(views)(v.value0);
                if (v1 instanceof Data_Maybe.Nothing) {
                    return pure(Data_Unit.unit);
                };
                if (v1 instanceof Data_Maybe.Just) {
                    return when(isCustomView(v1.value0))((function () {
                        var zoomFactor = (function () {
                            var $151 = v.value1 > 0.0;
                            if ($151) {
                                return 1.1;
                            };
                            return 0.9;
                        })();
                        var customState = getCustomViewState(state)(v1.value0);
                        var newDistance = customState.orbitDistance * zoomFactor;
                        var newCustom = {
                            orbitCenter: customState.orbitCenter,
                            orbitPhi: customState.orbitPhi,
                            orbitTheta: customState.orbitTheta,
                            orthoOffset: customState.orthoOffset,
                            orthoZoom: customState.orthoZoom,
                            orbitDistance: newDistance
                        };
                        return updateCustomViewState1(v1.value0)(newCustom);
                    })());
                };
                throw new Error("Failed pattern match at Lattice.UI.Components.ViewportRenderer (line 541, column 5 - line 549, column 51): " + [ v1.constructor.name ]);
            });
        };
        if (v instanceof RenderFrame) {
            return pure(Data_Unit.unit);
        };
        throw new Error("Failed pattern match at Lattice.UI.Components.ViewportRenderer (line 449, column 16 - line 552, column 14): " + [ v.constructor.name ]);
    };
};
var renderViewPanels = function (state) {
    return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "view-panels" ]), Halogen_HTML_Properties.attr("style")(panelsStyle) ])(Data_Array.mapWithIndex(renderViewPanel(state))(activeViews(state)));
};
var render = function (state) {
    return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "viewport-renderer", layoutClass(state.layout) ]), Halogen_HTML_Properties.attr("style")(containerStyle) ])([ renderViewPanels(state), renderLayoutControls(state) ]);
};
var component = function (dictMonadAff) {
    return Halogen_Component.mkComponent({
        initialState: initialState,
        render: render,
        "eval": Halogen_Component.mkEval({
            handleQuery: Halogen_Component.defaultEval.handleQuery,
            finalize: Halogen_Component.defaultEval.finalize,
            handleAction: handleAction(dictMonadAff),
            initialize: new Data_Maybe.Just(Initialize.value),
            receive: function ($155) {
                return Data_Maybe.Just.create(Receive.create($155));
            }
        })
    });
};
export {
    component,
    ViewChanged,
    LayoutChanged,
    CustomViewUpdated,
    ViewActiveCamera,
    ViewCustom1,
    ViewCustom2,
    ViewCustom3,
    ViewFront,
    ViewBack,
    ViewLeft,
    ViewRight,
    ViewTop,
    ViewBottom,
    Layout1View,
    Layout2ViewHorizontal,
    Layout2ViewVertical,
    Layout4View,
    eqViewType,
    showViewType,
    eqViewLayout
};
//# sourceMappingURL=index.js.map
