// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordInt);
var min = /* #__PURE__ */ Data_Ord.min(Data_Ord.ordInt);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var RadialSpin = /* #__PURE__ */ (function () {
    function RadialSpin() {

    };
    RadialSpin.value = new RadialSpin();
    return RadialSpin;
})();
var RadialZoom = /* #__PURE__ */ (function () {
    function RadialZoom() {

    };
    RadialZoom.value = new RadialZoom();
    return RadialZoom;
})();
var showRadialType = {
    show: function (v) {
        if (v instanceof RadialSpin) {
            return "RadialSpin";
        };
        if (v instanceof RadialZoom) {
            return "RadialZoom";
        };
        throw new Error("Failed pattern match at Lattice.Services.Effects.BlurDirectional (line 58, column 1 - line 60, column 33): " + [ v.constructor.name ]);
    }
};
var sharpenWithThreshold = function (params) {
    return function (original) {
        return function (sharpened) {
            var threshold = Data_Int.toNumber(params.threshold) / 255.0;
            var diff = Data_Number.abs(sharpened - original);
            var $19 = diff < threshold;
            if ($19) {
                return original;
            };
            return sharpened;
        };
    };
};
var radialOffset = function (params) {
    return function (x) {
        return function (y) {
            return function (sampleIdx) {
                var samples = max(1)(params.samples);
                var t = Data_Int.toNumber(sampleIdx) / Data_Int.toNumber(samples - 1 | 0) - 0.5;
                var dy$prime = y - params.centerY;
                var dx$prime = x - params.centerX;
                var dist = Data_Number.sqrt(dx$prime * dx$prime + dy$prime * dy$prime);
                var amount = params.amount / 100.0;
                var v = (function () {
                    if (params.radialType instanceof RadialZoom) {
                        return {
                            offsetX: dx$prime * amount * t,
                            offsetY: dy$prime * amount * t
                        };
                    };
                    if (params.radialType instanceof RadialSpin) {
                        var angle = Data_Number.atan2(dy$prime)(dx$prime);
                        var spinAngle = angle + amount * t;
                        return {
                            offsetX: Data_Number.cos(spinAngle) * dist - dx$prime,
                            offsetY: Data_Number.sin(spinAngle) * dist - dy$prime
                        };
                    };
                    throw new Error("Failed pattern match at Lattice.Services.Effects.BlurDirectional (line 174, column 30 - line 181, column 60): " + [ params.radialType.constructor.name ]);
                })();
                var weight = 1.0 / Data_Int.toNumber(samples);
                return {
                    dx: v.offsetX,
                    dy: v.offsetY,
                    weight: weight
                };
            };
        };
    };
};
var normalizeAngle = function (angle) {
    var twoPi = 2.0 * Data_Number.pi;
    var a = angle - twoPi * Data_Int.toNumber(Data_Int.floor(angle / twoPi));
    var $24 = a < 0.0;
    if ($24) {
        return a + twoPi;
    };
    return a;
};
var eqRadialType = {
    eq: function (x) {
        return function (y) {
            if (x instanceof RadialSpin && y instanceof RadialSpin) {
                return true;
            };
            if (x instanceof RadialZoom && y instanceof RadialZoom) {
                return true;
            };
            return false;
        };
    }
};
var distance2D = function (x1) {
    return function (y1) {
        return function (x2) {
            return function (y2) {
                var dy = y2 - y1;
                var dx = x2 - x1;
                return Data_Number.sqrt(dx * dx + dy * dy);
            };
        };
    };
};
var directionalOffset = function (params) {
    return function (sampleIdx) {
        var samples = max(1)(params.samples);
        var t = Data_Int.toNumber(sampleIdx) / Data_Int.toNumber(samples - 1 | 0) - 0.5;
        var weight = 1.0 / Data_Int.toNumber(samples);
        var dx = Data_Number.cos(params.angle) * params.distance * t;
        var dy = Data_Number.sin(params.angle) * params.distance * t;
        return {
            dx: dx,
            dy: dy,
            weight: weight
        };
    };
};
var defaultSharpenParams = {
    amount: 100.0,
    radius: 1,
    threshold: 0
};
var defaultRadialParams = /* #__PURE__ */ (function () {
    return {
        centerX: 0.5,
        centerY: 0.5,
        amount: 10.0,
        samples: 16,
        radialType: RadialZoom.value
    };
})();
var defaultDirectionalParams = {
    angle: 0.0,
    distance: 10.0,
    samples: 16
};
var defaultBoxParams = {
    radiusX: 5,
    radiusY: 5
};
var clampInt = function (lo) {
    return function (hi) {
        return function (x) {
            return max(lo)(min(hi)(x));
        };
    };
};
var sharpenKernel = function (params) {
    var r = clampInt(1)(10)(params.radius);
    var size = (r * 2 | 0) + 1 | 0;
    var blurWeight = 1.0 / Data_Int.toNumber(size * size | 0);
    var amount = params.amount / 100.0;
    var centerWeight = 1.0 + amount * (1.0 - blurWeight);
    var neighborWeight = -amount * blurWeight;
    var mkRow = function (i) {
        return map(function (j) {
            var $27 = i === r && j === r;
            if ($27) {
                return centerWeight;
            };
            return neighborWeight;
        })(Data_Array.range(0)(size - 1 | 0));
    };
    return map(mkRow)(Data_Array.range(0)(size - 1 | 0));
};
var boxBlurKernel = function (params) {
    var ry = clampInt(1)(250)(params.radiusY);
    var rx = clampInt(1)(250)(params.radiusX);
    var width = (rx * 2 | 0) + 1 | 0;
    var height = (ry * 2 | 0) + 1 | 0;
    var total = Data_Int.toNumber(width * height | 0);
    var weight = 1.0 / total;
    return Data_Array.replicate(height)(Data_Array.replicate(width)(weight));
};
export {
    RadialSpin,
    RadialZoom,
    defaultDirectionalParams,
    defaultRadialParams,
    defaultBoxParams,
    defaultSharpenParams,
    directionalOffset,
    radialOffset,
    boxBlurKernel,
    sharpenKernel,
    normalizeAngle,
    distance2D,
    sharpenWithThreshold,
    eqRadialType,
    showRadialType
};
//# sourceMappingURL=index.js.map
