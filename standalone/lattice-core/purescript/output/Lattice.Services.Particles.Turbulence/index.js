// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Tuple from "../Data.Tuple/index.js";
import * as $$Math from "../Math/index.js";
var TurbulenceNormal = /* #__PURE__ */ (function () {
    function TurbulenceNormal() {

    };
    TurbulenceNormal.value = new TurbulenceNormal();
    return TurbulenceNormal;
})();
var TurbulenceCurl = /* #__PURE__ */ (function () {
    function TurbulenceCurl() {

    };
    TurbulenceCurl.value = new TurbulenceCurl();
    return TurbulenceCurl;
})();
var TurbulenceDirected = /* #__PURE__ */ (function () {
    function TurbulenceDirected() {

    };
    TurbulenceDirected.value = new TurbulenceDirected();
    return TurbulenceDirected;
})();
var turbulenceInBounds = function (px) {
    return function (py) {
        return function (config) {
            var dy = config.y - py;
            var dx = config.x - px;
            var dist = $$Math.sqrt(dx * dx + dy * dy);
            return dist < config.radius;
        };
    };
};
var showTurbulenceType = {
    show: function (v) {
        if (v instanceof TurbulenceNormal) {
            return "TurbulenceNormal";
        };
        if (v instanceof TurbulenceCurl) {
            return "TurbulenceCurl";
        };
        if (v instanceof TurbulenceDirected) {
            return "TurbulenceDirected";
        };
        throw new Error("Failed pattern match at Lattice.Services.Particles.Turbulence (line 49, column 1 - line 52, column 49): " + [ v.constructor.name ]);
    }
};
var multiOctaveNoise = function (persistence) {
    return function (octaves) {
        var withAmplitude = function (octaveArr) {
            var indexed = Data_Array.mapWithIndex(function (i) {
                return function (n) {
                    return {
                        noise: n,
                        amp: $$Math.pow(persistence)(Data_Int.toNumber(i))
                    };
                };
            })(octaveArr);
            return indexed;
        };
        var combine = function (v) {
            return function (v1) {
                return new Data_Tuple.Tuple(v.value0 + v1.noise.value0 * v1.amp, v.value1 + v1.noise.value1 * v1.amp);
            };
        };
        return Data_Array.foldl(combine)(new Data_Tuple.Tuple(0.0, 0.0))(withAmplitude(octaves));
    };
};
var eqTurbulenceType = {
    eq: function (x) {
        return function (y) {
            if (x instanceof TurbulenceNormal && y instanceof TurbulenceNormal) {
                return true;
            };
            if (x instanceof TurbulenceCurl && y instanceof TurbulenceCurl) {
                return true;
            };
            if (x instanceof TurbulenceDirected && y instanceof TurbulenceDirected) {
                return true;
            };
            return false;
        };
    }
};
var defaultTurbulenceConfig = /* #__PURE__ */ (function () {
    return {
        x: 0.5,
        y: 0.5,
        radius: 0.5,
        strength: 1.0,
        frequency: 4.0,
        octaves: 4,
        persistence: 0.5,
        lacunarity: 2.0,
        turbulenceType: TurbulenceNormal.value,
        evolutionSpeed: 1.0e-2,
        enabled: true
    };
})();
var curlGradient = function (gradX) {
    return function (gradY) {
        return new Data_Tuple.Tuple(-gradY, gradX);
    };
};
var turbulenceForce = function (px) {
    return function (py) {
        return function (config) {
            return function (noiseX) {
                return function (noiseY) {
                    return function (deltaTime) {
                        var $24 = !config.enabled || !turbulenceInBounds(px)(py)(config);
                        if ($24) {
                            return {
                                x: 0.0,
                                y: 0.0
                            };
                        };
                        var safeRadius = $$Math.max(1.0e-3)(config.radius);
                        var dy = config.y - py;
                        var dx = config.x - px;
                        var dist = $$Math.sqrt(dx * dx + dy * dy);
                        var influence = 1.0 - dist / safeRadius;
                        var strength = config.strength * 1.0e-4 * influence;
                        if (config.turbulenceType instanceof TurbulenceNormal) {
                            return {
                                x: noiseX * strength * deltaTime,
                                y: noiseY * strength * deltaTime
                            };
                        };
                        if (config.turbulenceType instanceof TurbulenceCurl) {
                            var curl = curlGradient(noiseX)(noiseY);
                            return {
                                x: Data_Tuple.fst(curl) * strength * deltaTime,
                                y: Data_Tuple.snd(curl) * strength * deltaTime
                            };
                        };
                        if (config.turbulenceType instanceof TurbulenceDirected) {
                            return {
                                x: noiseX * strength * deltaTime,
                                y: noiseY * strength * deltaTime
                            };
                        };
                        throw new Error("Failed pattern match at Lattice.Services.Particles.Turbulence (line 116, column 7 - line 130, column 12): " + [ config.turbulenceType.constructor.name ]);
                    };
                };
            };
        };
    };
};
export {
    TurbulenceNormal,
    TurbulenceCurl,
    TurbulenceDirected,
    defaultTurbulenceConfig,
    turbulenceForce,
    turbulenceInBounds,
    multiOctaveNoise,
    curlGradient,
    eqTurbulenceType,
    showTurbulenceType
};
//# sourceMappingURL=index.js.map
