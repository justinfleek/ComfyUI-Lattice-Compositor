{"comments":"Lattice.Services.AI.StateSerializer - Prompt injection defense\n\nPure functions for sanitizing user data before sending to LLMs:\n- Control character removal\n- Whitespace normalization\n- Length truncation\n- Security boundary wrapping\n- Serialization mode recommendation\n\nSource: ui/src/services/ai/stateSerializer.ts\n","declarations":[{"children":[],"comments":"Sanitize a string for safe inclusion in LLM prompts.\n\n1. Remove control characters (keep no newlines -- they get collapsed)\n2. Collapse \\r\\n and multiple whitespace to single space\n3. Trim leading/trailing whitespace\n4. Truncate to maxLength, appending \"...\" if truncated\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"String"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"Int"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[["Prim"],"String"],"tag":"TypeConstructor"}],"tag":"TypeApp"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[88,42],"name":"src/Lattice/Services/AI/StateSerializer.purs","start":[88,1]},"title":"sanitizeForLLM"},{"children":[],"comments":"Sanitize text content for inclusion in serialized state.\n\nSimilar to sanitizeForLLM but:\n- Keeps newlines (\\n) for text formatting\n- Uses a fixed 1000 character limit\n- Appends \"...[truncated]\" if truncated\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"String"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[["Prim"],"String"],"tag":"TypeConstructor"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[112,40],"name":"src/Lattice/Services/AI/StateSerializer.purs","start":[112,1]},"title":"sanitizeTextContent"},{"children":[],"comments":"Wrap a JSON string in security boundary tags.\n\nThe boundary instructs the LLM to treat the enclosed content\nas untrusted data values, never as instructions.\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"String"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[["Prim"],"String"],"tag":"TypeConstructor"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[128,43],"name":"src/Lattice/Services/AI/StateSerializer.purs","start":[128,1]},"title":"wrapInSecurityBoundary"},{"children":[],"comments":"Check if a user request requires full data access.\n\nReturns true if the lowercased request contains any keyword\nthat implies the user needs to see actual data values\n(text content, parameter values, colors, fonts, etc.)\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"String"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[["Prim"],"Boolean"],"tag":"TypeConstructor"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[142,44],"name":"src/Lattice/Services/AI/StateSerializer.purs","start":[142,1]},"title":"requiresFullDataAccess"},{"children":[],"comments":"Get the recommended serialization mode for a user request.\n\nReturns Full if the request needs data values, Minimal otherwise.\n","info":{"declType":"value","type":{"annotation":[],"contents":[{"annotation":[],"contents":[{"annotation":[],"contents":[["Prim"],"Function"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Prim"],"String"],"tag":"TypeConstructor"}],"tag":"TypeApp"},{"annotation":[],"contents":[["Lattice","Services","AI","StateSerializer"],"SerializationMode"],"tag":"TypeConstructor"}],"tag":"TypeApp"}},"kind":null,"sourceSpan":{"end":[168,63],"name":"src/Lattice/Services/AI/StateSerializer.purs","start":[168,1]},"title":"getRecommendedSerializationMode"},{"children":[{"comments":null,"info":{"arguments":[],"declType":"dataConstructor"},"sourceSpan":{"end":[35,33],"name":"src/Lattice/Services/AI/StateSerializer.purs","start":[35,24]},"title":"Minimal"},{"comments":null,"info":{"arguments":[],"declType":"dataConstructor"},"sourceSpan":{"end":[35,40],"name":"src/Lattice/Services/AI/StateSerializer.purs","start":[35,34]},"title":"Full"},{"comments":null,"info":{"declType":"instance","dependencies":[],"type":{"annotation":[],"contents":[{"annotation":[],"contents":[["Data","Eq"],"Eq"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Lattice","Services","AI","StateSerializer"],"SerializationMode"],"tag":"TypeConstructor"}],"tag":"TypeApp"}},"sourceSpan":{"end":[37,60],"name":"src/Lattice/Services/AI/StateSerializer.purs","start":[37,1]},"title":"eqSerializationMode"},{"comments":null,"info":{"declType":"instance","dependencies":[],"type":{"annotation":[],"contents":[{"annotation":[],"contents":[["Data","Show"],"Show"],"tag":"TypeConstructor"},{"annotation":[],"contents":[["Lattice","Services","AI","StateSerializer"],"SerializationMode"],"tag":"TypeConstructor"}],"tag":"TypeApp"}},"sourceSpan":{"end":[41,21],"name":"src/Lattice/Services/AI/StateSerializer.purs","start":[39,1]},"title":"showSerializationMode"}],"comments":"Serialization mode: minimal sends less data, full sends everything\n","info":{"dataDeclType":"data","declType":"data","roles":[],"typeArguments":[]},"kind":null,"sourceSpan":{"end":[35,40],"name":"src/Lattice/Services/AI/StateSerializer.purs","start":[35,1]},"title":"SerializationMode"}],"name":"Lattice.Services.AI.StateSerializer","reExports":[]}