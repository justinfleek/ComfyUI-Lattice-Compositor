// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Control_Monad_State_Class from "../Control.Monad.State.Class/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Halogen_Component from "../Halogen.Component/index.js";
import * as Halogen_HTML_Core from "../Halogen.HTML.Core/index.js";
import * as Halogen_HTML_Elements from "../Halogen.HTML.Elements/index.js";
import * as Halogen_HTML_Events from "../Halogen.HTML.Events/index.js";
import * as Halogen_HTML_Properties from "../Halogen.HTML.Properties/index.js";
import * as Halogen_Query_HalogenM from "../Halogen.Query.HalogenM/index.js";
import * as Lattice_Services_GLSL_Engine from "../Lattice.Services.GLSL.Engine/index.js";
import * as Lattice_UI_Core from "../Lattice.UI.Core/index.js";
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var show1 = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordNumber);
var min = /* #__PURE__ */ Data_Ord.min(Data_Ord.ordNumber);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM);
var modify_ = /* #__PURE__ */ Control_Monad_State_Class.modify_(Halogen_Query_HalogenM.monadStateHalogenM);
var bind = /* #__PURE__ */ Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM);
var get = /* #__PURE__ */ Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM);
var pure = /* #__PURE__ */ Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM);
var when = /* #__PURE__ */ Control_Applicative.when(Halogen_Query_HalogenM.applicativeHalogenM);
var CanvasReady = /* #__PURE__ */ (function () {
    function CanvasReady() {

    };
    CanvasReady.value = new CanvasReady();
    return CanvasReady;
})();
var CanvasResized = /* #__PURE__ */ (function () {
    function CanvasResized(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    CanvasResized.create = function (value0) {
        return function (value1) {
            return new CanvasResized(value0, value1);
        };
    };
    return CanvasResized;
})();
var RenderFrame = /* #__PURE__ */ (function () {
    function RenderFrame(value0) {
        this.value0 = value0;
    };
    RenderFrame.create = function (value0) {
        return new RenderFrame(value0);
    };
    return RenderFrame;
})();
var Initialize = /* #__PURE__ */ (function () {
    function Initialize() {

    };
    Initialize.value = new Initialize();
    return Initialize;
})();
var Receive = /* #__PURE__ */ (function () {
    function Receive(value0) {
        this.value0 = value0;
    };
    Receive.create = function (value0) {
        return new Receive(value0);
    };
    return Receive;
})();
var HandleCanvasRef = /* #__PURE__ */ (function () {
    function HandleCanvasRef(value0) {
        this.value0 = value0;
    };
    HandleCanvasRef.create = function (value0) {
        return new HandleCanvasRef(value0);
    };
    return HandleCanvasRef;
})();
var HandleMouseDown = /* #__PURE__ */ (function () {
    function HandleMouseDown(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    HandleMouseDown.create = function (value0) {
        return function (value1) {
            return new HandleMouseDown(value0, value1);
        };
    };
    return HandleMouseDown;
})();
var HandleMouseMove = /* #__PURE__ */ (function () {
    function HandleMouseMove(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    HandleMouseMove.create = function (value0) {
        return function (value1) {
            return new HandleMouseMove(value0, value1);
        };
    };
    return HandleMouseMove;
})();
var HandleMouseUp = /* #__PURE__ */ (function () {
    function HandleMouseUp() {

    };
    HandleMouseUp.value = new HandleMouseUp();
    return HandleMouseUp;
})();
var HandleWheel = /* #__PURE__ */ (function () {
    function HandleWheel(value0) {
        this.value0 = value0;
    };
    HandleWheel.create = function (value0) {
        return new HandleWheel(value0);
    };
    return HandleWheel;
})();
var ZoomIn = /* #__PURE__ */ (function () {
    function ZoomIn() {

    };
    ZoomIn.value = new ZoomIn();
    return ZoomIn;
})();
var ZoomOut = /* #__PURE__ */ (function () {
    function ZoomOut() {

    };
    ZoomOut.value = new ZoomOut();
    return ZoomOut;
})();
var ResetView = /* #__PURE__ */ (function () {
    function ResetView() {

    };
    ResetView.value = new ResetView();
    return ResetView;
})();
var wrapperStyle = /* #__PURE__ */ (function () {
    return "flex: 1; position: relative; display: flex; " + "align-items: center; justify-content: center; overflow: hidden;";
})();
var toolbarStyle = /* #__PURE__ */ (function () {
    return "display: flex; align-items: center; gap: var(--lattice-space-2); " + ("padding: var(--lattice-space-2); background: var(--lattice-surface-1); " + "border-bottom: 1px solid var(--lattice-border-subtle);");
})();
var statusStyle = /* #__PURE__ */ (function () {
    return "display: flex; align-items: center; gap: var(--lattice-space-2); " + ("padding: var(--lattice-space-1) var(--lattice-space-2); " + ("background: var(--lattice-surface-1); font-size: var(--lattice-text-xs); " + "color: var(--lattice-text-muted); border-top: 1px solid var(--lattice-border-subtle);"));
})();
var renderToolbar = function (state) {
    return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-canvas-toolbar" ]), Halogen_HTML_Properties.attr("style")(toolbarStyle) ])([ Halogen_HTML_Elements.button([ Lattice_UI_Core.cls([ "lattice-canvas-btn" ]), Halogen_HTML_Events.onClick(function (v) {
        return ZoomOut.value;
    }), Halogen_HTML_Properties.title("Zoom Out") ])([ Halogen_HTML_Core.text("-") ]), Halogen_HTML_Elements.span([ Lattice_UI_Core.cls([ "lattice-zoom-level" ]) ])([ Halogen_HTML_Core.text(show(state.zoom * 100.0) + "%") ]), Halogen_HTML_Elements.button([ Lattice_UI_Core.cls([ "lattice-canvas-btn" ]), Halogen_HTML_Events.onClick(function (v) {
        return ZoomIn.value;
    }), Halogen_HTML_Properties.title("Zoom In") ])([ Halogen_HTML_Core.text("+") ]), Halogen_HTML_Elements.button([ Lattice_UI_Core.cls([ "lattice-canvas-btn" ]), Halogen_HTML_Events.onClick(function (v) {
        return ResetView.value;
    }), Halogen_HTML_Properties.title("Reset View") ])([ Halogen_HTML_Core.text("\u27f2") ]) ]);
};
var renderStatusBar = function (state) {
    return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-canvas-status" ]), Halogen_HTML_Properties.attr("style")(statusStyle) ])([ Halogen_HTML_Elements.span_([ Halogen_HTML_Core.text(show1(state.width) + (" \xd7 " + show1(state.height))) ]), Halogen_HTML_Elements.span_([ Halogen_HTML_Core.text(" | ") ]), Halogen_HTML_Elements.span_([ Halogen_HTML_Core.text("Zoom: " + (show(state.zoom * 100.0) + "%")) ]) ]);
};
var placeholderStyle = /* #__PURE__ */ (function () {
    return "position: absolute; inset: 0; display: flex; " + ("align-items: center; justify-content: center; " + "background: var(--lattice-surface-0); text-align: center;");
})();
var renderPlaceholder = function (state) {
    return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-canvas-placeholder" ]), Halogen_HTML_Properties.attr("style")(placeholderStyle) ])([ Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-placeholder-content" ]) ])([ Halogen_HTML_Elements.span([ Lattice_UI_Core.cls([ "lattice-placeholder-icon" ]) ])([ Halogen_HTML_Core.text("\ud83c\udfac") ]), Halogen_HTML_Elements.p_([ Halogen_HTML_Core.text("Canvas") ]), Halogen_HTML_Elements.p([ Lattice_UI_Core.cls([ "lattice-text-muted" ]) ])([ Halogen_HTML_Core.text(show1(state.width) + (" \xd7 " + show1(state.height))) ]) ]) ]);
};
var initialState = function (input) {
    return {
        width: input.width,
        height: input.height,
        backgroundColor: input.backgroundColor,
        isInitialized: false,
        zoom: 1.0,
        panX: 0.0,
        panY: 0.0,
        isDragging: false,
        glslEngineConfig: Data_Maybe.Nothing.value,
        webglAvailable: false,
        currentFrame: 0,
        time: 0.0
    };
};
var containerStyle = /* #__PURE__ */ (function () {
    return "display: flex; flex-direction: column; flex: 1; " + "background: var(--lattice-void); overflow: hidden;";
})();
var clamp = function (minVal) {
    return function (maxVal) {
        return function (val) {
            return max(minVal)(min(maxVal)(val));
        };
    };
};
var handleAction = function (dictMonadAff) {
    return function (v) {
        if (v instanceof Initialize) {
            return discard(modify_(function (v1) {
                var $35 = {};
                for (var $36 in v1) {
                    if ({}.hasOwnProperty.call(v1, $36)) {
                        $35[$36] = v1[$36];
                    };
                };
                $35.glslEngineConfig = new Data_Maybe.Just(Lattice_Services_GLSL_Engine.defaultEngineConfig);
                $35.webglAvailable = true;
                $35.isInitialized = true;
                return $35;
            }))(function () {
                return Halogen_Query_HalogenM.raise(CanvasReady.value);
            });
        };
        if (v instanceof Receive) {
            return discard(modify_(function (v1) {
                var $38 = {};
                for (var $39 in v1) {
                    if ({}.hasOwnProperty.call(v1, $39)) {
                        $38[$39] = v1[$39];
                    };
                };
                $38.width = v.value0.width;
                $38.height = v.value0.height;
                $38.backgroundColor = v.value0.backgroundColor;
                return $38;
            }))(function () {
                return bind(get)(function (state) {
                    return Halogen_Query_HalogenM.raise(new CanvasResized(state.width, state.height));
                });
            });
        };
        if (v instanceof HandleCanvasRef) {
            return pure(Data_Unit.unit);
        };
        if (v instanceof HandleMouseDown) {
            return modify_(function (v1) {
                var $43 = {};
                for (var $44 in v1) {
                    if ({}.hasOwnProperty.call(v1, $44)) {
                        $43[$44] = v1[$44];
                    };
                };
                $43.isDragging = true;
                return $43;
            });
        };
        if (v instanceof HandleMouseMove) {
            return bind(get)(function (state) {
                return when(state.isDragging)(modify_(function (v1) {
                    var $48 = {};
                    for (var $49 in v1) {
                        if ({}.hasOwnProperty.call(v1, $49)) {
                            $48[$49] = v1[$49];
                        };
                    };
                    $48.panX = state.panX + v.value0;
                    $48.panY = state.panY + v.value1;
                    return $48;
                }));
            });
        };
        if (v instanceof HandleMouseUp) {
            return modify_(function (v1) {
                var $53 = {};
                for (var $54 in v1) {
                    if ({}.hasOwnProperty.call(v1, $54)) {
                        $53[$54] = v1[$54];
                    };
                };
                $53.isDragging = false;
                return $53;
            });
        };
        if (v instanceof HandleWheel) {
            return bind(get)(function (state) {
                var newZoom = clamp(0.1)(10.0)(state.zoom + v.value0 * 1.0e-3);
                return modify_(function (v1) {
                    var $56 = {};
                    for (var $57 in v1) {
                        if ({}.hasOwnProperty.call(v1, $57)) {
                            $56[$57] = v1[$57];
                        };
                    };
                    $56.zoom = newZoom;
                    return $56;
                });
            });
        };
        if (v instanceof ZoomIn) {
            return bind(get)(function (state) {
                var newZoom = min(10.0)(state.zoom * 1.25);
                return modify_(function (v1) {
                    var $60 = {};
                    for (var $61 in v1) {
                        if ({}.hasOwnProperty.call(v1, $61)) {
                            $60[$61] = v1[$61];
                        };
                    };
                    $60.zoom = newZoom;
                    return $60;
                });
            });
        };
        if (v instanceof ZoomOut) {
            return bind(get)(function (state) {
                var newZoom = max(0.1)(state.zoom / 1.25);
                return modify_(function (v1) {
                    var $63 = {};
                    for (var $64 in v1) {
                        if ({}.hasOwnProperty.call(v1, $64)) {
                            $63[$64] = v1[$64];
                        };
                    };
                    $63.zoom = newZoom;
                    return $63;
                });
            });
        };
        if (v instanceof ResetView) {
            return modify_(function (v1) {
                var $66 = {};
                for (var $67 in v1) {
                    if ({}.hasOwnProperty.call(v1, $67)) {
                        $66[$67] = v1[$67];
                    };
                };
                $66.zoom = 1.0;
                $66.panX = 0.0;
                $66.panY = 0.0;
                return $66;
            });
        };
        throw new Error("Failed pattern match at Lattice.UI.Components.WebGLCanvas (line 201, column 16 - line 244, column 66): " + [ v.constructor.name ]);
    };
};
var canvasStyle = function (state) {
    return "transform: scale(" + (show(state.zoom) + (") " + ("translate(" + (show(state.panX) + ("px, " + (show(state.panY) + ("px); " + ("transform-origin: center; image-rendering: pixelated; " + "box-shadow: 0 4px 20px rgba(0,0,0,0.5);"))))))));
};
var render = function (state) {
    return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-webgl-container" ]), Halogen_HTML_Properties.attr("style")(containerStyle) ])([ renderToolbar(state), Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-canvas-wrapper" ]), Halogen_HTML_Properties.attr("style")(wrapperStyle) ])([ Halogen_HTML_Elements.canvas([ Lattice_UI_Core.cls([ "lattice-webgl-canvas" ]), Halogen_HTML_Properties.id("lattice-webgl"), Halogen_HTML_Properties.width(state.width), Halogen_HTML_Properties.height(state.height), Halogen_HTML_Properties.attr("style")(canvasStyle(state)) ]), (function () {
        var $69 = !state.isInitialized;
        if ($69) {
            return renderPlaceholder(state);
        };
        return Halogen_HTML_Core.text("");
    })() ]), renderStatusBar(state) ]);
};
var component = function (dictMonadAff) {
    return Halogen_Component.mkComponent({
        initialState: initialState,
        render: render,
        "eval": Halogen_Component.mkEval({
            handleQuery: Halogen_Component.defaultEval.handleQuery,
            finalize: Halogen_Component.defaultEval.finalize,
            handleAction: handleAction(dictMonadAff),
            initialize: new Data_Maybe.Just(Initialize.value),
            receive: function ($70) {
                return Data_Maybe.Just.create(Receive.create($70));
            }
        })
    });
};
export {
    CanvasReady,
    CanvasResized,
    RenderFrame,
    Initialize,
    Receive,
    HandleCanvasRef,
    HandleMouseDown,
    HandleMouseMove,
    HandleMouseUp,
    HandleWheel,
    ZoomIn,
    ZoomOut,
    ResetView,
    component,
    initialState,
    render,
    renderToolbar,
    renderPlaceholder,
    renderStatusBar,
    containerStyle,
    toolbarStyle,
    wrapperStyle,
    canvasStyle,
    placeholderStyle,
    statusStyle,
    handleAction,
    clamp
};
//# sourceMappingURL=index.js.map
