// Generated by purs version 0.15.15
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Identity from "../Data.Identity/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Effect_Aff from "../Effect.Aff/index.js";
import * as Lattice_Services_Math3D_Mat4 from "../Lattice.Services.Math3D.Mat4/index.js";
import * as Lattice_Services_Math3D_Quat from "../Lattice.Services.Math3D.Quat/index.js";
import * as Lattice_Services_Math3D_Vec3 from "../Lattice.Services.Math3D.Vec3/index.js";
import * as $$Math from "../Math/index.js";
import * as Test_Lattice_TestHelpers from "../Test.Lattice.TestHelpers/index.js";
import * as Test_Spec from "../Test.Spec/index.js";
import * as Test_Spec_Assertions from "../Test.Spec.Assertions/index.js";
var describe = /* #__PURE__ */ Test_Spec.describe(Data_Identity.monadIdentity);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit);
var discard1 = /* #__PURE__ */ discard(/* #__PURE__ */ Test_Spec.bindSpecT(Data_Identity.bindIdentity));
var it = /* #__PURE__ */ Test_Spec.it(Data_Identity.monadIdentity)(Test_Spec.exampleMUnit);
var shouldEqual = /* #__PURE__ */ Test_Spec_Assertions.shouldEqual(Effect_Aff.monadThrowAff);
var shouldEqual1 = /* #__PURE__ */ shouldEqual(/* #__PURE__ */ Data_Show.showArray(Data_Show.showBoolean))(/* #__PURE__ */ Data_Eq.eqArray(Data_Eq.eqBoolean));
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var eq1 = /* #__PURE__ */ Data_Eq.eq(Lattice_Services_Math3D_Vec3.eqVec3);
var shouldEqual2 = /* #__PURE__ */ shouldEqual(Lattice_Services_Math3D_Vec3.showVec3)(Lattice_Services_Math3D_Vec3.eqVec3);
var shouldEqual3 = /* #__PURE__ */ shouldEqual(Data_Show.showBoolean)(Data_Eq.eqBoolean);
var shouldEqual4 = /* #__PURE__ */ shouldEqual(Lattice_Services_Math3D_Quat.showQuat)(Lattice_Services_Math3D_Quat.eqQuat);
var discard2 = /* #__PURE__ */ discard(Effect_Aff.bindAff);
var shouldEqual5 = /* #__PURE__ */ shouldEqual(Data_Show.showNumber)(Data_Eq.eqNumber);
var vec3Close = function (v) {
    return function (v1) {
        return function (eps) {
            return $$Math.abs(v.x - v1.x) < eps && ($$Math.abs(v.y - v1.y) < eps && $$Math.abs(v.z - v1.z) < eps);
        };
    };
};
var strictTol = 1.0e-10;
var quatClose = function (v) {
    return function (v1) {
        return function (eps) {
            var negated = $$Math.abs(v.x + v1.x) < eps && ($$Math.abs(v.y + v1.y) < eps && ($$Math.abs(v.z + v1.z) < eps && $$Math.abs(v.w + v1.w) < eps));
            var direct = $$Math.abs(v.x - v1.x) < eps && ($$Math.abs(v.y - v1.y) < eps && ($$Math.abs(v.z - v1.z) < eps && $$Math.abs(v.w - v1.w) < eps));
            return direct || negated;
        };
    };
};
var mat4Close = function (v) {
    return function (v1) {
        return function (eps) {
            return $$Math.abs(v.m00 - v1.m00) < eps && ($$Math.abs(v.m10 - v1.m10) < eps && ($$Math.abs(v.m20 - v1.m20) < eps && ($$Math.abs(v.m30 - v1.m30) < eps && ($$Math.abs(v.m01 - v1.m01) < eps && ($$Math.abs(v.m11 - v1.m11) < eps && ($$Math.abs(v.m21 - v1.m21) < eps && ($$Math.abs(v.m31 - v1.m31) < eps && ($$Math.abs(v.m02 - v1.m02) < eps && ($$Math.abs(v.m12 - v1.m12) < eps && ($$Math.abs(v.m22 - v1.m22) < eps && ($$Math.abs(v.m32 - v1.m32) < eps && ($$Math.abs(v.m03 - v1.m03) < eps && ($$Math.abs(v.m13 - v1.m13) < eps && ($$Math.abs(v.m23 - v1.m23) < eps && $$Math.abs(v.m33 - v1.m33) < eps))))))))))))));
        };
    };
};
var isFiniteNum = function (n) {
    return n === n && (n !== 1.0 / 0.0 && n !== -(1.0 / 0.0));
};
var float32Tol = 1.0e-5;
var spec = /* #__PURE__ */ describe("STRICT: Transform Properties")(/* #__PURE__ */ discard1(/* #__PURE__ */ describe("Vector3 Operations")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("addition is commutative: a + b = b + a")(/* #__PURE__ */ (function () {
    var pairs = [ {
        a: Lattice_Services_Math3D_Vec3.vec3(1.0)(2.0)(3.0),
        b: Lattice_Services_Math3D_Vec3.vec3(4.0)(5.0)(6.0)
    }, {
        a: Lattice_Services_Math3D_Vec3.vec3(-1.0)(0.0)(1.0),
        b: Lattice_Services_Math3D_Vec3.vec3(100.0)(-50.0)(0.0)
    }, {
        a: Lattice_Services_Math3D_Vec3.vec3(1.0e-3)(2.0e-3)(3.0e-3),
        b: Lattice_Services_Math3D_Vec3.vec3(1000.0)(2000.0)(3000.0)
    } ];
    return shouldEqual1(map(function (p) {
        return eq1(Lattice_Services_Math3D_Vec3.add(p.a)(p.b))(Lattice_Services_Math3D_Vec3.add(p.b)(p.a));
    })(pairs))([ true, true, true ]);
})()))(function () {
    return discard1(it("subtraction inverse: a - a = zero")((function () {
        var vecs = [ Lattice_Services_Math3D_Vec3.vec3(1.0)(2.0)(3.0), Lattice_Services_Math3D_Vec3.vec3(-100.0)(50.0)(0.0), Lattice_Services_Math3D_Vec3.vec3(1.0e-3)(2.0e-3)(3.0e-3) ];
        return shouldEqual1(map(function (v) {
            return vec3Close(Lattice_Services_Math3D_Vec3.sub(v)(v))(Lattice_Services_Math3D_Vec3.zero)(strictTol);
        })(vecs))([ true, true, true ]);
    })()))(function () {
        return discard1(it("normalization produces unit length")((function () {
            var vecs = [ Lattice_Services_Math3D_Vec3.vec3(3.0)(4.0)(0.0), Lattice_Services_Math3D_Vec3.vec3(1.0)(1.0)(1.0), Lattice_Services_Math3D_Vec3.vec3(0.0)(0.0)(5.0), Lattice_Services_Math3D_Vec3.vec3(100.0)(200.0)(300.0) ];
            var results = map(function (v) {
                var n = Lattice_Services_Math3D_Vec3.normalize(v);
                var len = Lattice_Services_Math3D_Vec3.lengthVec3(n);
                return $$Math.abs(len - 1.0) < 1.0e-10;
            })(vecs);
            return shouldEqual1(results)([ true, true, true, true ]);
        })()))(function () {
            return discard1(it("zero vector normalizes to zero")(shouldEqual2(Lattice_Services_Math3D_Vec3.normalize(Lattice_Services_Math3D_Vec3.zero))(Lattice_Services_Math3D_Vec3.zero)))(function () {
                return discard1(it("dot product is commutative")((function () {
                    var b = Lattice_Services_Math3D_Vec3.vec3(4.0)(5.0)(6.0);
                    var a = Lattice_Services_Math3D_Vec3.vec3(1.0)(2.0)(3.0);
                    return Test_Lattice_TestHelpers.assertCloseTo(Lattice_Services_Math3D_Vec3.dot(a)(b))(Lattice_Services_Math3D_Vec3.dot(b)(a))(strictTol);
                })()))(function () {
                    return discard1(it("cross product is anti-commutative: a\xd7b = -(b\xd7a)")((function () {
                        var b = Lattice_Services_Math3D_Vec3.vec3(0.0)(1.0)(0.0);
                        var a = Lattice_Services_Math3D_Vec3.vec3(1.0)(0.0)(0.0);
                        var axb = Lattice_Services_Math3D_Vec3.cross(a)(b);
                        var bxa = Lattice_Services_Math3D_Vec3.cross(b)(a);
                        return shouldEqual3(vec3Close(axb)(Lattice_Services_Math3D_Vec3.neg(bxa))(strictTol))(true);
                    })()))(function () {
                        return discard1(it("lerp at t=0 returns first vector")((function () {
                            var b = Lattice_Services_Math3D_Vec3.vec3(10.0)(20.0)(30.0);
                            var a = Lattice_Services_Math3D_Vec3.vec3(1.0)(2.0)(3.0);
                            return shouldEqual2(Lattice_Services_Math3D_Vec3.lerp(a)(b)(0.0))(a);
                        })()))(function () {
                            return discard1(it("lerp at t=1 returns second vector")((function () {
                                var b = Lattice_Services_Math3D_Vec3.vec3(10.0)(20.0)(30.0);
                                var a = Lattice_Services_Math3D_Vec3.vec3(1.0)(2.0)(3.0);
                                return shouldEqual2(Lattice_Services_Math3D_Vec3.lerp(a)(b)(1.0))(b);
                            })()))(function () {
                                return it("lerp at t=0.5 returns midpoint")((function () {
                                    var b = Lattice_Services_Math3D_Vec3.vec3(10.0)(20.0)(30.0);
                                    var a = Lattice_Services_Math3D_Vec3.vec3(0.0)(0.0)(0.0);
                                    var mid = Lattice_Services_Math3D_Vec3.lerp(a)(b)(0.5);
                                    return shouldEqual3(vec3Close(mid)(Lattice_Services_Math3D_Vec3.vec3(5.0)(10.0)(15.0))(strictTol))(true);
                                })());
                            });
                        });
                    });
                });
            });
        });
    });
})))(function () {
    return discard1(describe("Matrix4 Operations")(discard1(it("identity preserves points")((function () {
        var points = [ Lattice_Services_Math3D_Vec3.vec3(1.0)(2.0)(3.0), Lattice_Services_Math3D_Vec3.vec3(-100.0)(50.0)(0.0), Lattice_Services_Math3D_Vec3.vec3(0.0)(0.0)(0.0) ];
        return shouldEqual1(map(function (p) {
            return eq1(Lattice_Services_Math3D_Mat4.transformPoint(Lattice_Services_Math3D_Mat4.identity)(p))(p);
        })(points))([ true, true, true ]);
    })()))(function () {
        return discard1(it("translation composition: T(a) * T(b) = T(a+b)")((function () {
            var b = Lattice_Services_Math3D_Vec3.vec3(5.0)(10.0)(15.0);
            var a = Lattice_Services_Math3D_Vec3.vec3(10.0)(20.0)(30.0);
            var composed = Lattice_Services_Math3D_Mat4.multiply(Lattice_Services_Math3D_Mat4.translate(a))(Lattice_Services_Math3D_Mat4.translate(b));
            var direct = Lattice_Services_Math3D_Mat4.translate(Lattice_Services_Math3D_Vec3.add(a)(b));
            return shouldEqual3(mat4Close(composed)(direct)(strictTol))(true);
        })()))(function () {
            return discard1(it("translation inverse: T(a) * T(-a) = I")((function () {
                var v = Lattice_Services_Math3D_Vec3.vec3(10.0)(20.0)(30.0);
                var composed = Lattice_Services_Math3D_Mat4.multiply(Lattice_Services_Math3D_Mat4.translate(v))(Lattice_Services_Math3D_Mat4.translate(Lattice_Services_Math3D_Vec3.neg(v)));
                return shouldEqual3(mat4Close(composed)(Lattice_Services_Math3D_Mat4.identity)(strictTol))(true);
            })()))(function () {
                return discard1(it("scale composition: S(a) * S(b) = S(a*b)")((function () {
                    var b = Lattice_Services_Math3D_Vec3.vec3(5.0)(6.0)(7.0);
                    var a = Lattice_Services_Math3D_Vec3.vec3(2.0)(3.0)(4.0);
                    var composed = Lattice_Services_Math3D_Mat4.multiply(Lattice_Services_Math3D_Mat4.scaleMat(a))(Lattice_Services_Math3D_Mat4.scaleMat(b));
                    var direct = Lattice_Services_Math3D_Mat4.scaleMat(Lattice_Services_Math3D_Vec3.mul(a)(b));
                    return shouldEqual3(mat4Close(composed)(direct)(float32Tol))(true);
                })()))(function () {
                    return discard1(it("rotation X composition: Rx(a) * Rx(b) = Rx(a+b)")((function () {
                        var composed = Lattice_Services_Math3D_Mat4.multiply(Lattice_Services_Math3D_Mat4.rotateX(0.3))(Lattice_Services_Math3D_Mat4.rotateX(0.7));
                        var direct = Lattice_Services_Math3D_Mat4.rotateX(0.3 + 0.7);
                        return shouldEqual3(mat4Close(composed)(direct)(float32Tol))(true);
                    })()))(function () {
                        return discard1(it("transformDirection ignores translation")((function () {
                            var t = Lattice_Services_Math3D_Mat4.translate(Lattice_Services_Math3D_Vec3.vec3(100.0)(200.0)(300.0));
                            var dir = Lattice_Services_Math3D_Vec3.vec3(1.0)(0.0)(0.0);
                            return shouldEqual2(Lattice_Services_Math3D_Mat4.transformDirection(t)(dir))(dir);
                        })()))(function () {
                            return discard1(it("determinant of identity is 1")(Test_Lattice_TestHelpers.assertCloseTo(Lattice_Services_Math3D_Mat4.determinant(Lattice_Services_Math3D_Mat4.identity))(1.0)(strictTol)))(function () {
                                return discard1(it("determinant of scale matrix is product of scales")((function () {
                                    var s = Lattice_Services_Math3D_Mat4.scaleMat(Lattice_Services_Math3D_Vec3.vec3(2.0)(3.0)(4.0));
                                    return Test_Lattice_TestHelpers.assertCloseTo(Lattice_Services_Math3D_Mat4.determinant(s))(24.0)(strictTol);
                                })()))(function () {
                                    return discard1(it("invert identity yields identity")((function () {
                                        var v = Lattice_Services_Math3D_Mat4.invert(Lattice_Services_Math3D_Mat4.identity);
                                        if (v instanceof Lattice_Services_Math3D_Mat4.InvertSuccess) {
                                            return shouldEqual3(mat4Close(v.value0)(Lattice_Services_Math3D_Mat4.identity)(strictTol))(true);
                                        };
                                        if (v instanceof Lattice_Services_Math3D_Mat4.SingularMatrix) {
                                            return shouldEqual3(false)(true);
                                        };
                                        throw new Error("Failed pattern match at Test.Lattice.Services.TransformProps (line 188, column 7 - line 190, column 51): " + [ v.constructor.name ]);
                                    })()))(function () {
                                        return discard1(it("invert of scale: S * S^-1 = I")((function () {
                                            var s = Lattice_Services_Math3D_Mat4.scaleMat(Lattice_Services_Math3D_Vec3.vec3(2.0)(3.0)(4.0));
                                            var v = Lattice_Services_Math3D_Mat4.invert(s);
                                            if (v instanceof Lattice_Services_Math3D_Mat4.InvertSuccess) {
                                                return shouldEqual3(mat4Close(Lattice_Services_Math3D_Mat4.multiply(s)(v.value0))(Lattice_Services_Math3D_Mat4.identity)(float32Tol))(true);
                                            };
                                            if (v instanceof Lattice_Services_Math3D_Mat4.SingularMatrix) {
                                                return shouldEqual3(false)(true);
                                            };
                                            throw new Error("Failed pattern match at Test.Lattice.Services.TransformProps (line 194, column 7 - line 197, column 51): " + [ v.constructor.name ]);
                                        })()))(function () {
                                            return discard1(it("zero matrix is singular")((function () {
                                                var v = Lattice_Services_Math3D_Mat4.invert(Lattice_Services_Math3D_Mat4.zeroMat);
                                                if (v instanceof Lattice_Services_Math3D_Mat4.SingularMatrix) {
                                                    return shouldEqual3(true)(true);
                                                };
                                                if (v instanceof Lattice_Services_Math3D_Mat4.InvertSuccess) {
                                                    return shouldEqual3(false)(true);
                                                };
                                                throw new Error("Failed pattern match at Test.Lattice.Services.TransformProps (line 200, column 7 - line 202, column 52): " + [ v.constructor.name ]);
                                            })()))(function () {
                                                return discard1(it("transpose is self-inverse")((function () {
                                                    var m = Lattice_Services_Math3D_Mat4.multiply(Lattice_Services_Math3D_Mat4.rotateX(0.5))(Lattice_Services_Math3D_Mat4.translate(Lattice_Services_Math3D_Vec3.vec3(1.0)(2.0)(3.0)));
                                                    var mt = Lattice_Services_Math3D_Mat4.transposeMat(m);
                                                    var mtt = Lattice_Services_Math3D_Mat4.transposeMat(mt);
                                                    return shouldEqual3(mat4Close(mtt)(m)(strictTol))(true);
                                                })()))(function () {
                                                    return discard1(it("lookAt produces finite matrix")((function () {
                                                        var up = Lattice_Services_Math3D_Vec3.vec3(0.0)(1.0)(0.0);
                                                        var target = Lattice_Services_Math3D_Vec3.vec3(0.0)(0.0)(0.0);
                                                        var eye = Lattice_Services_Math3D_Vec3.vec3(0.0)(0.0)(5.0);
                                                        var v = Lattice_Services_Math3D_Mat4.lookAt(eye)(target)(up);
                                                        var allFinite = isFiniteNum(v.m00) && (isFiniteNum(v.m10) && (isFiniteNum(v.m20) && (isFiniteNum(v.m30) && (isFiniteNum(v.m01) && (isFiniteNum(v.m11) && (isFiniteNum(v.m21) && (isFiniteNum(v.m31) && (isFiniteNum(v.m02) && (isFiniteNum(v.m12) && (isFiniteNum(v.m22) && (isFiniteNum(v.m32) && (isFiniteNum(v.m03) && (isFiniteNum(v.m13) && (isFiniteNum(v.m23) && isFiniteNum(v.m33)))))))))))))));
                                                        return shouldEqual3(allFinite)(true);
                                                    })()))(function () {
                                                        return discard1(it("perspective produces finite matrix")((function () {
                                                            var v = Lattice_Services_Math3D_Mat4.perspective($$Math.pi / 4.0)(16.0 / 9.0)(0.1)(1000.0);
                                                            var allFinite = isFiniteNum(v.m00) && (isFiniteNum(v.m10) && (isFiniteNum(v.m20) && (isFiniteNum(v.m30) && (isFiniteNum(v.m01) && (isFiniteNum(v.m11) && (isFiniteNum(v.m21) && (isFiniteNum(v.m31) && (isFiniteNum(v.m02) && (isFiniteNum(v.m12) && (isFiniteNum(v.m22) && (isFiniteNum(v.m32) && (isFiniteNum(v.m03) && (isFiniteNum(v.m13) && (isFiniteNum(v.m23) && isFiniteNum(v.m33)))))))))))))));
                                                            return shouldEqual3(allFinite)(true);
                                                        })()))(function () {
                                                            return it("orthographic produces finite matrix")((function () {
                                                                var v = Lattice_Services_Math3D_Mat4.orthographic(-10.0)(10.0)(-10.0)(10.0)(0.1)(100.0);
                                                                var allFinite = isFiniteNum(v.m00) && (isFiniteNum(v.m10) && (isFiniteNum(v.m20) && (isFiniteNum(v.m30) && (isFiniteNum(v.m01) && (isFiniteNum(v.m11) && (isFiniteNum(v.m21) && (isFiniteNum(v.m31) && (isFiniteNum(v.m02) && (isFiniteNum(v.m12) && (isFiniteNum(v.m22) && (isFiniteNum(v.m32) && (isFiniteNum(v.m03) && (isFiniteNum(v.m13) && (isFiniteNum(v.m23) && isFiniteNum(v.m33)))))))))))))));
                                                                return shouldEqual3(allFinite)(true);
                                                            })());
                                                        });
                                                    });
                                                });
                                            });
                                        });
                                    });
                                });
                            });
                        });
                    });
                });
            });
        });
    })))(function () {
        return discard1(describe("Quaternion Operations")(discard1(it("identity quaternion is (0,0,0,1)")(shouldEqual4(Lattice_Services_Math3D_Quat.identity)({
            x: 0.0,
            y: 0.0,
            z: 0.0,
            w: 1.0
        })))(function () {
            return discard1(it("normalize preserves unit quaternion")(shouldEqual4(Lattice_Services_Math3D_Quat.normalize(Lattice_Services_Math3D_Quat.identity))(Lattice_Services_Math3D_Quat.identity)))(function () {
                return discard1(it("normalize rescales non-unit quaternion")((function () {
                    var q = {
                        x: 0.0,
                        y: 0.0,
                        z: 0.0,
                        w: 2.0
                    };
                    var n = Lattice_Services_Math3D_Quat.normalize(q);
                    return shouldEqual3(quatClose(n)(Lattice_Services_Math3D_Quat.identity)(strictTol))(true);
                })()))(function () {
                    return discard1(it("conjugate flips xyz, keeps w")((function () {
                        var q = {
                            x: 1.0,
                            y: 2.0,
                            z: 3.0,
                            w: 4.0
                        };
                        var v = Lattice_Services_Math3D_Quat.conjugate(q);
                        return discard2(shouldEqual5(v.x)(-1.0))(function () {
                            return discard2(shouldEqual5(v.y)(-2.0))(function () {
                                return discard2(shouldEqual5(v.z)(-3.0))(function () {
                                    return shouldEqual5(v.w)(4.0);
                                });
                            });
                        });
                    })()))(function () {
                        return discard1(it("multiply identity is identity: q * I = q")((function () {
                            var q = Lattice_Services_Math3D_Quat.fromEuler(0.5)(0.3)(0.1);
                            return shouldEqual3(quatClose(Lattice_Services_Math3D_Quat.multiply(q)(Lattice_Services_Math3D_Quat.identity))(q)(strictTol))(true);
                        })()))(function () {
                            return discard1(it("multiply by inverse gives identity: q * q^-1 = I")((function () {
                                var q = Lattice_Services_Math3D_Quat.fromEuler(0.5)(0.3)(0.1);
                                var inv = Lattice_Services_Math3D_Quat.invert(q);
                                var result = Lattice_Services_Math3D_Quat.multiply(q)(inv);
                                return shouldEqual3(quatClose(result)(Lattice_Services_Math3D_Quat.identity)(float32Tol))(true);
                            })()))(function () {
                                return discard1(it("fromEuler -> toEuler roundtrip in stable range")((function () {
                                    var cases = [ {
                                        x: 0.0,
                                        y: 0.0,
                                        z: 0.0
                                    }, {
                                        x: 0.5,
                                        y: 0.3,
                                        z: 0.1
                                    }, {
                                        x: -0.5,
                                        y: 0.3,
                                        z: -0.1
                                    }, {
                                        x: 1.0,
                                        y: 0.5,
                                        z: 0.2
                                    } ];
                                    return shouldEqual1(map(function (c) {
                                        var q = Lattice_Services_Math3D_Quat.fromEuler(c.x)(c.y)(c.z);
                                        var v = Lattice_Services_Math3D_Quat.toEuler(q);
                                        return $$Math.abs(v.x - c.x) < 1.0e-2 && ($$Math.abs(v.y - c.y) < 1.0e-2 && $$Math.abs(v.z - c.z) < 1.0e-2);
                                    })(cases))([ true, true, true, true ]);
                                })()))(function () {
                                    return discard1(it("gimbal lock does not produce NaN")((function () {
                                        var q = Lattice_Services_Math3D_Quat.fromEuler(0.0)($$Math.pi / 2.0)(0.0);
                                        var v = Lattice_Services_Math3D_Quat.toEuler(q);
                                        return discard2(shouldEqual3(isFiniteNum(v.x))(true))(function () {
                                            return discard2(shouldEqual3(isFiniteNum(v.y))(true))(function () {
                                                return shouldEqual3(isFiniteNum(v.z))(true);
                                            });
                                        });
                                    })()))(function () {
                                        return discard1(it("fromAxisAngle -> toAxisAngle roundtrip")((function () {
                                            var axis = Lattice_Services_Math3D_Vec3.normalize(Lattice_Services_Math3D_Vec3.vec3(1.0)(1.0)(0.0));
                                            var q = Lattice_Services_Math3D_Quat.fromAxisAngle(axis)(1.0);
                                            var v = Lattice_Services_Math3D_Quat.toAxisAngle(q);
                                            return discard2(Test_Lattice_TestHelpers.assertCloseTo(v.value1)(1.0)(1.0e-2))(function () {
                                                return shouldEqual3(vec3Close(Lattice_Services_Math3D_Vec3.normalize(v.value0))(axis)(1.0e-2))(true);
                                            });
                                        })()))(function () {
                                            return discard1(it("slerp at t=0 returns first quaternion")((function () {
                                                var b = Lattice_Services_Math3D_Quat.fromEuler(1.0)(0.0)(0.0);
                                                var a = Lattice_Services_Math3D_Quat.fromEuler(0.0)(0.0)(0.0);
                                                return shouldEqual3(quatClose(Lattice_Services_Math3D_Quat.slerp(a)(b)(0.0))(a)(float32Tol))(true);
                                            })()))(function () {
                                                return discard1(it("slerp at t=1 returns second quaternion")((function () {
                                                    var b = Lattice_Services_Math3D_Quat.fromEuler(1.0)(0.0)(0.0);
                                                    var a = Lattice_Services_Math3D_Quat.fromEuler(0.0)(0.0)(0.0);
                                                    return shouldEqual3(quatClose(Lattice_Services_Math3D_Quat.slerp(a)(b)(1.0))(b)(float32Tol))(true);
                                                })()))(function () {
                                                    return discard1(it("slerp preserves unit quaternion")((function () {
                                                        var b = Lattice_Services_Math3D_Quat.fromEuler(1.0)(0.5)(0.3);
                                                        var a = Lattice_Services_Math3D_Quat.fromEuler(0.0)(0.0)(0.0);
                                                        var mid = Lattice_Services_Math3D_Quat.slerp(a)(b)(0.5);
                                                        var len = Lattice_Services_Math3D_Quat.lengthQuat(mid);
                                                        return Test_Lattice_TestHelpers.assertCloseTo(len)(1.0)(float32Tol);
                                                    })()))(function () {
                                                        return discard1(it("rotateVec3 by identity returns original vector")((function () {
                                                            var v = Lattice_Services_Math3D_Vec3.vec3(1.0)(2.0)(3.0);
                                                            return shouldEqual3(vec3Close(Lattice_Services_Math3D_Quat.rotateVec3(Lattice_Services_Math3D_Quat.identity)(v))(v)(strictTol))(true);
                                                        })()))(function () {
                                                            return discard1(it("90\xb0 rotation around Z maps X to Y")((function () {
                                                                var q = Lattice_Services_Math3D_Quat.fromAxisAngle(Lattice_Services_Math3D_Vec3.unitZ)($$Math.pi / 2.0);
                                                                var rotated = Lattice_Services_Math3D_Quat.rotateVec3(q)(Lattice_Services_Math3D_Vec3.unitX);
                                                                return shouldEqual3(vec3Close(rotated)(Lattice_Services_Math3D_Vec3.unitY)(float32Tol))(true);
                                                            })()))(function () {
                                                                return it("dotQuat is commutative")((function () {
                                                                    var b = Lattice_Services_Math3D_Quat.fromEuler(0.1)(0.2)(0.3);
                                                                    var a = Lattice_Services_Math3D_Quat.fromEuler(0.5)(0.3)(0.1);
                                                                    return Test_Lattice_TestHelpers.assertCloseTo(Lattice_Services_Math3D_Quat.dotQuat(a)(b))(Lattice_Services_Math3D_Quat.dotQuat(b)(a))(strictTol);
                                                                })());
                                                            });
                                                        });
                                                    });
                                                });
                                            });
                                        });
                                    });
                                });
                            });
                        });
                    });
                });
            });
        })))(function () {
            return discard1(describe("Vec3 conversion")(discard1(it("toArray -> fromArray roundtrip")((function () {
                var v = Lattice_Services_Math3D_Vec3.vec3(1.0)(2.0)(3.0);
                return shouldEqual2(Lattice_Services_Math3D_Vec3.fromArray(Lattice_Services_Math3D_Vec3.toArray(v)))(v);
            })()))(function () {
                return it("fromArray with short array returns zero")(shouldEqual2(Lattice_Services_Math3D_Vec3.fromArray([ 1.0, 2.0 ]))(Lattice_Services_Math3D_Vec3.zero));
            })))(function () {
                return describe("Quat conversion")(discard1(it("toArray -> fromArray roundtrip")((function () {
                    var q = Lattice_Services_Math3D_Quat.quatFromComponents(0.1)(0.2)(0.3)(0.9);
                    return shouldEqual4(Lattice_Services_Math3D_Quat.fromArray(Lattice_Services_Math3D_Quat.toArray(q)))(q);
                })()))(function () {
                    return it("fromArray with short array returns identity")(shouldEqual4(Lattice_Services_Math3D_Quat.fromArray([ 1.0, 2.0 ]))(Lattice_Services_Math3D_Quat.identity));
                }));
            });
        });
    });
}));
export {
    strictTol,
    float32Tol,
    vec3Close,
    mat4Close,
    quatClose,
    spec,
    isFiniteNum
};
//# sourceMappingURL=index.js.map
