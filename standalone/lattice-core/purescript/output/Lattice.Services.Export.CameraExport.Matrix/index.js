// Generated by purs version 0.15.15
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
var append = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var guardFinite = function (n) {
    var $7 = Data_Number["isFinite"](n);
    if ($7) {
        return n;
    };
    return 0.0;
};
var flattenMatrix3x4 = function (m) {
    if (m.length === 3) {
        return append(m[0])(append(m[1])(m[2]));
    };
    return [ 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0 ];
};
var degreesToRadians = function (deg) {
    return (deg * Data_Number.pi) / 180.0;
};
var defaultNearClip = 0.1;
var defaultFilmSize = 36.0;
var focalLengthToFOV = function (focalLength) {
    return function (filmSize) {
        var validFocal = (function () {
            var $12 = focalLength > 0.0;
            if ($12) {
                return focalLength;
            };
            return 50.0;
        })();
        var validFilm = (function () {
            var $13 = filmSize > 0.0;
            if ($13) {
                return filmSize;
            };
            return defaultFilmSize;
        })();
        return 2.0 * Data_Number.atan(validFilm / (2.0 * validFocal));
    };
};
var defaultFarClip = 1000.0;
var computeW2CMatrix = function (cam) {
    var rotZ = guardFinite(cam.rotation.z);
    var rz = degreesToRadians(rotZ);
    var sinZ = Data_Number.sin(rz);
    var rotY = guardFinite(cam.rotation.y);
    var ry = degreesToRadians(rotY);
    var sinY = Data_Number.sin(ry);
    var rotX = guardFinite(cam.rotation.x);
    var rx = degreesToRadians(rotX);
    var sinX = Data_Number.sin(rx);
    var r12 = -sinX;
    var posZ = guardFinite(cam.position.z);
    var posY = guardFinite(cam.position.y);
    var posX = guardFinite(cam.position.x);
    var cosZ = Data_Number.cos(rz);
    var cosY = Data_Number.cos(ry);
    var r00 = cosY * cosZ + sinY * sinX * sinZ;
    var r01 = -cosY * sinZ + sinY * sinX * cosZ;
    var r20 = -sinY * cosZ + cosY * sinX * sinZ;
    var r21 = sinY * sinZ + cosY * sinX * cosZ;
    var cosX = Data_Number.cos(rx);
    var r02 = sinY * cosX;
    var r10 = cosX * sinZ;
    var tx = -(r00 * posX + r10 * posY + r20 * posZ);
    var r11 = cosX * cosZ;
    var ty = -(r01 * posX + r11 * posY + r21 * posZ);
    var r22 = cosY * cosX;
    var tz = -(r02 * posX + r12 * posY + r22 * posZ);
    return [ [ r00, r10, r20, tx ], [ r01, r11, r21, ty ], [ r02, r12, r22, tz ] ];
};
var computeW2CMatrixFlat = function (cam) {
    var w2c = computeW2CMatrix(cam);
    return flattenMatrix3x4(w2c);
};
var computeViewMatrix = function (cam) {
    var rotZ = guardFinite(cam.rotation.z);
    var rz = degreesToRadians(rotZ);
    var sinZ = Data_Number.sin(rz);
    var rotY = guardFinite(cam.rotation.y);
    var ry = degreesToRadians(rotY);
    var sinY = Data_Number.sin(ry);
    var rotX = guardFinite(cam.rotation.x);
    var rx = degreesToRadians(rotX);
    var sinX = Data_Number.sin(rx);
    var r12 = -sinX;
    var posZ = guardFinite(cam.position.z);
    var posY = guardFinite(cam.position.y);
    var posX = guardFinite(cam.position.x);
    var cosZ = Data_Number.cos(rz);
    var cosY = Data_Number.cos(ry);
    var r00 = cosY * cosZ + sinY * sinX * sinZ;
    var r01 = -cosY * sinZ + sinY * sinX * cosZ;
    var r20 = -sinY * cosZ + cosY * sinX * sinZ;
    var r21 = sinY * sinZ + cosY * sinX * cosZ;
    var cosX = Data_Number.cos(rx);
    var r02 = sinY * cosX;
    var r10 = cosX * sinZ;
    var tx = -(r00 * posX + r10 * posY + r20 * posZ);
    var r11 = cosX * cosZ;
    var ty = -(r01 * posX + r11 * posY + r21 * posZ);
    var r22 = cosY * cosX;
    var tz = -(r02 * posX + r12 * posY + r22 * posZ);
    return [ [ r00, r01, r02, tx ], [ r10, r11, r12, ty ], [ r20, r21, r22, tz ], [ 0.0, 0.0, 0.0, 1.0 ] ];
};
var computeProjectionMatrix = function (cam) {
    return function (aspectRatio) {
        return function (nearClip) {
            return function (farClip) {
                var validNear = (function () {
                    var $20 = nearClip > 0.0;
                    if ($20) {
                        return nearClip;
                    };
                    return defaultNearClip;
                })();
                var validFocal = (function () {
                    var $21 = cam.focalLength > 0.0;
                    if ($21) {
                        return cam.focalLength;
                    };
                    return 50.0;
                })();
                var validFar = (function () {
                    var $22 = farClip > validNear;
                    if ($22) {
                        return farClip;
                    };
                    return defaultFarClip;
                })();
                var validAspect = (function () {
                    var $23 = aspectRatio > 0.0;
                    if ($23) {
                        return aspectRatio;
                    };
                    return 1.0;
                })();
                var nf = 1.0 / (validNear - validFar);
                var fovRad = focalLengthToFOV(validFocal)(defaultFilmSize);
                var tanHalfFov = Data_Number.tan(fovRad / 2.0);
                var f = (function () {
                    var $24 = tanHalfFov > 1.0e-3;
                    if ($24) {
                        return 1.0 / tanHalfFov;
                    };
                    return 1000.0;
                })();
                return [ [ f / validAspect, 0.0, 0.0, 0.0 ], [ 0.0, f, 0.0, 0.0 ], [ 0.0, 0.0, (validFar + validNear) * nf, 2.0 * validFar * validNear * nf ], [ 0.0, 0.0, -1.0, 0.0 ] ];
            };
        };
    };
};
export {
    computeViewMatrix,
    computeProjectionMatrix,
    computeW2CMatrix,
    computeW2CMatrixFlat,
    focalLengthToFOV,
    degreesToRadians
};
//# sourceMappingURL=index.js.map
