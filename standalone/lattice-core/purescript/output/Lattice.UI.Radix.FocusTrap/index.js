// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Apply from "../Control.Apply/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Effect from "../Effect/index.js";
import * as Unsafe_Reference from "../Unsafe.Reference/index.js";
import * as Web_DOM_Element from "../Web.DOM.Element/index.js";
import * as Web_DOM_Node from "../Web.DOM.Node/index.js";
import * as Web_DOM_NodeList from "../Web.DOM.NodeList/index.js";
import * as Web_DOM_ParentNode from "../Web.DOM.ParentNode/index.js";
import * as Web_HTML from "../Web.HTML/index.js";
import * as Web_HTML_HTMLDocument from "../Web.HTML.HTMLDocument/index.js";
import * as Web_HTML_HTMLElement from "../Web.HTML.HTMLElement/index.js";
import * as Web_HTML_Window from "../Web.HTML.Window/index.js";
import * as Web_UIEvent_KeyboardEvent from "../Web.UIEvent.KeyboardEvent/index.js";
var bind = /* #__PURE__ */ Control_Bind.bind(Effect.bindEffect);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var pure = /* #__PURE__ */ Control_Applicative.pure(Effect.applicativeEffect);
var bind1 = /* #__PURE__ */ Control_Bind.bind(Data_Maybe.bindMaybe);
var applySecond = /* #__PURE__ */ Control_Apply.applySecond(Effect.applyEffect);
var nodeToHTMLElement = function (node) {
    var v = Web_DOM_Element.fromNode(node);
    if (v instanceof Data_Maybe.Nothing) {
        return Data_Maybe.Nothing.value;
    };
    if (v instanceof Data_Maybe.Just) {
        return Web_HTML_HTMLElement.fromElement(v.value0);
    };
    throw new Error("Failed pattern match at Lattice.UI.Radix.FocusTrap (line 177, column 3 - line 179, column 42): " + [ v.constructor.name ]);
};
var getTabbableElements = function (container) {
    var selector = "a[href], button:not([disabled]), input:not([disabled]):not([type=hidden]), " + ("select:not([disabled]), textarea:not([disabled]), " + "[tabindex]:not([tabindex=\"-1\"]):not([disabled])");
    return function __do() {
        var nodeList = Web_DOM_ParentNode.querySelectorAll(selector)(Web_HTML_HTMLElement.toParentNode(container))();
        var nodes = Web_DOM_NodeList.toArray(nodeList)();
        var maybeElements = map(nodeToHTMLElement)(nodes);
        return Data_Array.catMaybes(maybeElements);
    };
};
var handleTabKey = function (scope) {
    return function (ke) {
        var $18 = Web_UIEvent_KeyboardEvent.key(ke) !== "Tab";
        if ($18) {
            return pure(false);
        };
        return function __do() {
            var tabbable = getTabbableElements(scope.container)();
            var $19 = Data_Array["null"](tabbable);
            if ($19) {
                return false;
            };
            var doc = bind(Web_HTML.window)(Web_HTML_Window.document)();
            var mActive = Web_HTML_HTMLDocument.activeElement(doc)();
            var last = Data_Array.last(tabbable);
            var isShift = Web_UIEvent_KeyboardEvent.shiftKey(ke);
            var first = Data_Array.head(tabbable);
            var mIndex = bind1(mActive)(function (active) {
                return Data_Array.findIndex(function (el) {
                    return Unsafe_Reference.unsafeRefEq(Web_HTML_HTMLElement.toNode(el))(Web_HTML_HTMLElement.toNode(active));
                })(tabbable);
            });
            if (mIndex instanceof Data_Maybe.Just && (mIndex.value0 === 0 && isShift)) {
                (function () {
                    if (last instanceof Data_Maybe.Just) {
                        return Web_HTML_HTMLElement.focus(last.value0)();
                    };
                    if (last instanceof Data_Maybe.Nothing) {
                        return Data_Unit.unit;
                    };
                    throw new Error("Failed pattern match at Lattice.UI.Radix.FocusTrap (line 119, column 11 - line 121, column 33): " + [ last.constructor.name ]);
                })();
                return true;
            };
            if (mIndex instanceof Data_Maybe.Just && (!isShift && mIndex.value0 === (Data_Array.length(tabbable) - 1 | 0))) {
                (function () {
                    if (first instanceof Data_Maybe.Just) {
                        return Web_HTML_HTMLElement.focus(first.value0)();
                    };
                    if (first instanceof Data_Maybe.Nothing) {
                        return Data_Unit.unit;
                    };
                    throw new Error("Failed pattern match at Lattice.UI.Radix.FocusTrap (line 126, column 11 - line 128, column 33): " + [ first.constructor.name ]);
                })();
                return true;
            };
            return false;
        };
    };
};
var trapFocus = function (scope) {
    return function __do() {
        var tabbable = getTabbableElements(scope.container)();
        var v = Data_Array.head(tabbable);
        if (v instanceof Data_Maybe.Just) {
            return Web_HTML_HTMLElement.focus(v.value0)();
        };
        if (v instanceof Data_Maybe.Nothing) {
            return Web_HTML_HTMLElement.focus(scope.container)();
        };
        throw new Error("Failed pattern match at Lattice.UI.Radix.FocusTrap (line 86, column 3 - line 88, column 49): " + [ v.constructor.name ]);
    };
};
var focusLast = function (scope) {
    return function __do() {
        var tabbable = getTabbableElements(scope.container)();
        var v = Data_Array.last(tabbable);
        if (v instanceof Data_Maybe.Just) {
            return Web_HTML_HTMLElement.focus(v.value0)();
        };
        if (v instanceof Data_Maybe.Nothing) {
            return Web_HTML_HTMLElement.focus(scope.container)();
        };
        throw new Error("Failed pattern match at Lattice.UI.Radix.FocusTrap (line 146, column 3 - line 148, column 49): " + [ v.constructor.name ]);
    };
};
var focusFirst = function (scope) {
    return function __do() {
        var tabbable = getTabbableElements(scope.container)();
        var v = Data_Array.head(tabbable);
        if (v instanceof Data_Maybe.Just) {
            return Web_HTML_HTMLElement.focus(v.value0)();
        };
        if (v instanceof Data_Maybe.Nothing) {
            return Web_HTML_HTMLElement.focus(scope.container)();
        };
        throw new Error("Failed pattern match at Lattice.UI.Radix.FocusTrap (line 138, column 3 - line 140, column 49): " + [ v.constructor.name ]);
    };
};
var destroyFocusScope = function (scope) {
    var removeGuard = function (v) {
        if (v instanceof Data_Maybe.Just) {
            return function __do() {
                var mParent = Web_DOM_Node.parentNode(Web_HTML_HTMLElement.toNode(v.value0))();
                if (mParent instanceof Data_Maybe.Just) {
                    return applySecond(Web_DOM_Node.removeChild(Web_HTML_HTMLElement.toNode(v.value0))(mParent.value0))(pure(Data_Unit.unit))();
                };
                if (mParent instanceof Data_Maybe.Nothing) {
                    return Data_Unit.unit;
                };
                throw new Error("Failed pattern match at Lattice.UI.Radix.FocusTrap (line 76, column 7 - line 78, column 29): " + [ mParent.constructor.name ]);
            };
        };
        if (v instanceof Data_Maybe.Nothing) {
            return pure(Data_Unit.unit);
        };
        throw new Error("Failed pattern match at Lattice.UI.Radix.FocusTrap (line 73, column 17 - line 79, column 25): " + [ v.constructor.name ]);
    };
    return function __do() {
        removeGuard(scope.startGuard)();
        removeGuard(scope.endGuard)();
        if (scope.previousActiveElement instanceof Data_Maybe.Just) {
            return Web_HTML_HTMLElement.focus(scope.previousActiveElement.value0)();
        };
        if (scope.previousActiveElement instanceof Data_Maybe.Nothing) {
            return Data_Unit.unit;
        };
        throw new Error("Failed pattern match at Lattice.UI.Radix.FocusTrap (line 68, column 3 - line 70, column 25): " + [ scope.previousActiveElement.constructor.name ]);
    };
};
var releaseFocus = destroyFocusScope;
var createFocusScope = function (container) {
    return function __do() {
        var doc = bind(Web_HTML.window)(Web_HTML_Window.document)();
        var prevActive = Web_HTML_HTMLDocument.activeElement(doc)();
        return {
            container: container,
            previousActiveElement: prevActive,
            startGuard: Data_Maybe.Nothing.value,
            endGuard: Data_Maybe.Nothing.value
        };
    };
};
export {
    createFocusScope,
    destroyFocusScope,
    trapFocus,
    releaseFocus,
    handleTabKey,
    focusFirst,
    focusLast,
    getTabbableElements
};
//# sourceMappingURL=index.js.map
