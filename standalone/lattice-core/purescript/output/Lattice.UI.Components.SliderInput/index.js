// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Control_Monad_State_Class from "../Control.Monad.State.Class/index.js";
import * as DOM_HTML_Indexed_InputType from "../DOM.HTML.Indexed.InputType/index.js";
import * as Data_Function from "../Data.Function/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Halogen_Component from "../Halogen.Component/index.js";
import * as Halogen_HTML_Core from "../Halogen.HTML.Core/index.js";
import * as Halogen_HTML_Elements from "../Halogen.HTML.Elements/index.js";
import * as Halogen_HTML_Events from "../Halogen.HTML.Events/index.js";
import * as Halogen_HTML_Properties from "../Halogen.HTML.Properties/index.js";
import * as Halogen_Query_HalogenM from "../Halogen.Query.HalogenM/index.js";
import * as Lattice_UI_Core from "../Lattice.UI.Core/index.js";
import * as Web_UIEvent_MouseEvent from "../Web.UIEvent.MouseEvent/index.js";
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var type_ = /* #__PURE__ */ Halogen_HTML_Properties.type_(Halogen_HTML_Core.isPropInputType);
var value = /* #__PURE__ */ Halogen_HTML_Properties.value(Halogen_HTML_Core.isPropString);
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordNumber);
var min = /* #__PURE__ */ Data_Ord.min(Data_Ord.ordNumber);
var pure = /* #__PURE__ */ Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM);
var modify_ = /* #__PURE__ */ Control_Monad_State_Class.modify_(Halogen_Query_HalogenM.monadStateHalogenM);
var bind = /* #__PURE__ */ Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM);
var get = /* #__PURE__ */ Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM);
var when = /* #__PURE__ */ Control_Applicative.when(Halogen_Query_HalogenM.applicativeHalogenM);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM);
var ValueChanged = /* #__PURE__ */ (function () {
    function ValueChanged(value0) {
        this.value0 = value0;
    };
    ValueChanged.create = function (value0) {
        return new ValueChanged(value0);
    };
    return ValueChanged;
})();
var Initialize = /* #__PURE__ */ (function () {
    function Initialize() {

    };
    Initialize.value = new Initialize();
    return Initialize;
})();
var Receive = /* #__PURE__ */ (function () {
    function Receive(value0) {
        this.value0 = value0;
    };
    Receive.create = function (value0) {
        return new Receive(value0);
    };
    return Receive;
})();
var StartLabelScrub = /* #__PURE__ */ (function () {
    function StartLabelScrub(value0) {
        this.value0 = value0;
    };
    StartLabelScrub.create = function (value0) {
        return new StartLabelScrub(value0);
    };
    return StartLabelScrub;
})();
var StartThumbDrag = /* #__PURE__ */ (function () {
    function StartThumbDrag(value0) {
        this.value0 = value0;
    };
    StartThumbDrag.create = function (value0) {
        return new StartThumbDrag(value0);
    };
    return StartThumbDrag;
})();
var OnTrackClick = /* #__PURE__ */ (function () {
    function OnTrackClick(value0) {
        this.value0 = value0;
    };
    OnTrackClick.create = function (value0) {
        return new OnTrackClick(value0);
    };
    return OnTrackClick;
})();
var OnInputChange = /* #__PURE__ */ (function () {
    function OnInputChange(value0) {
        this.value0 = value0;
    };
    OnInputChange.create = function (value0) {
        return new OnInputChange(value0);
    };
    return OnInputChange;
})();
var OnInputBlur = /* #__PURE__ */ (function () {
    function OnInputBlur() {

    };
    OnInputBlur.value = new OnInputBlur();
    return OnInputBlur;
})();
var unitStyle = "font-size: 12px; color: var(--lattice-text-muted); min-width: 16px;";
var trackStyle = /* #__PURE__ */ (function () {
    return "flex: 1; height: 4px; background: var(--lattice-surface-3); " + "border-radius: 2px; position: relative; cursor: pointer; min-width: 80px;";
})();
var roundToPrecision = function (prec) {
    return function (val) {
        var factor = Data_Number.pow(10.0)(Data_Int.toNumber(prec));
        return Data_Number.round(val * factor) / factor;
    };
};
var labelStyle = function (scrubbing) {
    return "min-width: 70px; font-size: 13px; cursor: ew-resize; user-select: none; " + ("transition: color 0.1s; color: " + ((function () {
        if (scrubbing) {
            return "var(--lattice-accent)";
        };
        return "var(--lattice-text-muted)";
    })() + ";"));
};
var inputStyle = /* #__PURE__ */ (function () {
    return "width: 50px; padding: 4px 6px; border: 1px solid var(--lattice-border-subtle); " + ("border-radius: 3px; background: var(--lattice-surface-2); " + "color: var(--lattice-text-primary); font-size: 13px; text-align: right;");
})();
var initialState = function (input) {
    return {
        value: input.value,
        min: input.min,
        max: input.max,
        step: input.step,
        label: input.label,
        unit: input.unit,
        showValue: input.showValue,
        gradient: input.gradient,
        disabled: input.disabled,
        precision: input.precision,
        isScrubbing: false,
        isDragging: false,
        scrubStartX: 0.0,
        scrubStartValue: 0.0
    };
};
var formatValue = function (val) {
    return function (prec) {
        var rounded = roundToPrecision(prec)(val);
        return show(rounded);
    };
};
var fillPercent = function (state) {
    var range = state.max - state.min;
    var $31 = range === 0.0;
    if ($31) {
        return 0.0;
    };
    return ((state.value - state.min) / range) * 100.0;
};
var fillStyle = function (state) {
    var percent = fillPercent(state);
    var bg = (function () {
        if (state.gradient instanceof Data_Maybe.Just) {
            return state.gradient.value0;
        };
        if (state.gradient instanceof Data_Maybe.Nothing) {
            return "var(--lattice-accent)";
        };
        throw new Error("Failed pattern match at Lattice.UI.Components.SliderInput (line 209, column 12 - line 211, column 43): " + [ state.gradient.constructor.name ]);
    })();
    return "height: 100%; border-radius: 2px; pointer-events: none; " + ("width: " + (show(percent) + ("%; background: " + (bg + ";"))));
};
var thumbStyle = function (state) {
    var percent = fillPercent(state);
    return "position: absolute; top: 50%; width: 12px; height: 12px; " + ("background: var(--lattice-text-primary); border: 2px solid var(--lattice-accent); " + ("border-radius: 50%; transform: translate(-50%, -50%); cursor: grab; " + ("transition: transform 0.1s; left: " + (show(percent) + "%;"))));
};
var containerStyle = "display: flex; align-items: center; gap: 8px;";
var render = function (state) {
    return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-slider-input" ]), Halogen_HTML_Properties.attr("data-state")((function () {
        if (state.disabled) {
            return "disabled";
        };
        return "enabled";
    })()), Halogen_HTML_Properties.attr("style")(containerStyle) ])([ (function () {
        if (state.label instanceof Data_Maybe.Just) {
            return Halogen_HTML_Elements.label([ Lattice_UI_Core.cls([ "lattice-slider-label" ]), Halogen_HTML_Properties.attr("style")(labelStyle(state.isScrubbing)), Halogen_HTML_Events.onMouseDown(StartLabelScrub.create) ])([ Halogen_HTML_Core.text(state.label.value0) ]);
        };
        if (state.label instanceof Data_Maybe.Nothing) {
            return Halogen_HTML_Core.text("");
        };
        throw new Error("Failed pattern match at Lattice.UI.Components.SliderInput (line 129, column 7 - line 137, column 30): " + [ state.label.constructor.name ]);
    })(), Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-slider-track" ]), Halogen_HTML_Properties.attr("style")(trackStyle), Halogen_HTML_Events.onMouseDown(OnTrackClick.create) ])([ Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-slider-fill" ]), Halogen_HTML_Properties.attr("style")(fillStyle(state)) ])([  ]), Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-slider-thumb" ]), Halogen_HTML_Properties.attr("style")(thumbStyle(state)), Halogen_HTML_Events.onMouseDown(StartThumbDrag.create) ])([  ]) ]), (function () {
        if (state.showValue) {
            return Halogen_HTML_Elements.input([ Lattice_UI_Core.cls([ "lattice-slider-value" ]), type_(DOM_HTML_Indexed_InputType.InputNumber.value), value(formatValue(state.value)(state.precision)), Halogen_HTML_Properties.attr("min")(show(state.min)), Halogen_HTML_Properties.attr("max")(show(state.max)), Halogen_HTML_Properties.attr("step")(show(state.step)), Halogen_HTML_Properties.disabled(state.disabled), Halogen_HTML_Properties.attr("style")(inputStyle), Halogen_HTML_Events.onValueInput(OnInputChange.create), Halogen_HTML_Events.onBlur(Data_Function["const"](OnInputBlur.value)) ]);
        };
        return Halogen_HTML_Core.text("");
    })(), (function () {
        if (state.unit instanceof Data_Maybe.Just) {
            return Halogen_HTML_Elements.span([ Lattice_UI_Core.cls([ "lattice-slider-unit" ]), Halogen_HTML_Properties.attr("style")(unitStyle) ])([ Halogen_HTML_Core.text(state.unit.value0) ]);
        };
        if (state.unit instanceof Data_Maybe.Nothing) {
            return Halogen_HTML_Core.text("");
        };
        throw new Error("Failed pattern match at Lattice.UI.Components.SliderInput (line 178, column 7 - line 185, column 30): " + [ state.unit.constructor.name ]);
    })() ]);
};
var clampValue = function (minVal) {
    return function (maxVal) {
        return function (val) {
            return max(minVal)(min(maxVal)(val));
        };
    };
};
var handleAction = function (dictMonadAff) {
    return function (v) {
        if (v instanceof Initialize) {
            return pure(Data_Unit.unit);
        };
        if (v instanceof Receive) {
            return modify_(function (v1) {
                var $41 = {};
                for (var $42 in v1) {
                    if ({}.hasOwnProperty.call(v1, $42)) {
                        $41[$42] = v1[$42];
                    };
                };
                $41.value = v.value0.value;
                $41.min = v.value0.min;
                $41.max = v.value0.max;
                $41.step = v.value0.step;
                $41.label = v.value0.label;
                $41.unit = v.value0.unit;
                $41.showValue = v.value0.showValue;
                $41.gradient = v.value0.gradient;
                $41.disabled = v.value0.disabled;
                $41.precision = v.value0.precision;
                return $41;
            });
        };
        if (v instanceof StartLabelScrub) {
            return bind(get)(function (state) {
                return when(!state.disabled)((function () {
                    var x = Data_Int.toNumber(Web_UIEvent_MouseEvent.clientX(v.value0));
                    return modify_(function (v1) {
                        var $45 = {};
                        for (var $46 in v1) {
                            if ({}.hasOwnProperty.call(v1, $46)) {
                                $45[$46] = v1[$46];
                            };
                        };
                        $45.isScrubbing = true;
                        $45.scrubStartX = x;
                        $45.scrubStartValue = state.value;
                        return $45;
                    });
                })());
            });
        };
        if (v instanceof StartThumbDrag) {
            return bind(get)(function (state) {
                return when(!state.disabled)(modify_(function (v1) {
                    var $49 = {};
                    for (var $50 in v1) {
                        if ({}.hasOwnProperty.call(v1, $50)) {
                            $49[$50] = v1[$50];
                        };
                    };
                    $49.isDragging = true;
                    return $49;
                }));
            });
        };
        if (v instanceof OnTrackClick) {
            return bind(get)(function (state) {
                return when(!state.disabled)(pure(Data_Unit.unit));
            });
        };
        if (v instanceof OnInputChange) {
            return bind(get)(function (state) {
                var v1 = Data_Number.fromString(v.value0);
                if (v1 instanceof Data_Maybe.Just) {
                    var newVal = roundToPrecision(state.precision)(clampValue(state.min)(state.max)(v1.value0));
                    return when(newVal !== state.value)(discard(modify_(function (v2) {
                        var $55 = {};
                        for (var $56 in v2) {
                            if ({}.hasOwnProperty.call(v2, $56)) {
                                $55[$56] = v2[$56];
                            };
                        };
                        $55.value = newVal;
                        return $55;
                    }))(function () {
                        return Halogen_Query_HalogenM.raise(new ValueChanged(newVal));
                    }));
                };
                if (v1 instanceof Data_Maybe.Nothing) {
                    return pure(Data_Unit.unit);
                };
                throw new Error("Failed pattern match at Lattice.UI.Components.SliderInput (line 300, column 5 - line 306, column 27): " + [ v1.constructor.name ]);
            });
        };
        if (v instanceof OnInputBlur) {
            return pure(Data_Unit.unit);
        };
        throw new Error("Failed pattern match at Lattice.UI.Components.SliderInput (line 261, column 16 - line 308, column 27): " + [ v.constructor.name ]);
    };
};
var component = function (dictMonadAff) {
    return Halogen_Component.mkComponent({
        initialState: initialState,
        render: render,
        "eval": Halogen_Component.mkEval({
            handleQuery: Halogen_Component.defaultEval.handleQuery,
            finalize: Halogen_Component.defaultEval.finalize,
            handleAction: handleAction(dictMonadAff),
            initialize: new Data_Maybe.Just(Initialize.value),
            receive: function ($60) {
                return Data_Maybe.Just.create(Receive.create($60));
            }
        })
    });
};
export {
    component,
    ValueChanged
};
//# sourceMappingURL=index.js.map
