// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Semigroup from "../Data.Semigroup/index.js";
import * as Data_Show from "../Data.Show/index.js";
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var map = /* #__PURE__ */ Data_Functor.map(Data_Maybe.functorMaybe);
var show1 = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var map1 = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var append1 = /* #__PURE__ */ Data_Semigroup.append(Data_Semigroup.semigroupArray);
var metadataToJSON = function (meta) {
    return "{" + ("\"numPoints\":" + (show(meta.numPoints) + ("," + ("\"numFrames\":" + (show(meta.numFrames) + ("," + ("\"width\":" + (show(meta.width) + ("," + ("\"height\":" + (show(meta.height) + ("," + ("\"fps\":" + (show(meta.fps) + "}"))))))))))))));
};
var intercalateWith = function (sep) {
    return function (f) {
        return function (arr) {
            var unsafeHead = function ($copy_a) {
                var $tco_done = false;
                var $tco_result;
                function $tco_loop(a) {
                    var v = Data_Array.index(a)(0);
                    if (v instanceof Data_Maybe.Just) {
                        $tco_done = true;
                        return v.value0;
                    };
                    if (v instanceof Data_Maybe.Nothing) {
                        $copy_a = a;
                        return;
                    };
                    throw new Error("Failed pattern match at Lattice.Services.Export.WanMoveExport.Export (line 224, column 20 - line 226, column 30): " + [ v.constructor.name ]);
                };
                while (!$tco_done) {
                    $tco_result = $tco_loop($copy_a);
                };
                return $tco_result;
            };
            var n = Data_Array.length(arr);
            return Data_Array.foldl(function (acc) {
                return function (i) {
                    var prefix = (function () {
                        var $11 = i > 0;
                        if ($11) {
                            return sep;
                        };
                        return "";
                    })();
                    var item = Data_Maybe.fromMaybe(f(unsafeHead(arr)))(map(f)(Data_Array.index(arr)(i)));
                    return acc + (prefix + item);
                };
            })("")(Data_Array.range(0)(n - 1 | 0));
        };
    };
};
var toJSONArray = function (f) {
    return function (arr) {
        return "[" + (intercalateWith(",")(f)(arr) + "]");
    };
};
var tracksToJSON = function (tracks) {
    var pointToJSON = function (p) {
        return "[" + (show1(p.x) + ("," + (show1(p.y) + "]")));
    };
    var trackToJSON = function (track) {
        return "[" + (intercalateWith(",")(pointToJSON)(track) + "]");
    };
    return "[" + (intercalateWith(",")(trackToJSON)(tracks) + "]");
};
var visibilityToJSON = function (vis) {
    var rowToJSON = function (row) {
        return "[" + (intercalateWith(",")(function (b) {
            if (b) {
                return "true";
            };
            return "false";
        })(row) + "]");
    };
    return "[" + (intercalateWith(",")(rowToJSON)(vis) + "]");
};
var toJSON = function (trajectory) {
    return "{" + ("\"tracks\":" + (tracksToJSON(trajectory.tracks) + ("," + ("\"visibility\":" + (visibilityToJSON(trajectory.visibility) + ("," + ("\"metadata\":" + (metadataToJSON(trajectory.metadata) + "}"))))))));
};
var exportWanMoveVisibility = function (trajectory) {
    var transposed = map1(function (f) {
        return map1(function (n) {
            var visRow = Data_Maybe.fromMaybe([  ])(Data_Array.index(trajectory.visibility)(n));
            var visVal = Data_Maybe.fromMaybe(false)(Data_Array.index(visRow)(f));
            return visVal;
        })(Data_Array.range(0)(trajectory.metadata.numPoints - 1 | 0));
    })(Data_Array.range(0)(trajectory.metadata.numFrames - 1 | 0));
    var boolToJSON = function (b) {
        if (b) {
            return "true";
        };
        return "false";
    };
    var rowToJSON = function (row) {
        return toJSONArray(boolToJSON)(row);
    };
    return toJSONArray(rowToJSON)(transposed);
};
var exportWanMoveTrackCoordsJSON = function (trajectory) {
    var pointToJSON = function (p) {
        return "[" + (show1(p.x) + ("," + (show1(p.y) + "]")));
    };
    var trackToJSON = function (track) {
        return toJSONArray(pointToJSON)(track);
    };
    var formattedTracks = map1(function (track) {
        return map1(function (point) {
            return {
                x: point.x,
                y: point.y
            };
        })(track);
    })(trajectory.tracks);
    return toJSONArray(trackToJSON)(formattedTracks);
};
var exportWanMoveTrackCoordsPackage = function (trajectory) {
    return {
        trackCoords: exportWanMoveTrackCoordsJSON(trajectory),
        metadata: trajectory.metadata
    };
};
var exportAsNPYData = function (trajectory) {
    var flatVis = Data_Array.foldl(function (acc) {
        return function (i) {
            var visRow = Data_Maybe.fromMaybe([  ])(Data_Array.index(trajectory.visibility)(i));
            return Data_Array.foldl(function (acc$prime) {
                return function (f) {
                    var v = Data_Maybe.fromMaybe(false)(Data_Array.index(visRow)(f));
                    return append1(acc$prime)([ (function () {
                        if (v) {
                            return 1;
                        };
                        return 0;
                    })() ]);
                };
            })(acc)(Data_Array.range(0)(trajectory.metadata.numFrames - 1 | 0));
        };
    })([  ])(Data_Array.range(0)(trajectory.metadata.numPoints - 1 | 0));
    var flatTracks = Data_Array.foldl(function (acc) {
        return function (i) {
            var track = Data_Maybe.fromMaybe([  ])(Data_Array.index(trajectory.tracks)(i));
            return Data_Array.foldl(function (acc$prime) {
                return function (f) {
                    var point = Data_Maybe.fromMaybe({
                        x: 0.0,
                        y: 0.0
                    })(Data_Array.index(track)(f));
                    return append1(acc$prime)([ point.x, point.y ]);
                };
            })(acc)(Data_Array.range(0)(trajectory.metadata.numFrames - 1 | 0));
        };
    })([  ])(Data_Array.range(0)(trajectory.metadata.numPoints - 1 | 0));
    return {
        tracks: flatTracks,
        visibility: flatVis,
        shape: {
            tracks: {
                n: trajectory.metadata.numPoints,
                t: trajectory.metadata.numFrames,
                coords: 2
            },
            visibility: {
                n: trajectory.metadata.numPoints,
                t: trajectory.metadata.numFrames
            }
        }
    };
};
var exportAsJSON = function (trajectory) {
    return toJSON(trajectory);
};
export {
    exportAsJSON,
    exportWanMoveTrackCoordsJSON,
    exportWanMoveVisibility,
    exportWanMoveTrackCoordsPackage,
    exportAsNPYData
};
//# sourceMappingURL=index.js.map
