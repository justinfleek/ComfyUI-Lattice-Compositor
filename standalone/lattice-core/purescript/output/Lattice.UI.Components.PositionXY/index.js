// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Control_Monad_State_Class from "../Control.Monad.State.Class/index.js";
import * as DOM_HTML_Indexed_InputType from "../DOM.HTML.Indexed.InputType/index.js";
import * as Data_Function from "../Data.Function/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Halogen_Component from "../Halogen.Component/index.js";
import * as Halogen_HTML_Core from "../Halogen.HTML.Core/index.js";
import * as Halogen_HTML_Elements from "../Halogen.HTML.Elements/index.js";
import * as Halogen_HTML_Events from "../Halogen.HTML.Events/index.js";
import * as Halogen_HTML_Properties from "../Halogen.HTML.Properties/index.js";
import * as Halogen_Query_HalogenM from "../Halogen.Query.HalogenM/index.js";
import * as Lattice_UI_Core from "../Lattice.UI.Core/index.js";
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var type_ = /* #__PURE__ */ Halogen_HTML_Properties.type_(Halogen_HTML_Core.isPropInputType);
var value = /* #__PURE__ */ Halogen_HTML_Properties.value(Halogen_HTML_Core.isPropString);
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordNumber);
var min = /* #__PURE__ */ Data_Ord.min(Data_Ord.ordNumber);
var pure = /* #__PURE__ */ Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM);
var modify_ = /* #__PURE__ */ Control_Monad_State_Class.modify_(Halogen_Query_HalogenM.monadStateHalogenM);
var bind = /* #__PURE__ */ Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM);
var get = /* #__PURE__ */ Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM);
var when = /* #__PURE__ */ Control_Applicative.when(Halogen_Query_HalogenM.applicativeHalogenM);
var XChanged = /* #__PURE__ */ (function () {
    function XChanged(value0) {
        this.value0 = value0;
    };
    XChanged.create = function (value0) {
        return new XChanged(value0);
    };
    return XChanged;
})();
var YChanged = /* #__PURE__ */ (function () {
    function YChanged(value0) {
        this.value0 = value0;
    };
    YChanged.create = function (value0) {
        return new YChanged(value0);
    };
    return YChanged;
})();
var ZChanged = /* #__PURE__ */ (function () {
    function ZChanged(value0) {
        this.value0 = value0;
    };
    ZChanged.create = function (value0) {
        return new ZChanged(value0);
    };
    return ZChanged;
})();
var LinkedChanged = /* #__PURE__ */ (function () {
    function LinkedChanged(value0) {
        this.value0 = value0;
    };
    LinkedChanged.create = function (value0) {
        return new LinkedChanged(value0);
    };
    return LinkedChanged;
})();
var Initialize = /* #__PURE__ */ (function () {
    function Initialize() {

    };
    Initialize.value = new Initialize();
    return Initialize;
})();
var Receive = /* #__PURE__ */ (function () {
    function Receive(value0) {
        this.value0 = value0;
    };
    Receive.create = function (value0) {
        return new Receive(value0);
    };
    return Receive;
})();
var ToggleLink = /* #__PURE__ */ (function () {
    function ToggleLink() {

    };
    ToggleLink.value = new ToggleLink();
    return ToggleLink;
})();
var OnXInput = /* #__PURE__ */ (function () {
    function OnXInput(value0) {
        this.value0 = value0;
    };
    OnXInput.create = function (value0) {
        return new OnXInput(value0);
    };
    return OnXInput;
})();
var OnYInput = /* #__PURE__ */ (function () {
    function OnYInput(value0) {
        this.value0 = value0;
    };
    OnYInput.create = function (value0) {
        return new OnYInput(value0);
    };
    return OnYInput;
})();
var OnZInput = /* #__PURE__ */ (function () {
    function OnZInput(value0) {
        this.value0 = value0;
    };
    OnZInput.create = function (value0) {
        return new OnZInput(value0);
    };
    return OnZInput;
})();
var OnBlur = /* #__PURE__ */ (function () {
    function OnBlur() {

    };
    OnBlur.value = new OnBlur();
    return OnBlur;
})();
var rowStyle = "display: flex; align-items: center; gap: 4px;";
var roundToPrecision = function (prec) {
    return function (val) {
        var factor = Data_Number.pow(10.0)(Data_Int.toNumber(prec));
        return Data_Number.round(val * factor) / factor;
    };
};
var linkBtnStyle = function (linked) {
    return "width: 20px; height: 20px; padding: 0; border: none; " + ("border-radius: 3px; background: transparent; cursor: pointer; " + ("display: flex; align-items: center; justify-content: center; " + ("transition: all 0.1s; font-size: 12px; " + ("color: " + ((function () {
        if (linked) {
            return "var(--lattice-accent)";
        };
        return "var(--lattice-text-muted)";
    })() + ";")))));
};
var labelStyle = /* #__PURE__ */ (function () {
    return "font-size: 12px; color: var(--lattice-text-muted); " + "font-weight: 500; min-width: 12px;";
})();
var inputStyle = /* #__PURE__ */ (function () {
    return "width: 55px; padding: 4px 6px; " + ("border: 1px solid var(--lattice-border-subtle); border-radius: 3px; " + ("background: var(--lattice-surface-2); color: var(--lattice-text-primary); " + "font-size: 13px; text-align: right;"));
})();
var initialState = function (input) {
    return {
        x: input.x,
        y: input.y,
        z: input.z,
        linked: input.linked,
        showLink: input.showLink,
        step: input.step,
        min: input.min,
        max: input.max,
        disabled: input.disabled,
        precision: input.precision,
        previousX: input.x,
        previousY: input.y
    };
};
var formatNumber = function (val) {
    return function (prec) {
        return show(roundToPrecision(prec)(val));
    };
};
var renderAxisInput = function (axis) {
    return function (value1) {
        return function (onInput) {
            return function (state) {
                return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-position-row" ]), Halogen_HTML_Properties.attr("style")(rowStyle) ])([ Halogen_HTML_Elements.label([ Lattice_UI_Core.cls([ "lattice-axis-label" ]), Halogen_HTML_Properties.attr("style")(labelStyle) ])([ Halogen_HTML_Core.text(axis) ]), Halogen_HTML_Elements.input([ Lattice_UI_Core.cls([ "lattice-position-input" ]), type_(DOM_HTML_Indexed_InputType.InputNumber.value), value(formatNumber(value1)(state.precision)), Halogen_HTML_Properties.attr("min")(show(state.min)), Halogen_HTML_Properties.attr("max")(show(state.max)), Halogen_HTML_Properties.attr("step")(show(state.step)), Halogen_HTML_Properties.disabled(state.disabled), Halogen_HTML_Properties.attr("style")(inputStyle), Halogen_HTML_Events.onValueInput(onInput), Halogen_HTML_Events.onBlur(Data_Function["const"](OnBlur.value)) ]) ]);
            };
        };
    };
};
var containerStyle = "display: flex; align-items: center; gap: 8px;";
var render = function (state) {
    return Halogen_HTML_Elements.div([ Lattice_UI_Core.cls([ "lattice-position-xy" ]), Halogen_HTML_Properties.attr("data-state")((function () {
        if (state.disabled) {
            return "disabled";
        };
        return "enabled";
    })()), Halogen_HTML_Properties.attr("style")(containerStyle) ])([ renderAxisInput("X")(state.x)(OnXInput.create)(state), (function () {
        if (state.showLink) {
            return Halogen_HTML_Elements.button([ Lattice_UI_Core.cls([ "lattice-link-btn" ]), Halogen_HTML_Properties.attr("data-state")((function () {
                if (state.linked) {
                    return "linked";
                };
                return "unlinked";
            })()), Halogen_HTML_Properties.attr("style")(linkBtnStyle(state.linked)), Halogen_HTML_Properties.title("Link X and Y"), Halogen_HTML_Events.onClick(Data_Function["const"](ToggleLink.value)) ])([ Halogen_HTML_Core.text((function () {
                if (state.linked) {
                    return "\u26d3";
                };
                return "\u2212";
            })()) ]);
        };
        return Halogen_HTML_Core.text("");
    })(), renderAxisInput("Y")(state.y)(OnYInput.create)(state), (function () {
        if (state.z instanceof Data_Maybe.Just) {
            return renderAxisInput("Z")(state.z.value0)(OnZInput.create)(state);
        };
        if (state.z instanceof Data_Maybe.Nothing) {
            return Halogen_HTML_Core.text("");
        };
        throw new Error("Failed pattern match at Lattice.UI.Components.PositionXY (line 142, column 7 - line 144, column 30): " + [ state.z.constructor.name ]);
    })() ]);
};
var clampValue = function (minVal) {
    return function (maxVal) {
        return function (val) {
            return max(minVal)(min(maxVal)(val));
        };
    };
};
var handleAction = function (dictMonadAff) {
    return function (v) {
        if (v instanceof Initialize) {
            return pure(Data_Unit.unit);
        };
        if (v instanceof Receive) {
            return modify_(function (v1) {
                var $42 = {};
                for (var $43 in v1) {
                    if ({}.hasOwnProperty.call(v1, $43)) {
                        $42[$43] = v1[$43];
                    };
                };
                $42.x = v.value0.x;
                $42.y = v.value0.y;
                $42.z = v.value0.z;
                $42.linked = v.value0.linked;
                $42.showLink = v.value0.showLink;
                $42.step = v.value0.step;
                $42.min = v.value0.min;
                $42.max = v.value0.max;
                $42.disabled = v.value0.disabled;
                $42.precision = v.value0.precision;
                return $42;
            });
        };
        if (v instanceof ToggleLink) {
            return bind(get)(function (state) {
                var newLinked = !state.linked;
                return discard(modify_(function (v1) {
                    var $46 = {};
                    for (var $47 in v1) {
                        if ({}.hasOwnProperty.call(v1, $47)) {
                            $46[$47] = v1[$47];
                        };
                    };
                    $46.linked = newLinked;
                    return $46;
                }))(function () {
                    return Halogen_Query_HalogenM.raise(new LinkedChanged(newLinked));
                });
            });
        };
        if (v instanceof OnXInput) {
            return bind(get)(function (state) {
                var v1 = Data_Number.fromString(v.value0);
                if (v1 instanceof Data_Maybe.Just) {
                    var newX = roundToPrecision(state.precision)(clampValue(state.min)(state.max)(v1.value0));
                    var deltaX = newX - state.previousX;
                    return discard(modify_(function (v2) {
                        var $50 = {};
                        for (var $51 in v2) {
                            if ({}.hasOwnProperty.call(v2, $51)) {
                                $50[$51] = v2[$51];
                            };
                        };
                        $50.x = newX;
                        $50.previousX = newX;
                        return $50;
                    }))(function () {
                        return discard(Halogen_Query_HalogenM.raise(new XChanged(newX)))(function () {
                            return when(state.linked)((function () {
                                var newY = roundToPrecision(state.precision)(clampValue(state.min)(state.max)(state.y + deltaX));
                                return discard(modify_(function (v2) {
                                    var $53 = {};
                                    for (var $54 in v2) {
                                        if ({}.hasOwnProperty.call(v2, $54)) {
                                            $53[$54] = v2[$54];
                                        };
                                    };
                                    $53.y = newY;
                                    $53.previousY = newY;
                                    return $53;
                                }))(function () {
                                    return Halogen_Query_HalogenM.raise(new YChanged(newY));
                                });
                            })());
                        });
                    });
                };
                if (v1 instanceof Data_Maybe.Nothing) {
                    return pure(Data_Unit.unit);
                };
                throw new Error("Failed pattern match at Lattice.UI.Components.PositionXY (line 249, column 5 - line 260, column 27): " + [ v1.constructor.name ]);
            });
        };
        if (v instanceof OnYInput) {
            return bind(get)(function (state) {
                var v1 = Data_Number.fromString(v.value0);
                if (v1 instanceof Data_Maybe.Just) {
                    var newY = roundToPrecision(state.precision)(clampValue(state.min)(state.max)(v1.value0));
                    var deltaY = newY - state.previousY;
                    return discard(modify_(function (v2) {
                        var $59 = {};
                        for (var $60 in v2) {
                            if ({}.hasOwnProperty.call(v2, $60)) {
                                $59[$60] = v2[$60];
                            };
                        };
                        $59.y = newY;
                        $59.previousY = newY;
                        return $59;
                    }))(function () {
                        return discard(Halogen_Query_HalogenM.raise(new YChanged(newY)))(function () {
                            return when(state.linked)((function () {
                                var newX = roundToPrecision(state.precision)(clampValue(state.min)(state.max)(state.x + deltaY));
                                return discard(modify_(function (v2) {
                                    var $62 = {};
                                    for (var $63 in v2) {
                                        if ({}.hasOwnProperty.call(v2, $63)) {
                                            $62[$63] = v2[$63];
                                        };
                                    };
                                    $62.x = newX;
                                    $62.previousX = newX;
                                    return $62;
                                }))(function () {
                                    return Halogen_Query_HalogenM.raise(new XChanged(newX));
                                });
                            })());
                        });
                    });
                };
                if (v1 instanceof Data_Maybe.Nothing) {
                    return pure(Data_Unit.unit);
                };
                throw new Error("Failed pattern match at Lattice.UI.Components.PositionXY (line 264, column 5 - line 275, column 27): " + [ v1.constructor.name ]);
            });
        };
        if (v instanceof OnZInput) {
            return bind(get)(function (state) {
                var v1 = Data_Number.fromString(v.value0);
                if (v1 instanceof Data_Maybe.Just) {
                    var newZ = roundToPrecision(state.precision)(clampValue(state.min)(state.max)(v1.value0));
                    return discard(modify_(function (v2) {
                        var $68 = {};
                        for (var $69 in v2) {
                            if ({}.hasOwnProperty.call(v2, $69)) {
                                $68[$69] = v2[$69];
                            };
                        };
                        $68.z = new Data_Maybe.Just(newZ);
                        return $68;
                    }))(function () {
                        return Halogen_Query_HalogenM.raise(new ZChanged(newZ));
                    });
                };
                if (v1 instanceof Data_Maybe.Nothing) {
                    return pure(Data_Unit.unit);
                };
                throw new Error("Failed pattern match at Lattice.UI.Components.PositionXY (line 279, column 5 - line 284, column 27): " + [ v1.constructor.name ]);
            });
        };
        if (v instanceof OnBlur) {
            return pure(Data_Unit.unit);
        };
        throw new Error("Failed pattern match at Lattice.UI.Components.PositionXY (line 224, column 16 - line 286, column 22): " + [ v.constructor.name ]);
    };
};
var component = function (dictMonadAff) {
    return Halogen_Component.mkComponent({
        initialState: initialState,
        render: render,
        "eval": Halogen_Component.mkEval({
            handleQuery: Halogen_Component.defaultEval.handleQuery,
            finalize: Halogen_Component.defaultEval.finalize,
            handleAction: handleAction(dictMonadAff),
            initialize: new Data_Maybe.Just(Initialize.value),
            receive: function ($73) {
                return Data_Maybe.Just.create(Receive.create($73));
            }
        })
    });
};
export {
    component,
    XChanged,
    YChanged,
    ZChanged,
    LinkedChanged
};
//# sourceMappingURL=index.js.map
