// Generated by purs version 0.15.15
import * as Data_Array from "../Data.Array/index.js";
import * as Data_EuclideanRing from "../Data.EuclideanRing/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Number from "../Data.Number/index.js";
import * as Data_Ord from "../Data.Ord/index.js";
import * as Data_Semiring from "../Data.Semiring/index.js";
var max = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordInt);
var min = /* #__PURE__ */ Data_Ord.min(Data_Ord.ordInt);
var max1 = /* #__PURE__ */ Data_Ord.max(Data_Ord.ordNumber);
var map = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorArray);
var add = /* #__PURE__ */ Data_Semiring.add(Data_Semiring.semiringNumber);
var mod = /* #__PURE__ */ Data_EuclideanRing.mod(Data_EuclideanRing.euclideanRingInt);
var EdgeClamp = /* #__PURE__ */ (function () {
    function EdgeClamp() {

    };
    EdgeClamp.value = new EdgeClamp();
    return EdgeClamp;
})();
var EdgeWrap = /* #__PURE__ */ (function () {
    function EdgeWrap() {

    };
    EdgeWrap.value = new EdgeWrap();
    return EdgeWrap;
})();
var EdgeMirror = /* #__PURE__ */ (function () {
    function EdgeMirror() {

    };
    EdgeMirror.value = new EdgeMirror();
    return EdgeMirror;
})();
var showEdgeMode = {
    show: function (v) {
        if (v instanceof EdgeClamp) {
            return "EdgeClamp";
        };
        if (v instanceof EdgeWrap) {
            return "EdgeWrap";
        };
        if (v instanceof EdgeMirror) {
            return "EdgeMirror";
        };
        throw new Error("Failed pattern match at Lattice.Services.Effects.BlurGaussian (line 50, column 1 - line 53, column 33): " + [ v.constructor.name ]);
    }
};
var safeIndex = function (arr) {
    return function (i) {
        return function (def) {
            return Data_Maybe.fromMaybe(def)(Data_Array.index(arr)(i));
        };
    };
};
var gaussianWeight = function (sigma) {
    return function (x) {
        var sigma2 = sigma * sigma;
        var coeff = 1.0 / (Data_Number.sqrt(2.0 * Data_Number.pi) * sigma);
        return coeff * Data_Number.exp(-(x * x) / (2.0 * sigma2));
    };
};
var eqEdgeMode = {
    eq: function (x) {
        return function (y) {
            if (x instanceof EdgeClamp && y instanceof EdgeClamp) {
                return true;
            };
            if (x instanceof EdgeWrap && y instanceof EdgeWrap) {
                return true;
            };
            if (x instanceof EdgeMirror && y instanceof EdgeMirror) {
                return true;
            };
            return false;
        };
    }
};
var defaultGaussianParams = /* #__PURE__ */ (function () {
    return {
        radius: 5,
        quality: 1.0,
        edgeMode: EdgeClamp.value
    };
})();
var clampInt = function (lo) {
    return function (hi) {
        return function (x) {
            return max(lo)(min(hi)(x));
        };
    };
};
var generateGaussianKernel = function (radius) {
    return function (quality) {
        var r = clampInt(1)(250)(radius);
        var sigma = Data_Int.toNumber(r) / max1(0.1)(quality);
        var weights = map(function (i) {
            return gaussianWeight(sigma)(Data_Int.toNumber(i));
        })(Data_Array.range(0)(r));
        var sideSum = Data_Array.foldl(add)(0.0)(map(function (i) {
            return safeIndex(weights)(i)(0.0);
        })(Data_Array.range(1)(r)));
        var centerWeight = safeIndex(weights)(0)(0.0);
        var totalSum = centerWeight + 2.0 * sideSum;
        return {
            weights: weights,
            radius: r,
            sum: totalSum
        };
    };
};
var clamp01 = /* #__PURE__ */ (function () {
    var $28 = max1(0.0);
    var $29 = Data_Ord.min(Data_Ord.ordNumber)(1.0);
    return function ($30) {
        return $28($29($30));
    };
})();
var applyKernel1D = function (pixels) {
    return function (kernel) {
        return function (mode) {
            return function (x) {
                var width = Data_Array.length(pixels);
                var sample = function (i) {
                    if (mode instanceof EdgeClamp) {
                        return safeIndex(pixels)(clampInt(0)(width - 1 | 0)(i))(0.0);
                    };
                    if (mode instanceof EdgeWrap) {
                        return safeIndex(pixels)(mod(i)(width))(0.0);
                    };
                    if (mode instanceof EdgeMirror) {
                        var i$prime = (function () {
                            var $25 = i < 0;
                            if ($25) {
                                return (-i | 0) - 1 | 0;
                            };
                            var $26 = i >= width;
                            if ($26) {
                                return ((2 * width | 0) - i | 0) - 1 | 0;
                            };
                            return i;
                        })();
                        return safeIndex(pixels)(clampInt(0)(width - 1 | 0)(i$prime))(0.0);
                    };
                    throw new Error("Failed pattern match at Lattice.Services.Effects.BlurGaussian (line 128, column 18 - line 135, column 62): " + [ mode.constructor.name ]);
                };
                var sides = Data_Array.foldl(add)(0.0)(Data_Array.mapWithIndex(function (i) {
                    return function (w) {
                        var $27 = i === 0;
                        if ($27) {
                            return 0.0;
                        };
                        return w * (sample(x - i | 0) + sample(x + i | 0));
                    };
                })(kernel.weights));
                var centerWeight = safeIndex(kernel.weights)(0)(0.0);
                var center = sample(x) * centerWeight;
                return (center + sides) / kernel.sum;
            };
        };
    };
};
export {
    EdgeClamp,
    EdgeWrap,
    EdgeMirror,
    defaultGaussianParams,
    gaussianWeight,
    generateGaussianKernel,
    applyKernel1D,
    eqEdgeMode,
    showEdgeMode
};
//# sourceMappingURL=index.js.map
