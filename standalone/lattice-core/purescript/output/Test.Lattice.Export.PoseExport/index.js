// Generated by purs version 0.15.15
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Identity from "../Data.Identity/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Effect_Aff from "../Effect.Aff/index.js";
import * as Lattice_Services_Export_Pose from "../Lattice.Services.Export.Pose/index.js";
import * as Test_Lattice_TestHelpers from "../Test.Lattice.TestHelpers/index.js";
import * as Test_Spec from "../Test.Spec/index.js";
import * as Test_Spec_Assertions from "../Test.Spec.Assertions/index.js";
var describe = /* #__PURE__ */ Test_Spec.describe(Data_Identity.monadIdentity);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit);
var discard1 = /* #__PURE__ */ discard(/* #__PURE__ */ Test_Spec.bindSpecT(Data_Identity.bindIdentity));
var it = /* #__PURE__ */ Test_Spec.it(Data_Identity.monadIdentity)(Test_Spec.exampleMUnit);
var discard2 = /* #__PURE__ */ discard(Effect_Aff.bindAff);
var shouldEqual = /* #__PURE__ */ Test_Spec_Assertions.shouldEqual(Effect_Aff.monadThrowAff);
var shouldEqual1 = /* #__PURE__ */ shouldEqual(Data_Show.showBoolean)(Data_Eq.eqBoolean);
var shouldEqual2 = /* #__PURE__ */ shouldEqual(Data_Show.showInt)(Data_Eq.eqInt);
var mkPose = function (id) {
    return function (kps) {
        return {
            id: id,
            keypoints: kps,
            format: Lattice_Services_Export_Pose.FormatCOCO18.value
        };
    };
};
var mkKeypoint = function (x) {
    return function (y) {
        return function (c) {
            return {
                x: x,
                y: y,
                confidence: c
            };
        };
    };
};
var simplePose = /* #__PURE__ */ mkPose("test")(/* #__PURE__ */ Data_Array.mapWithIndex(function (i) {
    return function (v) {
        return mkKeypoint(Data_Int.toNumber(i) * 10.0)(Data_Int.toNumber(i) * 20.0)(1.0);
    };
})(/* #__PURE__ */ Data_Array.range(0)(17)));
var simplePose2 = /* #__PURE__ */ mkPose("test2")(/* #__PURE__ */ Data_Array.mapWithIndex(function (i) {
    return function (v) {
        return mkKeypoint(Data_Int.toNumber(i) * 10.0 + 100.0)(Data_Int.toNumber(i) * 20.0 + 200.0)(0.5);
    };
})(/* #__PURE__ */ Data_Array.range(0)(17)));
var interpolatePosesTests = /* #__PURE__ */ describe("interpolatePoses")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("t=0 returns first pose keypoints")(/* #__PURE__ */ (function () {
    var result = Lattice_Services_Export_Pose.interpolatePoses(simplePose)(simplePose2)(0.0);
    var v = Data_Array.index(result.keypoints)(1);
    if (v instanceof Data_Maybe.Just) {
        return discard2(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(10.0)(v.value0.x))(function () {
            return Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(20.0)(v.value0.y);
        });
    };
    if (v instanceof Data_Maybe.Nothing) {
        return shouldEqual1(true)(false);
    };
    throw new Error("Failed pattern match at Test.Lattice.Export.PoseExport (line 186, column 7 - line 191, column 42): " + [ v.constructor.name ]);
})()))(function () {
    return discard1(it("t=1 returns second pose keypoints")((function () {
        var result = Lattice_Services_Export_Pose.interpolatePoses(simplePose)(simplePose2)(1.0);
        var v = Data_Array.index(result.keypoints)(1);
        if (v instanceof Data_Maybe.Just) {
            return discard2(Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(110.0)(v.value0.x))(function () {
                return Test_Lattice_TestHelpers.assertCloseTo(1.0e-10)(220.0)(v.value0.y);
            });
        };
        if (v instanceof Data_Maybe.Nothing) {
            return shouldEqual1(true)(false);
        };
        throw new Error("Failed pattern match at Test.Lattice.Export.PoseExport (line 195, column 7 - line 200, column 42): " + [ v.constructor.name ]);
    })()))(function () {
        return it("t=0.5 interpolates correctly")((function () {
            var result = Lattice_Services_Export_Pose.interpolatePoses(simplePose)(simplePose2)(0.5);
            var v = Data_Array.index(result.keypoints)(1);
            if (v instanceof Data_Maybe.Just) {
                return discard2(Test_Lattice_TestHelpers.assertCloseTo(1.0e-5)(60.0)(v.value0.x))(function () {
                    return Test_Lattice_TestHelpers.assertCloseTo(1.0e-5)(120.0)(v.value0.y);
                });
            };
            if (v instanceof Data_Maybe.Nothing) {
                return shouldEqual1(true)(false);
            };
            throw new Error("Failed pattern match at Test.Lattice.Export.PoseExport (line 204, column 7 - line 209, column 42): " + [ v.constructor.name ]);
        })());
    });
}));
var importRoundtripTests = /* #__PURE__ */ describe("importFromOpenPoseJSON roundtrip")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("import(export(pose)) preserves keypoint count")(/* #__PURE__ */ (function () {
    var exported = Lattice_Services_Export_Pose.exportToOpenPoseJSON([ simplePose ]);
    var imported = Lattice_Services_Export_Pose.importFromOpenPoseJSON(exported);
    var v = Data_Array.index(imported)(0);
    if (v instanceof Data_Maybe.Just) {
        return shouldEqual2(Data_Array.length(v.value0.keypoints))(18);
    };
    if (v instanceof Data_Maybe.Nothing) {
        return shouldEqual1(true)(false);
    };
    throw new Error("Failed pattern match at Test.Lattice.Export.PoseExport (line 143, column 7 - line 145, column 42): " + [ v.constructor.name ]);
})()))(function () {
    return discard1(it("import(export(pose)) preserves approximate coordinates")((function () {
        var exported = Lattice_Services_Export_Pose.exportToOpenPoseJSON([ simplePose ]);
        var imported = Lattice_Services_Export_Pose.importFromOpenPoseJSON(exported);
        var v = Data_Array.index(imported)(0);
        if (v instanceof Data_Maybe.Just) {
            return discard2((function () {
                var v1 = Data_Array.index(v.value0.keypoints)(0);
                if (v1 instanceof Data_Maybe.Just) {
                    return discard2(Test_Lattice_TestHelpers.assertCloseTo(1.0e-2)(0.0)(v1.value0.x))(function () {
                        return Test_Lattice_TestHelpers.assertCloseTo(1.0e-2)(0.0)(v1.value0.y);
                    });
                };
                if (v1 instanceof Data_Maybe.Nothing) {
                    return shouldEqual1(true)(false);
                };
                throw new Error("Failed pattern match at Test.Lattice.Export.PoseExport (line 153, column 11 - line 157, column 46): " + [ v1.constructor.name ]);
            })())(function () {
                var v1 = Data_Array.index(v.value0.keypoints)(1);
                if (v1 instanceof Data_Maybe.Just) {
                    return discard2(Test_Lattice_TestHelpers.assertCloseTo(1.0e-2)(10.0)(v1.value0.x))(function () {
                        return Test_Lattice_TestHelpers.assertCloseTo(1.0e-2)(20.0)(v1.value0.y);
                    });
                };
                if (v1 instanceof Data_Maybe.Nothing) {
                    return shouldEqual1(true)(false);
                };
                throw new Error("Failed pattern match at Test.Lattice.Export.PoseExport (line 159, column 11 - line 163, column 46): " + [ v1.constructor.name ]);
            });
        };
        if (v instanceof Data_Maybe.Nothing) {
            return shouldEqual1(true)(false);
        };
        throw new Error("Failed pattern match at Test.Lattice.Export.PoseExport (line 150, column 7 - line 164, column 42): " + [ v.constructor.name ]);
    })()))(function () {
        return discard1(it("import from empty people array returns empty array")((function () {
            var emptyJSON = {
                version: 1.0,
                people: [  ]
            };
            var imported = Lattice_Services_Export_Pose.importFromOpenPoseJSON(emptyJSON);
            return shouldEqual2(Data_Array.length(imported))(0);
        })()))(function () {
            return it("roundtrip preserves multiple poses")((function () {
                var exported = Lattice_Services_Export_Pose.exportToOpenPoseJSON([ simplePose, simplePose2 ]);
                var imported = Lattice_Services_Export_Pose.importFromOpenPoseJSON(exported);
                return shouldEqual2(Data_Array.length(imported))(2);
            })());
        });
    });
}));
var exportToOpenPoseJSONTests = /* #__PURE__ */ describe("exportToOpenPoseJSON")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("exports a valid version number")(/* #__PURE__ */ (function () {
    var result = Lattice_Services_Export_Pose.exportToOpenPoseJSON([ simplePose ]);
    return shouldEqual1(result.version > 0.0)(true);
})()))(function () {
    return discard1(it("exports correct number of people")((function () {
        var result = Lattice_Services_Export_Pose.exportToOpenPoseJSON([ simplePose ]);
        return shouldEqual2(Data_Array.length(result.people))(1);
    })()))(function () {
        return discard1(it("pose_keypoints_2d has 54 values (18 keypoints x 3)")((function () {
            var result = Lattice_Services_Export_Pose.exportToOpenPoseJSON([ simplePose ]);
            var v = Data_Array.index(result.people)(0);
            if (v instanceof Data_Maybe.Just) {
                return shouldEqual2(Data_Array.length(v.value0.pose_keypoints_2d))(54);
            };
            if (v instanceof Data_Maybe.Nothing) {
                return shouldEqual1(true)(false);
            };
            throw new Error("Failed pattern match at Test.Lattice.Export.PoseExport (line 110, column 7 - line 112, column 42): " + [ v.constructor.name ]);
        })()))(function () {
            return discard1(it("face_keypoints_2d is empty array")((function () {
                var result = Lattice_Services_Export_Pose.exportToOpenPoseJSON([ simplePose ]);
                var v = Data_Array.index(result.people)(0);
                if (v instanceof Data_Maybe.Just) {
                    return shouldEqual2(Data_Array.length(v.value0.face_keypoints_2d))(0);
                };
                if (v instanceof Data_Maybe.Nothing) {
                    return shouldEqual1(true)(false);
                };
                throw new Error("Failed pattern match at Test.Lattice.Export.PoseExport (line 116, column 7 - line 118, column 42): " + [ v.constructor.name ]);
            })()))(function () {
                return discard1(it("hand arrays are empty")((function () {
                    var result = Lattice_Services_Export_Pose.exportToOpenPoseJSON([ simplePose ]);
                    var v = Data_Array.index(result.people)(0);
                    if (v instanceof Data_Maybe.Just) {
                        return discard2(shouldEqual2(Data_Array.length(v.value0.hand_left_keypoints_2d))(0))(function () {
                            return shouldEqual2(Data_Array.length(v.value0.hand_right_keypoints_2d))(0);
                        });
                    };
                    if (v instanceof Data_Maybe.Nothing) {
                        return shouldEqual1(true)(false);
                    };
                    throw new Error("Failed pattern match at Test.Lattice.Export.PoseExport (line 122, column 7 - line 126, column 42): " + [ v.constructor.name ]);
                })()))(function () {
                    return it("handles empty poses array")((function () {
                        var result = Lattice_Services_Export_Pose.exportToOpenPoseJSON([  ]);
                        return shouldEqual2(Data_Array.length(result.people))(0);
                    })());
                });
            });
        });
    });
}));
var defaultConfigTests = /* #__PURE__ */ (function () {
    return describe("defaultPoseExportConfig")(discard1(it("has reasonable default width/height")(discard2(shouldEqual1(Lattice_Services_Export_Pose.defaultPoseExportConfig.width > 0)(true))(function () {
        return discard2(shouldEqual1(Lattice_Services_Export_Pose.defaultPoseExportConfig.height > 0)(true))(function () {
            return discard2(shouldEqual1(Lattice_Services_Export_Pose.defaultPoseExportConfig.width >= 64)(true))(function () {
                return shouldEqual1(Lattice_Services_Export_Pose.defaultPoseExportConfig.height >= 64)(true);
            });
        });
    })))(function () {
        return it("has valid default output format")(shouldEqual1(true)(true));
    }));
})();
var createPoseSequenceTests = /* #__PURE__ */ describe("createPoseSequence")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("creates correct number of frames")(/* #__PURE__ */ (function () {
    var keyframes = [ {
        frame: 0,
        poses: [ simplePose ]
    }, {
        frame: 10,
        poses: [ simplePose2 ]
    } ];
    var seq = Lattice_Services_Export_Pose.createPoseSequence(keyframes)(11)(24);
    return shouldEqual2(Data_Array.length(seq.frames))(11);
})()))(function () {
    return discard1(it("frames are numbered sequentially starting from 0")((function () {
        var keyframes = [ {
            frame: 0,
            poses: [ simplePose ]
        }, {
            frame: 4,
            poses: [ simplePose2 ]
        } ];
        var seq = Lattice_Services_Export_Pose.createPoseSequence(keyframes)(5)(30);
        return discard2((function () {
            var v = Data_Array.index(seq.frames)(0);
            if (v instanceof Data_Maybe.Just) {
                return shouldEqual2(v.value0.frameNumber)(0);
            };
            if (v instanceof Data_Maybe.Nothing) {
                return shouldEqual1(true)(false);
            };
            throw new Error("Failed pattern match at Test.Lattice.Export.PoseExport (line 233, column 7 - line 235, column 42): " + [ v.constructor.name ]);
        })())(function () {
            var v = Data_Array.index(seq.frames)(4);
            if (v instanceof Data_Maybe.Just) {
                return shouldEqual2(v.value0.frameNumber)(4);
            };
            if (v instanceof Data_Maybe.Nothing) {
                return shouldEqual1(true)(false);
            };
            throw new Error("Failed pattern match at Test.Lattice.Export.PoseExport (line 236, column 7 - line 238, column 42): " + [ v.constructor.name ]);
        });
    })()))(function () {
        return it("sequence stores fps correctly")((function () {
            var keyframes = [ {
                frame: 0,
                poses: [ simplePose ]
            } ];
            var seq = Lattice_Services_Export_Pose.createPoseSequence(keyframes)(10)(24);
            return shouldEqual2(seq.fps)(24);
        })());
    });
}));
var cocoBonesAndColorsTests = /* #__PURE__ */ describe("cocoBones and colors")(/* #__PURE__ */ discard1(/* #__PURE__ */ it("cocoBones has 16 bone connections")(/* #__PURE__ */ shouldEqual2(/* #__PURE__ */ Data_Array.length(Lattice_Services_Export_Pose.cocoBones))(16)))(function () {
    return discard1(it("openposeColors has 6 named color fields")(discard2(shouldEqual1(Lattice_Services_Export_Pose.openposeColors.head !== "")(true))(function () {
        return discard2(shouldEqual1(Lattice_Services_Export_Pose.openposeColors.right_arm !== "")(true))(function () {
            return discard2(shouldEqual1(Lattice_Services_Export_Pose.openposeColors.left_arm !== "")(true))(function () {
                return discard2(shouldEqual1(Lattice_Services_Export_Pose.openposeColors.right_leg !== "")(true))(function () {
                    return discard2(shouldEqual1(Lattice_Services_Export_Pose.openposeColors.left_leg !== "")(true))(function () {
                        return shouldEqual1(Lattice_Services_Export_Pose.openposeColors.torso !== "")(true);
                    });
                });
            });
        });
    })))(function () {
        return it("each bone connection has exactly 2 indices")((function () {
            var allHaveTwo = Data_Array.all(function (bone) {
                return Data_Array.length(bone) === 2;
            })(Lattice_Services_Export_Pose.cocoBones);
            return shouldEqual1(allHaveTwo)(true);
        })());
    });
}));
var spec = /* #__PURE__ */ describe("PoseExport")(/* #__PURE__ */ discard1(cocoBonesAndColorsTests)(function () {
    return discard1(exportToOpenPoseJSONTests)(function () {
        return discard1(importRoundtripTests)(function () {
            return discard1(interpolatePosesTests)(function () {
                return discard1(createPoseSequenceTests)(function () {
                    return defaultConfigTests;
                });
            });
        });
    });
}));
export {
    spec
};
//# sourceMappingURL=index.js.map
