# BUG-036: NaN Keyframe Accumulation Due to Equality Check Failure

## Summary
The `addCameraKeyframe()` function uses `k.frame === keyframe.frame` to check for existing keyframes. Since `NaN === NaN` is `false` in JavaScript, keyframes with `frame = NaN` are never detected as duplicates and accumulate indefinitely. Additionally, `sort()` with NaN values produces undefined ordering.

## Severity: LOW

## Location
- File: /ui/src/stores/actions/cameraActions.ts
- Lines: 207, 213, 230
- Functions: addCameraKeyframe, removeCameraKeyframe

## The Bug

### NaN === NaN is false
```typescript
// Line 207 - NaN equality check always fails
const existingIndex = keyframes.findIndex(k => k.frame === keyframe.frame);
// If keyframe.frame = NaN:
// k.frame === NaN is ALWAYS false (even if k.frame is also NaN)
// So existingIndex is always -1

if (existingIndex >= 0) {
  keyframes[existingIndex] = keyframe;  // Never executes for NaN
} else {
  keyframes.push(keyframe);  // ALWAYS pushes NaN keyframes
  keyframes.sort((a, b) => a.frame - b.frame);  // Line 213 - undefined with NaN
}
```

### Sort with NaN is undefined
```typescript
// Line 213
keyframes.sort((a, b) => a.frame - b.frame);
// NaN - number = NaN
// NaN - NaN = NaN
// Comparator returning NaN is treated as 0 by some implementations
// Result: undefined ordering, NaN keyframes may end up anywhere
```

### Same issue in removeCameraKeyframe
```typescript
// Line 230 - Same NaN equality problem
const index = keyframes.findIndex(k => k.frame === frame);
// If frame = NaN, index is always -1, keyframe never removed
```

## Proof of Failure
```typescript
const store = createCameraStore();
const cameraId = "cam1";

// Add same NaN keyframe multiple times
addCameraKeyframe(store, cameraId, { frame: NaN, position: [0,0,0] });
addCameraKeyframe(store, cameraId, { frame: NaN, position: [1,1,1] });
addCameraKeyframe(store, cameraId, { frame: NaN, position: [2,2,2] });

const keyframes = getCameraKeyframes(store, cameraId);
console.log(keyframes.length);  // 3, not 1 (should deduplicate)

// Try to remove
removeCameraKeyframe(store, cameraId, NaN);
console.log(keyframes.length);  // Still 3 (NaN keyframe can't be removed)
```

## Impact
- NaN keyframes accumulate with each edit, never replaced
- Cannot remove NaN keyframes once added
- Sort produces unstable/incorrect ordering
- Low severity because NaN frame requires upstream bug, but once introduced, data corrupts progressively

## Suggested Fix
Use `Number.isNaN()` or `Object.is()` for comparison:
```typescript
// Option 1: Reject NaN frames
export function addCameraKeyframe(
  store: CameraStore,
  cameraId: string,
  keyframe: CameraKeyframe
): void {
  if (!Number.isFinite(keyframe.frame)) {
    console.warn('Invalid keyframe frame:', keyframe.frame);
    return;
  }
  // ... rest of function
}

// Option 2: Use Object.is for comparison
const existingIndex = keyframes.findIndex(k => Object.is(k.frame, keyframe.frame));
// Object.is(NaN, NaN) returns true
```
