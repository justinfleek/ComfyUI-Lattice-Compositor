# BUG-104: LatticeEngine.setViewportTransform() No Validation

## Summary
The `setViewportTransform(transform)` method accepts a `number[]` parameter without any validation. It directly accesses `transform[0]`, `transform[4]`, and `transform[5]` which will be undefined if the array is too short, and passes potentially invalid values (0, NaN, Infinity) to camera methods.

## Severity: MEDIUM

## Location
- File: /ui/src/engine/LatticeEngine.ts
- Lines: 1023-1034
- Function: setViewportTransform

## The Bug
```typescript
// Lines 1023-1034
setViewportTransform(transform: number[]): void {
  this.viewportTransform = [...transform];  // No validation!

  // Direct array access without bounds checking
  const scale = transform[0];   // undefined if transform.length < 1
  const tx = transform[4];      // undefined if transform.length < 5
  const ty = transform[5];      // undefined if transform.length < 6

  // Passes potentially undefined/NaN/Infinity/0 to camera
  this.camera.setZoom(scale);   // scale=undefined → NaN in camera
  this.camera.setPan(tx, ty);   // tx/ty=undefined → NaN in camera
}
```

## Proof of Failure
```typescript
const engine = new LatticeEngine(config);

// Attack 1: Empty array
engine.setViewportTransform([]);
// scale = undefined, tx = undefined, ty = undefined
// camera.setZoom(undefined) → likely crash or NaN
// camera.setPan(undefined, undefined) → NaN in pan calculations

// Attack 2: Short array
engine.setViewportTransform([1, 0, 0, 1]);  // Missing tx, ty
// tx = undefined, ty = undefined
// camera.setPan(undefined, undefined) → NaN

// Attack 3: Scale = 0
engine.setViewportTransform([0, 0, 0, 0, 0, 0]);
// scale = 0
// camera.setZoom(0) → Division by zero in zoom calculations

// Attack 4: NaN/Infinity in transform
engine.setViewportTransform([NaN, 0, 0, NaN, Infinity, -Infinity]);
// All camera operations receive bad values

// Attack 5: Null/undefined
engine.setViewportTransform(null as any);
// Crash on [...transform] or transform[0]
```

## Impact
- Array index out of bounds → undefined values
- Undefined converted to NaN in camera calculations
- scale=0 causes division by zero in zoom math
- NaN/Infinity propagate to camera matrix
- Can crash if null/undefined passed
- Corrupts viewport for all subsequent renders

## Related
- 14C: Array inputs - empty, short, wrong type
- 14A: Numeric inputs - 0, NaN, Infinity
- 14D: Object inputs - null/undefined

## Suggested Fix
```typescript
setViewportTransform(transform: number[]): void {
  // Validate array exists and has correct length
  if (!Array.isArray(transform) || transform.length < 6) {
    console.warn('setViewportTransform: Invalid transform array, requires 6 elements');
    return;
  }

  // Validate all values are finite numbers
  for (let i = 0; i < 6; i++) {
    if (!Number.isFinite(transform[i])) {
      console.warn('setViewportTransform: Transform contains invalid value at index', i);
      return;
    }
  }

  // Validate scale is non-zero (avoid division by zero)
  if (transform[0] === 0 || transform[3] === 0) {
    console.warn('setViewportTransform: Scale cannot be zero');
    return;
  }

  this.viewportTransform = [...transform];

  const scale = transform[0];
  const tx = transform[4];
  const ty = transform[5];

  this.camera.setZoom(scale);
  this.camera.setPan(tx, ty);
}
```
