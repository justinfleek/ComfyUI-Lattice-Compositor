# BUG-058: Drag Force Has Wrong Sign (Accelerates Instead of Decelerates)

## Summary
The drag force calculation at line 106 produces a force in the SAME direction as velocity instead of opposing it. This causes drag to accelerate particles rather than slow them down.

## Severity: MEDIUM

## Location
- File: /ui/src/engine/particles/ParticleForceCalculator.ts
- Lines: 101-108
- Function: calculateForceField (case 'drag')

## The Bug
```typescript
// Lines 101-108
case 'drag': {
  const speed = Math.sqrt(vx * vx + vy * vy + vz * vz);
  if (speed > 0.001) {
    const dragMag = (field.linearDrag ?? 0.1) * speed +
                   (field.quadraticDrag ?? 0.01) * speed * speed;
    force.set(-vx, -vy, -vz).normalize().multiplyScalar(-dragMag * strength);
    //                                                  ^--- WRONG SIGN
  }
  break;
}
```

## Sign Analysis
Given velocity v = (vx, vy, vz) moving in +x direction, e.g., (100, 0, 0):

1. `set(-vx, -vy, -vz)` → (-100, 0, 0) - opposite of velocity ✓
2. `normalize()` → (-1, 0, 0) - unit vector opposite velocity ✓
3. `multiplyScalar(-dragMag * strength)`:
   - dragMag = linearDrag * speed + quadraticDrag * speed² > 0
   - strength > 0 (typical)
   - `-dragMag * strength` < 0 (NEGATIVE)
   - (-1, 0, 0) * (negative) = (+1, 0, 0) - points IN direction of velocity ✗

## Proof of Failure
```typescript
// Particle moving right at 100 units/sec
const vx = 100, vy = 0, vz = 0;
const field = {
  type: 'drag',
  position: { x: 0, y: 0, z: 0 },
  strength: 1,
  linearDrag: 0.1,
  quadraticDrag: 0.01,
  falloffStart: 0,
  falloffEnd: 1000,
  falloffType: 'none'
};

const force = calculateForceField(field, 0, 0, 0, vx, vy, vz, 1, 0);
console.log(force);
// Expected: negative x (opposing motion) → { x: -110, y: 0, z: 0 }
// Actual: positive x (same as motion) → { x: 110, y: 0, z: 0 }

// Over time, particle ACCELERATES instead of slowing down!
```

## Impact
- Particles with drag enabled accelerate infinitely instead of slowing down
- Any particle system using drag force field behaves incorrectly
- Visual effect is completely wrong - particles speed up when they should slow down
- Medium severity: Affects core physics behavior

## Suggested Fix
Remove the extra negative sign:
```typescript
case 'drag': {
  const speed = Math.sqrt(vx * vx + vy * vy + vz * vz);
  if (speed > 0.001) {
    const dragMag = (field.linearDrag ?? 0.1) * speed +
                   (field.quadraticDrag ?? 0.01) * speed * speed;
    // Remove the negative sign - the set(-vx,-vy,-vz) already opposes velocity
    force.set(-vx, -vy, -vz).normalize().multiplyScalar(dragMag * strength);
  }
  break;
}
```

Or equivalently, keep the sign and fix the set():
```typescript
force.set(vx, vy, vz).normalize().multiplyScalar(-dragMag * strength);
```
