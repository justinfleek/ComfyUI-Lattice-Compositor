# BUG-160: LightLayer.onApplyEvaluatedState() NaN Stored Directly

## Summary
onApplyEvaluatedState() assigns evaluated property values directly to light properties without validation. NaN values from expressions corrupt lighting.

## Severity: LOW

## Location
- File: /ui/src/engine/layers/LightLayer.ts
- Lines: 950-992
- Function: onApplyEvaluatedState()

## Crash Path Trace
```
Function: onApplyEvaluatedState(state: EvaluatedLayer)

Line 954-956:
  if (props['intensity'] !== undefined) {
    this.light.intensity = (props['intensity'] as number) / 100;
  }
  - props['intensity']=NaN → light.intensity = NaN / 100 = NaN

Line 959-964:
  if (props['coneAngle'] !== undefined && this.light instanceof THREE.SpotLight) {
    this.light.angle = THREE.MathUtils.degToRad((props['coneAngle'] as number) / 2);
  }
  - props['coneAngle']=NaN → degToRad(NaN/2) = NaN → light.angle = NaN

Line 972-975:
  if (props['colorTemperature'] !== undefined && this.lightData.useColorTemperature) {
    const rgb = kelvinToRGB(props['colorTemperature'] as number);
    this.light.color.setRGB(rgb.r, rgb.g, rgb.b);
  }
  - props['colorTemperature']=NaN → kelvinToRGB(NaN) → NaN colors

Line 978-982:
  if (props['falloffDistance'] !== undefined) {
    this.light.distance = this.lightData.falloff === 'none' ? 0 : (props['falloffDistance'] as number);
  }
  - props['falloffDistance']=NaN → light.distance = NaN

Result: SILENT CORRUPTION (SYSTEMIC-005) - multiple light properties can become NaN
```

## Code Evidence
```typescript
// Lines 950-982
protected override onApplyEvaluatedState(state: import('../MotionEngine').EvaluatedLayer): void {
  const props = state.properties;

  if (props['intensity'] !== undefined) {
    this.light.intensity = (props['intensity'] as number) / 100;  // No validation
  }

  if (props['coneAngle'] !== undefined && this.light instanceof THREE.SpotLight) {
    this.light.angle = THREE.MathUtils.degToRad((props['coneAngle'] as number) / 2);  // No validation
  }

  if (props['colorTemperature'] !== undefined && this.lightData.useColorTemperature) {
    const rgb = kelvinToRGB(props['colorTemperature'] as number);  // No validation
    this.light.color.setRGB(rgb.r, rgb.g, rgb.b);
  }

  if (props['falloffDistance'] !== undefined) {
    // ...
    this.light.distance = ... (props['falloffDistance'] as number);  // No validation
  }
}
```

## Impact
- Expression evaluation can return NaN (division by zero, sqrt negative, etc.)
- NaN propagates to light intensity, angle, color, distance
- Scene lighting breaks silently
- SYSTEMIC-005: NaN bypass pattern

## Suggested Fix
```typescript
if (props['intensity'] !== undefined) {
  const intensity = props['intensity'] as number;
  if (Number.isFinite(intensity) && intensity >= 0) {
    this.light.intensity = intensity / 100;
  }
}
```
