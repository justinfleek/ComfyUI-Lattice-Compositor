# BUG-005: Array Access on Potentially Empty Keyframes Array

## Summary
The `interpolateAtTime()` function accesses `keyframes[0].value` without first checking if the keyframes array is empty, which would throw a runtime error.

## Severity: MEDIUM

## Location
- File: /ui/src/services/expressions/expressionHelpers.ts
- Lines: 104
- Function: interpolateAtTime

## The Bug
When `before` is null (no keyframes at or before the current time), the code returns `keyframes[0].value`. However, if the keyframes array is empty, this will throw a TypeError.

## Code Evidence
```typescript
// Line 104
if (!before) return keyframes[0].value;
```

## Impact
- Runtime TypeError if called with empty keyframes array
- Crash during animation evaluation
- Unhandled exception may propagate and crash the render

## Suggested Fix
```typescript
if (!before) {
  if (keyframes.length === 0) return 0; // or a sensible default
  return keyframes[0].value;
}
```

---

## Fix Applied
**Date:** 2025-12-27
**Fixed by:** Claude (Forensic Audit)

### Code Change
```typescript
// BEFORE (Line 104):
if (!before) return keyframes[0].value;

// AFTER (Line 104):
if (!before) return keyframes.length > 0 ? keyframes[0].value : 0;
```

### Verification
| Input | Before | After |
|-------|--------|-------|
| keyframes=[] | TypeError: Cannot read 'value' of undefined | 0 ✓ |
| keyframes=[{frame:10, value:5}], time before first | 5 | 5 ✓ |
| keyframes has values, before found | Normal flow | Normal flow ✓ |

### Pattern Used
NULL/UNDEFINED: Safe array access with length check
