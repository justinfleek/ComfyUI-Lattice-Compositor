# BUG-014: Missing Switch Default Returns Undefined

## Summary
The `repeatAfter()` and `repeatBefore()` functions use a switch statement without a default case. If an invalid `type` parameter is passed at runtime, the function returns `undefined` instead of a valid value, violating the declared return type.

## Severity: MEDIUM

## Location
- File: /ui/src/services/expressions/loopExpressions.ts
- Lines: 58-89 (repeatAfter), 117-144 (repeatBefore)
- Functions: repeatAfter, repeatBefore

## The Bug
```typescript
switch (type) {
  case 'cycle': { ... return ... }
  case 'pingpong': { ... return ... }
  case 'offset': { ... return ... }
  case 'continue': { ... return ... }
  // NO DEFAULT CASE - falls through to implicit return undefined
}
```

## Proof of Failure
```typescript
const ctx = { time: 10, fps: 30, keyframes: [...], value: 100, velocity: 5 };

// TypeScript allows this cast
const result = repeatAfter(ctx, 'invalid' as LoopType);
console.log(result);  // undefined
console.log(typeof result);  // "undefined"

// Downstream code expecting number crashes:
const position = result * 2;  // NaN (undefined * 2)
```

## Impact
- Returns undefined instead of declared `number | number[]`
- Downstream calculations produce NaN
- TypeScript type safety is violated at runtime
- Silent failure with no warning

## Suggested Fix
```typescript
switch (type) {
  case 'cycle': { ... }
  case 'pingpong': { ... }
  case 'offset': { ... }
  case 'continue': { ... }
  default:
    console.warn(`[Expressions] Unknown loop type: ${type}`);
    return ctx.value;
}
```

---

## Fix Applied
**Date:** 2025-12-27
**Fixed by:** Claude (Forensic Audit)

### Code Change
```typescript
// ADDED to repeatAfter() switch (lines 89-93):
default: {
  // BUG-014: Handle unknown loop type
  console.warn(`[Expressions] Unknown loop type in repeatAfter: ${type}`);
  return ctx.value;
}

// ADDED to repeatBefore() switch (lines 149-153):
default: {
  // BUG-014: Handle unknown loop type
  console.warn(`[Expressions] Unknown loop type in repeatBefore: ${type}`);
  return ctx.value;
}
```

### Verification
| Input | Before | After |
|-------|--------|-------|
| type='invalid' | undefined | ctx.value + warning ✓ |
| type='cycle' | Works | Works ✓ |
| type='pingpong' | Works | Works ✓ |
| type='offset' | Works | Works ✓ |
| type='continue' | Works | Works ✓ |

### Pattern Used
Missing switch default - add default case that logs warning and returns safe fallback
