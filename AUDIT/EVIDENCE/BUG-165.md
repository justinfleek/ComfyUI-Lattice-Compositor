# BUG-165: PoseLayer.setCompositionSize() No Validation

## Summary
setCompositionSize() stores width/height values without validation. NaN, zero, or negative dimensions corrupt the canvas rendering context and cause silent failures when rendering poses.

## Severity: LOW

## Location
- File: /ui/src/engine/layers/PoseLayer.ts
- Lines: 446-449, 307-319
- Functions: setCompositionSize(), renderPoses()

## Crash Path Trace
```
Function: setCompositionSize(width: number, height: number)

Line 447-448:
  this.compWidth = width;   // NaN stored
  this.compHeight = height; // NaN stored

Function: onEvaluateFrame(frame: number)

Line 456-457:
  const width = this.compWidth;   // NaN
  const height = this.compHeight; // NaN

Line 460: this.renderPoses(width, height);

Function: renderPoses(width: number, height: number)

Line 312-314:
  if (canvas.width !== width || canvas.height !== height) {
    canvas.width = width;   // canvas.width = NaN → becomes 0 or undefined behavior
    canvas.height = height; // canvas.height = NaN → becomes 0 or undefined behavior
  }

Line 319: ctx.fillRect(0, 0, width, height);
  - fillRect(0, 0, NaN, NaN) → no-op or corrupt drawing

Line 346-347:
  x: kp.x * width,  // 0.5 * NaN = NaN
  y: kp.y * height, // 0.5 * NaN = NaN

Test cases:
  - width=NaN → canvas.width=NaN → 0 or undefined → empty canvas
  - width=0 → zero-size canvas → nothing visible
  - width=-100 → negative canvas dimensions → browser-dependent

Result: SILENT CORRUPTION - pose rendering fails silently
```

## Code Evidence
```typescript
// Lines 446-449
setCompositionSize(width: number, height: number): void {
  this.compWidth = width;   // No validation
  this.compHeight = height; // No validation
}

// Lines 312-314 in renderPoses()
if (canvas.width !== width || canvas.height !== height) {
  canvas.width = width;   // NaN/0/negative
  canvas.height = height; // NaN/0/negative
}

// Lines 346-347 in toPixel()
x: kp.x * width,  // NaN propagates
y: kp.y * height, // NaN propagates
```

## Impact
- Canvas dimensions become 0 or corrupt
- Pose rendering produces empty/black output
- Keypoint positions become NaN when normalized coords multiplied by NaN dimensions
- LayerManager calling with invalid dimensions silently breaks pose layer

## Suggested Fix
```typescript
setCompositionSize(width: number, height: number): void {
  if (!Number.isFinite(width) || !Number.isFinite(height) || width <= 0 || height <= 0) {
    console.warn(`setCompositionSize: invalid dimensions ${width}x${height}`);
    return;
  }
  this.compWidth = width;
  this.compHeight = height;
}
```
