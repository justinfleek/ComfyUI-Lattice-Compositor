# BUG-087: ParticleLayer.createParticleGrid() Division/Infinite Loop (SYSTEMIC-006)

## Summary
The createParticleGrid() method calculates the number of grid lines using `Math.ceil(compWidth / gridSize)`. When gridSize=0, this returns Infinity, causing the subsequent for loop to run forever.

## Severity: LOW (Visualization helper, not core functionality)

## Location
- File: /ui/src/engine/layers/ParticleLayer.ts
- Lines: 1673-1674
- Function: createParticleGrid

## The Bug
```typescript
// Lines 1673-1674
const xCount = Math.ceil(compWidth / gridSize);
// If gridSize=0: compWidth / 0 = Infinity
// Math.ceil(Infinity) = Infinity

for (let i = 0; i <= xCount; i++) {  // for (i = 0; i <= Infinity) NEVER TERMINATES!
  const x = -halfWidth + i * gridSize;
  // ... creates grid lines
}
```

## Full Context
```typescript
// Lines 1631-1700
createParticleGrid(
  compWidth: number = 1920,
  compHeight: number = 1080,
  gridSize: number = 100,  // Default is 100, but can be set to 0
  depth: number = 500
): void {
  // ... disposal code ...

  const halfWidth = compWidth / 2;
  const halfHeight = compHeight / 2;

  // First loop (Z-direction) - bounded by depth/gridSize (also vulnerable)
  for (let z = 0; z <= depth; z += gridSize) {  // gridSize=0 causes infinite loop too!
    // ... create horizontal lines
  }

  // Line 1673-1674 - X-direction loop
  const xCount = Math.ceil(compWidth / gridSize);  // Infinity if gridSize=0
  for (let i = 0; i <= xCount; i++) {
    // ... create vertical lines
  }

  // Third loop also vulnerable
  for (let z = 0; z <= depth; z += gridSize) {
    // ... create side lines
  }
}
```

## Proof of Failure
```typescript
const layer = new ParticleLayer(layerData);
layer.initializeWithRenderer(renderer);

// User passes gridSize=0 (or malformed config has gridSize=0)
layer.createParticleGrid(1920, 1080, 0, 500);
// -> xCount = Math.ceil(1920 / 0) = Infinity
// -> for (i = 0; i <= Infinity; i++) NEVER TERMINATES
// -> Browser freezes
```

## Impact
- Browser freezes creating infinite grid lines
- Low severity: Visualization helper function, not core particle rendering
- Requires user to pass gridSize=0 explicitly

## Related
- SYSTEMIC-006: Unbounded Loop Parameters
- Similar to division patterns in effects like Posterize

## Suggested Fix
```typescript
createParticleGrid(
  compWidth: number = 1920,
  compHeight: number = 1080,
  gridSize: number = 100,
  depth: number = 500
): void {
  // Validate gridSize to prevent division by zero
  if (!Number.isFinite(gridSize) || gridSize <= 0) {
    gridSize = 100;  // Fallback to default
  }

  // ... rest of implementation
}
```
