# BUG-057: Division by Zero in Flocking Perception Angle Check

## Summary
When two particles occupy the exact same position (dist=0), the perception angle calculation divides by zero, producing NaN direction vectors. This corrupts the dot product check and allows invalid neighbors to influence flocking behavior.

## Severity: LOW

## Location
- File: /ui/src/engine/particles/ParticleFlockingSystem.ts
- Lines: 121-123, 126
- Function: applyFlocking

## The Bug
```typescript
// Lines 115-129
const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);

// Check perception angle: is neighbor within field of view?
if (speed > 0.001 && perceptionCos > -1.0) {
  // Line 121-123: Division by dist - NO GUARD for dist=0
  const toNeighborX = -dx / dist;  // -0 / 0 = NaN
  const toNeighborY = -dy / dist;  // NaN
  const toNeighborZ = -dz / dist;  // NaN

  // Line 126: Dot product with NaN
  const dot = (vx / speed) * toNeighborX + ...;  // NaN

  // Line 129: NaN < perceptionCos is always false
  if (dot < perceptionCos) continue;  // NEVER triggers for NaN
}

// Particle at same position passes through to flocking calculations
// Line 133 guards separation with dist > 0, but alignment/cohesion don't check
```

## Proof of Failure
```typescript
// Two particles at exact same position
const particleBuffer = new Float32Array(PARTICLE_STRIDE * 2);
// Particle 0 at (100, 100, 100)
particleBuffer[0] = 100; particleBuffer[1] = 100; particleBuffer[2] = 100;
// Particle 1 at same position
particleBuffer[PARTICLE_STRIDE + 0] = 100;
particleBuffer[PARTICLE_STRIDE + 1] = 100;
particleBuffer[PARTICLE_STRIDE + 2] = 100;

flockingSystem.applyFlocking(particleBuffer, 0.016);

// Result:
// - toNeighborX/Y/Z = NaN (line 121-123)
// - dot = NaN (line 126)
// - NaN < perceptionCos = false (line 129)
// - Neighbor not skipped, proceeds to alignment/cohesion
// - Alignment: adds velocity of coincident particle (benign)
// - Cohesion: adds position (100,100,100) to center calculation
// - Cohesion vector: (100,100,100) - (100,100,100) = (0,0,0)
// - normalize(0,0,0) = (NaN, NaN, NaN) in Three.js
// - steering vector becomes NaN
// - Velocity becomes NaN (lines 174-176)
```

## Impact
- Particle velocity becomes NaN when two particles occupy same position
- NaN velocity propagates - particle disappears from render
- Can occur during spawn (multiple particles at emitter origin)
- Can occur during physics simulation (collision pushing to same point)

## Suggested Fix
```typescript
// Add dist > 0 guard before perception angle calculation
if (dist <= 0) continue;  // Skip coincident particles entirely

// OR guard the division specifically
if (speed > 0.001 && perceptionCos > -1.0 && dist > 0) {
  const toNeighborX = -dx / dist;
  // ...
}
```
