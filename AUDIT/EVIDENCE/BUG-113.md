# BUG-113: TextLayer.setStroke() Division by fontSize

## Summary
The `setStroke(color, width)` method calculates outline width by dividing by `this.textData.fontSize`. If fontSize was previously set to 0 (via BUG-112), this causes division by zero, producing Infinity as the outline width.

## Severity: MEDIUM

## Location
- File: /ui/src/engine/layers/TextLayer.ts
- Lines: 810-829
- Function: setStroke

## The Bug
```typescript
// Lines 810-829
setStroke(color: string, width: number): void {
  this.textData.stroke = color;
  this.textData.strokeWidth = width;

  const outlineWidth = width > 0 ? width / this.textData.fontSize : 0;
  //                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  // DIVISION BY ZERO if fontSize == 0!
  // Also produces NaN if fontSize is NaN

  this.textMesh.outlineWidth = outlineWidth;  // Infinity or NaN
  this.textMesh.outlineColor = width > 0 ? color : '';
  // ...
}
```

## Proof of Failure
```typescript
const textLayer = new TextLayer(layerData, resources);

// Setup: fontSize = 0 (via BUG-112 or bad initialization)
textLayer.setFontSize(0);

// Attack: Set stroke
textLayer.setStroke('#000000', 2);
// outlineWidth = 2 / 0 = Infinity
// Troika receives Infinity outline width
// Stroke may consume entire canvas or cause WebGL issues

// Also broken if fontSize was set to NaN:
textLayer.setFontSize(NaN);
textLayer.setStroke('#000000', 2);
// outlineWidth = 2 / NaN = NaN
// NaN outline width - rendering undefined
```

## Impact
- Infinity outline width causes massive/broken stroke rendering
- NaN outline width causes undefined Troika behavior
- Dependent on BUG-112 (fontSize = 0) being triggered first
- Medium severity: Chain vulnerability with BUG-112

## Related
- BUG-112: setFontSize no validation (precondition)
- SYSTEMIC-003: Division by zero pattern
- 14A: Numeric inputs - division by zero testing

## Suggested Fix
```typescript
setStroke(color: string, width: number): void {
  this.textData.stroke = color;
  this.textData.strokeWidth = width;

  // Guard against division by zero
  const fontSize = this.textData.fontSize || 72;  // Use default if 0
  const outlineWidth = width > 0 ? width / fontSize : 0;

  this.textMesh.outlineWidth = outlineWidth;
  this.textMesh.outlineColor = width > 0 ? color : '';
  // ...
}
```
