# BUG-065: Division by Zero When Both Particle Masses Are Zero

## Summary
In particle-particle collision response, the impulse calculation divides by totalMass (mass1 + mass2). If both particles have mass 0, the division produces Infinity, causing particles to fly off to infinity.

## Severity: LOW

## Location
- File: /ui/src/engine/particles/ParticleCollisionSystem.ts
- Lines: 306-307
- Function: applyParticleCollisions

## The Bug
```typescript
// Lines 306-307
const totalMass = mass1 + mass2;
const impulse = -(1 + bounciness) * dvn / totalMass;  // Division by zero if both masses are 0!

// Lines 310-316 apply impulse to velocities
vx += impulse * mass2 * nx;  // Infinity * 0 = NaN
```

## Proof of Failure
```typescript
const collision = new ParticleCollisionSystem(1000, {
  enabled: true,
  particleCollision: true,
  particleRadius: 10
});

// Set up two particles with mass = 0
const buffer = new Float32Array(1000 * PARTICLE_STRIDE);

// Particle 0 at position (0, 0, 0)
buffer[0] = 0; buffer[1] = 0; buffer[2] = 0;  // position
buffer[3] = 10; buffer[4] = 0; buffer[5] = 0;  // velocity (moving right)
buffer[6] = 0; buffer[7] = 10;  // age=0, lifetime=10
buffer[8] = 0;  // mass = 0!

// Particle 1 at position (5, 0, 0) - within collision radius
const offset1 = PARTICLE_STRIDE;
buffer[offset1 + 0] = 5; buffer[offset1 + 1] = 0; buffer[offset1 + 2] = 0;
buffer[offset1 + 3] = -10; buffer[offset1 + 4] = 0; buffer[offset1 + 5] = 0;
buffer[offset1 + 6] = 0; buffer[offset1 + 7] = 10;
buffer[offset1 + 8] = 0;  // mass = 0!

collision.setSpatialHash(spatialHash);
collision.update(buffer);

// Line 306: totalMass = 0 + 0 = 0
// Line 307: impulse = -(1 + 0.5) * dvn / 0 = Â±Infinity
// Line 310: vx += Infinity * 0 * nx = NaN
// Velocities become NaN
```

## Impact
- Particles with zero mass produce NaN velocities after collision
- NaN propagates and corrupts particle system
- Low severity: Requires specific configuration (mass = 0)

## Suggested Fix
```typescript
// Guard against zero total mass
const totalMass = mass1 + mass2;
if (totalMass <= 0) continue; // Skip collision if no mass
const impulse = -(1 + bounciness) * dvn / totalMass;
```

Or treat zero mass as infinite mass (immovable):
```typescript
const totalMass = mass1 + mass2;
if (totalMass <= 0) {
  // Treat as elastic collision with equal masses
  const temp = [vx, vy, vz];
  vx = jvx; vy = jvy; vz = jvz;
  jvx = temp[0]; jvy = temp[1]; jvz = temp[2];
  // Apply bounciness
  vx *= bounciness; vy *= bounciness; vz *= bounciness;
  jvx *= bounciness; jvy *= bounciness; jvz *= bounciness;
}
```
