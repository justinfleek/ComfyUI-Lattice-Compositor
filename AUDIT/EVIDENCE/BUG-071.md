# BUG-071: Division by Zero in FPS Detection When Few Frames Captured

## Summary
In detectVideoFps(), if the timing condition `lastTime - startTime > 0.5` is met before collecting 10 frames, the trimmed array could be empty, causing division by zero.

## Severity: LOW

## Location
- File: /ui/src/engine/layers/VideoLayer.ts
- Line: 983
- Function: detectVideoFps (utility function)

## The Bug
```typescript
// Lines 973-984
// Collect enough frames for accurate measurement (at least 10 frames or 0.5 seconds)
if (frameDurations.length >= 10 || lastTime - startTime > 0.5) {
  // Calculate average frame duration, excluding outliers
  const sorted = [...frameDurations].sort((a, b) => a - b);
  const trimmed = sorted.slice(1, -1); // Remove min/max
  const avgFrameDuration = trimmed.reduce((a, b) => a + b, 0) / trimmed.length;  // Division!
```

The condition uses `||` not `&&`. If `lastTime - startTime > 0.5` but only 2 frames captured:
- sorted.length = 2
- trimmed = sorted.slice(1, -1) = [] (empty!)
- trimmed.length = 0
- avgFrameDuration = 0 / 0 = NaN

## Proof of Failure
```typescript
// Slow video or slow system - only 2 frames in 0.5 seconds
frameDurations = [0.25, 0.26];  // 2 entries
lastTime - startTime = 0.51;   // > 0.5, triggers early exit

sorted = [0.25, 0.26];
trimmed = sorted.slice(1, -1);  // [] - removes both!
avgFrameDuration = 0 / 0;       // NaN
detectedFps = Math.round(1 / NaN);  // NaN
```

## Impact
- FPS detection returns NaN for slow videos
- Video playback may break
- Low severity: Edge case with very slow videos

## Suggested Fix
```typescript
if (frameDurations.length >= 10 || lastTime - startTime > 0.5) {
  const sorted = [...frameDurations].sort((a, b) => a - b);
  // Only trim if we have enough samples
  const trimmed = sorted.length > 4 ? sorted.slice(1, -1) : sorted;
  if (trimmed.length === 0) {
    // Fallback if somehow empty
    return null;
  }
  const avgFrameDuration = trimmed.reduce((a, b) => a + b, 0) / trimmed.length;
```
