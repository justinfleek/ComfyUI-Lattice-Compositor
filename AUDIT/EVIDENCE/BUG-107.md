# BUG-107: LatticeEngine.captureFrameAsBlob() Quality Parameter No Validation

## Summary
The `captureFrameAsBlob(format, quality)` method accepts a quality parameter (default 0.95) intended to be 0-1, but performs no validation. Out-of-range values are passed directly to `canvas.convertToBlob()` where behavior is undefined.

## Severity: LOW

## Location
- File: /ui/src/engine/LatticeEngine.ts
- Lines: 1439-1455
- Function: captureFrameAsBlob

## The Bug
```typescript
// Lines 1439-1455
async captureFrameAsBlob(
  format: 'png' | 'jpeg' | 'webp' = 'png',
  quality: number = 0.95
): Promise<Blob> {
  this.assertNotDisposed();

  const { imageData, width, height } = this.captureFrame();

  const canvas = new OffscreenCanvas(width, height);
  const ctx = canvas.getContext('2d')!;
  ctx.putImageData(imageData, 0, 0);

  return canvas.convertToBlob({
    type: `image/${format}`,
    quality,  // No validation! Passed directly to browser API
  });
}
```

## Proof of Failure
```typescript
const engine = new LatticeEngine(config);

// Attack 1: Quality > 1
const blob = await engine.captureFrameAsBlob('jpeg', 5.0);
// Browser behavior undefined - may clamp, may error, may produce bad output

// Attack 2: Quality < 0
const blob = await engine.captureFrameAsBlob('jpeg', -0.5);
// Negative quality is invalid

// Attack 3: NaN quality
const blob = await engine.captureFrameAsBlob('jpeg', NaN);
// Browser may produce corrupt output or default behavior

// Attack 4: Quality for PNG (ignored but confusing)
const blob = await engine.captureFrameAsBlob('png', 0.1);
// PNG is lossless, quality is ignored - potential user confusion

// Note: Most browsers clamp to [0,1], but behavior is not standardized
// and may vary across browsers
```

## Impact
- Browser-dependent undefined behavior for out-of-range quality
- Potential corrupt image output
- Low severity: Usually called with fixed values, not user input
- Browser typically clamps, but relying on this is fragile

## Related
- 14A: Numeric inputs - out of range testing
- 14X: Platform/Environment - browser differences

## Suggested Fix
```typescript
async captureFrameAsBlob(
  format: 'png' | 'jpeg' | 'webp' = 'png',
  quality: number = 0.95
): Promise<Blob> {
  this.assertNotDisposed();

  // Validate and clamp quality to [0, 1]
  if (!Number.isFinite(quality)) {
    quality = 0.95;
  }
  quality = Math.max(0, Math.min(1, quality));

  const { imageData, width, height } = this.captureFrame();

  const canvas = new OffscreenCanvas(width, height);
  const ctx = canvas.getContext('2d')!;
  ctx.putImageData(imageData, 0, 0);

  return canvas.convertToBlob({
    type: `image/${format}`,
    quality,
  });
}
```
