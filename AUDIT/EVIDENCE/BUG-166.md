# BUG-166: interpolatePoses() NaN Propagation

## Summary
The interpolatePoses() utility function interpolates between two poses using parameter t without validation. NaN or invalid t values produce poses with NaN keypoint positions.

## Severity: LOW

## Location
- File: /ui/src/engine/layers/PoseLayer.ts
- Lines: 697-720
- Function: interpolatePoses()

## Crash Path Trace
```
Function: interpolatePoses(pose1: Pose, pose2: Pose, t: number): Pose

Line 704-712:
  for (let i = 0; i < pose1.keypoints.length; i++) {
    const kp1 = pose1.keypoints[i];
    const kp2 = pose2.keypoints[i];

    keypoints.push({
      x: kp1.x + (kp2.x - kp1.x) * t,  // NaN if t=NaN
      y: kp1.y + (kp2.y - kp1.y) * t,  // NaN if t=NaN
      confidence: Math.min(kp1.confidence, kp2.confidence)
    });
  }

Test cases:
  - t=NaN:
    - (kp2.x - kp1.x) * NaN = NaN
    - kp1.x + NaN = NaN
    - All keypoint positions become NaN

  - t=Infinity:
    - (kp2.x - kp1.x) * Infinity = Â±Infinity
    - Keypoints at infinity (extreme extrapolation)

  - kp1.x=NaN or kp2.x=NaN:
    - Arithmetic with NaN produces NaN
    - Output pose has NaN positions

Result: SILENT CORRUPTION - returned pose has NaN/Infinity keypoint positions
```

## Code Evidence
```typescript
// Lines 697-720
export function interpolatePoses(pose1: Pose, pose2: Pose, t: number): Pose {
  if (pose1.keypoints.length !== pose2.keypoints.length) {
    throw new Error('Poses must have same number of keypoints');
  }

  const keypoints: PoseKeypoint[] = [];

  for (let i = 0; i < pose1.keypoints.length; i++) {
    const kp1 = pose1.keypoints[i];
    const kp2 = pose2.keypoints[i];

    keypoints.push({
      x: kp1.x + (kp2.x - kp1.x) * t,  // No validation on t
      y: kp1.y + (kp2.y - kp1.y) * t,  // No validation on t
      confidence: Math.min(kp1.confidence, kp2.confidence)
    });
  }

  return {
    id: `interpolated_${Date.now()}`,
    keypoints,
    format: pose1.format
  };
}
```

## Impact
- Animation systems may pass NaN frame ratios
- Returned pose has NaN positions
- When rendered, ctx.arc(NaN, NaN, ...) fails silently
- Pose skeleton disappears or renders incorrectly

## Suggested Fix
```typescript
export function interpolatePoses(pose1: Pose, pose2: Pose, t: number): Pose {
  if (pose1.keypoints.length !== pose2.keypoints.length) {
    throw new Error('Poses must have same number of keypoints');
  }

  // Validate and clamp t
  if (!Number.isFinite(t)) {
    console.warn(`interpolatePoses: invalid t=${t}, clamping to 0`);
    t = 0;
  }
  t = Math.max(0, Math.min(1, t));  // Optional: clamp to 0-1 range

  // ... rest of function
}
```
