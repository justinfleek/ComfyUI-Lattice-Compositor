# BUG-163: PointCloudLayer setPointSize()/setOpacity() NaN Propagation

## Summary
setPointSize() and setOpacity() store values directly to shader uniforms without validation. onApplyEvaluatedState() passes evaluated values through these setters without NaN checks. NaN/Infinity corrupt point cloud rendering.

## Severity: LOW

## Location
- File: /ui/src/engine/layers/PointCloudLayer.ts
- Lines: 962-966, 971-975, 1060-1070
- Functions: setPointSize(), setOpacity(), onApplyEvaluatedState()

## Crash Path Trace
```
Function: setPointSize(size: number)

Line 963-964:
  if (this.material) {
    this.material.uniforms.pointSize.value = size;  // No validation
  }

Test cases:
  - size=NaN → uniform pointSize=NaN → shader gl_PointSize=NaN → points invisible
  - size=Infinity → uniform pointSize=Infinity → huge points, memory issues
  - size=-5 → negative point size → undefined GPU behavior

Function: setOpacity(opacity: number)

Line 972-973:
  if (this.material) {
    this.material.uniforms.opacity.value = opacity;  // No validation
  }

Test cases:
  - opacity=NaN → uniform opacity=NaN → shader alpha=NaN → rendering corrupt
  - opacity=Infinity → over-bright rendering
  - opacity=-1 → negative alpha → undefined behavior

Function: onApplyEvaluatedState(state)

Line 1063-1068:
  if (props['pointSize'] !== undefined) {
    this.setPointSize(props['pointSize'] as number);  // Passes NaN to setter
  }
  if (props['opacity'] !== undefined) {
    this.setOpacity(props['opacity'] as number);  // Passes NaN to setter
  }

Result: SILENT CORRUPTION (SYSTEMIC-005) - uniforms receive NaN from expressions
```

## Code Evidence
```typescript
// Lines 962-966
setPointSize(size: number): void {
  if (this.material) {
    this.material.uniforms.pointSize.value = size;  // No validation
  }
}

// Lines 971-975
setOpacity(opacity: number): void {
  if (this.material) {
    this.material.uniforms.opacity.value = opacity;  // No validation
  }
}

// Lines 1060-1070
protected override onApplyEvaluatedState(state: import('../MotionEngine').EvaluatedLayer): void {
  const props = state.properties;

  if (props['pointSize'] !== undefined) {
    this.setPointSize(props['pointSize'] as number);  // NaN passed through
  }

  if (props['opacity'] !== undefined) {
    this.setOpacity(props['opacity'] as number);  // NaN passed through
  }
}
```

## Impact
- Point cloud becomes invisible (NaN size)
- Points render incorrectly (negative/Infinity values)
- Expression evaluation can produce NaN
- Same SYSTEMIC-005 pattern as other layers

## Suggested Fix
```typescript
setPointSize(size: number): void {
  if (!Number.isFinite(size) || size <= 0) {
    console.warn(`setPointSize: invalid size ${size}`);
    return;
  }
  if (this.material) {
    this.material.uniforms.pointSize.value = size;
  }
}

setOpacity(opacity: number): void {
  if (!Number.isFinite(opacity) || opacity < 0 || opacity > 1) {
    console.warn(`setOpacity: invalid opacity ${opacity}`);
    return;
  }
  if (this.material) {
    this.material.uniforms.opacity.value = opacity;
  }
}
```
