# BUG-169: ProceduralMatteLayer.applyLevels() Division by Zero

## Summary
applyLevels() calculates inputRange as inputWhite - inputBlack. When these values are equal, division by zero occurs, producing NaN pixel values that corrupt the matte output.

## Severity: LOW

## Location
- File: /ui/src/engine/layers/ProceduralMatteLayer.ts
- Lines: 644, 651
- Function: applyLevels()

## Crash Path Trace
```
Function: applyLevels(frame: number)

Line 630-631:
  const inputBlack = this.matteEvaluator.evaluate(levels.inputBlack, frame);
  const inputWhite = this.matteEvaluator.evaluate(levels.inputWhite, frame);

Line 644:
  const inputRange = inputWhite - inputBlack;
  - inputBlack=128, inputWhite=128 → inputRange=0

Line 651:
  value = Math.max(0, Math.min(255, (value - inputBlack) / inputRange * 255));
  - (128 - 128) / 0 = 0/0 = NaN
  - Math.max(0, NaN) = NaN (SYSTEMIC-005)
  - Math.min(255, NaN) = NaN (SYSTEMIC-005)

Line 659:
  data[i] = data[i + 1] = data[i + 2] = Math.round(NaN);
  - Math.round(NaN) = NaN
  - Pixel values become NaN → rendering undefined

Result: SILENT CORRUPTION - matte becomes all-black or garbage
```

## Code Evidence
```typescript
// Lines 644-659
const inputRange = inputWhite - inputBlack;  // Can be 0
const outputRange = outputWhite - outputBlack;

for (let i = 0; i < data.length; i += 4) {
  let value = data[i];

  // Input levels - DIVISION BY ZERO if inputRange=0
  value = Math.max(0, Math.min(255, (value - inputBlack) / inputRange * 255));

  // Gamma correction
  value = Math.pow(value / 255, 1 / gamma) * 255;  // NaN propagates

  // Output levels
  value = outputBlack + (value / 255) * outputRange;

  data[i] = data[i + 1] = data[i + 2] = Math.round(value);  // NaN stored
}
```

## Impact
- User can animate inputBlack and inputWhite to same value
- Division by zero produces NaN
- All pixel values become NaN
- Canvas rendering becomes black or corrupt
- SYSTEMIC-005: Math.max/min don't catch NaN

## Suggested Fix
```typescript
const inputRange = inputWhite - inputBlack;
if (inputRange === 0) {
  // All values should become inputBlack (or skip processing)
  return;
}
```
