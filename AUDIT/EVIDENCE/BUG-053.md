# BUG-053: NaN Geometry Cache Key Collision

## Summary
When NaN dimensions are passed to `getPlaneGeometry()`, `getCircleGeometry()`, or `getBoxGeometry()`, the cache key becomes `plane:NaN:NaN` (or similar). All subsequent NaN requests return the same cached geometry, causing incorrect rendering when different geometries were intended.

## Severity: LOW

## Location
- File: /ui/src/engine/core/ResourceManager.ts
- Lines: 276, 295, 314-318
- Functions: getPlaneGeometry, getCircleGeometry, getBoxGeometry

## The Bug
```typescript
// Line 276
getPlaneGeometry(width: number, height: number): THREE.PlaneGeometry {
  const key = `plane:${width}:${height}`;
  // If width=NaN, height=NaN: key = "plane:NaN:NaN"

  let geometry = this.geometries.get(key);
  if (!geometry) {
    geometry = new THREE.PlaneGeometry(width, height);
    // THREE.PlaneGeometry(NaN, NaN) creates degenerate geometry
    this.geometries.set(key, geometry);
  }
  return geometry;
}

// Same pattern at lines 295 and 314-318
```

## Proof of Failure
```typescript
// First call with NaN
const geom1 = resourceManager.getPlaneGeometry(NaN, NaN);
// Creates key "plane:NaN:NaN", creates degenerate geometry

// Second call with different NaN source
const geom2 = resourceManager.getPlaneGeometry(parseInt("abc"), parseInt("def"));
// Also creates key "plane:NaN:NaN"
// Returns SAME cached degenerate geometry

// Third call with valid values that became NaN upstream
const geom3 = resourceManager.getPlaneGeometry(undefinedVar * 2, undefinedVar * 2);
// Also key "plane:NaN:NaN", returns same degenerate geometry

// All three get the same broken geometry
console.log(geom1 === geom2); // true
console.log(geom2 === geom3); // true
```

## Impact
- All NaN geometry requests collide to same cache entry
- Degenerate geometry (0 vertices) causes invisible meshes
- Related to SYSTEMIC-004 (NaN values stored)

## Suggested Fix
```typescript
getPlaneGeometry(width: number, height: number): THREE.PlaneGeometry {
  // Validate before caching
  if (!Number.isFinite(width) || !Number.isFinite(height)) {
    console.warn('getPlaneGeometry: Invalid dimensions', { width, height });
    // Return a default 1x1 geometry instead of caching NaN
    width = 1;
    height = 1;
  }

  const key = `plane:${width}:${height}`;
  // ... rest
}
```
