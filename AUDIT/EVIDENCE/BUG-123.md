# BUG-123: AudioLayer.updateGain() NaN Bypass

## Summary
The `updateGain(levelDb)` method clamps the input using `Math.max(-60, Math.min(12, levelDb))`. However, NaN bypasses these checks, and the resulting NaN is passed to `gainNode.gain.setValueAtTime()`, causing undefined WebAudio behavior.

## Severity: LOW

## Location
- File: /ui/src/engine/layers/AudioLayer.ts
- Lines: 323-336
- Function: updateGain

## The Bug
```typescript
// Lines 323-336
updateGain(levelDb: number): void {
  if (!this.playbackNodes) return;

  // Convert dB to linear: linear = 10^(dB/20)
  // Clamp to reasonable range: -60dB to +12dB
  const clampedDb = Math.max(-60, Math.min(12, levelDb));
  //                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  // NaN bypasses! Math.max(-60, Math.min(12, NaN)) = NaN

  const linearGain = clampedDb <= -60 ? 0 : Math.pow(10, clampedDb / 20);
  //                 ^^^^^^^^^^^^^^^^^
  // NaN <= -60 is false, so Math.pow(10, NaN/20) = NaN

  // Use setValueAtTime for immediate update without clicks
  this.playbackNodes.gainNode.gain.setValueAtTime(
    linearGain,  // NaN passed to WebAudio!
    this.playbackNodes.context.currentTime
  );
}
```

## Proof of Failure
```typescript
const audioLayer = new AudioLayer(layerData);
audioLayer.initializePlayback(audioBuffer);

// NaN comparison behavior:
console.log(Math.min(12, NaN));   // NaN
console.log(Math.max(-60, NaN));  // NaN
console.log(NaN <= -60);          // false
console.log(Math.pow(10, NaN/20)); // NaN

// Attack: level = NaN
audioLayer.updateGain(NaN);
// clampedDb = NaN
// linearGain = NaN
// gainNode.gain.setValueAtTime(NaN, ...)
// WebAudio behavior undefined - may mute, may error, may ignore

// Could happen from:
// - Corrupt keyframe interpolation
// - Expression returning NaN
// - Audio-reactive calculation producing NaN
```

## Impact
- WebAudio GainNode receives NaN value
- Audio may mute, glitch, or error
- Low severity: Usually called with interpolated animation values

## Related
- BUG-124: updatePan NaN bypass (same pattern)
- BUG-118: VideoLayer.setAudioLevel NaN bypass (similar)
- SYSTEMIC-005: NaN bypass via comparison operators
- 14A: Numeric inputs - NaN testing

## Suggested Fix
```typescript
updateGain(levelDb: number): void {
  if (!this.playbackNodes) return;

  // Guard against NaN
  if (!Number.isFinite(levelDb)) {
    levelDb = 0;  // Default to unity gain
  }

  // Clamp to reasonable range: -60dB to +12dB
  const clampedDb = Math.max(-60, Math.min(12, levelDb));
  const linearGain = clampedDb <= -60 ? 0 : Math.pow(10, clampedDb / 20);

  this.playbackNodes.gainNode.gain.setValueAtTime(
    linearGain,
    this.playbackNodes.context.currentTime
  );
}
```
