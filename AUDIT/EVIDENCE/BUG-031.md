# BUG-031: removeLegacyAudioMapping NaN Index Coerces to 0

## Summary
The `removeLegacyAudioMapping` function uses `splice(index, 1)` without validating the index parameter. When index is NaN, JavaScript coerces it to 0, removing the FIRST element instead of failing safely.

## Severity: HIGH

## Location
- File: /ui/src/stores/actions/audioActions.ts
- Lines: 397
- Function: `removeLegacyAudioMapping`

## The Bug
Line 397 passes `index` directly to `splice()` without validation.

## Code Evidence
```typescript
// Lines 390-402
export function removeLegacyAudioMapping(
  store: AudioStore,
  layerId: string,
  index: number  // <-- No validation at runtime
): void {
  const mappings = store.audioMappings.get(layerId);
  if (mappings) {
    mappings.splice(index, 1);  // NaN becomes 0!
    if (mappings.length === 0) {
      store.audioMappings.delete(layerId);
    }
  }
}
```

## Crash Path Trace
```
1. UI calls removeLegacyAudioMapping(store, 'layer1', parseInt('not-a-number'))
2. parseInt('not-a-number') returns NaN
3. Line 395: mappings = [{id:'a'}, {id:'b'}, {id:'c'}] (3 mappings)
4. Line 397: mappings.splice(NaN, 1)
5. JavaScript: splice() coerces NaN to 0
6. Result: mappings.splice(0, 1) removes FIRST element
7. mappings is now [{id:'b'}, {id:'c'}]
8. Wrong mapping removed! User intended to remove 'c' but 'a' was removed
```

## JavaScript Coercion Proof
```javascript
const arr = ['a', 'b', 'c'];
arr.splice(NaN, 1);
console.log(arr);  // ['b', 'c'] - first element removed!

arr.splice(undefined, 1);
console.log(arr);  // ['c'] - first element removed again!
```

## Impact
- WRONG DATA DELETED - silent data corruption
- User removes wrong audio mapping
- No error or warning
- Data loss with no undo if outside history scope

## Suggested Fix
```typescript
export function removeLegacyAudioMapping(
  store: AudioStore,
  layerId: string,
  index: number
): void {
  const mappings = store.audioMappings.get(layerId);
  if (!mappings) return;
  
  // BUG-031 FIX: Validate index
  if (!Number.isInteger(index) || index < 0 || index >= mappings.length) {
    console.warn('[Audio] Invalid mapping index:', index);
    return;
  }
  
  mappings.splice(index, 1);
  if (mappings.length === 0) {
    store.audioMappings.delete(layerId);
  }
}
```
