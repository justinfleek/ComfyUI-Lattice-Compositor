# BUG-133: DepthLayer Shader Division by Zero (minDepth === maxDepth)

## Summary
The depth visualization shader divides by `(maxDepth - minDepth)` without validation. When minDepth equals maxDepth, this causes division by zero in the shader, producing undefined behavior that varies by GPU.

## Severity: LOW

## Location
- File: /ui/src/engine/layers/DepthLayer.ts
- Lines: 107 (shader), 208-209 (uniforms)
- Function: fragment shader, onEvaluateFrame

## The Bug
```glsl
// Fragment shader, line 107
float normalizedDepth = (depth - minDepth) / (maxDepth - minDepth);
//                                           ^^^^^^^^^^^^^^^^^^^^
// Division by zero when minDepth === maxDepth!
```

```typescript
// Lines 208-209
this.material.uniforms.minDepth.value = this.depthData.minDepth;
this.material.uniforms.maxDepth.value = this.depthData.maxDepth;
// No validation that they're different!
```

## Proof of Failure
```typescript
const depthLayer = new DepthLayer({
  ...layerData,
  data: {
    minDepth: 0.5,
    maxDepth: 0.5  // Equal to minDepth!
  }
});

// In shader:
// normalizedDepth = (depth - 0.5) / (0.5 - 0.5)
// normalizedDepth = (depth - 0.5) / 0.0
// Result varies by GPU: Infinity, NaN, 0, or garbage

// Behavior by GPU:
// - NVIDIA: Often returns Infinity, clamp gives 1.0
// - AMD: May return NaN, clamp gives NaN â†’ black pixels
// - Intel: Undefined
// - Mobile: Varies widely
```

## Impact
- Visual output varies by GPU vendor
- Some GPUs produce all-white, some produce black, some produce garbage
- Low severity: Depth range typically set from depth map stats

## Related
- BUG-077: ProceduralMatteLayer applyLevels division by zero (same pattern)
- BUG-025: colorRenderer levels division by zero
- SYSTEMIC-003: Division by zero pattern
- 14P: WebGL/GPU - shader edge cases

## Suggested Fix
```typescript
// In onEvaluateFrame or onUpdate
const minDepth = this.depthData.minDepth;
const maxDepth = this.depthData.maxDepth;

// Ensure valid range
const range = maxDepth - minDepth;
if (Math.abs(range) < 0.0001) {
  // Force minimal range to avoid division by zero
  this.material.uniforms.minDepth.value = minDepth;
  this.material.uniforms.maxDepth.value = minDepth + 0.0001;
} else {
  this.material.uniforms.minDepth.value = minDepth;
  this.material.uniforms.maxDepth.value = maxDepth;
}
```
