
#Eigen: always use version 3.4
find_package (Eigen3 3.4 REQUIRED)

# add_subdirectory(yaml-cpp)
# set(YAML_CPP_BUILD_TESTS OFF CACHE BOOL "" FORCE)
# set(YAML_CPP_BUILD_TOOLS OFF CACHE BOOL "" FORCE)
# set_property(TARGET yaml-cpp APPEND PROPERTY INTERFACE_INCLUDE_DIRECTORIES
# 	"${PROJECT_SOURCE_DIR}/extern/yaml-cpp/include")

find_package(OpenMP)

include(ExternalProject)
set(CCD_BUILD_PATH "${CMAKE_BINARY_DIR}/${CMAKE_BUILD_TYPE}/lib/libccd")
set(CCD_INSTALL_PREFIX ${CCD_BUILD_PATH})
ExternalProject_Add(ccd 
    PREFIX ${CCD_BUILD_PATH}
    SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/libccd
    CMAKE_ARGS
     -DCMAKE_INSTALL_PREFIX:PATH=${CCD_BUILD_PATH}
     -DCMAKE_C_COMPILER=${CMAKE_C_COMPILER}
     -DCMAKE_CXX_COMPILER=${CMAKE_CXX_COMPILER}
     -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
     -DCMAKE_BUILD_RPATH_USE_ORIGIN=ON
     -DBUILD_TESTING=OFF
)
if(BUILD_NIX_PACKAGE)
    set(CCD_LIBRARY ${CCD_BUILD_PATH}/lib64/libccd.so CACHE FILEPATH "" FORCE)
else()
    set(CCD_LIBRARY ${CCD_BUILD_PATH}/lib/libccd.so CACHE FILEPATH "" FORCE)
endif()
set(CCD_INCLUDE_PATH "${CCD_BUILD_PATH}/include/" CACHE FILEPATH "" FORCE)

set(FCL_BUILD_PATH "${CMAKE_BINARY_DIR}/${CMAKE_BUILD_TYPE}/lib/fcl")
set(FCL_INSTALL_PREFIX ${FCL_BUILD_PATH})
ExternalProject_Add(fcl
    PREFIX ${FCL_INSTALL_PREFIX}
    SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/fcl
    CMAKE_ARGS
     -DCCD_INCLUDE_DIR:PATH=${CCD_BUILD_PATH}/include
     -DCCD_LIBRARY:FILEPATH=${CCD_LIBRARY}
     -DCMAKE_C_COMPILER=${CMAKE_C_COMPILER}
     -DCMAKE_CXX_COMPILER=${CMAKE_CXX_COMPILER}
     -DCMAKE_INSTALL_PREFIX:PATH=${FCL_BUILD_PATH}
     -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
     -DCMAKE_BUILD_RPATH_USE_ORIGIN=ON
     -DBUILD_TESTING=OFF
)
add_dependencies(fcl ccd)
if(BUILD_NIX_PACKAGE)
    set(FCL_LIBRARY ${FCL_BUILD_PATH}/lib64/libfcl.so CACHE FILEPATH "" FORCE)
else()
    set(FCL_LIBRARY ${FCL_BUILD_PATH}/lib/libfcl.so CACHE FILEPATH "" FORCE)
endif()
set(FCL_INCLUDE_PATH "${FCL_BUILD_PATH}/include/" CACHE FILEPATH "" FORCE)
#set(HPP_FCL_INSTALL_PREFIX ${HPP_FCL_BUILD_PATH})
#ExternalProject_Add(hpp-fcl
#    PREFIX ${HPP_FCL_INSTALL_PREFIX}
#    SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/hpp-fcl
#    CMAKE_ARGS
#     -DCMAKE_INSTALL_PREFIX:PATH=${HPP_FCL_BUILD_PATH}
#     -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
#     -DBUILD_PYTHON_INTERFACE=OFF
#)
#set(HPP_FCL_LIBRARY ${HPP_FCL_BUILD_PATH}/lib/libfcl.so CACHE FILEPATH "" FORCE)
# include_directories(${FCL_INSTALL_PREFIX}/fcl/include)

add_subdirectory(amgcl)

set(AMGCL_INCLUDE_PATH "${PROJECT_SOURCE_DIR}/extern/amgcl" PARENT_SCOPE)
set(LIBIGL_INCLUDE_PATH "${PROJECT_SOURCE_DIR}/extern/libigl/include" PARENT_SCOPE)

set(DISCREGRID_BUILD_PATH "${CMAKE_BINARY_DIR}/${CMAKE_BUILD_TYPE}/lib/Discregrid")
set(DISCREGRID_INSTALL_PREFIX ${DISCREGRID_BUILD_PATH})
ExternalProject_Add(Discregrid
	PREFIX ${DISCREGRID_INSTALL_PREFIX}
	SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/Discregrid
    CMAKE_ARGS
     -DCMAKE_C_COMPILER=${CMAKE_C_COMPILER}
     -DCMAKE_CXX_COMPILER=${CMAKE_CXX_COMPILER}
	 -DCMAKE_INSTALL_PREFIX:PATH=${DISCREGRID_BUILD_PATH}
     -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
     -DCMAKE_BUILD_RPATH_USE_ORIGIN=ON
)
set(DISCREGRID_INCLUDE_PATH "${DISCREGRID_BUILD_PATH}/include" CACHE FILEPATH "" FORCE)
set(DISCREGRID_LIBRARY ${DISCREGRID_BUILD_PATH}/lib/libDiscregrid.a CACHE FILEPATH "" FORCE)

